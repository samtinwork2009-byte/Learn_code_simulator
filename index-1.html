<!DOCTYPE html><html lang="zh-TW"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="互動式編程學習環境，支援 HTML、CSS、JavaScript、Python、Java、PHP 等多種語言，提供前後端 API 模擬器">
    <meta name="keywords" content="編程學習,代碼編輯器,API模擬器,前端開發,後端開發,程式教學">
    <meta name="author" content="Sam. T">
    <meta name="theme-color" content="#1e1e1e">
    <title>編程語言模擬器及學習平台 | 互動式代碼編輯與 API 模擬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&amp;family=Courier+Prime:wght@400;700&amp;family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            /* 专业IDE配色 - 参考VS Code Dark+ */
            --primary: #4ec9b0;        /* Teal青色 - 主要强调色 */
            --secondary: #569cd6;      /* Blue蓝色 - 次要强调色 */
            --accent: #ce9178;         /* 橙色 - 强调色 */
            --dark-bg: #1e1e1e;        /* VS Code深灰背景 */
            --darker-bg: #1a1a1a;      /* 更深的背景 */
            --card-bg: #252526;        /* 卡片背景 */
            --text: #d4d4d4;           /* VS Code浅灰文字 */
            --text-gray: #858585;      /* 次要文字 */
            --success: #4ec9b0;        /* 成功绿色 */
            --error: #f48771;          /* 错误红色 */
            --warning: #dcdcaa;        /* 警告黄色 */
            --border: #000000;         /* 纯黑色边框 - 专业感 */
            --sidebar-bg: #252526;     /* 侧边栏背景 */
            --input-bg: #3c3c3c;       /* 输入框背景 */
            --hover-bg: #2a2d2e;       /* 悬停背景 */
            --active-bg: #37373d;      /* 激活背景 */
            --glow-primary: rgba(78, 201, 176, 0.2);
            --glow-secondary: rgba(86, 156, 214, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            overflow-x: hidden;
            /* 極細網格背景效果 */
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 217, 255, 0.05) 2px, rgba(0, 217, 255, 0.05) 3px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0, 217, 255, 0.05) 2px, rgba(0, 217, 255, 0.05) 3px),
                radial-gradient(circle at 15% 15%, rgba(0, 217, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 85% 85%, rgba(124, 58, 237, 0.03) 0%, transparent 50%);
            /* 移动端优化 */
            font-size: 16px;
            /* 性能优化 - 启用硬件加速 */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 移动端字体和布局优化 */
        @media (max-width: 768px) {
            body {
                font-size: 17px; /* 增大基础字体 */
            }
            h1 {
                font-size: 2rem !important;
            }
            h2 {
                font-size: 1.6rem !important;
            }
            h3 {
                font-size: 1.35rem !important;
            }
            p {
                font-size: 1.05rem; /* 增大段落文字 */
                line-height: 1.6;
            }
            .btn {
                font-size: 17px !important;
                padding: 14px 26px !important;
                min-height: 44px; /* 确保触控区域足够大 */
            }
            .code-input, #freeCodeEditor {
                font-size: 16px !important;
                line-height: 1.5;
            }
            .editor-tool-btn {
                font-size: 15px !important;
                padding: 8px 12px !important;
                min-height: 40px;
            }
            .category-grid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            .category-card {
                padding: 40px 30px !important;
            }
            .category-card h3 {
                font-size: 1.6rem !important;
            }
            .category-card p {
                font-size: 1.1rem !important;
            }
            .page {
                padding: 20px 15px !important;
            }
            /* 导航和状态栏文字 */
            .lang-tab {
                font-size: 15px !important;
                padding: 14px 20px !important;
            }
            /* 工具提示和小文字 */
            small, .small-text {
                font-size: 0.95rem !important;
            }
        }

        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            body {
                font-size: 16px;
            }
            h1 {
                font-size: 1.8rem !important;
            }
            .category-card {
                padding: 30px 20px !important;
            }
        }

        h1, h2, h3, h4 {
            font-family: 'Courier Prime', 'Courier New', monospace;
            font-weight: 700;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page {
            display: none;
            min-height: 100vh;
            padding: 40px 20px;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-15px);
            }
        }

        @keyframes orbit1 {
            0% {
                transform: rotate(0deg) translateX(50px) rotate(0deg);
            }
            100% {
                transform: rotate(360deg) translateX(50px) rotate(-360deg);
            }
        }

        @keyframes orbit2 {
            0% {
                transform: rotate(120deg) translateX(50px) rotate(-120deg);
            }
            100% {
                transform: rotate(480deg) translateX(50px) rotate(-480deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
            50% {
                opacity: 0.6;
                transform: translateX(-50%) scale(1.1);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 滚动性能优化 - 所有滚动区域应用这些优化 */
        .optimized-scroll {
            overflow-y: auto;
            /* 启用硬件加速 */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            /* 优化滚动性能 */
            will-change: scroll-position;
            /* 平滑滚动 */
            -webkit-overflow-scrolling: touch;
            /* 优化渲染层 */
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* 滚动条样式优化 */
        .optimized-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .optimized-scroll::-webkit-scrollbar-track {
            background: var(--darker-bg);
            border-radius: 4px;
        }

        .optimized-scroll::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .optimized-scroll::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* 可折叠侧边栏 */
        .collapsible-sidebar {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .collapsible-sidebar.collapsed {
            width: 0 !important;
            min-width: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
        }

        .collapsible-sidebar.collapsed > *:not(.sidebar-toggle-btn) {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar-toggle-btn {
            position: absolute;
            top: 20px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: var(--primary);
            border: 2px solid var(--card-bg);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .sidebar-toggle-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(78, 201, 176, 0.4);
        }

        .collapsed .sidebar-toggle-btn {
            right: -35px;
        }

        /* 性能优化：减少动画重绘 */
        .performance-optimized {
            contain: layout style paint;
            content-visibility: auto;
        }

        .btn {
            display: inline-block;
            padding: 14px 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px var(--glow-primary), 0 0 20px var(--glow-primary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: rgba(0, 217, 255, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hero {
            text-align: center;
            padding: 80px 20px 60px;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            margin-bottom: 24px;
            line-height: 1.2;
        }

        .hero-intro {
            font-size: clamp(1rem, 2vw, 1.3rem);
            color: var(--text-gray);
            max-width: 800px;
            margin: 0 auto 50px;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 80px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            margin-top: 60px;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 50px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.4s;
            z-index: -1;
        }

        .category-card:hover::before {
            opacity: 1;
        }

        .category-card:hover {
            transform: translateY(-10px);
            border-color: transparent;
        }

        .category-icon {
            font-size: 64px;
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .category-card h3 {
            font-size: 1.8rem;
            margin-bottom: 16px;
        }

        .category-card p {
            color: var(--text-gray);
            line-height: 1.6;
        }

        .language-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .language-tag {
            padding: 6px 16px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 20px;
            font-size: 14px;
            color: var(--primary);
        }

        .mode-selection {
            max-width: 900px;
            margin: 60px auto;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .mode-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
        }

        .mode-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(0, 217, 255, 0.2);
        }

        .mode-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .mode-card h3 {
            font-size: 1.6rem;
            margin-bottom: 12px;
        }

        .mode-card p {
            color: var(--text-gray);
            line-height: 1.6;
        }

        /* 關卡選擇 */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .level-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
            position: relative;
        }

        .level-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.2);
        }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .level-card.completed {
            border-color: var(--success);
        }

        .level-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .level-title {
            font-size: 1rem;
            color: var(--text-gray);
            margin-bottom: 5px;
        }

        .level-status {
            font-size: 0.9rem;
            color: var(--success);
            margin-top: 10px;
        }

        /* 題目顯示 */
        .quiz-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .quiz-progress {
            font-size: 1.1rem;
            color: var(--primary);
        }

        .quiz-type-badge {
            padding: 8px 20px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid var(--primary);
            border-radius: 20px;
            font-size: 14px;
            color: var(--primary);
        }

        .question-content {
            margin-bottom: 30px;
        }

        .question-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text);
        }

        .question-desc {
            font-size: 1.1rem;
            color: var(--text-gray);
            line-height: 1.8;
            margin-bottom: 25px;
        }

        .options-grid {
            display: grid;
            gap: 15px;
            margin-top: 25px;
        }

        .option-card {
            background: rgba(0, 217, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option-card:hover {
            border-color: var(--primary);
            background: rgba(0, 217, 255, 0.1);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(0, 217, 255, 0.15);
        }

        .option-card.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .option-card.wrong {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-card.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-letter {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
            font-size: 1.1rem;
        }

        .code-input {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            background: var(--darker-bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            outline: none;
            line-height: 1.6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .code-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px var(--primary), 0 0 20px rgba(0, 217, 255, 0.15);
        }

        .quiz-actions {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-top: 30px;
        }

        .result-display {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
        }

        .result-score {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
        }

        .result-message {
            font-size: 1.3rem;
            color: var(--text-gray);
            margin-bottom: 30px;
        }

        .stars {
            font-size: 3rem;
            color: var(--warning);
            margin: 20px 0;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .back-btn:hover {
            border-color: var(--primary);
            transform: translateX(-5px);
        }

        /* 標籤篩選按鈕 */
        .tag-filter-btn {
            padding: 8px 16px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 20px;
            color: var(--primary);
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-filter-btn:hover {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .tag-filter-btn.active {
            background: var(--primary);
            color: var(--dark-bg);
            border-color: var(--primary);
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            border: 1px solid var(--border);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text);
            font-size: 28px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .flowchart {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: rgba(0, 217, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .flow-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            min-width: 50px;
        }

        .flow-content h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }

        .flow-content p {
            color: var(--text-gray);
            line-height: 1.6;
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* 脈衝動畫 - 用於錯誤提示和成功狀態 */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 10px currentColor;
            }
            50% {
                opacity: 0.7;
                box-shadow: 0 0 20px currentColor;
            }
        }

        /* 發光邊框動畫 - 代碼執行成功時 */
        @keyframes glowBorder {
            0%, 100% {
                box-shadow: 0 0 5px var(--glow-primary), 0 0 10px var(--glow-primary);
            }
            50% {
                box-shadow: 0 0 15px var(--glow-primary), 0 0 30px var(--glow-primary);
            }
        }

        .glow-success {
            animation: glowBorder 1.5s ease-in-out;
        }

        /* 🎯 一站式平台動畫 */
        @keyframes fadeInAnim {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOutAnim {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slideUpAnim {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes bounceAnim {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes progressAnim {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        /* 標籤切���樣式 */
        .preview-tab {
            position: relative;
        }

        .preview-tab:hover {
            background: rgba(0, 217, 255, 0.05);
            color: var(--text) !important;
        }

        .preview-tab.active {
            color: var(--primary) !important;
            border-bottom-color: var(--primary) !important;
        }

        .preview-panel {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .preview-panel.active {
            opacity: 1;
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-switch {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 24px;
        }

        .slider-switch:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider-switch {
            background-color: var(--primary);
        }

        input:checked + .slider-switch:before {
            transform: translateX(26px);
        }

        /* 編輯器工具按鈕 */
        .editor-tool-btn {
            padding: 6px 12px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 11px;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .editor-tool-btn:hover {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-1px);
        }

        .editor-tool-btn i {
            font-size: 10px;
        }

        /* 圖標按鈕樣式 */
        .icon-btn {
            padding: 4px 8px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            font-size: 12px;
        }

        .icon-btn:hover {
            background: rgba(0, 217, 255, 0.1);
            color: var(--primary);
        }

        /* 文件標籤樣式（專業IDE風格） */
        .file-tab {
            padding: 10px 16px;
            background: var(--darker-bg);
            border-right: 1px solid var(--border);
            cursor: pointer;
            min-width: 120px;
            height: 40px;
            position: relative;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            color: var(--text-gray);
        }

        .file-tab:hover {
            background: var(--hover-bg);
            color: var(--text);
        }

        .file-tab.active-tab {
            background: var(--card-bg);
            color: var(--text);
            border-bottom: 2px solid var(--primary);
        }

        .file-tab .file-modified {
            margin-left: auto;
        }

        /* 文件項目樣式 */
        .file-item {
            padding: 8px 12px;
            margin: 2px 4px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            font-size: 13px;
            color: var(--text);
            position: relative;
        }

        .file-item:hover {
            background: rgba(0, 217, 255, 0.08);
        }

        .file-item.active {
            background: rgba(0, 217, 255, 0.15);
            border-left: 3px solid var(--primary);
        }

        .file-item .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-item .file-actions {
            display: none;
            gap: 4px;
        }

        .file-item:hover .file-actions {
            display: flex;
        }

        /* 標籤頁樣式 */
        .file-tab {
            padding: 10px 16px;
            background: var(--darker-bg);
            border: none;
            border-right: 1px solid var(--border);
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            font-family: 'Fira Code', monospace;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            position: relative;
        }

        .file-tab:hover {
            background: rgba(0, 217, 255, 0.05);
            color: var(--text);
        }

        .file-tab.active {
            background: var(--card-bg);
            color: var(--primary);
            border-top: 2px solid var(--primary);
        }

        .file-tab .close-tab {
            opacity: 0;
            margin-left: 8px;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .file-tab:hover .close-tab {
            opacity: 1;
        }

        .file-tab .close-tab:hover {
            background: rgba(255, 71, 87, 0.2);
            color: var(--error);
        }

        /* 搜索面板樣式 */
        .search-panel {
            position: absolute;
            top: 50px;
            right: 20px;
            width: 350px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .search-panel.active {
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 10px 14px;
            background: var(--darker-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-options {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .search-option {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-gray);
        }

        /* 自定義對話框樣式 */
        .custom-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .custom-modal.active {
            display: flex;
        }

        .custom-modal-content {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid var(--border);
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .custom-modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .custom-modal-message {
            color: var(--text);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .custom-modal-input {
            width: 100%;
            padding: 10px 14px;
            background: var(--darker-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .custom-modal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .custom-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* 版權信息樣式 */
        .copyright-section {
            margin-top: 80px;
            padding: 40px 20px;
            border-top: 2px solid var(--border);
            text-align: center;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 217, 255, 0.03) 100%);
        }

        .copyright-section p {
            color: var(--text-gray);
            font-size: 14px;
            line-height: 2;
            margin: 8px 0;
        }

        .copyright-section .creator {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .copyright-section .shield-icon {
            color: var(--warning);
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: 1fr;
            }

            .mode-grid {
                grid-template-columns: 1fr;
            }

            .level-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .quiz-header {
                flex-direction: column;
                gap: 15px;
            }

            /* 自由模式在移動設備上垂直堆疊 */
            #freePage > .container > div:last-child {
                flex-direction: column !important;
                height: auto !important;
            }

            #freePage > .container > div:last-child > div {
                flex: 1 1 auto !important;
                min-height: 300px;
            }

            /* Git 模擬器頁面佈局修復 */
            #githubSimulatorPage .container > div[style*="grid-template-columns: 350px 1fr"] {
                grid-template-columns: 1fr !important; /* 變為單欄佈局 */
                gap: 0 !important; /* 移除間距 */
            }

            #githubSimulatorPage #gitSidebar {
                width: 100% !important; /* 側邊欄佔滿寬度 */
                min-width: 100% !important;
                padding: 15px !important;
                border-right: none !important;
                border-bottom: 1px solid var(--border) !important;
            }

            #githubSimulatorPage #gitSidebar .sidebar-toggle-btn {
                display: none !important; /* 在手機版隱藏折疊按鈕 */
            }

            /* 提交歷史和終端輸出也變為單欄 */
            #githubSimulatorPage .container > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            /* 確保文字內容不會被遮擋，特別是提交歷史中的文字 */
            #gitCommitHistory p {
                word-break: break-word;
            }

            .copyright-section {
                margin-top: 60px;
                padding: 30px 15px;
            }

            .copyright-section p {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 返回導航按鈕 -->
    <button class="back-btn" id="backBtn" style="display: none;" aria-label="返回主頁">
        <i class="fas fa-arrow-left" aria-hidden="true"></i> 返回
    </button>

    <!-- 主頁 -->
    <div class="page active" id="homePage" role="main">
        <div class="container">
            <div class="hero">
                <!-- 科技感編程icon -->
                <div style="text-align: center; margin-bottom: 30px; animation: float 3s ease-in-out infinite;">
                    <div style="display: inline-block; position: relative;">
                        <i class="fas fa-laptop-code" style="font-size: 80px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px var(--glow-primary));"></i>
                        <!-- 環繞的小圖標 -->
                        <i class="fas fa-code" style="position: absolute; top: -10px; left: -15px; font-size: 24px; color: var(--primary); animation: orbit1 4s linear infinite;"></i>
                        <i class="fas fa-terminal" style="position: absolute; top: -10px; right: -15px; font-size: 24px; color: var(--secondary); animation: orbit2 4s linear infinite;"></i>
                        <i class="fas fa-brackets-curly" style="position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); font-size: 24px; color: var(--primary); animation: pulse 2s ease-in-out infinite;"></i>
                    </div>
                </div>
                <h1 class="gradient-text">編程語言模擬器及學習平台</h1>
                <p class="hero-intro">
                    歡迎來到互動式編程學習環境！在這裡自由編寫代碼，實時運行並查看結果。
                    支援多種前端與後端編程語言，提供即時語法檢測和代碼提示，讓您在自由探索中學習成長。
                </p>

                <div class="hero-buttons">
                    <button class="btn" id="guideBtn">
                        <i class="fas fa-book-open"></i> 平台使用操作指南
                    </button>
                    <button class="btn btn-outline" id="flowchartBtn">
                        <i class="fas fa-sitemap"></i> 快速入門流程圖
                    </button>
                </div>
            </div>

            <h2 style="text-align: center; font-size: 2rem; margin-bottom: 20px;">選擇編程語言開始學習</h2>
            <p style="text-align: center; color: var(--text-gray); font-size: 1.1rem; margin-bottom: 40px;">
                在自由模式中編寫代碼，�����������時查看運行結果
            </p>

            <h3 style="text-align: center; font-size: 1.5rem; margin-bottom: 30px; color: var(--primary);">前端語言</h3>
            <div class="category-grid" style="margin-bottom: 60px;">
                <div class="category-card" data-language="html" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-html5"></i>
                    </div>
                    <h3>HTML</h3>
                    <p>超文本標記語言，網頁結構的基礎</p>
                </div>

                <div class="category-card" data-language="css" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-css3-alt"></i>
                    </div>
                    <h3>CSS</h3>
                    <p>層疊樣式表，網頁美化的利器</p>
                </div>

                <div class="category-card" data-language="javascript" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-js"></i>
                    </div>
                    <h3>JavaScript</h3>
                    <p>動態腳本語言，實現互動效果</p>
                </div>
            </div>

            <h3 style="text-align: center; font-size: 1.5rem; margin-bottom: 30px; color: var(--secondary);">後端語言</h3>
            <div class="category-grid" style="margin-bottom: 60px;">
                <div class="category-card" data-language="python" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-python"></i>
                    </div>
                    <h3>Python</h3>
                    <p>簡潔優雅的通用編程語言</p>
                </div>

                <div class="category-card" data-language="java" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-java"></i>
                    </div>
                    <h3>Java</h3>
                    <p>跨平台的企業級編程語言</p>
                </div>

                <div class="category-card" data-language="php" data-mode="free">
                    <div class="category-icon">
                        <i class="fab fa-php"></i>
                    </div>
                    <h3>PHP</h3>
                    <p>Web開發的服務器端腳本語言</p>
                </div>
            </div>

            <h3 style="text-align: center; font-size: 1.5rem; margin-bottom: 30px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">前後端整合</h3>
            <div class="category-grid" style="margin-bottom: 60px;">
                <div class="category-card" id="apiSimulatorCard" style="cursor: pointer; background: linear-gradient(135deg, rgba(78, 201, 176, 0.1), rgba(86, 156, 214, 0.1)); border: 2px solid var(--primary); grid-column: 1 / -1;">
                    <div class="category-icon" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <h3 style="font-size: 1.8rem;">前後端 API 模擬器</h3>
                    <p style="font-size: 1.1rem;">體驗完整的前後端交互流程：虛擬 API、數據庫模擬、玩家數據管理</p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: var(--primary); font-size: 0.95rem;">
                            <i class="fas fa-key"></i> API Key 管理
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: var(--primary); font-size: 0.95rem;">
                            <i class="fas fa-database"></i> 模擬數據庫
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: var(--primary); font-size: 0.95rem;">
                            <i class="fas fa-gamepad"></i> 遊戲進度存儲
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: var(--primary); font-size: 0.95rem;">
                            <i class="fas fa-exchange-alt"></i> ���後端通信
                        </span>
                    </div>
                </div>

                <!-- GitHub 風格版本控制模擬器 -->
                <div class="category-card" id="githubSimulatorCard" style="cursor: pointer; background: linear-gradient(135deg, rgba(167, 113, 247, 0.1), rgba(78, 201, 176, 0.1)); border: 2px solid #a371f7; grid-column: 1 / -1;">
                    <div class="category-icon" style="color: #a371f7;">
                        <i class="fab fa-github"></i>
                    </div>
                    <h3 style="font-size: 1.8rem;">GitHub 版本控制模擬器</h3>
                    <p style="font-size: 1.1rem;">完整模擬 Git 工作流程：提交、分支、合併、Pull Request 協作開發</p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: #a371f7; font-size: 0.95rem;">
                            <i class="fas fa-code-branch"></i> 分支管理
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: #a371f7; font-size: 0.95rem;">
                            <i class="fas fa-save"></i> 提交歷史
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: #a371f7; font-size: 0.95rem;">
                            <i class="fas fa-users"></i> 協作開發
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 8px; color: #a371f7; font-size: 0.95rem;">
                            <i class="fas fa-code-merge"></i> Pull Request
                        </span>
                    </div>
                </div>

                <!-- 新增流程指引按鈕 -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 60px;">
                    <button onclick="showGuide('apiGuide')" style="padding: 20px; background: linear-gradient(135deg, rgba(78, 201, 176, 0.15), rgba(86, 156, 214, 0.15)); border: 2px solid var(--primary); border-radius: 12px; color: var(--text); cursor: pointer; transition: all 0.3s; font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 12px;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(78, 201, 176, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <i class="fas fa-book-open" style="font-size: 1.3rem; color: var(--primary);"></i>
                        <span>前後端API結合流程步驟指引</span>
                    </button>

                    <button onclick="showGuide('githubGuide')" style="padding: 20px; background: linear-gradient(135deg, rgba(167, 113, 247, 0.15), rgba(78, 201, 176, 0.15)); border: 2px solid #a371f7; border-radius: 12px; color: var(--text); cursor: pointer; transition: all 0.3s; font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 12px;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(167, 113, 247, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <i class="fab fa-github" style="font-size: 1.3rem; color: #a371f7;"></i>
                        <span>Github 模擬開發儲存庫操作流程</span>
                    </button>
                </div>
            </div>

            <!-- 版權信息區域 -->
            <div class="copyright-section">
                <p class="creator">
                    <i class="fas fa-code"></i> Create By <strong>Sam. T</strong>
                </p>
                <p>
                    <i class="shield-icon fas fa-shield-alt"></i>
                    Copyright © 2025 Sam. T. All rights reserved.
                </p>
                <p>版權所有 © 2025 Sam. T</p>
                <p style="font-size: 12px; opacity: 0.8; margin-top: 12px;">
                    此平台已受版權保護 | 本平台僅供學習交流使用
                </p>
            </div>
        </div>
    </div>

    <!-- 前後端API結合流程步驟指引頁面 -->
    <div class="page" id="apiGuidePage" style="display: none;">
        <div class="container" style="max-width: 1400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
                <h1 class="gradient-text" style="font-size: 2.5rem; margin: 0;">
                    <i class="fas fa-book-open"></i> 前後端API結合流程步驟指引
                </h1>
                <button onclick="showPage('home')" class="btn btn-outline" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-home"></i> 返回主頁
                </button>
            </div>

            <!-- 應用簡介 -->
            <div style="background: linear-gradient(135deg, rgba(78, 201, 176, 0.15), rgba(86, 156, 214, 0.15)); border: 2px solid var(--primary); border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(78, 201, 176, 0.2);">
                <h2 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 20px; text-align: center;">
                    <i class="fas fa-info-circle"></i> 前後端 API 模擬器是什麼？
                </h2>
                <p style="color: var(--text); line-height: 1.9; font-size: 1.1rem; text-align: justify;">
                    <strong style="color: var(--primary);">前後端 API 模擬器</strong>是一個完整的學習環境，讓您在純前端環境中體驗真實的<strong>前後端分離開發流程</strong>。它模擬了完整的 Web 應用架構，包括：
                </p>
                <ul style="color: var(--text-gray); line-height: 1.9; font-size: 1.05rem; margin-top: 15px; margin-left: 30px;">
                    <li><strong style="color: var(--primary);">虛擬後端 API 服務器</strong>：支持 RESTful API 端點，處理 HTTP 請求（GET、POST、PUT、DELETE）</li>
                    <li><strong style="color: var(--secondary);">模擬數據庫系統</strong>：內存數據庫，支持完整的 CRUD（創建、讀取、更新、刪除）操作</li>
                    <li><strong style="color: var(--success);">前端請求處理</strong>：真實的 HTTP 請求發送與響應處理，包含狀態碼、響應頭、JSON 數據</li>
                    <li><strong style="color: var(--warning);">API 認證機制</strong>：API Key 和 JWT Token 認證模擬，體驗真實的安全認證流程</li>
                    <li><strong style="color: #8b5cf6);">實時監控系統</strong>：可視化數據流、請求日誌、狀態監控，完整追蹤每個請求的生命週期</li>
                </ul>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid var(--primary);">
                    <p style="color: var(--text); font-size: 1.05rem; line-height: 1.8; margin: 0;">
                        <i class="fas fa-lightbulb" style="color: var(--warning);"></i> <strong>核心價值：</strong>無需安裝任何後端環境（Node.js、Python、PHP 等），無需配置數據庫，即可完整體驗前後端協作開發的全流程，是學習 Web 開發、API 設計、前後端通信的理想工具！
                    </p>
                </div>
            </div>

            <p style="text-align: center; color: var(--text-gray); margin-bottom: 40px; font-size: 1.1rem;">
                完整的前後端API整合開發流程 • 從規劃到部署的詳細步驟指南
            </p>

            <!-- HTTP請求完整生命週期流程圖 -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); border: 2px solid #3b82f6; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #3b82f6; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-route"></i> HTTP 請求完整生命週期
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #3b82f6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">1</div>
                            <h3 style="color: #3b82f6; margin: 0; font-size: 1.2rem;">📤 前端發送 HTTP 請求</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>使用者觸發操作（點擊按鈕、提交表單等）</li>
                            <li>前端 JavaScript 調用 fetch() 或 axios</li>
                            <li>組裝請求：URL、HTTP方法(GET/POST/PUT/DELETE)、Headers、Body</li>
                            <li>瀏覽器通過網絡層發送請求到伺服器</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #10b981; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">2</div>
                            <h3 style="color: #10b981; margin: 0; font-size: 1.2rem;">🔒 中間件處理（Middleware）</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li><strong>CORS 檢查：</strong>驗證跨域請求是否允許</li>
                            <li><strong>身份驗證：</strong>檢查 JWT Token 或 Session</li>
                            <li><strong>API Key 驗證：</strong>確認請求攜帶有效的 API Key</li>
                            <li><strong>請求日誌：</strong>記錄請求時間、來源、端點等資訊</li>
                            <li><strong>速率限制：</strong>防止API濫用，限制請求頻率</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #f59e0b; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">3</div>
                            <h3 style="color: #f59e0b; margin: 0; font-size: 1.2rem;">🛤️ 路由匹配與控制器</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>根據 HTTP 方法和 URL 路徑匹配對應的路由</li>
                            <li>例如：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">POST /api/login</code> → 登入控制器</li>
                            <li>路由器將請求轉發到對應的處理函數（Controller）</li>
                            <li>解析請求參數（URL參數、Query參數、Body數據）</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #8b5cf6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">4</div>
                            <h3 style="color: #8b5cf6; margin: 0; font-size: 1.2rem;">⚙️ 業務邏輯處理</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>驗證輸入數據（數據格式、必填欄位、數據範圍）</li>
                            <li>執行核心業務邏輯（計算、轉換、驗證等）</li>
                            <li>調用服務層（Service Layer）處理複雜邏輯</li>
                            <li>錯誤處理：捕獲異常並返回適當的錯誤訊息</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ec4899;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #ec4899; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">5</div>
                            <h3 style="color: #ec4899; margin: 0; font-size: 1.2rem;">💾 數據庫操作</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>建立數據庫連接（Connection Pool）</li>
                            <li>執行 CRUD 操作：
                                <ul style="margin-top: 8px;">
                                    <li><strong>Create:</strong> INSERT 新數據</li>
                                    <li><strong>Read:</strong> SELECT 查詢數據</li>
                                    <li><strong>Update:</strong> UPDATE 更新數據</li>
                                    <li><strong>Delete:</strong> DELETE 刪除數據</li>
                                </ul>
                            </li>
                            <li>使用 ORM/ODM 簡化數據庫操作（Sequelize、Mongoose等）</li>
                            <li>事務處理：確保數據一致性</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #06b6d4;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #06b6d4; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">6</div>
                            <h3 style="color: #06b6d4; margin: 0; font-size: 1.2rem;">📦 組裝 HTTP 響應</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>設置 HTTP 狀態碼：
                                <ul style="margin-top: 8px;">
                                    <li>200 OK - 成功</li>
                                    <li>201 Created - 資源創建成功</li>
                                    <li>400 Bad Request - 請求參數錯誤</li>
                                    <li>401 Unauthorized - 未授權</li>
                                    <li>404 Not Found - 資源不存在</li>
                                    <li>500 Internal Server Error - 伺服器錯誤</li>
                                </ul>
                            </li>
                            <li>設置響應 Headers（Content-Type、CORS等）</li>
                            <li>序列化響應數據為 JSON 格式</li>
                            <li>發送響應回前端</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #14b8a6;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #14b8a6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">7</div>
                            <h3 style="color: #14b8a6; margin: 0; font-size: 1.2rem;">📥 前端接收與處理響應</h3>
                        </div>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 55px;">
                            <li>接收伺服器響應數據</li>
                            <li>檢查響應狀態碼，判斷請求成功或失敗</li>
                            <li>解析 JSON 響應數據</li>
                            <li>更新 UI 界面：
                                <ul style="margin-top: 8px;">
                                    <li>成功：顯示數據、更新狀態、顯示成功提示</li>
                                    <li>失敗：顯示錯誤訊息、回滾操作</li>
                                </ul>
                            </li>
                            <li>錯誤處理：網絡錯誤、超時、伺服器錯誤等</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 詳細操作流程步驟 -->
            <div style="background: linear-gradient(135deg, rgba(78, 201, 176, 0.1), rgba(86, 156, 214, 0.1)); border: 2px solid var(--primary); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-list-ol"></i> 前後端API結合開發流程步驟
                </h2>

                <p style="color: var(--text-gray); text-align: center; margin-bottom: 30px; font-size: 1.05rem;">
                    以下為完整的前後端整合開發流程，從需求分析到部署上線的每個關鍵步驟
                </p>

                <!-- 步驟 1: 需求分析與API設計 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #3b82f6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">1</div>
                        <h3 style="color: #3b82f6; margin: 0; font-size: 1.4rem;">需求分析與 API 設計</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>明確前後端功能需求，設計清晰的 API 接口規範
                        </p>

                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 具體步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>確定功能需求</strong>：列出所有需要實現的功能（用戶登錄、數據查詢、文件上傳等）</li>
                                <li><strong>規劃數據結構</strong>：設計數據庫表結構，確定實體關係（ER圖）</li>
                                <li><strong>定義 API 端點</strong>：為每個功能設計對應的 API 路由
                                    <ul style="margin-top: 8px; margin-left: 20px;">
                                        <li>例如：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">POST /api/auth/login</code> - 用戶登錄</li>
                                        <li>例如：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">GET /api/users/:id</code> - 獲取用戶信息</li>
                                    </ul>
                                </li>
                                <li><strong>編寫 API 文檔</strong>：詳細記錄每個端點的請求方法、參數、響應格式</li>
                                <li><strong>確定認證方案</strong>：選擇 JWT、Session、OAuth 等認證方式</li>
                            </ol>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> Swagger/OpenAPI、Postman、Draw.io（流程圖）、Figma（原型設計）</span>
                        </div>
                    </div>
                </div>

                <!-- 步驟 2: 後端API開發 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #10b981; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">2</div>
                        <h3 style="color: #10b981; margin: 0; font-size: 1.4rem;">後端 API 開發與實現</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>實現後端業務邏輯、數據庫操作、API 端點
                        </p>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #10b981; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 具體步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>環境搭建</strong>：安裝 Node.js/Python/PHP 等後端框架（Express、Django、Laravel）</li>
                                <li><strong>數據庫配置</strong>：連接 MySQL/MongoDB/PostgreSQL，創建數據表</li>
                                <li><strong>實現路由控制器</strong>：編寫處理 HTTP 請求的函數
                                    <pre style="background: var(--darker-bg); padding: 10px; border-radius: 6px; margin-top: 8px; overflow-x: auto;"><code style="color: #10b981;">// Express 示例
app.post('/api/login', async (req, res) =&gt; {
    const { username, password } = req.body;
    // 驗證邏輯...
    res.json({ success: true, token: '...' });
});</code></pre>
                                </li>
                                <li><strong>實現中間件</strong>：身份驗證、CORS 配置、錯誤處理、請求日誌</li>
                                <li><strong>數據驗證</strong>：使用 Joi、Yup 等庫驗證輸入數據</li>
                                <li><strong>錯誤處理</strong>：統一的錯誤響應格式（狀態碼、錯誤訊息）</li>
                            </ol>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> Express.js、Nest.js、Django REST、Laravel、Postman（API 測試）</span>
                        </div>
                    </div>
                </div>

                <!-- 步驟 3: 前端開發與API調用 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #f59e0b; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #f59e0b; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">3</div>
                        <h3 style="color: #f59e0b; margin: 0; font-size: 1.4rem;">前端開發與 API 調用</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>構建前端界面，實現與後端的數據交互
                        </p>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 具體步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>構建 UI 界面</strong>：使用 React/Vue/Angular 或原生 HTML/CSS/JS</li>
                                <li><strong>配置 API 服務</strong>：創建統一的 API 請求服務層
                                    <pre style="background: var(--darker-bg); padding: 10px; border-radius: 6px; margin-top: 8px; overflow-x: auto;"><code style="color: #f59e0b;">// Axios API 服務示例
const api = axios.create({
    baseURL: 'https://api.example.com',
    headers: { 'Authorization': `Bearer ${token}` }
});

api.post('/api/login', { username, password })
    .then(res =&gt; console.log(res.data))
    .catch(err =&gt; console.error(err));</code></pre>
                                </li>
                                <li><strong>實現請求攔截器</strong>：自動添加 Token、處理錯誤響應</li>
                                <li><strong>狀態管理</strong>：使用 Redux/Vuex/Pinia 管理全局狀態</li>
                                <li><strong>Loading 與錯誤處理</strong>：顯示加載動畫、友好的錯誤提示</li>
                                <li><strong>數據緩存</strong>：避免重複請求，提升性能</li>
                            </ol>
                        </div>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <strong style="color: #f59e0b;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> Axios、Fetch API、React Query、SWR、Redux Toolkit</span>
                        </div>
                    </div>
                </div>

                <!-- 步驟 4: 調試與測試 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #8b5cf6; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #8b5cf6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">4</div>
                        <h3 style="color: #8b5cf6; margin: 0; font-size: 1.4rem;">調試、除錯與測試</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>確保前後端交互正常，發現並修復潛在問題
                        </p>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #8b5cf6; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 具體步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>後端 API 測試</strong>：
                                    <ul style="margin-top: 8px; margin-left: 20px;">
                                        <li>使用 <strong>Postman</strong> 或 <strong>Insomnia</strong> 測試每個 API 端點</li>
                                        <li>驗證各種請求參數和場景（正常、異常、邊界值）</li>
                                        <li>檢查響應狀態碼、數據格式、錯誤處理</li>
                                    </ul>
                                </li>
                                <li><strong>前端調試</strong>：
                                    <ul style="margin-top: 8px; margin-left: 20px;">
                                        <li>使用 <strong>Chrome DevTools</strong> 的 Network 面板查看 HTTP 請求</li>
                                        <li>檢查請求頭、請求體、響應數據</li>
                                        <li>使用 <strong>Console</strong> 查看錯誤日誌</li>
                                        <li>設置斷點調試 JavaScript 代碼</li>
                                    </ul>
                                </li>
                                <li><strong>整合測試</strong>：測試完整的用戶流程（註冊→登錄→操作→登出）</li>
                                <li><strong>CORS 問題處理</strong>：配置後端允許跨域請求</li>
                                <li><strong>錯誤場景測試</strong>：模擬網絡錯誤、服務器錯誤、認證失敗等</li>
                            </ol>
                        </div>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                            <strong style="color: #8b5cf6;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> Postman、Insomnia、Chrome DevTools、Jest、Mocha、Cypress（E2E測試）</span>
                        </div>
                    </div>
                </div>

                <!-- 步驟 5: 部署與上線 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #ec4899;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #ec4899; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">5</div>
                        <h3 style="color: #ec4899; margin: 0; font-size: 1.4rem;">部署與上線運營</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>將應用部署到生產環境，確保穩定運行
                        </p>

                        <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #ec4899; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 具體步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>後端部署</strong>：部署到 AWS、Azure、Heroku、Vercel 等雲平台</li>
                                <li><strong>數據庫遷移</strong>：將本地數據庫遷移到雲端（AWS RDS、MongoDB Atlas）</li>
                                <li><strong>前端部署</strong>：部署到 Netlify、Vercel、GitHub Pages、CDN</li>
                                <li><strong>環境變量配置</strong>：設置生產環境的 API URL、密鑰等敏感信息</li>
                                <li><strong>HTTPS 配置</strong>：啟用 SSL 證書，確保數據傳輸安全</li>
                                <li><strong>監控與日誌</strong>：配置性能監控（New Relic、Sentry）、日誌系統</li>
                                <li><strong>CI/CD 流程</strong>：配置自動化部署（GitHub Actions、Jenkins）</li>
                            </ol>
                        </div>

                        <div style="background: rgba(236, 72, 153, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <strong style="color: #ec4899;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> Docker、Kubernetes、AWS、Vercel、Netlify、GitHub Actions、Nginx</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 注意事項與常見問題 -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid #ef4444; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #ef4444; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-exclamation-triangle"></i> 注意事項與常見問題
                </h2>

                <div style="display: grid; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <h3 style="color: #ef4444; margin-bottom: 12px;"><i class="fas fa-ban"></i> CORS 跨域問題</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>前端請求被瀏覽器攔截，出現 "No 'Access-Control-Allow-Origin' header" 錯誤
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong style="color: #10b981;">解決方案：</strong>在後端配置 CORS 中間件，允許前端域名訪問
                        </p>
                        <pre style="background: var(--darker-bg); padding: 12px; border-radius: 6px; margin-top: 10px; overflow-x: auto;"><code style="color: #10b981;">// Node.js Express 示例
const cors = require('cors');
app.use(cors({
    origin: 'https://your-frontend.com',
    credentials: true
}));</code></pre>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 12px;"><i class="fas fa-key"></i> 認證 Token 過期</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>用戶長時間未操作，Token 過期導致請求失敗
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong style="color: #10b981;">解決方案：</strong>實現 Refresh Token 機制或在攔截器中檢測 401 錯誤自動跳轉登錄頁
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 12px;"><i class="fas fa-database"></i> 數據同步問題</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>前端顯示的數據與後端數據不一致
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong style="color: #10b981;">解決方案：</strong>使用 WebSocket 或輪詢實現實時數據同步；操作成功後立即刷新數據
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 12px;"><i class="fas fa-shield-alt"></i> API 安全性</h3>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong>重要提示：</strong>
                        </p>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 20px; margin-top: 8px;">
                            <li>⚠️ 永遠不要在前端代碼中暴露 API 密鑰或敏感信息</li>
                            <li>⚠️ 對所有用戶輸入進行驗證和清理，防止 SQL 注入</li>
                            <li>⚠️ 使用 HTTPS 加密傳輸，防止中間人攻擊</li>
                            <li>⚠️ 實施速率限制，防止 API 濫用和 DDoS 攻擊</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 總結與建議 -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15)); border: 2px solid #10b981; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);">
                <h2 style="color: #10b981; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-lightbulb"></i> 總結與最佳建議
                </h2>

                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-check-circle"></i> 核心要點總結</h3>
                    <ul style="color: var(--text-gray); line-height: 2; font-size: 1.05rem;">
                        <li>✅ <strong>先設計後開發</strong>：充分的 API 設計和文檔是成功的基礎</li>
                        <li>✅ <strong>前後端分離</strong>：讓前端專注於用戶體驗，後端專注於業務邏輯和數據處理</li>
                        <li>✅ <strong>統一的數據格式</strong>：使用 JSON 作為標準數據交換格式</li>
                        <li>✅ <strong>RESTful 設計原則</strong>：遵循 HTTP 方法語義，使 API 清晰易懂</li>
                        <li>✅ <strong>完善的錯誤處理</strong>：為每種錯誤提供明確的狀態碼和錯誤訊息</li>
                        <li>✅ <strong>安全第一</strong>：認證、授權、數據驗證、HTTPS 缺一不可</li>
                        <li>✅ <strong>持續測試</strong>：在開發過程中不斷測試，而非開發完成後才測試</li>
                    </ul>
                </div>

                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #3b82f6; margin-bottom: 15px;"><i class="fas fa-star"></i> 專業建議</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <strong style="color: #3b82f6;">💡 建議 1：使用 API 管理平台</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                使用 Postman、Swagger、Apifox 等工具管理 API 文檔、進行團隊協作，提升開發效率
                            </p>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;">💡 建議 2：版本控制與 Git 工作流</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                前後端代碼分開管理，使用 Git 進行版本控制，採用 Feature Branch 工作流程，可結合本平台的 <strong>GitHub 版本控制模擬器</strong> 練習
                            </p>
                        </div>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <strong style="color: #f59e0b;">💡 建議 3：建立開發規範</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                統一的代碼風格、命名規範、提交訊息規範，使用 ESLint、Prettier 自動格式化代碼
                            </p>
                        </div>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                            <strong style="color: #8b5cf6;">💡 建議 4：持續學習與實踐</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                利用本平台的 <strong>前後端 API 模擬器</strong> 反復練習前後端交互，理解每個環節的運作原理，在實踐中成長
                            </p>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(16, 185, 129, 0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #10b981;">
                    <p style="color: var(--text); font-size: 1.15rem; line-height: 1.9; margin: 0;">
                        <i class="fas fa-rocket" style="color: #10b981; font-size: 1.5rem; vertical-align: middle;"></i>
                        <strong style="color: #10b981;">記住：</strong>前後端 API 整合是 Web 開發的核心技能。<br>
                        通過不斷實踐和調試，你會掌握從設計到部署的完整流程，成為全棧開發者！
                    </p>
                </div>
            </div>

            <!-- 前後端整合最佳實踐 -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid #10b981; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #10b981; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-star"></i> 前後端整合最佳實踐
                </h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">
                            <i class="fas fa-shield-alt"></i> 安全性
                        </h3>
                        <ul style="color: var(--text-gray); line-height: 1.8;">
                            <li>✓ 使用 HTTPS 加密傳輸</li>
                            <li>✓ 實施 JWT 或 OAuth 身份驗證</li>
                            <li>✓ 驗證和清理所有用戶輸入</li>
                            <li>✓ 防止 XSS、CSRF、SQL Injection</li>
                            <li>✓ 實施 API 速率限制</li>
                            <li>✓ 敏感數據加密存儲</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">
                            <i class="fas fa-tachometer-alt"></i> 性能優化
                        </h3>
                        <ul style="color: var(--text-gray); line-height: 1.8;">
                            <li>✓ 使用 CDN 加速靜態資源</li>
                            <li>✓ 實施數據庫索引和查詢優化</li>
                            <li>✓ 使用 Redis 緩存熱點數據</li>
                            <li>✓ 壓縮響應數據（Gzip）</li>
                            <li>✓ 分頁查詢大量數據</li>
                            <li>✓ 實施懶加載和虛擬滾動</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">
                            <i class="fas fa-exclamation-triangle"></i> 錯誤處理
                        </h3>
                        <ul style="color: var(--text-gray); line-height: 1.8;">
                            <li>✓ 統一的錯誤響應格式</li>
                            <li>✓ 明確的錯誤碼和訊息</li>
                            <li>✓ 前端友好的錯誤提示</li>
                            <li>✓ 記錄錯誤日誌便於調試</li>
                            <li>✓ 優雅降級處理</li>
                            <li>✓ 實施重試機制</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">
                            <i class="fas fa-clipboard-check"></i> 測試與驗證
                        </h3>
                        <ul style="color: var(--text-gray); line-height: 1.8;">
                            <li>✓ API 端點單元測試</li>
                            <li>✓ 整合測試前後端交互</li>
                            <li>✓ 使用 Postman 測試 API</li>
                            <li>✓ 模擬各種錯誤場景</li>
                            <li>✓ 壓力測試和負載測試</li>
                            <li>✓ 持續整合/部���（CI/CD）</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- API設計規範 -->
            <div style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(139, 92, 246, 0.1)); border: 2px solid #ec4899; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #ec4899; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-code"></i> RESTful API 設計規範
                </h2>

                <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: var(--text); margin-bottom: 15px; font-size: 1.2rem;">
                        <i class="fas fa-link"></i> URL 設計規則
                    </h3>
                    <ul style="color: var(--text-gray); line-height: 1.8;">
                        <li>✓ 使用名詞而非動詞：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/users</code> 而非 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/getUsers</code></li>
                        <li>✓ 使用複數形式：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/users</code> 而非 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/user</code></li>
                        <li>✓ 使用小寫字母和連字符：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/user-profiles</code></li>
                        <li>✓ 使用資源嵌套表示關係：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">/api/users/123/posts</code></li>
                    </ul>
                </div>

                <div style="background: var(--card-bg); padding: 20px; border-radius: 12px;">
                    <h3 style="color: var(--text); margin-bottom: 15px; font-size: 1.2rem;">
                        <i class="fas fa-layer-group"></i> HTTP 方法與 CRUD 對應
                    </h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <strong style="color: #3b82f6;">GET</strong> - 讀取資源
                            <div style="color: var(--text-gray); margin-top: 5px;">
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">GET /api/users</code> - 獲取所有用戶<br>
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">GET /api/users/123</code> - 獲取特定用戶
                            </div>
                        </div>

                        <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;">POST</strong> - 創建資源
                            <div style="color: var(--text-gray); margin-top: 5px;">
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">POST /api/users</code> - 創建新用戶
                            </div>
                        </div>

                        <div style="padding: 12px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <strong style="color: #f59e0b;">PUT / PATCH</strong> - 更新資源
                            <div style="color: var(--text-gray); margin-top: 5px;">
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">PUT /api/users/123</code> - 完整更新用戶<br>
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">PATCH /api/users/123</code> - 部分更新用戶
                            </div>
                        </div>

                        <div style="padding: 12px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 3px solid #ef4444;">
                            <strong style="color: #ef4444;">DELETE</strong> - 刪除資源
                            <div style="color: var(--text-gray); margin-top: 5px;">
                                <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">DELETE /api/users/123</code> - 刪除特定用戶
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Github 模擬開發儲存庫操作流程頁面 -->
    <div class="page" id="githubGuidePage" style="display: none;">
        <div class="container" style="max-width: 1400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
                <h1 class="gradient-text" style="font-size: 2.5rem; margin: 0;">
                    <i class="fab fa-github"></i> Github 模擬開發儲存庫操作流程
                </h1>
                <button onclick="showPage('home')" class="btn btn-outline" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-home"></i> 返回主頁
                </button>
            </div>

            <!-- 應用簡介 -->
            <div style="background: linear-gradient(135deg, rgba(167, 113, 247, 0.15), rgba(78, 201, 176, 0.15)); border: 2px solid #a371f7; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(167, 113, 247, 0.2);">
                <h2 style="color: #a371f7; font-size: 1.8rem; margin-bottom: 20px; text-align: center;">
                    <i class="fas fa-info-circle"></i> GitHub 版本控制模擬器是什麼？
                </h2>
                <p style="color: var(--text); line-height: 1.9; font-size: 1.1rem; text-align: justify;">
                    <strong style="color: #a371f7;">GitHub 版本控制模擬器</strong>是一個完整的 Git + GitHub 學習環境，讓您在瀏覽器中體驗真實的<strong>版本控制與協作開發流程</strong>。它完整模擬了現代軟體開發團隊的工作方式，包括：
                </p>
                <ul style="color: var(--text-gray); line-height: 1.9; font-size: 1.05rem; margin-top: 15px; margin-left: 30px;">
                    <li><strong style="color: #3b82f6;">Git 核心命令</strong>：init、add、commit、push、pull、merge 等所有常用 Git 操作</li>
                    <li><strong style="color: #10b981;">分支管理系統</strong>：創建分支、切換分支、合併分支、解決衝突，完整體驗分支工作流</li>
                    <li><strong style="color: #f59e0b;">提交歷史追蹤</strong>：完整的 Git Log 記錄，可視化提交樹，追蹤每次代碼變更</li>
                    <li><strong style="color: #8b5cf6;">Pull Request 流程</strong>：創建 PR、代碼審查、合併 PR，體驗團隊協作開發</li>
                    <li><strong style="color: #ec4899;">遠端倉庫操作</strong>：Clone、Fork、Push、Pull 等與 GitHub 的交互操作</li>
                    <li><strong style="color: #06b6d4;">可視化界面</strong>：直觀的分支圖、提交歷史、文件變更，輕鬆理解 Git 工作原理</li>
                </ul>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #a371f7;">
                    <p style="color: var(--text); font-size: 1.05rem; line-height: 1.8; margin: 0;">
                        <i class="fas fa-lightbulb" style="color: var(--warning);"></i> <strong>核心價值：</strong>無需安裝 Git 軟體或註冊 GitHub 帳號，即可完整學習版本控制的核心概念和操作流程。這是從零開始學習 Git 和 GitHub 的最佳入門工具，讓您在安全的模擬環境中反復練習，建立信心後再應用到真實項目！
                    </p>
                </div>
            </div>

            <p style="text-align: center; color: var(--text-gray); margin-bottom: 40px; font-size: 1.1rem;">
                完整的 Git + GitHub 版本控制操作指南 • 從初始化到協作開發的完整流程
            </p>

            <!-- 快速導航 -->
            <div style="background: linear-gradient(135deg, rgba(167, 113, 247, 0.1), rgba(78, 201, 176, 0.1)); border: 2px solid #a371f7; border-radius: 16px; padding: 25px; margin-bottom: 30px;">
                <h2 style="color: #a371f7; font-size: 1.5rem; margin-bottom: 20px; text-align: center;">
                    <i class="fas fa-compass"></i> 操作類別導航
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button onclick="document.getElementById('git-basic').scrollIntoView({behavior: 'smooth'})" style="padding: 15px; background: var(--card-bg); border: 2px solid #3b82f6; border-radius: 10px; color: var(--text); cursor: pointer; transition: all 0.3s; font-weight: 600;" onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'" onmouseout="this.style.background='var(--card-bg)'">
                        <i class="fas fa-play-circle"></i> 基礎操作
                    </button>
                    <button onclick="document.getElementById('git-branch').scrollIntoView({behavior: 'smooth'})" style="padding: 15px; background: var(--card-bg); border: 2px solid #10b981; border-radius: 10px; color: var(--text); cursor: pointer; transition: all 0.3s; font-weight: 600;" onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'" onmouseout="this.style.background='var(--card-bg)'">
                        <i class="fas fa-code-branch"></i> 分支管理
                    </button>
                    <button onclick="document.getElementById('git-remote').scrollIntoView({behavior: 'smooth'})" style="padding: 15px; background: var(--card-bg); border: 2px solid #f59e0b; border-radius: 10px; color: var(--text); cursor: pointer; transition: all 0.3s; font-weight: 600;" onmouseover="this.style.background='rgba(245, 158, 11, 0.2)'" onmouseout="this.style.background='var(--card-bg)'">
                        <i class="fas fa-cloud"></i> 遠端操作
                    </button>
                    <button onclick="document.getElementById('git-collab').scrollIntoView({behavior: 'smooth'})" style="padding: 15px; background: var(--card-bg); border: 2px solid #8b5cf6; border-radius: 10px; color: var(--text); cursor: pointer; transition: all 0.3s; font-weight: 600;" onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'" onmouseout="this.style.background='var(--card-bg)'">
                        <i class="fas fa-users"></i> 協作開發
                    </button>
                    <button onclick="document.getElementById('git-advanced').scrollIntoView({behavior: 'smooth'})" style="padding: 15px; background: var(--card-bg); border: 2px solid #ec4899; border-radius: 10px; color: var(--text); cursor: pointer; transition: all 0.3s; font-weight: 600;" onmouseover="this.style.background='rgba(236, 72, 153, 0.2)'" onmouseout="this.style.background='var(--card-bg)'">
                        <i class="fas fa-magic"></i> 進階技巧
                    </button>
                </div>
            </div>

            <!-- 基礎操作 -->
            <div id="git-basic" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); border: 2px solid #3b82f6; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #3b82f6; font-size: 1.8rem; margin-bottom: 25px;">
                    <i class="fas fa-play-circle"></i> 1. Git 基礎操作
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">📦 初始化倉庫</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git init</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            在當前目錄創建新的 Git 倉庫。這會創建一個 .git 隱藏目錄，用於存儲版本控制信息。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">➕ 添加文件到暫存區</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git add .</code><br>
                            <code style="color: #10b981;">git add &lt;file&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            將修改的文件添加到暫存區（Staging Area）。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git add .</code> 添加所有文件，<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git add &lt;file&gt;</code> 添加特定文件。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">💾 提交更改</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git commit -m "提交訊息"</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            將暫存區的文件提交到本地倉庫。提交訊息應該清晰描述本次更改的內容。
                        </p>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px;">
                            <strong style="color: #3b82f6;">✨ 提交訊息最佳實踐：</strong>
                            <ul style="color: var(--text-gray); margin-top: 8px; line-height: 1.7;">
                                <li>使用現在式動詞：「Add」而非「Added」</li>
                                <li>第一行簡短摘要（50字符以內）</li>
                                <li>詳細描述放在空行之後</li>
                                <li>例如：「Add user authentication feature」</li>
                            </ul>
                        </div>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">📊 查看狀態</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git status</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            查看當前工作目錄和暫存區的狀態。顯示哪些文件被修改、哪些文件在暫存區、哪些文件未被追蹤。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ec4899;">
                        <h3 style="color: #ec4899; margin-bottom: 15px;">📜 查看提交歷史</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git log</code><br>
                            <code style="color: #10b981;">git log --oneline</code><br>
                            <code style="color: #10b981;">git log --graph --all</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            查看提交歷史。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">--oneline</code> 簡化輸出，<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">--graph</code> 顯示分支圖形。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 分支管理 -->
            <div id="git-branch" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid #10b981; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #10b981; font-size: 1.8rem; margin-bottom: 25px;">
                    <i class="fas fa-code-branch"></i> 2. 分支管理
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">🌿 創建分支</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git branch &lt;branch-name&gt;</code><br>
                            <code style="color: #10b981;">git checkout -b &lt;branch-name&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            創建新分支。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">checkout -b</code> 創建並立即切換到新分支。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">🔄 切換分支</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git checkout &lt;branch-name&gt;</code><br>
                            <code style="color: #10b981;">git switch &lt;branch-name&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            切換到指定分支。Git 2.23+ 推薦使用 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">switch</code> 命令。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">🔗 合併分支</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git merge &lt;branch-name&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            將指定分支合併到當前分支。如果有衝突，需要手動解決。
                        </p>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px;">
                            <strong style="color: #ef4444;">⚠️ 處理合併衝突：</strong>
                            <ol style="color: var(--text-gray); margin-top: 8px; line-height: 1.7;">
                                <li>打開有衝突的文件</li>
                                <li>查找 &lt;&lt;&lt;&lt;&lt;&lt;&lt;、=======、&gt;&gt;&gt;&gt;&gt;&gt;&gt; 標記</li>
                                <li>手動編輯，保留需要的代碼</li>
                                <li>刪除衝突標記</li>
                                <li>git add 並 git commit</li>
                            </ol>
                        </div>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">🗑️ 刪除分支</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git branch -d &lt;branch-name&gt;</code><br>
                            <code style="color: #10b981;">git branch -D &lt;branch-name&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            刪除分支。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">-d</code> 安全刪除（已合併），<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">-D</code> 強制刪除。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ec4899;">
                        <h3 style="color: #ec4899; margin-bottom: 15px;">📋 查看分支</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git branch</code><br>
                            <code style="color: #10b981;">git branch -a</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            查看所有分支。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">-a</code> 顯示包括遠端分支。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 遠端操作 -->
            <div id="git-remote" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(139, 92, 246, 0.1)); border: 2px solid #f59e0b; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #f59e0b; font-size: 1.8rem; margin-bottom: 25px;">
                    <i class="fas fa-cloud"></i> 3. 遠端倉庫操作
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">📥 克隆倉庫</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git clone &lt;repository-url&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            從遠端倉庫克隆完整的項目到本地。包括所有文件、分支和提交歷史。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">🔗 添加遠端倉庫</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git remote add origin &lt;repository-url&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            將本地倉庫連接到遠端倉庫。origin 是遠端倉庫的默認名稱。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">⬆️ 推送到遠端</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git push origin &lt;branch-name&gt;</code><br>
                            <code style="color: #10b981;">git push -u origin &lt;branch-name&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            將本地提交推送到遠端倉庫。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">-u</code> 設置上游分支，之後只需 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git push</code>。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">⬇️ 拉取更新</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git pull origin &lt;branch-name&gt;</code><br>
                            <code style="color: #10b981;">git fetch origin</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git pull</code> = fetch + merge。<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">fetch</code> 只下載不合併。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 協作開發 -->
            <div id="git-collab" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); border: 2px solid #8b5cf6; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #8b5cf6; font-size: 1.8rem; margin-bottom: 25px;">
                    <i class="fas fa-users"></i> 4. 協作開發流程
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">🍴 Fork 工作流程</h3>
                        <ol style="color: var(--text-gray); line-height: 1.8;">
                            <li>Fork 原始倉庫到你的 GitHub 帳號</li>
                            <li>Clone 你的 Fork 到本地：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git clone &lt;your-fork-url&gt;</code></li>
                            <li>添加上游倉庫：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git remote add upstream &lt;original-url&gt;</code></li>
                            <li>創建功能分支：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git checkout -b feature/new-feature</code></li>
                            <li>進行開發並提交</li>
                            <li>推送到你的 Fork：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git push origin feature/new-feature</code></li>
                            <li>在 GitHub 上創建 Pull Request</li>
                        </ol>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">🔄 Pull Request 流程</h3>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong style="color: #10b981;">創建 Pull Request：</strong>
                            <ol style="color: var(--text-gray); margin-top: 8px; line-height: 1.7;">
                                <li>在 GitHub 上點擊「New Pull Request」</li>
                                <li>選擇基礎分支（通常是 main）和比較分支（你的功能分支）</li>
                                <li>填寫 PR 標題和描述：
                                    <ul style="margin-top: 5px;">
                                        <li>說明更改的內容和原因</li>
                                        <li>列出相關的 Issue 編號</li>
                                        <li>添加截圖或演示（如適用）</li>
                                    </ul>
                                </li>
                                <li>請求代碼審查（Code Review）</li>
                                <li>根據反饋進行修改</li>
                                <li>審查通過後合併</li>
                            </ol>
                        </div>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">👀 代碼審查最佳實踐</h3>
                        <ul style="color: var(--text-gray); line-height: 1.8;">
                            <li>✓ 保持 PR 小而專注（&lt; 400 行代碼）</li>
                            <li>✓ 提供清晰的描述和上下文</li>
                            <li>✓ 添加測試並確保通過</li>
                            <li>✓ 及時回應審查意見</li>
                            <li>✓ 使用友好和建設性的語言</li>
                            <li>✓ 審查者應在 24-48 小時內回應</li>
                        </ul>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">🔄 保持 Fork 同步</h3>
                        <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <code style="color: #10b981;">git fetch upstream</code><br>
                            <code style="color: #10b981;">git checkout main</code><br>
                            <code style="color: #10b981;">git merge upstream/main</code><br>
                            <code style="color: #10b981;">git push origin main</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            定期同步上游倉庫的更新到你的 Fork，避免衝突累積。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 進階技巧 -->
            <div id="git-advanced" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(59, 130, 246, 0.1)); border: 2px solid #ec4899; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #ec4899; font-size: 1.8rem; margin-bottom: 25px;">
                    <i class="fas fa-magic"></i> 5. 進階技巧
                </h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 15px;">📝 Stash（儲藏）</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git stash</code><br>
                            <code style="color: #10b981;">git stash pop</code><br>
                            <code style="color: #10b981;">git stash list</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            暫時保存未提交的更改，切換分支後再恢復。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-bottom: 15px;">⏪ Reset 與 Revert</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git reset HEAD~1</code><br>
                            <code style="color: #10b981;">git revert &lt;commit&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            撤銷提交。reset 重寫歷史，revert 創建新提交。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px;">🎯 Cherry-pick</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git cherry-pick &lt;commit&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            從其他分支選擇特定提交應用到當前分支。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">🔧 Rebase</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git rebase main</code><br>
                            <code style="color: #10b981;">git rebase -i HEAD~3</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            將提交移到另一個基礎上。保持提交歷史線性。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ec4899;">
                        <h3 style="color: #ec4899; margin-bottom: 15px;">🏷️ Tags（標籤）</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git tag v1.0.0</code><br>
                            <code style="color: #10b981;">git push origin v1.0.0</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            標記重要的提交點，如版本發布。
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #06b6d4;">
                        <h3 style="color: #06b6d4; margin-bottom: 15px;">🔍 Blame</h3>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem;">
                            <code style="color: #10b981;">git blame &lt;file&gt;</code>
                        </div>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 0.9rem;">
                            查看文件每一行的最後修改者和提交。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 完整的Git工作流程步驟 -->
            <div style="background: linear-gradient(135deg, rgba(78, 201, 176, 0.1), rgba(86, 156, 214, 0.1)); border: 2px solid var(--primary); border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-list-ol"></i> GitHub 版本控制完整工作流程
                </h2>

                <p style="color: var(--text-gray); text-align: center; margin-bottom: 30px; font-size: 1.05rem;">
                    從項目初始化到團隊協作的完整 Git + GitHub 工作流程
                </p>

                <!-- 流程 1: 初始化與首次提交 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #3b82f6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">1</div>
                        <h3 style="color: #3b82f6; margin: 0; font-size: 1.4rem;">項目初始化與首次提交</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>創建本地倉庫並進行第一次代碼提交
                        </p>

                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-terminal"></i> 操作步驟：</h4>
                            <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
<pre style="margin: 0; color: #10b981; font-family: 'Fira Code', monospace; line-height: 1.7;"><code># 1. 初始化 Git 倉庫
git init

# 2. 查看當前狀態
git status

# 3. 添加文件到暫存區
git add .              # 添加所有文件
git add index.html     # 添加特定文件

# 4. 提交到本地倉庫
git commit -m "Initial commit: 添加項目基礎文件"

# 5. 查看提交歷史
git log --oneline</code></pre>
                            </div>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;"><i class="fas fa-lightbulb"></i> 重要提示：</strong>
                            <ul style="color: var(--text-gray); margin-top: 8px; line-height: 1.8; margin-left: 20px;">
                                <li>提交訊息要清晰描述本次更改的內容</li>
                                <li>使用現在式動詞：「Add」而非「Added」</li>
                                <li>第一次提交通常命名為 "Initial commit"</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 流程 2: 分支開發工作流 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #10b981; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">2</div>
                        <h3 style="color: #10b981; margin: 0; font-size: 1.4rem;">Feature Branch 開發流程</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>使用分支進行新功能開發，保持主分支穩定
                        </p>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #10b981; margin-bottom: 10px;"><i class="fas fa-terminal"></i> 操作步驟：</h4>
                            <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
<pre style="margin: 0; color: #10b981; font-family: 'Fira Code', monospace; line-height: 1.7;"><code># 1. 創建並切換到新分支
git checkout -b feature/user-login
# 或使用新語法
git switch -c feature/user-login

# 2. 在新分支上進行開發
# ... 修改代碼 ...

# 3. 查看變更
git status
git diff

# 4. 提交更改
git add .
git commit -m "Add user login functionality"

# 5. 繼續開發和提交...
git add .
git commit -m "Add login validation"

# 6. 查看分支列表
git branch</code></pre>
                            </div>
                        </div>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <strong style="color: #f59e0b;"><i class="fas fa-info-circle"></i> 分支命名規範：</strong>
                            <ul style="color: var(--text-gray); margin-top: 8px; line-height: 1.8; margin-left: 20px;">
                                <li><code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">feature/功能名稱</code> - 新功能開發</li>
                                <li><code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">bugfix/錯誤名稱</code> - 錯誤修復</li>
                                <li><code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">hotfix/緊急修復</code> - 緊急修復</li>
                                <li><code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">refactor/重構名稱</code> - 代碼重構</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 流程 3: 合併分支 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #f59e0b; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #f59e0b; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">3</div>
                        <h3 style="color: #f59e0b; margin: 0; font-size: 1.4rem;">合併分支與解決衝突</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>將功能分支合併回主分支
                        </p>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px;"><i class="fas fa-terminal"></i> 操作步驟：</h4>
                            <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
<pre style="margin: 0; color: #10b981; font-family: 'Fira Code', monospace; line-height: 1.7;"><code># 1. 切換回主分支
git checkout main

# 2. 合併功能分支
git merge feature/user-login

# 3. 如果有衝突，手動解決
# - 打開有衝突的文件
# - 查找 &lt;&lt;&lt;&lt;&lt;&lt;&lt;、=======、&gt;&gt;&gt;&gt;&gt;&gt;&gt; 標記
# - 保留需要的代碼，刪除衝突標記
# - 保存文件

# 4. 完成衝突解決後
git add .
git commit -m "Merge feature/user-login into main"

# 5. 刪除已合併的分支
git branch -d feature/user-login</code></pre>
                            </div>
                        </div>

                        <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ef4444;">
                            <strong style="color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> 處理合併衝突注意事項：</strong>
                            <ul style="color: var(--text-gray); margin-top: 8px; line-height: 1.8; margin-left: 20px;">
                                <li>仔細檢查衝突內容，理解雙方的更改</li>
                                <li>與團隊成員溝通，確定正確的解決方案</li>
                                <li>解決後務必測試功能是否正常</li>
                                <li>使用 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git merge --abort</code> 可取消合併</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 流程 4: 連接遠端倉庫 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #8b5cf6; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #8b5cf6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">4</div>
                        <h3 style="color: #8b5cf6; margin: 0; font-size: 1.4rem;">連接 GitHub 遠端倉���</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>將本地代碼推送到 GitHub
                        </p>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #8b5cf6; margin-bottom: 10px;"><i class="fas fa-terminal"></i> 操作步驟：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px; margin-bottom: 12px;">
                                <li style="margin-bottom: 10px;"><strong>在 GitHub 上創建新倉庫</strong>
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        <li>登錄 GitHub，點擊右上角 "+" → "New repository"</li>
                                        <li>填寫倉庫名稱、描述</li>
                                        <li>選擇 Public 或 Private</li>
                                        <li>點擊 "Create repository"</li>
                                    </ul>
                                </li>
                                <li style="margin-bottom: 10px;"><strong>連接遠端倉庫</strong></li>
                            </ol>
                            <div style="background: var(--darker-bg); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
<pre style="margin: 0; color: #10b981; font-family: 'Fira Code', monospace; line-height: 1.7;"><code># 添加遠端倉庫
git remote add origin https://github.com/username/repo-name.git

# 查看遠端倉庫
git remote -v

# 推送到遠端（首次）
git push -u origin main

# 之後的推送只需
git push</code></pre>
                            </div>
                        </div>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                            <strong style="color: #8b5cf6;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> GitHub Desktop、GitKraken、SourceTree（圖形化界面）、GitHub CLI</span>
                        </div>
                    </div>
                </div>

                <!-- 流程 5: Pull Request 協作流程 -->
                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 4px solid #ec4899;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: #ec4899; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; flex-shrink: 0;">5</div>
                        <h3 style="color: #ec4899; margin: 0; font-size: 1.4rem;">團隊協作：Pull Request 流程</h3>
                    </div>

                    <div style="margin-left: 65px;">
                        <p style="color: var(--text); line-height: 1.8; margin-bottom: 15px;">
                            <strong>目標：</strong>通過 Pull Request 進行代碼審查和協作
                        </p>

                        <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #ec4899; margin-bottom: 10px;"><i class="fas fa-tasks"></i> 完整流程：</h4>
                            <ol style="color: var(--text-gray); line-height: 1.9; margin-left: 20px;">
                                <li><strong>開發者 A：創建功能分支並推送</strong>
<pre style="background: var(--darker-bg); padding: 12px; border-radius: 6px; margin-top: 8px; margin-bottom: 8px; overflow-x: auto;"><code style="color: #10b981;">git checkout -b feature/new-feature
# 進行開發...
git add .
git commit -m "Add new feature"
git push -u origin feature/new-feature</code></pre>
                                </li>
                                <li><strong>在 GitHub 上創建 Pull Request</strong>
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        <li>訪問 GitHub 倉庫頁面</li>
                                        <li>點擊 "Pull requests" → "New pull request"</li>
                                        <li>選擇 base: main，compare: feature/new-feature</li>
                                        <li>填寫 PR 標題和詳細描述</li>
                                        <li>添加審查者（Reviewers）</li>
                                        <li>點擊 "Create pull request"</li>
                                    </ul>
                                </li>
                                <li><strong>審查者 B：進行代碼審查</strong>
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        <li>查看代碼變更</li>
                                        <li>添加評論和建議</li>
                                        <li>請求更改或批准</li>
                                    </ul>
                                </li>
                                <li><strong>開發者 A：根據反饋修改</strong>
<pre style="background: var(--darker-bg); padding: 12px; border-radius: 6px; margin-top: 8px; margin-bottom: 8px; overflow-x: auto;"><code style="color: #10b981;"># 在同一分支繼續修改
git add .
git commit -m "Address review comments"
git push  # 會自動更新 PR</code></pre>
                                </li>
                                <li><strong>合併 Pull Request</strong>
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        <li>審查通過後，點擊 "Merge pull request"</li>
                                        <li>選擇合併方式（Merge、Squash、Rebase）</li>
                                        <li>確認合併並刪除分支</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>

                        <div style="background: rgba(236, 72, 153, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <strong style="color: #ec4899;"><i class="fas fa-tools"></i> 使用工具：</strong>
                            <span style="color: var(--text-gray);"> GitHub Web Interface、GitHub Mobile、GitHub CLI (gh pr create)、VS Code GitHub Extension</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Git最佳實踐與注意事項 -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid #ef4444; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: #ef4444; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-exclamation-triangle"></i> 注意事項與常見問題
                </h2>

                <div style="display: grid; gap: 20px;">
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <h3 style="color: #ef4444; margin-bottom: 12px;"><i class="fas fa-ban"></i> 避免直接在 main 分支開發</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>直接在 main 分支開發會導致未完成的代碼影響穩定版本
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong style="color: #10b981;">最佳實踐：</strong>始終在功能分支開發，通過 PR 合併到 main
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #f59e0b; margin-bottom: 12px;"><i class="fas fa-history"></i> 提交訊息要有意義</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>模糊的提交訊息（如 "update"、"fix"）無法追蹤變更歷史
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong style="color: #10b981;">最佳實踐：</strong>使用清晰描述性的提交訊息
                        </p>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 6px; margin-top: 10px;">
                            <p style="color: var(--text-gray); margin: 0; line-height: 1.7;">
                                ✅ 好的例子：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">"Add user authentication with JWT tokens"</code><br>
                                ❌ 不好的例子：<code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">"update"</code>
                            </p>
                        </div>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-bottom: 12px;"><i class="fas fa-code-branch"></i> 定期同步遠端更新</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>問題：</strong>長時間不同步會累積大量衝突
                        </p>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong style="color: #10b981;">最佳實踐：</strong>每天開始工作前執行 <code style="background: var(--darker-bg); padding: 2px 6px; border-radius: 4px;">git pull</code>
                        </p>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 12px;"><i class="fas fa-file-alt"></i> 使用 .gitignore</h3>
                        <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                            <strong>重要提示：</strong>避免提交敏感文件和臨時文件
                        </p>
                        <div style="background: var(--darker-bg); padding: 12px; border-radius: 6px; margin-top: 10px;">
<pre style="margin: 0; color: var(--text-gray); font-family: 'Fira Code', monospace; line-height: 1.7;"><code># .gitignore 示例
node_modules/
.env
*.log
.DS_Store
dist/
build/</code></pre>
                        </div>
                    </div>

                    <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 4px solid #ec4899;">
                        <h3 style="color: #ec4899; margin-bottom: 12px;"><i class="fas fa-shield-alt"></i> 保護重要分支</h3>
                        <p style="color: var(--text-gray); line-height: 1.8;">
                            <strong>最佳實踐：</strong>在 GitHub 設置中啟用 Branch Protection Rules：
                        </p>
                        <ul style="color: var(--text-gray); line-height: 1.8; margin-left: 20px; margin-top: 8px;">
                            <li>✓ 要求 Pull Request 審查</li>
                            <li>✓ 要求狀態檢查通過（CI/CD）</li>
                            <li>✓ 禁止強制推送</li>
                            <li>✓ 禁止刪除保護分支</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 總結與建議 -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(139, 92, 246, 0.15)); border: 2px solid #10b981; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);">
                <h2 style="color: #10b981; font-size: 1.8rem; margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-lightbulb"></i> 總結與最佳建議
                </h2>

                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #a371f7; margin-bottom: 15px;"><i class="fas fa-check-circle"></i> Git 核心概念總結</h3>
                    <ul style="color: var(--text-gray); line-height: 2; font-size: 1.05rem;">
                        <li>✅ <strong>三個區域</strong>：工作區（Working Directory）→ 暫存區（Staging Area）→ 倉庫（Repository）</li>
                        <li>✅ <strong>分支策略</strong>：main 保持穩定，feature 分支開發新功能，hotfix 緊急修復</li>
                        <li>✅ <strong>提交原則</strong>：小而頻繁的提交優於大而稀疏的提交</li>
                        <li>✅ <strong>協作流程</strong>：Fork → Clone → Branch → Commit → Push → Pull Request → Review → Merge</li>
                        <li>✅ <strong>衝突處理</strong>：耐心分析、及時溝通、謹慎合併</li>
                        <li>✅ <strong>版本標記</strong>：使用 Tags 標記重要版本（v1.0.0、v2.0.0）</li>
                    </ul>
                </div>

                <div style="background: var(--card-bg); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #3b82f6; margin-bottom: 15px;"><i class="fas fa-star"></i> 專業建議</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <strong style="color: #3b82f6;">💡 建議 1：建立團隊 Git 規範</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                制定團隊統一的分支命名、提交訊息、PR 描述規範，使用 Conventional Commits 等標準
                            </p>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <strong style="color: #10b981;">💡 建議 2：整合 CI/CD 流程</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                使用 GitHub Actions、Jenkins 等工具，自動執行測試、構建、部署，確保代碼質量
                            </p>
                        </div>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <strong style="color: #f59e0b;">💡 建議 3：善用 GitHub 功能</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                充分利用 Issues 追蹤問題、Projects 管理任務、Wiki 維護文檔、Discussions 團隊討論
                            </p>
                        </div>

                        <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                            <strong style="color: #8b5cf6;">💡 建議 4：持續學習與實踐</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                利用本平台的 <strong>GitHub 版本控制模擬器</strong> 反復練習各種場景，包括分支管理、衝突解決、PR 流程等，在實踐中掌握 Git
                            </p>
                        </div>

                        <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <strong style="color: #ec4899;">💡 建議 5：結合前後端開發</strong>
                            <p style="color: var(--text-gray); margin-top: 8px; line-height: 1.8;">
                                將本模擬器與 <strong>前後端 API 模擬器</strong> 結合使用，體驗完整的全棧開發流程：編寫代碼 → 版本控制 → API 測試 → 部署上線
                            </p>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(16, 185, 129, 0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #10b981;">
                    <p style="color: var(--text); font-size: 1.15rem; line-height: 1.9; margin: 0;">
                        <i class="fab fa-github" style="color: #a371f7; font-size: 1.5rem; vertical-align: middle;"></i>
                        <strong style="color: #10b981;">記住：</strong>Git 是現代軟體開發不可或缺的技能。<br>
                        通過不斷練習和實踐，你會精通版本控制，成為高效的團隊協作者！
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub 版本控制模擬器頁面 -->
    <div class="page" id="githubSimulatorPage">
        <div class="container" style="max-width: 1400px;">
            <h1 class="gradient-text" style="text-align: center; margin-bottom: 16px;">
                <i class="fab fa-github"></i> GitHub 版本控制模擬器
            </h1>
            <p style="text-align: center; color: var(--text-gray); margin-bottom: 40px; font-size: 1.1rem;">
                完整模擬真實的 Git + GitHub 工作流程 • 學習版本控制和團隊協作開發
            </p>

            <!-- 💡 快速開始提示 -->
            <div style="background: linear-gradient(135deg, rgba(167, 113, 247, 0.1), rgba(59, 130, 246, 0.1)); border: 2px solid #a371f7; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #a371f7; font-size: 1.2rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-rocket"></i> 快速開始 Git 操作
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px;">
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <div style="color: #10b981; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-play-circle"></i> 步驟 1：模擬修改
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「模擬代碼修改」按鈕創建文件變更
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                        <div style="color: #3b82f6; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-check"></i> 步驟 2：查看狀態
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git status」查看文件變更狀態
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <div style="color: #f59e0b; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-save"></i> 步驟 3：提交代碼
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git commit」提交變更到倉庫
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                        <div style="color: #8b5cf6; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-code-branch"></i> 步驟 4：分支管理
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git branch」創建新分支進行開發
                        </p>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(167, 113, 247, 0.1); border-radius: 8px; border-left: 3px solid #a371f7;">
                    <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.7; margin: 0;">
                        <i class="fas fa-lightbulb" style="color: var(--warning);"></i> <strong style="color: #a371f7;">提示：</strong>
                        可以從自由模式編輯器中將代碼「傳送到 GitHub 模擬器」進行版本控制，也可以將代碼「傳送到 API 模擬器」進行 API 測試。完成開發後，結合兩個模擬器體驗完整的開發流程！
                    </p>
                </div>
            </div>

            <!-- 🎯 GitHub 完整操作流程指引 -->
            <div style="background: linear-gradient(135deg, rgba(167, 113, 247, 0.15), rgba(78, 201, 176, 0.15)); border: 2px solid #a371f7; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(167, 113, 247, 0.2);">
                <h2 style="color: #a371f7; font-size: 1.8rem; margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 12px;">
                    <i class="fab fa-github"></i> 📖 Git + GitHub 完整操作指南
                </h2>

                <!-- 步驟指示器 -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <!-- 步驟 1 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #10b981; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">1</div>
                        <h3 style="color: #10b981; font-size: 1.1rem; margin: 20px 0 10px 0;">修改代碼</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            在「代碼工作區」的文本框中輸入或修改代碼，或點擊「模擬代碼修改」按鈕自動生成變更
                        </p>
                    </div>

                    <!-- 步驟 2 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #3b82f6; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #3b82f6; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">2</div>
                        <h3 style="color: #3b82f6; font-size: 1.1rem; margin: 20px 0 10px 0;">查看狀態</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git status」查看當前倉庫狀態，確認有未提交的更改（紅色顯示）
                        </p>
                    </div>

                    <!-- 步驟 3 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #f59e0b; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #f59e0b; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">3</div>
                        <h3 style="color: #f59e0b; font-size: 1.1rem; margin: 20px 0 10px 0;">提交代碼</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git commit」，輸入提交信息（如："新增登錄功能"），提交到當前分支
                        </p>
                    </div>

                    <!-- 步驟 4 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #8b5cf6; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #8b5cf6; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">4</div>
                        <h3 style="color: #8b5cf6; font-size: 1.1rem; margin: 20px 0 10px 0;">創建分支</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git branch」創建新分支（如："feature/login"），用於開發新功能
                        </p>
                    </div>

                    <!-- 步驟 5 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #ec4899; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #ec4899; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">5</div>
                        <h3 style="color: #ec4899; font-size: 1.1rem; margin: 20px 0 10px 0;">推送到遠程</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「git push」將本地提交推送到遠程倉庫（模擬 GitHub），查看推送結果
                        </p>
                    </div>

                    <!-- 步驟 6 -->
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; border-left: 4px solid #06b6d4; position: relative;">
                        <div style="position: absolute; top: -12px; left: 12px; background: #06b6d4; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">6</div>
                        <h3 style="color: #06b6d4; font-size: 1.1rem; margin: 20px 0 10px 0;">創建 PR</h3>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「Create PR」創建 Pull Request，輸入標題和描述，提交代碼審查請求
                        </p>
                    </div>
                </div>

                <!-- 視覺化流程圖 -->
                <div style="background: var(--darker-bg); border-radius: 12px; padding: 25px; border: 1px solid var(--border);">
                    <h3 style="color: #a371f7; font-size: 1.2rem; margin-bottom: 20px; text-align: center;">
                        <i class="fab fa-git-alt"></i> Git + GitHub 工作流程圖
                    </h3>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap; font-family: 'Fira Code', monospace; font-size: 13px;">
                        <div style="background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">✏️</div>
                            <div style="color: #10b981; font-weight: bold; font-size: 12px;">修改代碼</div>
                        </div>
                        <div style="color: #10b981; font-size: 20px;">→</div>
                        <div style="background: rgba(59, 130, 246, 0.2); border: 2px solid #3b82f6; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">📊</div>
                            <div style="color: #3b82f6; font-weight: bold; font-size: 12px;">git status</div>
                        </div>
                        <div style="color: #3b82f6; font-size: 20px;">→</div>
                        <div style="background: rgba(245, 158, 11, 0.2); border: 2px solid #f59e0b; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">💾</div>
                            <div style="color: #f59e0b; font-weight: bold; font-size: 12px;">git commit</div>
                        </div>
                        <div style="color: #f59e0b; font-size: 20px;">→</div>
                        <div style="background: rgba(139, 92, 246, 0.2); border: 2px solid #8b5cf6; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">🌿</div>
                            <div style="color: #8b5cf6; font-weight: bold; font-size: 12px;">git branch</div>
                        </div>
                        <div style="color: #8b5cf6; font-size: 20px;">→</div>
                        <div style="background: rgba(236, 72, 153, 0.2); border: 2px solid #ec4899; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">☁️</div>
                            <div style="color: #ec4899; font-weight: bold; font-size: 12px;">git push</div>
                        </div>
                        <div style="color: #ec4899; font-size: 20px;">→</div>
                        <div style="background: rgba(6, 182, 212, 0.2); border: 2px solid #06b6d4; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 110px;">
                            <div style="font-size: 24px; margin-bottom: 6px;">🔀</div>
                            <div style="color: #06b6d4; font-weight: bold; font-size: 12px;">Pull Request</div>
                        </div>
                    </div>
                </div>

                <!-- 關鍵概念說明 -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 25px; margin-top: 20px; border: 1px solid var(--border);">
                    <h3 style="color: #a371f7; font-size: 1.1rem; margin-bottom: 16px;">
                        <i class="fas fa-lightbulb"></i> 💡 關鍵概念解釋
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; color: var(--text-gray); font-size: 0.9rem; line-height: 1.8;">
                        <div>
                            <strong style="color: var(--primary);">本地倉庫 vs 遠程倉庫：</strong><br>
                            本地倉庫在你的電腦上，遠程倉庫在 GitHub 服務器上。使用 push 推送，使用 pull 拉取。
                        </div>
                        <div>
                            <strong style="color: var(--secondary);">分支（Branch）：</strong><br>
                            分支是獨立的開發線。main 是主分支，feature/xxx 是功能分支，開發完成後合併回 main。
                        </div>
                        <div>
                            <strong style="color: var(--warning);">提交（Commit）：</strong><br>
                            提交是代碼的快照，包含提交信息、作者、時間戳和 40 字符的 Hash 值（唯一標識）。
                        </div>
                        <div>
                            <strong style="color: var(--success);">Pull Request（PR）：</strong><br>
                            PR 是代碼審查和合併請求，讓團隊成員審查你的代碼後再合併到主分支。
                        </div>
                    </div>
                </div>

                <!-- 快速開始按鈕 -->
                <div style="margin-top: 25px; text-align: center;">
                    <button onclick="githubQuickStart()" style="background: linear-gradient(135deg, #a371f7, var(--primary)); color: white; border: none; padding: 14px 32px; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 16px rgba(167, 113, 247, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(167, 113, 247, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(167, 113, 247, 0.3)'">
                        <i class="fab fa-github"></i> 🚀 開始 Git 工作流程示範
                    </button>
                    <div style="color: var(--text-gray); font-size: 0.9rem; margin-top: 10px;">點擊按鈕自動執行完整的 Git 操作流程</div>
                </div>
            </div>

            <!-- Git 操作面板 -->
            <div style="display: grid; grid-template-columns: 350px 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- 左側：倉庫信息和操作（可折叠侧边栏） -->
                <div id="gitSidebar" class="collapsible-sidebar" style="background: var(--card-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border); height: fit-content;">
                    <!-- 折叠按钮 -->
                    <div class="sidebar-toggle-btn" onclick="toggleGitSidebar()" title="折叠/展开侧边栏">
                        <i class="fas fa-chevron-left" id="gitSidebarToggleIcon"></i>
                    </div>

                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fab fa-git-alt"></i> 倉庫狀態
                    </h3>

                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <i class="fas fa-code-branch" style="color: #a371f7;"></i>
                            <span style="font-size: 14px; color: var(--text-gray);">當前分支：</span>
                            <span id="currentBranch" style="font-weight: 600; color: var(--primary);">main</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <i class="fas fa-clock" style="color: var(--secondary);"></i>
                            <span style="font-size: 14px; color: var(--text-gray);">提交數量：</span>
                            <span id="commitCount" style="font-weight: 600;">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-file-alt" style="color: var(--warning);"></i>
                            <span style="font-size: 14px; color: var(--text-gray);">未提交更改：</span>
                            <span id="changedFiles" style="font-weight: 600; color: var(--warning);">0</span>
                        </div>
                    </div>

                    <hr style="border: none; border-top: 1px solid var(--border); margin: 20px 0;">

                    <h4 style="color: var(--secondary); margin-bottom: 16px; font-size: 15px;">
                        <i class="fas fa-terminal"></i> Git 操作
                    </h4>

                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="gitStatus()" class="btn" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-info-circle"></i> git status
                        </button>
                        <button onclick="showCommitDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-save"></i> git commit
                        </button>
                        <button onclick="showBranchDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-code-branch"></i> git branch
                        </button>
                        <button onclick="showMergeDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-code-merge"></i> git merge
                        </button>
                        <button onclick="gitDiff()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-file-contract"></i> git diff
                        </button>
                        <button onclick="showTagDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-tag"></i> git tag
                        </button>
                        <button onclick="gitPush()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-upload"></i> git push
                        </button>
                        <button onclick="gitPull()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-download"></i> git pull
                        </button>
                    </div>

                    <hr style="border: none; border-top: 1px solid var(--border); margin: 20px 0;">

                    <h4 style="color: var(--primary); margin-bottom: 16px; font-size: 15px;">
                        <i class="fas fa-users"></i> 協作功能
                    </h4>

                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="showPullRequestDialog()" class="btn" style="width: 100%; padding: 12px; font-size: 14px; background: linear-gradient(135deg, #a371f7, var(--primary));">
                            <i class="fas fa-code-pull-request"></i> 創建 Pull Request
                        </button>
                        <button onclick="showCloneDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-clone"></i> Clone 倉庫
                        </button>
                        <button onclick="showForkDialog()" class="btn btn-outline" style="width: 100%; padding: 12px; font-size: 14px;">
                            <i class="fas fa-code-fork"></i> Fork 倉庫
                        </button>
                    </div>
                </div>

                <!-- 右側：代碼編輯區 -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
                        <span><i class="fas fa-code"></i> 工作區 (Working Directory)</span>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="addNewFile()" class="btn btn-outline" style="padding: 8px 16px; font-size: 13px;">
                                <i class="fas fa-file-plus"></i> 新建文件
                            </button>
                            <button onclick="simulateChange()" class="btn btn-outline" style="padding: 8px 16px; font-size: 13px;">
                                <i class="fas fa-edit"></i> 模擬修改
                            </button>
                        </div>
                    </h3>

                    <textarea id="gitWorkingArea" style="width: 100%; min-height: 400px; padding: 20px; background: var(--darker-bg); color: var(--text); border: 1px solid var(--border); border-radius: 8px; font-family: 'Fira Code', monospace; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="// 在這裡編寫代碼...
// 代碼修改後會被 Git 追蹤

function hello() {
    console.log('Hello GitHub!');
}"></textarea>

                    <!-- 🎯 GitHub 導入/導出按鈕 -->
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-outline" id="importGitCodeBtn" style="flex: 1; min-width: 150px; background: rgba(78, 201, 176, 0.1); border-color: var(--primary); color: var(--primary);" aria-label="從裝置導入代碼到Git工作區">
                            <i class="fas fa-file-import" aria-hidden="true"></i> 導入代碼
                        </button>
                        <button class="btn btn-outline" id="exportGitCodeBtn" style="flex: 1; min-width: 150px; background: rgba(86, 156, 214, 0.1); border-color: var(--secondary); color: var(--secondary);" aria-label="導出Git工作區代碼">
                            <i class="fas fa-file-export" aria-hidden="true"></i> 導出代碼
                        </button>
                        <button class="btn btn-outline" id="exportGitHistoryBtn" style="flex: 1; min-width: 180px; background: rgba(167, 113, 247, 0.1); border-color: #a371f7; color: #a371f7;" aria-label="導出完整Git歷史">
                            <i class="fas fa-code-branch" aria-hidden="true"></i> 導出Git歷史
                        </button>
                    </div>
                    <!-- 隱藏的文���輸入框 -->
                    <input type="file" id="gitFileInput" accept=".js,.txt,.html,.css,.md,.json" style="display: none;">

                    <div style="margin-top: 16px; padding: 16px; background: rgba(0, 217, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="display: flex; align-items: start; gap: 12px;">
                            <i class="fas fa-info-circle" style="color: var(--primary); margin-top: 4px;"></i>
                            <div style="font-size: 14px; color: var(--text-gray); line-height: 1.6;">
                                <strong style="color: var(--text);">提示：</strong>
                                修改代碼後點擊「git status」查看變更，使用「git commit」提交更改，
                                使用「git push」推送到遠程倉庫
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Git 歷史記錄和分支視圖 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- 提交歷史 -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border);">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        <i class="fas fa-history"></i> 提交歷史 (git log)
                    </h3>
                    <div id="gitCommitHistory" class="optimized-scroll" style="max-height: 400px;">
                        <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                            <p>還沒有提交記錄</p>
                            <p style="font-size: 13px; margin-top: 8px;">修改代碼後執行 git commit 來創建第一個提交</p>
                        </div>
                    </div>
                </div>

                <!-- 分支管理 -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border);">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        <i class="fas fa-code-branch"></i> 分支列表 (git branch)
                    </h3>
                    <div id="gitBranchList" class="optimized-scroll" style="max-height: 400px;">
                        <div onclick="switchBranch('main')" style="padding: 12px 16px; background: rgba(0, 217, 255, 0.1); border-left: 4px solid var(--primary); border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-check" style="color: var(--primary);"></i>
                                <span style="font-weight: 600; color: var(--primary);">main</span>
                                <span style="font-size: 12px; color: var(--text-gray); margin-left: auto;">（當前分支）</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="showBranchDialog()" class="btn" style="width: 100%; margin-top: 16px; padding: 10px; font-size: 14px;">
                        <i class="fas fa-plus"></i> 創建新分支
                    </button>
                </div>
            </div>

            <!-- Pull Requests -->
            <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border); margin-bottom: 30px;">
                <h3 style="color: #a371f7; margin-bottom: 20px;">
                    <i class="fas fa-code-pull-request"></i> Pull Requests
                </h3>
                <div id="pullRequestList">
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fab fa-github" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                        <p>沒有活動的 Pull Request</p>
                        <p style="font-size: 13px; margin-top: 8px;">創建分支並發起 Pull Request 來協作開發</p>
                    </div>
                </div>
            </div>

            <!-- 終端輸出 -->
            <div style="background: var(--darker-bg); border-radius: 12px; padding: 24px; border: 1px solid var(--border);">
                <h3 style="color: var(--secondary); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-terminal"></i> Git 終端輸出
                    <button onclick="clearGitTerminal()" class="btn btn-outline" style="margin-left: auto; padding: 6px 12px; font-size: 12px;">
                        <i class="fas fa-trash"></i> 清空
                    </button>
                </h3>
                <pre id="gitTerminal" class="optimized-scroll" style="background: #000; color: #0f0; padding: 20px; border-radius: 8px; font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.6; max-height: 300px; margin: 0;">$ 等待 Git 命令...</pre>
            </div>
        </div>
    </div>

    <!-- 自由模式頁 -->
    <div class="page" id="freePage">
        <div class="container" style="max-width: 100%; padding: 20px;">
            <!-- 頂部控制欄 -->
            <div style="background: var(--card-bg); border-radius: 12px; padding: 20px 30px; margin-bottom: 20px; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <h2 class="gradient-text" style="font-size: 1.5rem; margin: 0;" id="freePageTitle">
                        自由模式 - HTML
                    </h2>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <!-- 模板選擇器 -->
                        <div style="position: relative;">
                            <button class="btn btn-outline" id="templateBtn" style="padding: 10px 20px; font-size: 14px;">
                                <i class="fas fa-file-code"></i> 模板
                            </button>
                            <div id="templateDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 8px; min-width: 200px; z-index: 1000; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);">
                                <!-- 模板選項將由 JS 動態生成 -->
                            </div>
                        </div>
                        <!-- 匯入按鈕 -->
                        <button class="btn btn-outline" id="importBtn" style="padding: 10px 20px; font-size: 14px;">
                            <i class="fas fa-file-import"></i> 匯入
                        </button>
                        <!-- 匯出按鈕 -->
                        <button class="btn btn-outline" id="exportBtn" style="padding: 10px 20px; font-size: 14px;">
                            <i class="fas fa-file-export"></i> 匯出
                        </button>
                        <!-- 設���按鈕 -->
                        <button class="btn btn-outline" id="settingsBtn" style="padding: 10px 20px; font-size: 14px;">
                            <i class="fas fa-cog"></i> 設置
                        </button>
                        <!-- 運行按鈕 -->
                        <button class="btn" id="runCodeBtn" style="padding: 10px 24px; font-size: 14px;">
                            <i class="fas fa-play"></i> 運行
                        </button>
                    </div>
                </div>
            </div>

            <!-- 隱藏的文件輸入 -->
            <input type="file" id="fileInput" accept=".html,.css,.js,.py,.rb,.java,.cpp,.cs,.txt" style="display: none;">

            <!-- 編輯器與預覽區域 -->
            <div style="display: flex; gap: 1px; height: calc(100vh - 200px); min-height: 500px; background: var(--border); border-radius: 12px; overflow: hidden;">
                <!-- �����側邊欄：文件資源管理器 (15%寬度) -->
                <div id="fileExplorer" style="flex: 0 0 200px; display: flex; flex-direction: column; background: var(--darker-bg); border-right: 1px solid var(--border);">
                    <!-- 文件管理器標題 -->
                    <div style="padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;">
                        <span style="font-size: 12px; font-weight: 600; color: var(--text); text-transform: uppercase; letter-spacing: 0.5px;">
                            <i class="fas fa-folder" style="margin-right: 6px; color: var(--primary);"></i>檔案
                        </span>
                        <div style="display: flex; gap: 6px;">
                            <button onclick="createNewFile()" class="icon-btn" title="新增檔案">
                                <i class="fas fa-file-plus"></i>
                            </button>
                            <button onclick="toggleFileExplorer()" class="icon-btn" title="收起側邊欄">
                                <i class="fas fa-angle-left"></i>
                            </button>
                        </div>
                    </div>
                    <!-- 文件列表 -->
                    <div id="fileList" class="optimized-scroll" style="flex: 1; padding: 8px 4px;">
                        <!-- 文件項目將由 JS 動態生成 -->
                    </div>
                </div>

                <!-- 中間：代碼編輯器 (40-45%寬度) -->
                <div id="editorContainer" style="flex: 1; display: flex; flex-direction: column; background: var(--card-bg);">
                    <!-- 語言標籤頁 (HTML/CSS/JavaScript切換) -->
                    <div id="languageTabs" style="padding: 0; border-bottom: 1px solid var(--border); display: flex; align-items: center; background: var(--darker-bg); overflow-x: auto;">
                        <button class="lang-tab active" data-lang="html" onclick="switchLanguageTab('html')" style="padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid var(--primary); color: var(--primary); cursor: pointer; font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; transition: all 0.3s;">
                            <i class="fab fa-html5"></i> HTML
                        </button>
                        <button class="lang-tab" data-lang="css" onclick="switchLanguageTab('css')" style="padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid transparent; color: var(--text-gray); cursor: pointer; font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; transition: all 0.3s;">
                            <i class="fab fa-css3-alt"></i> CSS
                        </button>
                        <button class="lang-tab" data-lang="javascript" onclick="switchLanguageTab('javascript')" style="padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid transparent; color: var(--text-gray); cursor: pointer; font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; transition: all 0.3s;">
                            <i class="fab fa-js"></i> JavaScript
                        </button>
                        <div style="flex: 1;"></div>
                        <button id="toggleMergeBtn" onclick="toggleMergeMode()" style="padding: 8px 16px; margin-right: 12px; background: var(--card-bg); border: 1px solid var(--border); color: var(--text); cursor: pointer; border-radius: 6px; font-size: 12px; font-weight: 500; transition: all 0.3s;">
                            <i class="fas fa-layer-group"></i> <span id="mergeBtnText">合併模式</span>
                        </button>
                    </div>

                    <!-- 檔案標籤頁 -->
                    <div id="fileTabs" style="padding: 0; border-bottom: 1px solid var(--border); display: none; align-items: center; background: var(--darker-bg); overflow-x: auto; max-width: 100%;">
                        <!-- 標籤將由 JS 動態生成 -->
                    </div>
                    <!-- 編輯器標題欄 -->
                    <div style="padding: 12px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-code" style="color: var(--primary); font-size: 16px;"></i>
                            <span style="font-family: 'Courier Prime', monospace; font-size: 14px; font-weight: 600; color: var(--text);">代碼編輯器</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--error); opacity: 0.6;"></div>
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--warning); opacity: 0.6;"></div>
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success); opacity: 0.6;"></div>
                        </div>
                    </div>
                    <!-- 編輯器工具欄 -->
                    <div style="padding: 8px 12px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; background: rgba(0, 217, 255, 0.02); position: relative;">
                        <button onclick="toggleTemplateCode()" class="editor-tool-btn" title="顯示/隱藏HTML模板代碼" id="templateToggleBtn">
                            <i class="fas fa-eye-slash"></i> <span id="templateToggleText">隱藏模板</span>
                        </button>
                        <div style="width: 1px; height: 20px; background: var(--border);"></div>
                        <button onclick="toggleSearchPanel()" class="editor-tool-btn" title="搜尋代碼 (Ctrl+F)">
                            <i class="fas fa-search"></i> 搜尋
                        </button>
                        <button onclick="replaceInCode()" class="editor-tool-btn" title="取代代碼">
                            <i class="fas fa-exchange-alt"></i> 取代
                        </button>
                        <button onclick="toggleCodeFold()" class="editor-tool-btn" title="代碼摺疊">
                            <i class="fas fa-compress"></i> 摺疊
                        </button>
                        <button onclick="duplicateLine()" class="editor-tool-btn" title="複製當前行">
                            <i class="fas fa-clone"></i> 複製行
                        </button>
                        <button onclick="commentLine()" class="editor-tool-btn" title="註釋/取消註釋">
                            <i class="fas fa-comment-slash"></i> 註釋
                        </button>
                        <div style="width: 1px; height: 20px; background: var(--border);"></div>
                        <!-- 🎯 一站式平台功能：傳送到模擬器 -->
                        <button onclick="sendToAPISimulator()" class="editor-tool-btn" title="將代碼傳送到 API 模擬器進行前後端連接測試" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981; font-weight: 600;">
                            <i class="fas fa-paper-plane"></i> 傳送到 API 模擬器
                        </button>
                        <button onclick="sendToGitHub()" class="editor-tool-btn" title="將代碼傳送到 GitHub 模擬器進行版本控制" style="background: rgba(167, 113, 247, 0.1); border: 1px solid rgba(167, 113, 247, 0.3); color: #a371f7; font-weight: 600;">
                            <i class="fas fa-code-branch"></i> 傳送到 GitHub
                        </button>
                        <div style="flex: 1;"></div>
                        <span style="font-size: 11px; color: var(--text-gray);">
                            <i class="fas fa-keyboard"></i> Ctrl+F 搜尋 | Ctrl+T 切換模板
                        </span>

                        <!-- 增強搜索面板 -->
                        <div id="searchPanel" class="search-panel">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h4 style="margin: 0; color: var(--primary); font-size: 14px;">
                                    <i class="fas fa-search"></i> 搜索與取代
                                </h4>
                                <button onclick="toggleSearchPanel()" class="icon-btn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <input type="text" id="searchInput" class="search-input" placeholder="搜索...">
                            <input type="text" id="replaceInput" class="search-input" placeholder="取代為...">

                            <div class="search-options">
                                <label class="search-option">
                                    <input type="checkbox" id="regexSearch">
                                    <span>正則表達式</span>
                                </label>
                                <label class="search-option">
                                    <input type="checkbox" id="caseSensitive">
                                    <span>區分大小寫</span>
                                </label>
                                <label class="search-option">
                                    <input type="checkbox" id="wholeWord">
                                    <span>全字匹配</span>
                                </label>
                            </div>

                            <div style="display: flex; gap: 8px; margin-top: 12px;">
                                <button onclick="findNext()" class="btn" style="flex: 1; padding: 8px; font-size: 12px;">
                                    <i class="fas fa-arrow-down"></i> 下一個
                                </button>
                                <button onclick="findPrevious()" class="btn" style="flex: 1; padding: 8px; font-size: 12px;">
                                    <i class="fas fa-arrow-up"></i> 上一個
                                </button>
                            </div>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <button onclick="replaceNext()" class="btn btn-outline" style="flex: 1; padding: 8px; font-size: 12px;">
                                    取代
                                </button>
                                <button onclick="replaceAll()" class="btn btn-outline" style="flex: 1; padding: 8px; font-size: 12px;">
                                    全部取代
                                </button>
                            </div>

                            <div id="searchResults" style="margin-top: 12px; font-size: 11px; color: var(--text-gray); text-align: center;">
                                <!-- 搜索結果統計 -->
                            </div>
                        </div>
                    </div>
                    <!-- 代碼編輯器容器（帶行號） -->
                    <div style="flex: 1; display: flex; background: var(--darker-bg); position: relative; overflow: hidden;">
                        <!-- 行號列 -->
                        <div id="lineNumbers" style="width: 60px; background: var(--card-bg); color: var(--text-gray); font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.6; padding: 20px 10px 20px 0; text-align: right; user-select: none; border-right: 1px solid var(--border); overflow: hidden;">
                            <div>1</div>
                        </div>
                        <!-- 代碼編輯區 -->
                        <textarea id="freeCodeEditor" class="code-input" style="flex: 1; border: none; border-radius: 0; font-size: 13px; line-height: 1.6; font-weight: 400; padding-left: 15px;" placeholder="// 在此輸入您的代碼..."></textarea>
                        <!-- 代碼小地圖（Minimap） -->
                        <div id="minimap" style="width: 120px; background: rgba(0,0,0,0.3); border-left: 1px solid var(--border); overflow: hidden; position: relative; display: none;">
                            <canvas id="minimapCanvas" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>
                    <!-- 底部狀態欄（專業IDE風格） -->
                    <div style="padding: 6px 12px; border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; font-size: 12px; font-family: 'Fira Code', monospace; color: var(--text-gray); flex-wrap: wrap; gap: 8px; background: var(--card-bg);">
                        <!-- 左側狀態 -->
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <!-- Git 分支 -->
                            <button onclick="showGitBranchMenu()" style="background: transparent; border: none; color: var(--text-gray); cursor: pointer; display: flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 4px; transition: all 0.2s;" title="Git 分支">
                                <i class="fas fa-code-branch" style="font-size: 11px;"></i>
                                <span id="statusGitBranch">main</span>
                            </button>
                            <!-- 錯誤/警告 -->
                            <button onclick="toggleProblemsPanel()" style="background: transparent; border: none; color: var(--text-gray); cursor: pointer; display: flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 4px; transition: all 0.2s;" title="問題">
                                <i class="fas fa-times-circle" style="color: var(--error); font-size: 11px;"></i>
                                <span id="statusErrors">0</span>
                                <i class="fas fa-exclamation-triangle" style="color: var(--warning); font-size: 11px; margin-left: 4px;"></i>
                                <span id="statusWarnings">0</span>
                            </button>
                            <!-- 執行時間 -->
                            <span id="executionTime" style="display: none; color: var(--success);">
                                <i class="fas fa-clock"></i> <span id="execTimeValue">0</span>ms
                            </span>
                        </div>
                        <!-- 右側狀態 -->
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <!-- 游標位置 -->
                            <span id="cursorPosition" style="cursor: pointer;" title="前往指定行">
                                行 <span id="statusLine">1</span>, 列 <span id="statusColumn">1</span>
                            </span>
                            <!-- 選中字符數 -->
                            <span id="selectionInfo" style="display: none;">已選 <span id="selectedCount">0</span></span>
                            <!-- 縮排 -->
                            <span style="cursor: pointer;" title="縮排設置">空格: 4</span>
                            <!-- 編碼 -->
                            <span style="cursor: pointer;" title="文件編碼">UTF-8</span>
                            <!-- 語言模式 -->
                            <button onclick="showLanguageSelector()" style="background: transparent; border: none; color: var(--primary); cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.2s; font-family: 'Fira Code', monospace; font-size: 12px;" title="選擇語言模式">
                                <i class="fas fa-code"></i> <span id="statusLanguage">JavaScript</span>
                            </button>
                            <!-- 小地圖切換 -->
                            <button onclick="toggleMinimap()" style="background: transparent; border: none; color: var(--text-gray); cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.2s;" title="切換小地圖">
                                <i class="fas fa-map"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 調整大小分隔條 -->
                <div id="resizer" style="flex: 0 0 5px; background: var(--border); cursor: col-resize; position: relative; transition: background 0.2s;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 3px; height: 40px; background: var(--primary); border-radius: 2px; opacity: 0.5;"></div>
                </div>

                <!-- 右側：預覽與分析面板 (可調整寬度) -->
                <div id="previewSection" style="flex: 1; display: flex; flex-direction: column; background: var(--card-bg); min-width: 300px;">
                    <!-- 標題列 -->
                    <div style="padding: 12px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; background: var(--darker-bg);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-eye" style="color: var(--primary); font-size: 16px;"></i>
                            <span style="font-family: 'Courier Prime', monospace; font-size: 14px; font-weight: 600; color: var(--text);">即時預覽與分析</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div id="previewIndicator" style="width: 8px; height: 8px; border-radius: 50%; background: var(--success); box-shadow: 0 0 10px var(--success);"></div>
                            <button onclick="togglePreviewSize()" class="icon-btn" title="最大化/還原">
                                <i class="fas fa-expand-alt" id="expandIcon"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 即時預覽區域 -->
                    <div id="previewPanel" style="flex: 1; min-height: 200px; overflow: hidden; position: relative; display: flex; flex-direction: column; background: #000000; border-bottom: 1px solid var(--border);">
                        <!-- 前端 iframe 預覽 -->
                        <div id="freePreviewContainer" style="flex: 1; background: #000000; overflow: hidden; display: flex;">
                            <iframe id="freePreviewFrame" style="width: 100%; height: 100%; border: none; background: #ffffff;"></iframe>
                        </div>
                        <!-- 後端控制台���出 -->
                        <div id="freeConsoleOutput" class="optimized-scroll" style="display: none; flex: 1; background: #000000; padding: 20px; color: #00ff00; font-family: 'Fira Code', monospace; white-space: pre-wrap; font-size: 13px; line-height: 1.6;">
                            執行結果將顯示在這裡...
                        </div>
                    </div>

                    <!-- 即時代碼分析面板（顯示在預覽下方） -->
                    <div id="analysisPanel" class="optimized-scroll" style="flex: 0 0 auto; max-height: 400px; background: var(--darker-bg); border-top: 2px solid var(--border);">
                        <div style="padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; background: rgba(0, 217, 255, 0.03);">
                            <h3 style="color: var(--primary); font-size: 14px; margin: 0; font-family: 'Courier Prime', monospace; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-clipboard-check"></i> 即時代碼分析
                            </h3>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span id="analysisStatus" style="font-size: 11px; color: var(--text-gray);">
                                    <i class="fas fa-circle" style="font-size: 6px; color: var(--success);"></i> 即時分析中
                                </span>
                                <button onclick="toggleAnalysisPanel()" class="icon-btn" title="收起/展開">
                                    <i class="fas fa-chevron-down" id="analysisPanelIcon"></i>
                                </button>
                            </div>
                        </div>
                        <div id="analysisContent" style="padding: 16px 20px;">
                            <!-- 代碼品質評分 -->
                            <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 8px; margin-bottom: 16px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <span style="color: var(--text); font-weight: 600;">整體品質評分</span>
                                    <span id="qualityScore" style="font-size: 24px; font-weight: 700; color: var(--success);">--</span>
                                </div>
                                <div style="width: 100%; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                                    <div id="qualityBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--error), var(--warning), var(--success)); transition: width 0.5s;"></div>
                                </div>
                            </div>

                            <!-- 代碼統計 -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 16px;">
                                <div style="padding: 12px; background: rgba(124, 58, 237, 0.1); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--secondary);" id="statLines">0</div>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">總行數</div>
                                </div>
                                <div style="padding: 12px; background: rgba(0, 217, 255, 0.1); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--primary);" id="statFunctions">0</div>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">函數數量</div>
                                </div>
                                <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--success);" id="statComments">0</div>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">註釋行數</div>
                                </div>
                            </div>

                            <!-- 即時程式碼分析狀態表 -->
                            <div style="padding: 16px; background: rgba(0, 217, 255, 0.03); border-radius: 8px; margin-bottom: 16px; border: 1px solid var(--border);">
                                <h4 style="color: var(--primary); font-size: 14px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-clipboard-list"></i> 🔍 即時程式碼分析
                                </h4>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                        <thead>
                                            <tr style="border-bottom: 1px solid var(--border);">
                                                <th style="padding: 8px; text-align: left; color: var(--text); font-weight: 600;">檢查項目</th>
                                                <th style="padding: 8px; text-align: center; color: var(--text); font-weight: 600; width: 70px;">狀態</th>
                                                <th style="padding: 8px; text-align: left; color: var(--text); font-weight: 600;">建議</th>
                                            </tr>
                                        </thead>
                                        <tbody style="color: var(--text-gray);">
                                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <td style="padding: 10px 8px;">語法正確性</td>
                                                <td style="padding: 10px 8px; text-align: center;">
                                                    <span id="checkSyntax" style="font-size: 16px;">⏳</span>
                                                </td>
                                                <td style="padding: 10px 8px;" id="checkSyntaxMsg">等待分析...</td>
                                            </tr>
                                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <td style="padding: 10px 8px;">程式碼風格</td>
                                                <td style="padding: 10px 8px; text-align: center;">
                                                    <span id="checkStyle" style="font-size: 16px;">⏳</span>
                                                </td>
                                                <td style="padding: 10px 8px;" id="checkStyleMsg">等待分析...</td>
                                            </tr>
                                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <td style="padding: 10px 8px;">潛在錯誤</td>
                                                <td style="padding: 10px 8px; text-align: center;">
                                                    <span id="checkErrors" style="font-size: 16px;">⏳</span>
                                                </td>
                                                <td style="padding: 10px 8px;" id="checkErrorsMsg">等待分析...</td>
                                            </tr>
                                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <td style="padding: 10px 8px;">效能優化</td>
                                                <td style="padding: 10px 8px; text-align: center;">
                                                    <span id="checkPerf" style="font-size: 16px;">⏳</span>
                                                </td>
                                                <td style="padding: 10px 8px;" id="checkPerfMsg">等待分析...</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 8px;">安全性</td>
                                                <td style="padding: 10px 8px; text-align: center;">
                                                    <span id="checkSecurity" style="font-size: 16px;">⏳</span>
                                                </td>
                                                <td style="padding: 10px 8px;" id="checkSecurityMsg">等待分析...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- 問題檢測 -->
                            <div style="padding: 16px; background: rgba(0, 217, 255, 0.05); border-radius: 8px; border-left: 3px solid var(--primary);">
                                <h4 style="color: var(--primary); font-size: 14px; margin-bottom: 12px;">
                                    <i class="fas fa-bug"></i> 問題檢測
                                </h4>
                                <div id="issuesList" style="color: var(--text-gray); line-height: 1.8; font-size: 13px;">
                                    開始編寫代碼後，這裡將顯示代碼品質分析、最佳實踐建議和潛在錯誤提示。
                                </div>
                            </div>

                            <!-- 最佳實踐建議 -->
                            <div style="padding: 16px; background: rgba(16, 185, 129, 0.05); border-radius: 8px; border-left: 3px solid var(--success); margin-top: 16px;">
                                <h4 style="color: var(--success); font-size: 14px; margin-bottom: 12px;">
                                    <i class="fas fa-lightbulb"></i> 最佳實踐建議
                                </h4>
                                <div id="suggestionsList" style="color: var(--text-gray); line-height: 1.8; font-size: 13px;">
                                    暫無建議
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 程式碼片段庫面板 -->
                    <div id="snippetsPanel" class="preview-panel optimized-scroll" style="display: none; flex: 1; background: var(--darker-bg); padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 style="color: var(--primary); font-size: 16px; margin: 0; font-family: 'Courier Prime', monospace;">
                                <i class="fas fa-bookmark"></i> 程式碼片段庫
                            </h3>
                            <button id="saveSnippetBtn" class="btn" style="padding: 8px 16px; font-size: 12px;">
                                <i class="fas fa-save"></i> 保存當前代碼
                            </button>
                        </div>
                        <div id="snippetsList" style="display: grid; gap: 12px;">
                            <!-- 程式碼片段將在這裡動態生成 -->
                            <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 8px; border-left: 3px solid var(--secondary); text-align: center;">
                                <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">
                                    <i class="fas fa-info-circle"></i> 尚無保存的程式碼片段<br>
                                    <small style="font-size: 12px; opacity: 0.8;">點擊「保存當前代碼」開始建立您的程式碼庫</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 前後端 API 模擬器頁面 -->
    <div class="page" id="apiSimulatorPage" role="main" aria-labelledby="apiSimulatorTitle">
        <div class="container" style="max-width: 1400px; padding: 20px;">
            <header style="text-align: center; margin-bottom: 40px;">
                <div style="display: inline-block; position: relative; margin-bottom: 20px;">
                    <i class="fas fa-network-wired" aria-hidden="true" style="font-size: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px var(--glow-primary));"></i>
                </div>
                <h1 id="apiSimulatorTitle" class="gradient-text" style="font-size: 2.5rem; margin-bottom: 15px;">前後端 API 模擬器</h1>
                <p style="color: var(--text-gray); font-size: 1.1rem; max-width: 800px; margin: 0 auto;">
                    在純前端環境中體驗完整的前後端交互流程，包括 API 調用、數據庫操作、用戶認證等功能
                </p>
            </header>

            <!-- 🎯 前後端連結狀態面板 -->
            <div style="background: linear-gradient(135deg, rgba(78, 201, 176, 0.15), rgba(86, 156, 214, 0.15)); border: 2px solid var(--primary); border-radius: 16px; padding: 25px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(78, 201, 176, 0.2);">
                <h2 style="color: var(--primary); font-size: 1.6rem; margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 12px;">
                    <i class="fas fa-link"></i> 前後端連結狀態
                </h2>

                <!-- 連結狀態指示器 -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- 前端狀態 -->
                    <div id="frontendStatus" style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 2px solid var(--border); text-align: center; transition: all 0.3s;">
                        <div style="font-size: 48px; margin-bottom: 10px;">💻</div>
                        <h3 style="color: var(--text-gray); font-size: 1.1rem; margin-bottom: 8px;">前端代碼</h3>
                        <div id="frontendStatusText" style="color: var(--text-gray); font-size: 0.9rem;">等待代碼執行...</div>
                    </div>

                    <!-- 連結狀態 -->
                    <div id="connectionStatus" style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 2px solid var(--border); text-align: center; transition: all 0.3s;">
                        <div style="font-size: 48px; margin-bottom: 10px;">🔗</div>
                        <h3 style="color: var(--text-gray); font-size: 1.1rem; margin-bottom: 8px;">連結狀態</h3>
                        <div id="connectionStatusText" style="color: var(--text-gray); font-size: 0.9rem;">未連結</div>
                    </div>

                    <!-- 後端狀態 -->
                    <div id="backendStatus" style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 2px solid var(--border); text-align: center; transition: all 0.3s;">
                        <div style="font-size: 48px; margin-bottom: 10px;">⚙️</div>
                        <h3 style="color: var(--text-gray); font-size: 1.1rem; margin-bottom: 8px;">後端 API</h3>
                        <div id="backendStatusText" style="color: var(--text-gray); font-size: 0.9rem;">等待請求...</div>
                    </div>

                    <!-- 數據庫狀態 -->
                    <div id="databaseStatus" style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 2px solid var(--border); text-align: center; transition: all 0.3s;">
                        <div style="font-size: 48px; margin-bottom: 10px;">💾</div>
                        <h3 style="color: var(--text-gray); font-size: 1.1rem; margin-bottom: 8px;">數據庫</h3>
                        <div id="databaseStatusText" style="color: var(--text-gray); font-size: 0.9rem;">未連接</div>
                    </div>
                </div>

                <!-- 🎯 實時數據流可視化 -->
                <div id="dataFlowVisualization" style="margin-top: 20px; padding: 15px; background: var(--darker-bg); border-radius: 12px; border: 1px solid var(--border); display: none;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <div style="text-align: center;">
                            <div style="font-size: 32px; margin-bottom: 5px;">💻</div>
                            <div style="font-size: 0.8rem; color: var(--text-gray);">前端</div>
                        </div>
                        <div style="flex: 1; min-width: 100px;">
                            <div id="dataFlowArrow1" style="height: 4px; background: linear-gradient(90deg, transparent, var(--primary)); position: relative; border-radius: 2px;">
                                <div style="position: absolute; right: 0; top: -4px; width: 0; height: 0; border-left: 8px solid var(--primary); border-top: 6px solid transparent; border-bottom: 6px solid transparent;"></div>
                            </div>
                            <div style="text-align: center; margin-top: 5px; font-size: 0.75rem; color: var(--primary);" id="dataFlowLabel1">HTTP 請求</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 32px; margin-bottom: 5px;">⚙️</div>
                            <div style="font-size: 0.8rem; color: var(--text-gray);">後端 API</div>
                        </div>
                        <div style="flex: 1; min-width: 100px;">
                            <div id="dataFlowArrow2" style="height: 4px; background: linear-gradient(90deg, transparent, var(--secondary)); position: relative; border-radius: 2px;">
                                <div style="position: absolute; right: 0; top: -4px; width: 0; height: 0; border-left: 8px solid var(--secondary); border-top: 6px solid transparent; border-bottom: 6px solid transparent;"></div>
                            </div>
                            <div style="text-align: center; margin-top: 5px; font-size: 0.75rem; color: var(--secondary);" id="dataFlowLabel2">數據操作</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 32px; margin-bottom: 5px;">💾</div>
                            <div style="font-size: 0.8rem; color: var(--text-gray);">數據庫</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 💡 操作提示面板 -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #3b82f6; font-size: 1.2rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle"></i> 快速開始指引
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                        <div style="color: #3b82f6; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-play-circle"></i> 步驟 1
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「一鍵測試」或從下拉選單選擇示例代碼
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <div style="color: #10b981; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-code"></i> 步驟 2
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            查看前端代碼如何調用 API
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <div style="color: #f59e0b; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-paper-plane"></i> 步驟 3
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            點擊「執行代碼」發送 API 請求
                        </p>
                    </div>
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                        <div style="color: #8b5cf6; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem;">
                            <i class="fas fa-check-circle"></i> 步驟 4
                        </div>
                        <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                            查看響應數據和請求日誌
                        </p>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(78, 201, 176, 0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                    <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.7; margin: 0;">
                        <i class="fas fa-lightbulb" style="color: var(--warning);"></i> <strong style="color: var(--primary);">提示：</strong>
                        可以從自由模式編輯器中將代碼「傳送到 API 模擬器」進行測試，也可以將代碼「傳送到 GitHub 模擬器」進行版本控制
                    </p>
                </div>
            </div>

                <!-- 一鍵測試按鈕 -->
                <div style="text-align: center;">
                    <button onclick="testFullStackIntegration()" style="background: linear-gradient(135deg, #10b981, #3b82f6); color: white; border: none; padding: 18px 48px; border-radius: 12px; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4); transition: all 0.3s; margin-bottom: 12px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 32px rgba(16, 185, 129, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 24px rgba(16, 185, 129, 0.4)'">
                        <i class="fas fa-bolt"></i> ⚡ 一鍵測試前後端整合
                    </button>
                    <div style="color: var(--text-gray); font-size: 1rem; margin-top: 8px;">自動執行：載入示例 → 發送 API 請求 → 顯示響應 → 驗證數據庫</div>

                    <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="loadQuickStartExample()" style="background: rgba(78, 201, 176, 0.1); color: var(--primary); border: 2px solid var(--primary); padding: 12px 24px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(78, 201, 176, 0.2)'" onmouseout="this.style.background='rgba(78, 201, 176, 0.1)'">
                            <i class="fas fa-code"></i> 載入示例代碼
                        </button>
                        <button onclick="clearAllAPISimulatorData()" style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 2px solid #ef4444; padding: 12px 24px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">
                            <i class="fas fa-redo"></i> 重置所有狀態
                        </button>
                    </div>

                    <!-- 🎯 導出完整項目按鈕 -->
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(167, 113, 247, 0.1), rgba(78, 201, 176, 0.1)); border: 2px solid #a371f7; border-radius: 12px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h3 style="color: #a371f7; font-size: 1.2rem; margin-bottom: 8px;">
                                <i class="fas fa-box-open"></i> 完整項目導出
                            </h3>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">
                                導出包含前端代碼、後端API配置、數據庫數據和Git歷史的完整項目包
                            </p>
                        </div>
                        <button onclick="exportCompleteProject()" style="background: linear-gradient(135deg, #a371f7, var(--primary)); color: white; border: none; padding: 14px 32px; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 16px rgba(167, 113, 247, 0.3); transition: all 0.3s; width: 100%; max-width: 400px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(167, 113, 247, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(167, 113, 247, 0.3)'">
                            <i class="fas fa-download"></i> 📦 導出完整項目
                        </button>
                        <div style="margin-top: 12px; font-size: 0.85rem; color: var(--text-gray); text-align: center;">
                            <i class="fas fa-info-circle"></i> 包含完整的前後端代碼���數據庫和配置，可直接部署
                        </div>
                    </div>
                </div>
            </div>


            <!-- API Key 管理區 -->
            <div style="background: var(--card-bg); border-radius: 12px; padding: 30px; margin-bottom: 25px; border: 1px solid var(--border);">
                <h2 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-key"></i> API Key 管理中心
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="background: var(--darker-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--primary);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: var(--text-gray); font-size: 0.9rem;">當前 API Key</span>
                            <button class="btn btn-outline" id="generateApiKeyBtn" style="padding: 6px 12px; font-size: 0.85rem;" aria-label="重新生成 API Key">
                                <i class="fas fa-sync-alt" aria-hidden="true"></i> 重新生成
                            </button>
                        </div>
                        <div style="background: var(--input-bg); padding: 12px; border-radius: 6px; font-family: 'Fira Code', monospace; font-size: 0.9rem; word-break: break-all; display: flex; align-items: center; gap: 10px;">
                            <span id="currentApiKey" style="flex: 1;" aria-label="當前 API Key">sk_live_xxxxxxxxxxxxxxxxxxxxxx</span>
                            <button class="btn btn-outline" id="copyApiKeyBtn" style="padding: 6px 10px; font-size: 0.8rem;" aria-label="複製 API Key">
                                <i class="fas fa-copy" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-gray);">
                            <i class="fas fa-info-circle" aria-hidden="true"></i> 此 Key 僅用於本地模擬，不會發送到任何伺服器
                        </div>
                        <!-- API Key 驗證狀態 -->
                        <div id="apiKeyStatus" style="margin-top: 12px; padding: 10px; background: var(--input-bg); border-radius: 6px; border-left: 3px solid #10b981; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 16px;"></i>
                            <div style="flex: 1;">
                                <div style="font-size: 0.9rem; font-weight: 600; color: #10b981;">API Key 已就緒</div>
                                <div style="font-size: 0.75rem; color: var(--text-gray); margin-top: 2px;">所有 API 端點可以正常訪問</div>
                            </div>
                            <div id="apiKeyValidTime" style="font-size: 0.75rem; color: var(--text-gray);">剛才</div>
                        </div>
                    </div>
                    <div style="background: var(--darker-bg); padding: 20px; border-radius: 8px;">
                        <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 10px;">API 請求統計</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);" id="apiRequestCount">0</div>
                                <div style="font-size: 0.85rem; color: var(--text-gray);">總請求數</div>
                            </div>
                            <div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: var(--success);" id="apiSuccessRate">100%</div>
                                <div style="font-size: 0.85rem; color: var(--text-gray);">成功率</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 🎯 即時狀態監控面板 -->
                <div style="background: var(--darker-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border); margin-top: 20px;">
                    <h3 style="color: var(--secondary); font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-heartbeat"></i> 即時狀態監控
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <!-- API 狀態 -->
                        <div id="apiRealtimeStatus" style="background: var(--card-bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(107, 114, 128, 0.1); border-radius: 6px;">
                                <i class="fas fa-circle" style="color: #6b7280;"></i>
                                <span style="color: #6b7280; font-weight: 600; font-size: 13px;">待機中</span>
                            </div>
                        </div>

                        <!-- 請求進度 -->
                        <div id="apiRequestProgress" style="background: var(--card-bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="color: var(--text-gray); font-size: 12px; text-align: center;">無活動請求</div>
                        </div>

                        <!-- 數據庫狀態 -->
                        <div style="background: var(--card-bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-database" style="color: #8b5cf6;"></i>
                                <div style="flex: 1;">
                                    <div style="color: #8b5cf6; font-size: 12px; font-weight: 600;">數據庫</div>
                                    <div style="color: var(--text-gray); font-size: 11px;">內存模式</div>
                                </div>
                                <div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 🎯 API 高級配置 - 延遲回應和情境化模擬 -->
                <div style="background: var(--darker-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border); margin-top: 20px;">
                    <h3 style="color: var(--warning); font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-cog"></i> API 高級配置
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- 延遲回應配置 -->
                        <div style="background: var(--card-bg); padding: 16px; border-radius: 8px; border: 1px solid var(--border);">
                            <h4 style="color: var(--warning); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-clock"></i> 延遲回應模擬
                            </h4>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 6px; color: var(--text-gray); font-size: 0.85rem;">延遲類型：</label>
                                <select id="apiDelayType" style="width: 100%; padding: 8px; background: var(--input-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; font-size: 16px;">
                                    <option value="random">隨機延遲 (300-800ms)</option>
                                    <option value="fixed">固定延遲</option>
                                    <option value="none">無延遲（即時響應）</option>
                                    <option value="slow">慢速網絡 (1-3秒)</option>
                                </select>
                            </div>
                            <div id="fixedDelayControl" style="display: none; margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 6px; color: var(--text-gray); font-size: 0.85rem;">固定延遲時間 (毫秒)：</label>
                                <input type="number" id="apiFixedDelay" value="500" min="0" max="10000" step="100" style="width: 100%; padding: 8px; background: var(--input-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; font-size: 16px;">
                            </div>
                            <div style="padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 6px; font-size: 0.8rem; color: var(--text-gray);">
                                <i class="fas fa-info-circle" style="color: var(--warning);"></i> 模擬真實網絡環境中的延遲
                            </div>
                        </div>

                        <!-- 情境化回應配置 -->
                        <div style="background: var(--card-bg); padding: 16px; border-radius: 8px; border: 1px solid var(--border);">
                            <h4 style="color: var(--secondary); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-th-list"></i> 情境化回應
                            </h4>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 6px; color: var(--text-gray); font-size: 0.85rem;">響應情境：</label>
                                <select id="apiScenario" style="width: 100%; padding: 8px; background: var(--input-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; font-size: 16px;">
                                    <option value="normal">正常響應（200 OK）</option>
                                    <option value="error500">服務器錯誤（500）</option>
                                    <option value="error404">端點不存在（404）</option>
                                    <option value="error403">權限不足（403）</option>
                                    <option value="rateLimit">超過速率限制（429）</option>
                                    <option value="timeout">請求超時模擬</option>
                                </select>
                            </div>
                            <div style="padding: 10px; background: rgba(86, 156, 214, 0.1); border-radius: 6px; font-size: 0.8rem; color: var(--text-gray);">
                                <i class="fas fa-info-circle" style="color: var(--secondary);"></i> 根據不同情境返回不同狀態碼和內容
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 🎯 項目結構模擬器（類似GitHub倉庫） -->
                <div style="background: var(--darker-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border); margin-top: 20px;">
                    <h3 style="color: var(--primary); font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fab fa-github"></i> 項目結構 (類似 GitHub 倉庫)
                    </h3>
                    <div style="background: var(--card-bg); border-radius: 8px; padding: 15px; font-family: 'Fira Code', monospace; font-size: 13px; border: 1px solid var(--border);">
                        <div style="color: var(--primary); font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-folder-open"></i> project-repo/
                        </div>
                        <div style="padding-left: 20px;">
                            <!-- frontend folder -->
                            <div style="margin-bottom: 10px;">
                                <div style="color: #f59e0b; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <i class="fas fa-folder"></i> frontend/
                                    <span style="color: var(--text-gray); font-size: 11px; font-weight: normal;">前端代碼</span>
                                </div>
                                <div style="padding-left: 20px; color: var(--text-gray); line-height: 1.8;">
                                    <div><i class="far fa-file-code"></i> index.html</div>
                                    <div><i class="far fa-file-code"></i> style.css</div>
                                    <div><i class="far fa-file-code"></i> app.js</div>
                                </div>
                            </div>
                            <!-- backend folder -->
                            <div style="margin-bottom: 10px;">
                                <div style="color: #10b981; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <i class="fas fa-folder"></i> backend/
                                    <span style="color: var(--text-gray); font-size: 11px; font-weight: normal;">後端代碼</span>
                                </div>
                                <div style="padding-left: 20px; color: var(--text-gray); line-height: 1.8;">
                                    <div><i class="fab fa-node-js"></i> server.js</div>
                                    <div><i class="far fa-file-code"></i> routes.js</div>
                                    <div><i class="fas fa-database"></i> database.js</div>
                                </div>
                            </div>
                            <!-- docs folder -->
                            <div style="margin-bottom: 10px;">
                                <div style="color: #3b82f6; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <i class="fas fa-folder"></i> docs/
                                    <span style="color: var(--text-gray); font-size: 11px; font-weight: normal;">文檔</span>
                                </div>
                                <div style="padding-left: 20px; color: var(--text-gray); line-height: 1.8;">
                                    <div><i class="fab fa-markdown"></i> README.md</div>
                                    <div><i class="fab fa-markdown"></i> API.md</div>
                                </div>
                            </div>
                            <!-- root files -->
                            <div style="color: var(--text-gray); line-height: 1.8; margin-top: 10px;">
                                <div><i class="fab fa-npm"></i> package.json</div>
                                <div><i class="fab fa-markdown"></i> README.md</div>
                                <div><i class="far fa-file"></i> .gitignore</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: rgba(78, 201, 176, 0.1); border-left: 3px solid var(--primary); border-radius: 6px;">
                        <div style="color: var(--text-gray); font-size: 12px; line-height: 1.6;">
                            <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                            此結構模擬真實的 GitHub 倉庫組織方式，前後端代碼分離，便於團隊協作開發。
                        </div>
                    </div>
                </div>

                <!-- 🎯 開發階段工作流程面板 -->
                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); border: 2px solid #3b82f6; border-radius: 16px; padding: 25px; margin-top: 25px;">
                    <h2 style="color: #3b82f6; font-size: 1.6rem; margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 12px;">
                        <i class="fas fa-tasks"></i> 真實開發階段工作流程
                    </h2>

                    <!-- 階段導航標籤 -->
                    <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                        <button onclick="showDevStage(1)" class="dev-stage-btn active" data-stage="1" style="padding: 10px 16px; background: rgba(59, 130, 246, 0.2); border: 2px solid #3b82f6; color: #3b82f6; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-lightbulb"></i> 1. 規劃設計
                        </button>
                        <button onclick="showDevStage(2)" class="dev-stage-btn" data-stage="2" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-cogs"></i> 2. 環境設置
                        </button>
                        <button onclick="showDevStage(3)" class="dev-stage-btn" data-stage="3" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-server"></i> 3. 後端開發
                        </button>
                        <button onclick="showDevStage(4)" class="dev-stage-btn" data-stage="4" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-palette"></i> 4. 前端開發
                        </button>
                        <button onclick="showDevStage(5)" class="dev-stage-btn" data-stage="5" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-link"></i> 5. 前後端整合
                        </button>
                        <button onclick="showDevStage(6)" class="dev-stage-btn" data-stage="6" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-rocket"></i> 6. 測試與部署
                        </button>
                        <button onclick="showDevStage(7)" class="dev-stage-btn" data-stage="7" style="padding: 10px 16px; background: transparent; border: 2px solid var(--border); color: var(--text-gray); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                            <i class="fas fa-toolbox"></i> 7. 工具與技術棧
                        </button>
                    </div>

                    <!-- 第1階段：規劃設計 -->
                    <div id="dev-stage-1" class="dev-stage-panel" style="display: block;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-search"></i> 代碼偵測與分析
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 偵測匯入的前端代碼類型</li>
                                    <li>✓ 偵測匯入的後端代碼類型</li>
                                    <li>✓ 自動識別框架（React、Vue、Node.js等）</li>
                                    <li>✓ 分析API端點需求</li>
                                    <li>✓ 檢測數據庫schema</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="document.getElementById('frontendCodeEditor').scrollIntoView({behavior: 'smooth'});">→ 前往前端編輯器</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #ec4899;">
                                <h4 style="color: #ec4899; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-clipboard-list"></i> 需求分析
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 確定功能需求清單</li>
                                    <li>✓ 定義API接口規範</li>
                                    <li>✓ 規劃數據模型</li>
                                    <li>✓ 確定身份驗證方式（JWT、OAuth等）</li>
                                    <li>✓ 評估第三方服務需求</li>
                                    <li>✓ 制定性能與安全要求</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-project-diagram"></i> 架構設計
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 選擇前端框架（React、Vue、Angular）</li>
                                    <li>✓ 選擇後端框架（Express、Django、Spring）</li>
                                    <li>✓ 選擇數據庫（MySQL、PostgreSQL、MongoDB）</li>
                                    <li>✓ 設計系統架構圖</li>
                                    <li>✓ 規劃API路由結構</li>
                                    <li>✓ 設計數據流向</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-chart-line"></i> 技術選型
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 通訊協議選擇（REST、GraphQL、WebSocket）</li>
                                    <li>✓ 狀態管理方案（Redux、Vuex、Context API）</li>
                                    <li>✓ ORM/ODM選擇（Sequelize、Mongoose、TypeORM）</li>
                                    <li>✓ 快取策略（Redis、Memcached）</li>
                                    <li>✓ 部署方案（Docker、Kubernetes、雲服務）</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="showDevStage(7);">→ 查看完整技術棧</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 第2階段：開發環境設置 -->
                    <div id="dev-stage-2" class="dev-stage-panel" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-code"></i> 代碼編輯器安裝
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ VS Code（推薦）</li>
                                    <li>✓ WebStorm</li>
                                    <li>✓ Sublime Text</li>
                                    <li>✓ 安裝必要插件（ESLint、Prettier、Git Lens）</li>
                                    <li>✓ 配置編輯器設定</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="showToolSimulator('vscode');">→ 啟動VS Code模擬器</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-code-branch"></i> 版本控制設置
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 安裝Git</li>
                                    <li>✓ 配置GitHub/GitLab/Bitbucket</li>
                                    <li>✓ 設置SSH金鑰</li>
                                    <li>✓ 創建遠端倉庫</li>
                                    <li>✓ 配置.gitignore</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="document.getElementById('githubSimulator').scrollIntoView({behavior: 'smooth'});">→ 前往GitHub模擬器</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-box"></i> 依賴管理工具
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ Node.js 與 npm/yarn</li>
                                    <li>✓ Python 與 pip/pipenv</li>
                                    <li>✓ 初始化package.json</li>
                                    <li>✓ 安裝前端依賴（React、Vue等）</li>
                                    <li>✓ 安裝後端依賴（Express、Django等）</li>
                                    <li>✓ 設置開發與生產環境變數</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-database"></i> 數據庫環境
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 安裝數據庫（MySQL、PostgreSQL、MongoDB）</li>
                                    <li>✓ 配置數據庫管理工具</li>
                                    <li>✓ MySQL Workbench</li>
                                    <li>✓ pgAdmin</li>
                                    <li>✓ MongoDB Compass</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="document.getElementById('databaseSection').scrollIntoView({behavior: 'smooth'});">→ 前往數據庫模擬器</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 第3階段：後端開發 -->
                    <div id="dev-stage-3" class="dev-stage-panel" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-server"></i> 服務器框架搭建
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ Express.js (Node.js)</li>
                                    <li>✓ Django/Flask (Python)</li>
                                    <li>✓ Spring Boot (Java)</li>
                                    <li>✓ 配置服務器端口</li>
                                    <li>✓ 設置基本路由</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="document.getElementById('backendCodeEditor').scrollIntoView({behavior: 'smooth'});">→ 前往後端編輯器</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-exchange-alt"></i> API 端點開發
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ RESTful API 設計</li>
                                    <li>✓ CRUD 操作實現</li>
                                    <li>✓ 請求驗證與錯誤處理</li>
                                    <li>✓ API 文檔撰寫（Swagger）</li>
                                    <li>✓ 測試API端點</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="showToolSimulator('postman');">→ 使用Postman測試</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-database"></i> 數據庫集成
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 配置數據庫連接</li>
                                    <li>✓ 設計數據模型（Schema）</li>
                                    <li>✓ ORM/ODM 設置</li>
                                    <li>✓ 資料庫遷移（Migration）</li>
                                    <li>✓ 種子數據（Seeding）</li>
                                    <li style="color: var(--primary); cursor: pointer;" onclick="document.getElementById('databaseSection').scrollIntoView({behavior: 'smooth'});">→ 管理數據庫</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #ec4899;">
                                <h4 style="color: #ec4899; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-shield-alt"></i> 中間件與安全
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ CORS 配置</li>
                                    <li>✓ 身份驗證（JWT、OAuth）</li>
                                    <li>✓ 授權與權限控制</li>
                                    <li>✓ API 速率限制</li>
                                    <li>✓ 請求日誌記錄</li>
                                    <li>✓ 加密與安全最佳實踐</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-vial"></i> 後端測試
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 單元測試（Jest、Mocha）</li>
                                    <li>✓ 整合測試</li>
                                    <li>✓ API 端點測試</li>
                                    <li>✓ 數據庫測試</li>
                                    <li>✓ 測試覆蓋率報告</li>
                                    <li style="color: var(--primary);">→ 執行測試套件</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 第4階段：前端開發 -->
                    <div id="dev-stage-4" class="dev-stage-panel" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-sitemap"></i> 專案結構建立
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 元件化架構規劃</li>
                                    <li>✓ 目錄結構設計</li>
                                    <li style="color: var(--primary);">→ 查看上方項目結構</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-code"></i> API 服務層封裝
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ HTTP 客戶端配置</li>
                                    <li>✓ API 呼叫函數封裝</li>
                                    <li style="color: var(--primary);">→ 在編輯器中查看示例</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-database"></i> 狀態管理
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 全域狀態管理</li>
                                    <li>✓ 本地狀態管理</li>
                                    <li>✓ LocalStorage 模擬</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-check-square"></i> 使用者互動邏輯
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 事件處理</li>
                                    <li>✓ 表單驗證</li>
                                    <li>✓ 錯誤反饋</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 第5階段：前後端整合 -->
                    <div id="dev-stage-5" class="dev-stage-panel" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-plug"></i> API 對接測試
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 端點連通性測試</li>
                                    <li>✓ 資料格式驗證</li>
                                    <li style="color: var(--primary);">→ 執行代碼測試</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-globe"></i> 跨域問題解決
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ CORS 配置</li>
                                    <li>✓ 代理服務器設置</li>
                                    <li style="color: var(--primary);">→ 查看CORS示例</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-exclamation-triangle"></i> 錯誤處理整合
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 統一錯誤格式</li>
                                    <li>✓ 錯誤訊息顯示</li>
                                    <li>✓ HTTP狀態碼處理</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-spinner"></i> 載入狀態管理
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 請求載入指示</li>
                                    <li>✓ 優化使用者體驗</li>
                                    <li>✓ 進度條顯示</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 第6階段：測試與部署 -->
                    <div id="dev-stage-6" class="dev-stage-panel" style="display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-vial"></i> 整合測試
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 端到端測試</li>
                                    <li>✓ 使用者流程測試</li>
                                    <li style="color: var(--primary);">→ 一鍵測試整合</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-tachometer-alt"></i> 效能測試
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 載入時間測試</li>
                                    <li>✓ 請求延遲監控</li>
                                    <li style="color: var(--primary);">→ 查看性能數據</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-shield-alt"></i> 安全性檢查
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ API Key 驗證</li>
                                    <li>✓ 權限驗證測試</li>
                                    <li>✓ XSS/CSRF 防護</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-rocket"></i> 建置與部署
                                </h4>
                                <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                    <li>✓ 前端資源優化</li>
                                    <li>✓ 後端程式打包</li>
                                    <li style="color: var(--primary);">→ 導出完整項目</li>
                                </ul>
                            </div>

                            <div style="background: var(--card-bg); padding: 18px; border-radius: 10px; border-left: 4px solid #ec4899; grid-column: span 2;">
                                <h4 style="color: #ec4899; margin-bottom: 10px; font-size: 1.05rem;">
                                    <i class="fas fa-chart-line"></i> 監控與維護
                                </h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                    <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                        <li>✓ 系統監控設置</li>
                                        <li>✓ 即時狀態監控</li>
                                    </ul>
                                    <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                        <li>✓ 日誌分析</li>
                                        <li>✓ API 請求日誌</li>
                                    </ul>
                                    <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                                        <li>✓ 效能優化</li>
                                        <li style="color: var(--primary);">→ 查看即時狀態</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 第7階段：工具與技術棧 -->
                    <div id="dev-stage-7" class="dev-stage-panel" style="display: none;">
                        <div style="margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); border-radius: 12px; border-left: 4px solid #8b5cf6;">
                            <h3 style="color: #8b5cf6; margin-bottom: 15px; font-size: 1.3rem;">
                                <i class="fas fa-info-circle"></i> 工具與技術棧總覽
                            </h3>
                            <p style="color: var(--text-gray); line-height: 1.8; margin-bottom: 10px;">
                                本平台提供完整的開發工具模擬環境，讓您在瀏覽器中體驗真實的前後端開發流程。所有工具均在平台內完成，無需安裝任何軟體。
                            </p>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                                <div style="padding: 8px 16px; background: rgba(59, 130, 246, 0.15); border-radius: 20px; color: #3b82f6; font-size: 0.9rem;">
                                    <i class="fas fa-check-circle"></i> 零安裝
                                </div>
                                <div style="padding: 8px 16px; background: rgba(16, 185, 129, 0.15); border-radius: 20px; color: #10b981; font-size: 0.9rem;">
                                    <i class="fas fa-check-circle"></i> 純瀏覽器運行
                                </div>
                                <div style="padding: 8px 16px; background: rgba(245, 158, 11, 0.15); border-radius: 20px; color: #f59e0b; font-size: 0.9rem;">
                                    <i class="fas fa-check-circle"></i> 真實模擬
                                </div>
                                <div style="padding: 8px 16px; background: rgba(236, 72, 153, 0.15); border-radius: 20px; color: #ec4899; font-size: 0.9rem;">
                                    <i class="fas fa-check-circle"></i> 即時反饋
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- 程式編輯器 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #3b82f6;">
                                <h4 style="color: #3b82f6; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-code" style="font-size: 1.3rem;"></i> 程式編輯器
                                </h4>
                                <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ VS Code（推薦）</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• 強大的IntelliSense</li>
                                        <li>• 豐富的插件生態</li>
                                        <li>• 內建Git支援</li>
                                    </ul>
                                </div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 8px;">✓ WebStorm - JetBrains專業IDE</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 12px;">✓ Sublime Text - 輕量快速</div>
                                <button onclick="showToolSimulator('vscode')" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                                    <i class="fas fa-play"></i> 啟動編輯器模擬
                                </button>
                            </div>

                            <!-- 版本控制系統 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #10b981;">
                                <h4 style="color: #10b981; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fab fa-git-alt" style="font-size: 1.3rem;"></i> 版本控制系統
                                </h4>
                                <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ Git + GitHub</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• 分支管理（Branch）</li>
                                        <li>• 提交歷史（Commit）</li>
                                        <li>• Pull Request</li>
                                    </ul>
                                </div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 8px;">✓ GitLab - DevOps平台</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 12px;">✓ Bitbucket - Atlassian生態</div>
                                <button onclick="document.getElementById('githubSimulator').scrollIntoView({behavior: 'smooth'})" class="btn" style="width: 100%; margin-top: 10px; background: rgba(16, 185, 129, 0.2); border-color: #10b981; color: #10b981;">
                                    <i class="fab fa-github"></i> 前往GitHub模擬器
                                </button>
                            </div>

                            <!-- API 測試工具 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #f59e0b;">
                                <h4 style="color: #f59e0b; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-vial" style="font-size: 1.3rem;"></i> API 測試工具
                                </h4>
                                <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ Postman</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• API端點測試</li>
                                        <li>• 請求集合管理</li>
                                        <li>• 自動化測試腳本</li>
                                    </ul>
                                </div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 8px;">✓ Insomnia - 簡潔高效</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 12px;">✓ Swagger UI - API文檔與測試</div>
                                <button onclick="showToolSimulator('postman')" class="btn" style="width: 100%; margin-top: 10px; background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; color: #f59e0b;">
                                    <i class="fas fa-play"></i> 啟動Postman模擬
                                </button>
                            </div>

                            <!-- 資料庫管理工具 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #8b5cf6;">
                                <h4 style="color: #8b5cf6; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-database" style="font-size: 1.3rem;"></i> 資料庫管理工具
                                </h4>
                                <div style="background: rgba(139, 92, 246, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ MySQL Workbench</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• 視覺化設計工具</li>
                                        <li>• SQL查詢編輯器</li>
                                        <li>• 資料庫管理</li>
                                    </ul>
                                </div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 8px;">✓ pgAdmin - PostgreSQL管理</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 12px;">✓ MongoDB Compass - NoSQL GUI</div>
                                <button onclick="document.getElementById('databaseSection').scrollIntoView({behavior: 'smooth'})" class="btn" style="width: 100%; margin-top: 10px; background: rgba(139, 92, 246, 0.2); border-color: #8b5cf6; color: #8b5cf6;">
                                    <i class="fas fa-database"></i> 前往數據庫模擬器
                                </button>
                            </div>

                            <!-- 通訊技術與協議 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #ec4899; grid-column: span 2;">
                                <h4 style="color: #ec4899; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-network-wired" style="font-size: 1.3rem;"></i> 通訊技術與協議
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px;">
                                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                                        <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px; font-size: 1rem;">
                                            <i class="fas fa-exchange-alt"></i> REST API
                                        </div>
                                        <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 0;">
                                            <li>✓ 最常用標準</li>
                                            <li>✓ 無狀態通信</li>
                                            <li>✓ HTTP方法對應CRUD</li>
                                            <li style="color: var(--primary); cursor: pointer; margin-top: 8px;" onclick="executeAPISimulatorCode();">→ 測試REST API</li>
                                        </ul>
                                    </div>

                                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                        <div style="color: #10b981; font-weight: 600; margin-bottom: 8px; font-size: 1rem;">
                                            <i class="fas fa-project-diagram"></i> GraphQL
                                        </div>
                                        <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 0;">
                                            <li>✓ 靈活的資料查詢</li>
                                            <li>✓ 減少過度獲取</li>
                                            <li>✓ ���類型系統</li>
                                            <li style="color: var(--text-gray); margin-top: 8px;">→ 查詢優化範例</li>
                                        </ul>
                                    </div>

                                    <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                                        <div style="color: #f59e0b; font-weight: 600; margin-bottom: 8px; font-size: 1rem;">
                                            <i class="fas fa-bolt"></i> WebSocket
                                        </div>
                                        <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 0;">
                                            <li>✓ 全雙工通信</li>
                                            <li>✓ 即時應用必備</li>
                                            <li>✓ 低延遲推送</li>
                                            <li style="color: var(--text-gray); margin-top: 8px;">→ 即時通訊範例</li>
                                        </ul>
                                    </div>

                                    <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                                        <div style="color: #8b5cf6; font-weight: 600; margin-bottom: 8px; font-size: 1rem;">
                                            <i class="fas fa-cogs"></i> RPC / gRPC
                                        </div>
                                        <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 0;">
                                            <li>✓ 遠程程序呼叫</li>
                                            <li>✓ 高效二進制傳輸</li>
                                            <li>✓ 微服務架構</li>
                                            <li style="color: var(--text-gray); margin-top: 8px;">→ 服務間通訊</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- 協作與部署工具 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #06b6d4;">
                                <h4 style="color: #06b6d4; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-users-cog" style="font-size: 1.3rem;"></i> 協作與部署工具
                                </h4>
                                <div style="display: grid; gap: 12px;">
                                    <div style="background: rgba(6, 182, 212, 0.1); padding: 12px; border-radius: 8px;">
                                        <div style="color: var(--text); font-weight: 600; margin-bottom: 6px;">
                                            <i class="fas fa-book"></i> API 文件工具
                                        </div>
                                        <div style="color: var(--text-gray); font-size: 0.85rem; display: flex; gap: 15px; flex-wrap: wrap;">
                                            <span>✓ Swagger/OpenAPI</span>
                                            <span>✓ API Blueprint</span>
                                            <span>✓ Postman Collections</span>
                                        </div>
                                    </div>

                                    <div style="background: rgba(6, 182, 212, 0.1); padding: 12px; border-radius: 8px;">
                                        <div style="color: var(--text); font-weight: 600; margin-bottom: 6px;">
                                            <i class="fas fa-tasks"></i> 專案管理工具
                                        </div>
                                        <div style="color: var(--text-gray); font-size: 0.85rem; display: flex; gap: 15px; flex-wrap: wrap;">
                                            <span>✓ Jira</span>
                                            <span>✓ Trello</span>
                                            <span>✓ Asana</span>
                                        </div>
                                    </div>

                                    <div style="background: rgba(6, 182, 212, 0.1); padding: 12px; border-radius: 8px;">
                                        <div style="color: var(--text); font-weight: 600; margin-bottom: 6px;">
                                            <i class="fas fa-rocket"></i> 持續整合/部署 (CI/CD)
                                        </div>
                                        <div style="color: var(--text-gray); font-size: 0.85rem; display: flex; gap: 15px; flex-wrap: wrap;">
                                            <span>✓ Jenkins</span>
                                            <span>✓ GitHub Actions</span>
                                            <span>✓ GitLab CI/CD</span>
                                            <span>✓ CircleCI</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 容器化技術 -->
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #0ea5e9;">
                                <h4 style="color: #0ea5e9; margin-bottom: 15px; font-size: 1.15rem; display: flex; align-items: center; gap: 10px;">
                                    <i class="fab fa-docker" style="font-size: 1.3rem;"></i> 容器化技術
                                </h4>
                                <div style="background: rgba(14, 165, 233, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ Docker</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• 應用容器化</li>
                                        <li>• 一致的開發環境</li>
                                        <li>• 快速部署</li>
                                    </ul>
                                </div>
                                <div style="background: rgba(14, 165, 233, 0.1); padding: 12px; border-radius: 8px;">
                                    <div style="color: var(--text); font-weight: 600; margin-bottom: 8px;">✓ Kubernetes (K8s)</div>
                                    <ul style="color: var(--text-gray); font-size: 0.85rem; line-height: 1.7; list-style: none; padding-left: 20px;">
                                        <li>• 容器編排</li>
                                        <li>• 自動擴展</li>
                                        <li>• 服務發現與負載均衡</li>
                                    </ul>
                                </div>
                                <button onclick="showToolSimulator('docker')" class="btn" style="width: 100%; margin-top: 10px; background: rgba(14, 165, 233, 0.2); border-color: #0ea5e9; color: #0ea5e9;">
                                    <i class="fab fa-docker"></i> 啟動Docker模擬
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 主要功能區域 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                <!-- 左側：前端代碼編輯器（可折叠侧边栏） -->
                <div id="apiSidebar" class="collapsible-sidebar" style="background: var(--card-bg); border-radius: 12px; padding: 25px; border: 1px solid var(--border);">
                    <!-- 折叠按钮 -->
                    <div class="sidebar-toggle-btn" onclick="toggleApiSidebar()" title="折叠/展开前端代码区">
                        <i class="fas fa-chevron-left" id="apiSidebarToggleIcon"></i>
                    </div>

                    <h2 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fab fa-js"></i> 前端代碼（JavaScript）
                    </h2>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-gray); font-size: 0.9rem;">選擇示例：</label>
                        <select id="frontendExample" style="width: 100%; padding: 10px; background: var(--input-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; font-size: 16px;">
                            <optgroup label="基礎 API 調用">
                                <option value="user_auth">用戶認證 (POST /api/login)</option>
                                <option value="game_save">遊戲進度保存 (POST /api/game/save)</option>
                                <option value="game_load">遊戲進度讀取 (GET /api/game/load)</option>
                                <option value="player_data">玩家資料獲取 (GET /api/player)</option>
                                <option value="leaderboard">排行榜查詢 (GET /api/leaderboard)</option>
                            </optgroup>
                            <optgroup label="進階概念示例">
                                <option value="cors_example">CORS 跨域請求處理</option>
                                <option value="error_handling">錯誤處理與重試機制</option>
                                <option value="file_upload">文件上傳 (multipart/form-data)</option>
                                <option value="pagination">分頁查詢 (GET with params)</option>
                                <option value="batch_request">批量請求處理</option>
                            </optgroup>
                            <optgroup label="前後端連接完整示例">
                                <option value="frontend_api_service">✨ 完整 API 服務層（React + Axios）</option>
                                <option value="jwt_auth_example">🔐 JWT 身份驗證完整流程</option>
                                <option value="cors_config">🌐 CORS 跨域配置詳解</option>
                            </optgroup>
                            <optgroup label="其他">
                                <option value="backend_code">查看後端代碼示例</option>
                                <option value="custom">自定義請求</option>
                            </optgroup>
                        </select>
                    </div>
                    <textarea id="frontendCodeEditor" style="width: 100%; height: 350px; padding: 15px; background: var(--darker-bg); color: var(--text); border: 1px solid var(--border); border-radius: 8px; font-family: 'Fira Code', monospace; font-size: 14px; resize: vertical; line-height: 1.5;" aria-label="前端代碼編輯器" placeholder="在此輸入 JavaScript 代碼..."></textarea>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" id="executeFrontendBtn" style="flex: 1; min-width: 140px;" aria-label="執行前端代碼">
                            <i class="fas fa-play" aria-hidden="true"></i> 執行前端代碼
                        </button>
                        <button class="btn btn-outline" id="clearFrontendBtn" style="min-width: 100px;" aria-label="清空代碼編輯器">
                            <i class="fas fa-trash" aria-hidden="true"></i> 清空
                        </button>
                    </div>

                    <!-- 🎯 導入/導出按鈕 -->
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-outline" id="importFrontendBtn" style="flex: 1; background: rgba(78, 201, 176, 0.1); border-color: var(--primary); color: var(--primary);" aria-label="從裝置導入代碼文件">
                            <i class="fas fa-file-import" aria-hidden="true"></i> 導入文件
                        </button>
                        <button class="btn btn-outline" id="exportFrontendBtn" style="flex: 1; background: rgba(86, 156, 214, 0.1); border-color: var(--secondary); color: var(--secondary);" aria-label="導出當前代碼到裝置">
                            <i class="fas fa-file-export" aria-hidden="true"></i> 導出代碼
                        </button>
                    </div>
                    <!-- 隱藏的文件輸入框 -->
                    <input type="file" id="frontendFileInput" accept=".js,.txt,.html,.css" style="display: none;">

                    <!-- 🎯 快捷操作按鈕 -->
                    <div style="margin-top: 15px; padding: 15px; background: var(--darker-bg); border-radius: 8px; border: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                            <i class="fas fa-rocket" style="color: var(--primary);"></i>
                            <span style="color: var(--text-gray); font-size: 0.9rem; font-weight: 600;">快捷操作</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button onclick="navigateTo('apiSimulatorPage')" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981; padding: 10px 16px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; justify-content: center;" onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.1)'">
                                <i class="fas fa-network-wired"></i>
                                <span>API 模擬器</span>
                            </button>
                            <button onclick="navigateTo('githubSimulatorPage')" style="background: rgba(167, 113, 247, 0.1); border: 1px solid rgba(167, 113, 247, 0.3); color: #a371f7; padding: 10px 16px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; justify-content: center;" onmouseover="this.style.background='rgba(167, 113, 247, 0.2)'" onmouseout="this.style.background='rgba(167, 113, 247, 0.1)'">
                                <i class="fab fa-github"></i>
                                <span>GitHub 模擬器</span>
                            </button>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem; color: var(--text-gray); text-align: center;">
                            <i class="fas fa-info-circle"></i> 在其他模擬器中繼續開發
                        </div>
                    </div>
                </div>

                <!-- 右側：後端 API 模擬 -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 25px; border: 1px solid var(--border);">
                    <h2 style="color: var(--secondary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fab fa-python"></i> 後端 API 響應（模擬）
                    </h2>

                    <!-- 🎯 實時 HTTP 請求監控面板 -->
                    <div id="httpMonitorPanel" style="margin-bottom: 20px; padding: 15px; background: var(--darker-bg); border-radius: 8px; border: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div id="httpStatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; background: #6b7280; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 0.9rem; font-weight: 600; color: var(--text);">HTTP 請求監控</span>
                            </div>
                            <div id="httpRequestCounter" style="font-size: 0.85rem; color: var(--text-gray);">
                                <span id="httpTotalRequests">0</span> 個請求
                            </div>
                        </div>
                        <div id="httpLastRequest" style="font-size: 0.8rem; color: var(--text-gray); padding: 8px; background: var(--input-bg); border-radius: 6px;">
                            <i class="fas fa-info-circle"></i> 等待 HTTP 請求...
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-gray); font-size: 0.9rem;">API ���點配置：</label>
                        <select id="apiEndpoint" style="width: 100%; padding: 10px; background: var(--input-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; font-size: 16px;">
                            <option value="/api/login">POST /api/login - 用戶登錄</option>
                            <option value="/api/register">POST /api/register - 用戶註冊</option>
                            <option value="/api/game/save">POST /api/game/save - 保存遊戲</option>
                            <option value="/api/game/load">GET /api/game/load - 讀取遊戲</option>
                            <option value="/api/player">GET /api/player - 玩家資料</option>
                            <option value="/api/leaderboard">GET /api/leaderboard - 排行榜</option>
                        </select>
                    </div>
                    <div class="optimized-scroll" style="background: var(--darker-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--secondary); max-height: 350px; font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.6;">
                        <div id="backendResponse" style="white-space: pre-wrap; color: var(--text);">
// 後端響應將在這裡顯示
// 執行前端代碼後，模擬的後端響應會出現在此處
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: var(--darker-bg); border-radius: 6px; border-left: 3px solid var(--warning);">
                        <div style="font-size: 0.85rem; color: var(--text-gray);">
                            <i class="fas fa-info-circle"></i>
                            <strong>說明：</strong>後端 API 完全由前端模擬，數據存儲在瀏覽器 localStorage 中
                        </div>
                    </div>

                    <!-- 🎯 HTTP 請求完整生命周期可視化 -->
                    <div id="httpLifecyclePanel" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, rgba(78, 201, 176, 0.05), rgba(86, 156, 214, 0.05)); border-radius: 12px; border: 2px solid var(--border); display: none;">
                        <h3 style="color: var(--primary); font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-route"></i> HTTP ���求生命周期（真實流程模擬）
                        </h3>

                        <div style="display: grid; gap: 12px;">
                            <!-- 階段1：前端發送請求 -->
                            <div id="lifecycle-step-1" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">1</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">📤 前端發送 HTTP 請求</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">瀏覽器 → 網絡層 → 伺服器</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段2：中間件處理 -->
                            <div id="lifecycle-step-2" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">2</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">🔐 中間件層處理</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">CORS → 身份驗證 → API Key 檢查 → 請求日誌</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段3：路由匹配 -->
                            <div id="lifecycle-step-3" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">3</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">🛣️ 路由匹配與控制器</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">路由解析 → 參數提取 → 控制器調用</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段4：業務邏輯處理 -->
                            <div id="lifecycle-step-4" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">4</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">⚙️ 業務邏輯處理</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">數據驗證 → 業務規則檢查 → 數據轉換</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段5：數據庫操作 -->
                            <div id="lifecycle-step-5" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">5</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">💾 數據庫操作</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">連接池 → SQL/NoSQL 查詢 → 事務處理 → 數據返回</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段6：響應組裝 -->
                            <div id="lifecycle-step-6" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">6</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">📦 響應數據組裝</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">數據序列化 → 添加響應頭 → 狀態碼設置</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>

                            <!-- 階段7：返回前端 -->
                            <div id="lifecycle-step-7" class="lifecycle-step" style="padding: 12px; background: var(--card-bg); border-radius: 8px; border-left: 4px solid #6b7280; opacity: 0.5;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="step-indicator" style="width: 28px; height: 28px; border-radius: 50%; background: #6b7280; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">7</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">📥 前端接收響應</div>
                                        <div style="font-size: 0.85rem; color: var(--text-gray);">JSON 解析 → 狀態檢查 → UI 更新 → 用戶反饋</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color: #6b7280; font-size: 20px; display: none;"></i>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 15px; padding: 12px; background: rgba(78, 201, 176, 0.1); border-radius: 6px; border-left: 3px solid var(--primary);">
                            <div style="font-size: 0.85rem; color: var(--text-gray);">
                                <i class="fas fa-lightbulb" style="color: var(--primary);"></i>
                                <strong style="color: var(--primary);">真實流程模擬：</strong>此面板展示了真實世界中HTTP請求的完整生命周期，包括中間件、路由、業務邏輯、數據庫操作等所有環節。
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 數據庫管理區 -->
            <div style="background: var(--card-bg); border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid var(--border);">
                <h2 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-database"></i> 模擬數據庫管理
                </h2>
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-outline" id="viewUsersBtn" aria-label="查看用戶數據表">
                        <i class="fas fa-users" aria-hidden="true"></i> 查看用戶表
                    </button>
                    <button class="btn btn-outline" id="viewGamesBtn" aria-label="查看遊戲進度數據表">
                        <i class="fas fa-gamepad" aria-hidden="true"></i> 查看遊戲進度表
                    </button>
                    <button class="btn btn-outline" id="viewPlayersBtn" aria-label="查看玩家資料數據表">
                        <i class="fas fa-user-circle" aria-hidden="true"></i> 查看玩家資料表
                    </button>
                    <button class="btn btn-outline" id="clearDatabaseBtn" style="margin-left: auto; border-color: var(--error); color: var(--error);" aria-label="清空���有數據庫">
                        <i class="fas fa-trash-alt" aria-hidden="true"></i> 清空數據庫
                    </button>
                </div>
                <div class="optimized-scroll" style="background: var(--darker-bg); padding: 20px; border-radius: 8px; max-height: 400px;">
                    <pre id="databaseView" role="log" aria-live="polite" style="margin: 0; font-family: 'Fira Code', monospace; font-size: 13px; color: var(--text); white-space: pre-wrap; word-wrap: break-word;">選擇一個數據表查看內容...</pre>
                </div>
            </div>

            <!-- API 請求日誌 -->
            <div style="background: var(--card-bg); border-radius: 12px; padding: 25px; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--secondary); margin: 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-list-alt"></i> API 請求日誌
                    </h2>
                    <button class="btn btn-outline" id="clearLogsBtn" style="padding: 8px 16px; font-size: 0.9rem;" aria-label="清空 API 請求日誌">
                        <i class="fas fa-eraser" aria-hidden="true"></i> 清空日誌
                    </button>
                </div>
                <div class="optimized-scroll" style="background: var(--darker-bg); padding: 20px; border-radius: 8px; max-height: 300px;">
                    <div id="apiLogs" role="log" aria-live="polite" style="font-family: 'Fira Code', monospace; font-size: 12px; line-height: 1.8;">
                        <div style="color: var(--text-gray); font-style: italic;">暫無請求記錄...</div>
                    </div>
                </div>
            </div>
        </div>
    

    <!-- 操作指南模態 -->
    <div class="modal" id="guideModal">
        <div class="modal-content">
            <button class="modal-close" id="closeGuide">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="gradient-text" style="margin-bottom: 30px;">平台使用操作指南</h2>

            <div class="optimized-scroll" style="max-height: 70vh; padding-right: 10px;">
                <div style="display: grid; gap: 20px;">
                    <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-book"></i> 1. 選擇學習範疇
                        </h4>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            • <strong>前端語言</strong>：HTML, CSS, JavaScript（即時預覽）<br>
                            • <strong>後端語言</strong>：Python, Ruby, Java, C++, C#, TypeScript, Go, Rust, PHP（控制台輸出）<br>
                            <small style="color: var(--warning); font-size: 12px;">
                                <i class="fas fa-info-circle"></i> 2025年最新支持：TypeScript, Go, Rust, PHP 已加入！
                            </small>
                        </p>
                    </div>

                    <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-code"></i> 2. 選擇學習模式
                        </h4>
                        <p style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            • <strong>自由模式</strong>：完整的代碼編輯器，支持多種高級功能<br>
                            • <strong>題目模式</strong>：10個精心設計的關卡，循序漸進學習
                        </p>
                    </div>

                    <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-palette"></i> 🌐 前端專屬功能與工具
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong>✨ 即時預覽系統：</strong><br>
                            • 輸入代碼後 <span style="color: var(--primary);">50ms</span> 內即時渲染<br>
                            • 完整 iframe 沙盒環境，模擬真實瀏覽器<br>
                            • 支持 HTML/CSS/JavaScript 混合編寫<br>
                            • 自動刷新，無需手動運行<br><br>

                            <strong>🎨 前端特化工具：</strong><br>
                            • <strong>DOM 檢視器</strong>：實時查看頁面結構<br>
                            • <strong>CSS 調試</strong>：樣式即時修改和預覽<br>
                            • <strong>響應式測試</strong>：切換不同設備尺寸<br>
                            • <strong>瀏覽器控制台</strong>：查看 console.log 輸出<br><br>

                            <strong>📐 前端模板庫：</strong><br>
                            • HTML5 基礎模板（標準結構）<br>
                            • 響應式網頁模板（RWD）<br>
                            • Flexbox 佈局範例<br>
                            • CSS Grid 佈局範例<br>
                            • JavaScript 互動特效模板<br>
                            • 登入表單、導航欄、卡片設計等
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(124, 58, 237, 0.05); border-radius: 12px; border-left: 4px solid var(--secondary);">
                        <h4 style="color: var(--secondary); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-server"></i> ⚙️ 後端專屬功能與工具
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong>🖥️ 控制台���行：</strong><br>
                            • 點擊「運行」執行後端代碼<br>
                            • 黑底綠字終端���格輸出<br>
                            • 支持多種後端語言（Python, Ruby, Java, C++, C#）<br>
                            • 顯示執行時間統計<br><br>

                            <strong>🔧 後端特化工具：</strong><br>
                            • <strong>變數監視器</strong>：追蹤變數值變化<br>
                            • <strong>斷點調試</strong>：在指定行暫停執行<br>
                            • <strong>逐步執���</strong>：單步調試程序流程<br>
                            • <strong>堆疊追蹤</strong>：查看函數調用堆疊<br>
                            • <strong>記憶體分析</strong>：監控記憶體使用情況<br><br>

                            <strong>📚 後端模板庫：</strong><br>
                            • Python 基礎結構（函數、類）<br>
                            • 資料結構實現（鏈表、樹、圖）<br>
                            • 演算法模板（排序、搜尋）<br>
                            • 檔案處理範例<br>
                            • API 請求範例<br>
                            • 資料���連接範例（SQLite）
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(16, 185, 129, 0.05); border-radius: 12px; border-left: 4px solid var(--success);">
                        <h4 style="color: var(--success); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-tools"></i> 🛠️ 通用編輯器功能
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong>📝 智能編輯：</strong><br>
                            • <strong>智慧補全</strong>：自動完成關鍵字、標籤、函數<br>
                            • <strong>語法高亮</strong>：不同語言元素用顏色區分<br>
                            • <strong>代碼摺疊</strong>：折疊/展開代碼區塊<br>
                            • <strong>多游標編輯</strong>：同時編輯多個位置<br>
                            • <strong>快速註釋</strong>：一鍵註釋/取消註釋<br>
                            • <strong>代碼格式化</strong>：自動美化代碼<br><br>

                            <strong>🔍 搜尋與替換：</strong><br>
                            • 快速搜尋代碼（Ctrl+F）<br>
                            • 批量替換文本<br>
                            • 正則表達���支持<br><br>

                            <strong>📂 文件操作：</strong><br>
                            • 匯入代碼文件（.html, .css, .js, .py, .rb, .java, .cpp）<br>
                            • 匯出代碼為文件<br>
                            • 保存為程式碼片段
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(124, 58, 237, 0.05); border-radius: 12px; border-left: 4px solid var(--secondary);">
                        <h4 style="color: var(--secondary); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-layer-group"></i> 多標籤面板
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong>👁️ 即時預覽標籤：</strong><br>
                            • <strong>前端語言</strong>：HTML/CSS/JS 代碼在 iframe 中即時渲染，完全模擬瀏覽器環境<br>
                            • <strong>後端語言</strong>：Python 等代碼的控制台輸出結果<br>
                            • 綠色指示燈表示預覽功能正常運行<br>
                            • 輸入任何代碼後自動更新，無需手動刷新<br><br>

                            <strong>✅ 代碼 Review 標���（即時分析系統）：</strong><br>
                            • <strong>自動觸發</strong>：停止輸入 2 秒後自動分析<br>
                            • <strong>五大檢查項目</strong>：語法正確性、程式碼風格、潛在錯誤、效能優化、安全性<br>
                            • <strong>狀態表格</strong>：實時顯示每個檢查項的狀態（✅⚠️❌）<br>
                            • <strong>品質評分</strong>：0-100 分綜合評分���顏色標示（綠/黃/紅）<br>
                            • <strong>詳細建議</strong>：針對性的改進方案和最佳實踐<br>
                            • <strong>問題定位</strong>：準確指出錯誤位置和類型<br>
                            • <strong>多語言支持</strong>：JavaScript、Python、HTML、CSS 各有專門檢查規則<br><br>

                            <strong>📚 程式碼片段庫標籤：</strong><br>
                            • 保存當前編輯的代碼為片段<br>
                            • 一鍵載入已保存的片段到編輯器<br>
                            • 片段管理功能（查看、刪除）<br>
                            • 所有片段存儲在瀏覽器本地
                        </div>
                    </div>

                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(120, 119, 198, 0.1), rgba(255, 122, 127, 0.1)); border-radius: 12px; border: 2px solid #9333ea; box-shadow: 0 0 20px rgba(147, 51, 234, 0.2);">
                        <h4 style="color: #a855f7; margin-bottom: 15px; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-rocket"></i> 💎 專業 IDE 功能（2025 全新）
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong style="color: #a855f7; font-size: 16px;">🎨 專業編輯器界面：</strong><br>
                            • <strong>行號顯示</strong>：自動顯示行號，當前行高亮顯示<br>
                            • <strong>代碼小地圖（Minimap）</strong>：像 VS Code 一樣的代碼縮略圖，快速導航<br>
                            • <strong>檔案標籤系統</strong>：多檔案切換，類似專業 IDE<br>
                            • <strong>側邊欄文件管理器</strong>：樹狀文件結構，直觀管理專案<br><br>

                            <strong style="color: #10b981;">📊 智能狀態欄：</strong><br>
                            • <strong>Git 分支顯示</strong>：當前分支一目了然，點擊快速切換<br>
                            • <strong>錯誤/警告統計</strong>：實時顯示代碼問題數量<br>
                            • <strong>光標位置</strong>：顯示當前行號和列號<br>
                            • <strong>選中統計</strong>：顯示選中的字符數量<br>
                            • <strong>語言模式</strong>：點擊切換編程語言模式<br>
                            • <strong>編碼顯示</strong>：UTF-8 等編碼信息<br>
                            • <strong>縮排設置</strong>：空格/Tab 切換<br><br>

                            <strong style="color: #f59e0b;">⌨️ 強大快捷鍵系統：</strong><br>
                            • <kbd style="background: var(--darker-bg); padding: 3px 8px; border-radius: 4px; font-family: monospace;">Ctrl+Shift+P</kbd> - 打開命令面板（所有功能一鍵搜索）<br>
                            • <kbd style="background: var(--darker-bg); padding: 3px 8px; border-radius: 4px; font-family: monospace;">Ctrl+G</kbd> - 前往指定行<br>
                            • <kbd style="background: var(--darker-bg); padding: 3px 8px; border-radius: 4px; font-family: monospace;">Ctrl+F</kbd> - 搜索代碼<br>
                            • <kbd style="background: var(--darker-bg); padding: 3px 8px; border-radius: 4px; font-family: monospace;">Ctrl+K Ctrl+T</kbd> - 主題選擇器<br><br>

                            <strong style="color: #ec4899;">🎨 多主題支持：</strong><br>
                            • VS Code Dark+（默認）- 經典專業主題<br>
                            • Monokai Pro - 高對比度護眼主題<br>
                            • Dracula - 流行的紫色主題<br>
                            • GitHub Dark - GitHub 風格<br>
                            • One Dark Pro - Atom 經典主題<br><br>

                            <strong style="color: #06b6d4;">🛠️ 命令面板功能：</strong><br>
                            按 <kbd style="background: var(--darker-bg); padding: 3px 8px; border-radius: 4px; font-family: monospace;">Ctrl+Shift+P</kbd> 打開命令面板，快速訪問：<br>
                            • 運行代碼<br>
                            • 格式化代碼<br>
                            • 搜索/取代<br>
                            • 切換小地圖<br>
                            • 切換主題<br>
                            • 前往指定行<br>
                            • 更多功能持續添加中...
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(16, 185, 129, 0.05); border-radius: 12px; border-left: 4px solid var(--success);">
                        <h4 style="color: var(--success); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-keyboard"></i> 快捷操作與重要提示
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            • <strong>即時預覽（前端）</strong>：直接在左側編輯器輸入 HTML/CSS/JS，右側立即顯示效果（延遲僅 50ms）<br>
                            • <strong>運行代碼（後端）</strong>：編寫 Python 等代碼後點擊「運行」按鈕查看輸出<br>
                            • <strong>格式化代碼</strong>：點擊編輯器底部狀態欄的「格式化」按鈕自動美化代碼<br>
                            • <strong>切換標籤</strong>：點擊右側預覽面板頂部的標籤（即時預覽/Review/片段庫）<br>
                            • <strong>調整設置</strong>：點擊頂部「���置」按鈕調整字體大小、縮排等<br>
                            • <strong>匯入匯出</strong>：使用頂部按鈕匯入本地文件或匯出當前代碼<br>
                            • <strong>模板載入</strong>：點擊「模板」按鈕快速載入預設或自定義模板<br>
                            • <strong>💡 新功能</strong>：按 <kbd style="background: var(--darker-bg); padding: 2px 6px; border-radius: 3px;">Ctrl+Shift+P</kbd> 打開命令面板探索更多功能！
                        </div>
                    </div>

                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(78, 201, 176, 0.1), rgba(86, 156, 214, 0.1)); border-radius: 12px; border-left: 4px solid var(--primary); border: 2px solid var(--primary);">
                        <h4 style="color: var(--primary); margin-bottom: 15px; font-size: 18px;">
                            <i class="fas fa-network-wired"></i> 🔌 前後端 API 模擬器（重點功能）
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong style="color: var(--primary); font-size: 16px;">📖 功能概述：</strong><br>
                            完整模擬真實的前後端開發流程，讓您在瀏覽器中體驗前後端交互、API 調用、數據庫操作等核心概念。<br><br>

                            <strong style="color: var(--success);">✨ 核心功能：</strong><br>
                            • <strong>API Key 管理</strong>：自動生成 API 密鑰，模擬真實認證流程<br>
                            • <strong>模擬數據庫</strong>：三個數據表（users、games、players），支持完整 CRUD 操作<br>
                            • <strong>即時響應</strong>：前端發送請求 → 後端處理 → 返回 JSON 響應<br>
                            • <strong>請求日誌</strong>：記錄所有 API 調用，包含時間戳、方法、端點、狀態<br>
                            • <strong>數據可視化</strong>：實時查看數據庫中的數據變化<br><br>

                            <strong style="color: var(--secondary);">🎯 支持的 API 端點：</strong><br>
                            1. <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">POST /api/login</code> - 用戶登錄認證<br>
                            2. <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">GET/POST /api/player</code> - 玩家資料管理<br>
                            3. <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">POST /api/game/save</code> - 遊戲進度保存<br>
                            4. <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">GET /api/leaderboard</code> - 排行榜查詢（支持分頁）<br>
                            5. <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">POST /api/upload</code> - 文件上傳模擬<br><br>

                            <strong style="color: #a371f7;">💡 豐富的代碼示例（10+ 種）：</strong><br>
                            • ✨ <strong>完整 API 服務層</strong>（React + Axios）- 包含請求/響應攔截器、錯誤處理<br>
                            • 🔐 <strong>JWT 身份驗證</strong> - 完整的登錄/驗證/登出流程<br>
                            • 🌐 <strong>CORS 跨域配置</strong> - 4 種不同的配置方案<br>
                            • 📄 基礎 API 調用（用戶認證、數據獲取）<br>
                            • 📊 分頁查詢示例<br>
                            • 📦 批量請求處理<br>
                            • 📁 文件上傳示例<br>
                            • 🔧 錯誤處理與重試機制<br>
                            • 📋 完整後端代碼（Node.js/Express）<br><br>

                            <strong style="color: var(--warning);">📝 使用步驟：</strong><br>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <strong>1️⃣ 進入模擬器</strong><br>
                                　　點擊主頁「前後端 API 模擬器」卡片<br><br>

                                <strong>2️⃣ 獲取 API Key</strong><br>
                                　　• 系統自動生成唯一的 API 密鑰<br>
                                　　• 可點擊「複製」按鈕複製到剪貼板<br>
                                　　• 可點擊「重新生成」按鈕生成新密鑰<br><br>

                                <strong>3️⃣ 選擇示例代碼</strong><br>
                                　　• 從下拉選單選擇示例（推薦：完整 API 服務層）<br>
                                　　• 代碼會自動載入到編輯器<br>
                                　　• 也可以自己編寫代碼<br><br>

                                <strong>4️⃣ 執行代���</strong><br>
                                　　• 點擊「執行代碼」按鈕<br>
                                　　• 查看後端響應（右側面板）<br>
                                　　• 查看請求日誌（底部日誌面板）<br><br>

                                <strong>5️⃣ 查看數據庫</strong><br>
                                　　• 點擊「查看用戶表」、「查看遊戲表」等按鈕<br>
                                　　• 查看數據變化（實時更新）<br>
                                　　• 可隨時清空數據庫重新開始<br>
                            </div><br>

                            <strong style="color: var(--error);">⚠️ 學習重點：</strong><br>
                            • 理解 HTTP 請求方法（GET、POST、PUT、DELETE）<br>
                            • 理解 RESTful API 設計規範<br>
                            • 理解請求頭（Headers）和請求體（Body）<br>
                            • 理解 HTTP 狀態碼（200、401、404、500 等）<br>
                            • 理解 JSON 數據格式<br>
                            • 理解前後端認證機制（API Key、JWT）<br>
                            • 理解 CORS ���域問題與解決方案<br>
                        </div>
                    </div>

                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(167, 113, 247, 0.1), rgba(78, 201, 176, 0.1)); border-radius: 12px; border-left: 4px solid #a371f7; border: 2px solid #a371f7;">
                        <h4 style="color: #a371f7; margin-bottom: 15px; font-size: 18px;">
                            <i class="fab fa-github"></i> 🐙 GitHub 版本控制模擬器（重點功能）
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong style="color: #a371f7; font-size: 16px;">📖 功能概述：</strong><br>
                            完整模擬 Git 和 GitHub 的版本控制工作流程，包括提交、分支、合併、Pull Request 等核心功能。<br><br>

                            <strong style="color: var(--success);">✨ Git 核心命令：</strong><br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git status</code> - 查看倉庫狀態<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git commit</code> - 提交代碼更改<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git branch</code> - 創建新分支<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git checkout</code> - 切換分支<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git merge</code> - 合併分支<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git push</code> - 推送到遠程<br>
                            • <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">git pull</code> - 從遠程拉取<br><br>

                            <strong style="color: var(--secondary);">🎯 GitHub 協作功能：</strong><br>
                            • <strong>Pull Request</strong>：創建、合併、關閉 PR<br>
                            • <strong>Clone 倉庫</strong>：模擬克隆操作<br>
                            • <strong>Fork 倉庫</strong>：模擬分叉操作<br>
                            • <strong>分支管理</strong>：可視化分支列表<br>
                            • <strong>提交歷史</strong>：查看完整的 git log<br><br>

                            <strong style="color: var(--warning);">📝 使用步驟：</strong><br>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <strong>基礎提交流程：</strong><br>
                                1. 在代碼工作區編寫代碼（或點擊「模擬修改」）<br>
                                2. 點擊 <code>git status</code> 查看變更狀態<br>
                                3. 點擊 <code>git commit</code> 提交代碼<br>
                                4. 輸入提交信息（commit message）<br>
                                5. 查看提交歷史面板中的新提交<br><br>

                                <strong>分支開發流程：</strong><br>
                                1. 點擊 <code>git branch</code> 創建新分支<br>
                                2. 輸入分支名稱（如：feature/new-feature）<br>
                                3. 在分支列表中點擊切換到新分支<br>
                                4. 修改代碼並提交<br>
                                5. 點擊「創建 Pull Request」發起 PR<br>
                                6. 在 PR 列表中點擊「Merge」合併代碼<br><br>

                                <strong>團隊協作流程：</strong><br>
                                1. 創建功能分支並開發<br>
                                2. 提交代碼到本地分支<br>
                                3. 使用 <code>git push</code> 推送到遠程<br>
                                4. 創建 Pull Request 請求合併<br>
                                5. 審查代碼（模擬）<br>
                                6. 合併 PR 到主分支<br>
                                7. 使用 <code>git pull</code> 拉取最新代碼<br>
                            </div><br>

                            <strong style="color: var(--error);">⚠️ 學習重點：</strong><br>
                            • 理解 Git 的基本概念（工作區、暫存區、倉庫）<br>
                            • 理解提交（commit）的作用和最佳實踐<br>
                            • 理解分支（branch）的概念和使用場景<br>
                            • 理解合併（merge）和可能的衝突<br>
                            • 理解遠程倉庫和本地倉庫的關係<br>
                            • 理解 Pull Request 的協作開發流程<br>
                            • 養成良好的版本控制習慣<br>
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(16, 185, 129, 0.05); border-radius: 12px; border-left: 4px solid var(--success);">
                        <h4 style="color: var(--success); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-graduation-cap"></i> 📝 題目模式進階功能
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            <strong>🎯 智能篩選系統：</strong><br>
                            • <strong>難度篩選</strong>：基礎、中級、高級<br>
                            • <strong>類型篩選</strong>：選擇題、編程題、混合題<br>
                            • <strong>主題標籤</strong>：演算法、資料結構、語法基礎、實務應用<br>
                            • <strong>完成狀態</strong>：未完成、已完成、全部顯示<br>
                            • <strong>多重篩選</strong>：可同時應用多個條件<br><br>

                            <strong>🎲 隨機題目功能：</strong><br>
                            • 隨機抽選題目進行練習<br>
                            • 可設定難度範圍<br>
                            • 可限定主題標籤<br>
                            • 適合每日挑戰和復習<br><br>

                            <strong>📊 分類瀏覽：</strong><br>
                            • <strong>按難度</strong>：1-10 關依序排列<br>
                            • <strong>按主題</strong>：演算法、資料結構、語法等分組<br>
                            • <strong>按語言</strong>：HTML、CSS、JavaScript、Python 等分類<br>
                            • <strong>學習進度</strong>：顯示完成百分比<br><br>

                            <strong>✅ 練習流程：</strong><br>
                            1. 選擇關卡或使用篩選/隨機功能<br>
                            2. 閱讀題目描述和要求<br>
                            3. 編寫代碼並運行測試<br>
                            4. 查看系統自動評分和反饋<br>
                            5. 完成所有關卡解鎖成就證書
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(245, 158, 11, 0.05); border-radius: 12px; border-left: 4px solid var(--warning);">
                        <h4 style="color: var(--warning); margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-exclamation-triangle"></i> 重要提示與注意事項
                        </h4>
                        <div style="color: var(--text-gray); line-height: 1.8; font-size: 14px;">
                            • <strong>即時預覽說明</strong>：前端語言���HTML/CSS/JS）會在您輸入時自動預覽，無需點擊運行按鈕<br>
                            • <strong>後端語言運行</strong>：Python 等後端語言需要點擊「運行」按鈕才能看到輸出結果<br>
                            • <strong>數據存儲限制</strong>：程式碼片段和自定義模板僅保存在瀏覽器內存中，刷新頁面後會清除<br>
                            • <strong>匯出重要代碼</strong>：建議定期使用「���出」按鈕下載重要代碼到本地，以防數據丟失<br>
                            • <strong>瀏覽器兼容性</strong>：建議使用最新版 Chrome、Firefox 或 Edge 瀏覽器以獲得最佳體驗<br>
                            • <strong>手機使用提示</strong>：移動設備上編輯器和預覽面板會自動調整為上下佈局，確保良好的閱讀和編輯體驗<br>
                            • <strong>代碼執行安全</strong>���所有前端代碼在隔離的 iframe 中運行，後端代碼為模擬執行（不會實際運行）
                        </div>
                    </div>
                </div>
            </div>

                <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">3. 題目模式關卡設計</h4>
                    <p style="color: var(--text-gray); line-height: 1.6;">
                        • 關卡1-5：每關2題（基礎→語法）<br>
                        • 關卡6-10：每關4題（整合→進階）<br>
                        • 題目類型：選擇題 + 編程題
                    </p>
                </div>

                <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">4. 答題方式</h4>
                    <p style="color: var(--text-gray); line-height: 1.6;">
                        選擇題：點擊選項，檢查答案<br>
                        編程題：輸入代碼，查看執行結果
                    </p>
                </div>

                <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">5. 評分標準</h4>
                    <p style="color: var(--text-gray); line-height: 1.6;">
                        ⭐⭐⭐ 全對 (90%+)<br>
                        ⭐⭐ 良好 (70-89%)<br>
                        ⭐ 及格 (60-69%)
                    </p>
                </div>
            </div>
        </div>
    

    <!-- 流程圖模態 -->
    <div class="modal" id="flowchartModal">
        <div class="modal-content">
            <button class="modal-close" id="closeFlowchart">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="gradient-text" style="margin-bottom: 30px;">快速入門流程圖</h2>

            <div class="flowchart">
                <div class="flow-step">
                    <div class="flow-number">1</div>
                    <div class="flow-content">
                        <h4>選擇學習範疇</h4>
                        <p><strong>前端語言</strong>：HTML, CSS, JavaScript（支持即時預覽）<br>
                        <strong>後端語言</strong>：Python, Ruby, Java, C++, C#, TypeScript, Go, Rust, PHP（控制台輸出）</p>
                    </div>
                </div>

                <div style="text-align: center; color: var(--primary); font-size: 24px;">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <div class="flow-step">
                    <div class="flow-number">2</div>
                    <div class="flow-content">
                        <h4>選擇學習模式</h4>
                        <p><strong>自由模式</strong>：功能完整的代碼編輯器，支持即時預覽、代碼格式化、匯入匯出等<br>
                        <strong>題目模式</strong>：10 個精心設計的關卡，每關包含選擇題和編程題</p>
                    </div>
                </div>

                <div style="text-align: center; color: var(--primary); font-size: 24px;">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <div class="flow-step">
                    <div class="flow-number">3</div>
                    <div class="flow-content">
                        <h4>開始編碼 - 即時 Review 流程</h4>
                        <div style="background: rgba(0, 217, 255, 0.08); padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 3px solid var(--primary);">
                            <p style="margin-bottom: 8px;"><strong>使用者輸入程式碼</strong></p>
                            <p style="font-size: 0.95em; margin-left: 20px;">↓</p>
                            <p style="margin-bottom: 8px;"><strong>即時分析（每 2 秒或停止輸入後）</strong></p>
                            <p style="font-size: 0.95em; margin-left: 20px;">↓</p>
                            <p style="margin-bottom: 8px;"><strong>多維度檢查</strong></p>
                            <ul style="margin-left: 35px; font-size: 0.95em; line-height: 1.8;">
                                <li>語法檢查 - 自動檢測代碼錯誤</li>
                                <li>風格檢查 - 符合最佳實踐</li>
                                <li>潛在錯誤 - 提前發現問題</li>
                                <li>效能建議 - 優化代碼性能</li>
                                <li>安全性檢查 - 避免安全漏洞</li>
                            </ul>
                            <p style="font-size: 0.95em; margin-left: 20px; margin-top: 8px;">↓</p>
                            <p><strong>即時顯示結果（右側/底部 Review 面板）</strong></p>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; color: var(--primary); font-size: 24px;">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <div class="flow-step">
                    <div class="flow-number">4</div>
                    <div class="flow-content">
                        <h4>使用編輯器強化功能</h4>
                        <p><strong>編輯功能</strong>：智慧補全、錯誤檢查、格式化、代碼摺疊、多游標編輯<br>
                        <strong>調試工具</strong>：斷點、逐步執行、變數監視、堆疊檢視、執行流程視覺化<br>
                        <strong>模板系統</strong>：快速啟動項目、自訂模板、模板預覽與比較<br>
                        <strong>視覺化學習</strong>：演算法執行動畫、資料結構展示、複雜度分析</p>
                    </div>
                </div>

                <div style="text-align: center; color: var(--primary); font-size: 24px;">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <div class="flow-step">
                    <div class="flow-number">5</div>
                    <div class="flow-content">
                        <h4>查看即時回饋與成果</h4>
                        <p>• <strong>執行結果</strong>：即時顯示程式輸出<br>
                        • <strong>測試用例</strong>：自動檢查代碼正確性<br>
                        • <strong>效能統計</strong>：執行時間與記憶體分析<br>
                        • <strong>品質評分</strong>：代碼質量綜合評估<br>
                        • <strong>優化建議</strong>：針對性改進提示</p>
                    </div>
                </div>

                <div style="text-align: center; color: var(--primary); font-size: 24px;">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <div class="flow-step">
                    <div class="flow-number">6</div>
                    <div class="flow-content">
                        <h4>持續進步與成長</h4>
                        <p>• 完成更多關卡解鎖新挑戰<br>
                        • 嘗試不同語言擴展技能樹<br>
                        • 在自由模式中實踐所學知識<br>
                        • 使用調試工具深入理解代碼執行<br>
                        • 不斷提升編程技能，成為全棧開發者</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定義對話框 -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-content">
            <h3 class="custom-modal-title" id="modalTitle">提示</h3>
            <p class="custom-modal-message" id="modalMessage"></p>
            <input type="text" class="custom-modal-input" id="modalInput" style="display: none;">
            <div class="custom-modal-buttons">
                <button class="btn btn-outline" id="modalCancelBtn" style="padding: 10px 20px; font-size: 14px;">取消</button>
                <button class="btn" id="modalConfirmBtn" style="padding: 10px 20px; font-size: 14px;">確定</button>
            </div>
        </div>
    </div>

    <script>
        // 全局狀態
        const state = {
            category: null,
            mode: null,
            language: null,
            // 新增：程式碼片段（內存存儲）
            snippets: [],
            // 新增：編輯器設置
            editorSettings: {
                theme: 'dark',
                fontSize: 13,
                showLineNumbers: true,
                tabSize: 2,
                autoComplete: true,
                liveErrorCheck: true
            },
            // 新增：自定義模板
            customTemplates: [],
            // 新增：文件管理系統
            files: [
                { id: 1, name: 'index.html', content: '', type: 'html', active: true }
            ],
            currentFileId: 1,
            nextFileId: 2,
            fileExplorerVisible: true,
            // 新增：搜索狀態
            searchMatches: [],
            currentMatchIndex: -1,
            // API 模擬器狀態
            apiSimulator: {
                apiKey: '',
                requestCount: 0,
                successCount: 0,
                logs: [],
                lastKeyValidation: Date.now(),
                // 新增：即時狀態監控
                realtime: {
                    status: 'idle', // idle, processing, success, error
                    lastRequest: null,
                    latency: 0,
                    activeConnections: 0
                }
            },
            // 新增：項目結構模擬器
            projectStructure: {
                root: 'project-repo',
                folders: {
                    'frontend': {
                        files: ['index.html', 'style.css', 'app.js'],
                        description: '前端代碼（HTML/CSS/JS）'
                    },
                    'backend': {
                        files: ['server.js', 'routes.js', 'database.js'],
                        description: '後端代碼（Node.js + Express）'
                    },
                    'docs': {
                        files: ['README.md', 'API.md'],
                        description: '說明文檔'
                    }
                },
                rootFiles: ['package.json', 'README.md', '.gitignore']
            }
        };
        // 自定義提示框（替代 prompt）
        function showPromptDialog(message, defaultValue = '') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const title = document.getElementById('modalTitle');
                const msg = document.getElementById('modalMessage');
                const input = document.getElementById('modalInput');
                const cancelBtn = document.getElementById('modalCancelBtn');
                const confirmBtn = document.getElementById('modalConfirmBtn');

                title.textContent = '輸入';
                msg.textContent = message;
                input.style.display = 'block';
                input.value = defaultValue;
                cancelBtn.style.display = 'inline-block';
                modal.classList.add('active');

                input.focus();
                input.select();

                const handleConfirm = () => {
                    const value = input.value;
                    cleanup();
                    resolve(value || null);
                };

                const handleCancel = () => {
                    cleanup();
                    resolve(null);
                };

                const handleEnter = (e) => {
                    if (e.key === 'Enter') {
                        handleConfirm();
                    } else if (e.key === 'Escape') {
                        handleCancel();
                    }
                };

                const cleanup = () => {
                    modal.classList.remove('active');
                    input.style.display = 'none';
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    input.removeEventListener('keydown', handleEnter);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
                input.addEventListener('keydown', handleEnter);
            });
        }

        // 自定義確認框（替代 confirm）
        function showConfirmDialog(message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const title = document.getElementById('modalTitle');
                const msg = document.getElementById('modalMessage');
                const input = document.getElementById('modalInput');
                const cancelBtn = document.getElementById('modalCancelBtn');
                const confirmBtn = document.getElementById('modalConfirmBtn');

                title.textContent = '確認';
                msg.textContent = message;
                input.style.display = 'none';
                cancelBtn.style.display = 'inline-block';
                modal.classList.add('active');

                const handleConfirm = () => {
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    modal.classList.remove('active');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }

        // 內建模板庫
        const templates = {
            html: [
                {
                    name: '基礎 HTML5 模板',
                    category: 'basic',
                    description: '標準HTML5結構',
                    code: `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的網頁</title>
</head>
<body>
    <h1>歡迎！</h1>
    <p>開始編寫您的內容...</p>
</body>
</html>`
                },
                {
                    name: '響應式網頁模板',
                    category: 'layout',
                    description: '自適應設計',
                    code: `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>響應式網頁</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>響應式���計</h1>
        <p>這個模板會自動適應不同螢幕大小。</p>
    </div>
</body>
</html>`
                },
                {
                    name: '登入表單頁面',
                    category: 'form',
                    description: '完整登入頁面',
                    code: `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登入</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 350px;
        }
        h2 {
            margin: 0 0 30px;
            text-align: center;
            color: #333;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>會員登入</h2>
        <form>
            <input type="email" placeholder="電子郵件" required>
            <input type="password" placeholder="密碼" required>
            <button type="submit">登入</button>
        </form>
    </div>
</body>
</html>`
                },
                {
                    name: '導航欄模板',
                    category: 'component',
                    description: '響應式導航欄',
                    code: `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>導航欄</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        nav {
            background: #333;
            padding: 15px 0;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        .logo {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-links a:hover {
            color: #667eea;
        }
        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">MyWebsite</div>
            <ul class="nav-links">
                <li><a href="#home">首頁</a></li>
                <li><a href="#about">關於</a></li>
                <li><a href="#services">服務</a></li>
                <li><a href="#contact">聯絡</a></li>
            </ul>
        </div>
    </nav>
    <div style="padding: 40px; text-align: center;">
        <h1>歡迎！</h1>
    </div>
</body>
</html>`
                },
                {
                    name: '卡片���計頁面',
                    category: 'component',
                    description: '卡片佈局',
                    code: `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卡片設計</title>
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .card-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        .card-content {
            padding: 20px;
        }
        .card-title {
            margin: 0 0 10px;
            color: #333;
        }
        .card-text {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="cards-container">
        <div class="card">
            <div class="card-image"></div>
            <div class="card-content">
                <h3 class="card-title">卡片標題 1</h3>
                <p class="card-text">這是卡片的描���文字。</p>
            </div>
        </div>
        <div class="card">
            <div class="card-image" style="background: linear-gradient(135deg, #f093fb, #f5576c);"></div>
            <div class="card-content">
                <h3 class="card-title">卡片標題 2</h3>
                <p class="card-text">這是卡片的描述文字。</p>
            </div>
        </div>
        <div class="card">
            <div class="card-image" style="background: linear-gradient(135deg, #4facfe, #00f2fe);"></div>
            <div class="card-content">
                <h3 class="card-title">卡片標題 3</h3>
                <p class="card-text">這是卡片的描述文字。</p>
            </div>
        </div>
    </div>
</body>
</html>`
                }
            ],
            css: [
                {
                    name: 'Flexbox 佈局',
                    code: `.container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.item {
    flex: 1;
    padding: 20px;
    margin: 10px;
}`
                },
                {
                    name: 'Grid 佈局',
                    code: `.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
}

.grid-item {
    background: #f0f0f0;
    padding: 20px;
    border-radius: 8px;
}`
                }
            ],
            javascript: [
                {
                    name: 'DOM 操作範例',
                    category: 'basic',
                    description: '基礎DOM操作',
                    code: `// 獲取元素
const button = document.querySelector('#myButton');
const output = document.querySelector('#output');

// 添加事件監聽
button.addEventListener('click', () => {
    output.textContent = 'Hello, World!';
});`
                },
                {
                    name: 'Fetch API 範例',
                    category: 'api',
                    description: '異步數據獲取',
                    code: `// 使用 Fetch API 獲取數據
async function fetchData(url) {
    try {
        const response = await fetch(url);
        const data = await response.json();
        console.log(data);
        return data;
    } catch (error) {
        console.error('錯誤:', error);
    }
}

// 使用範例
// fetchData('https://api.example.com/data');`
                },
                {
                    name: '表單驗證範例',
                    category: 'form',
                    description: '前端表單驗證',
                    code: `// 表單驗證
function validateForm(formData) {
    const email = formData.get('email');
    const password = formData.get('password');
    const errors = [];

    // 電子郵件驗證
    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
    if (!emailRegex.test(email)) {
        errors.push('電子郵件格式不正確');
    }

    // 密碼驗證（至少8位）
    if (password.length < 8) {
        errors.push('密碼至少需要8個字符');
    }

    return {
        isValid: errors.length === 0,
        errors
    };
}

// 使用範例
const form = document.querySelector('form');
form.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const result = validateForm(formData);

    if (result.isValid) {
        console.log('表單驗證通過！');
    } else {
        console.log('錯誤：', result.errors);
    }
});`
                },
                {
                    name: 'Local Storage 範例',
                    category: 'storage',
                    description: '本地存儲操作（注意：在 Canvas iframe 環境中不可用）',
                    code: `// Local Storage 操作範例
// 注意：此代碼在 Canvas iframe 環境中無法運行
// 僅作為學習參考

// 保存數據
function saveData(key, value) {
    // localStorage.setItem(key, JSON.stringify(value));
    console.log('注意：localStorage 在 iframe 中不可用');
    console.log('請使用內存變量或其他存儲方案');
}

// 讀取數據
function getData(key) {
    // const data = localStorage.getItem(key);
    // return data ? JSON.parse(data) : null;
    console.log('localStorage 在 Canvas iframe 環境中不支持');
    return null;
}

// 刪除數據
function deleteData(key) {
    // localStorage.removeItem(key);
    console.log('localStorage 在 Canvas iframe 環境中不支持');
}

// 替代方案：使用內存對象
const memoryStorage = {};
function saveToMemory(key, value) {
    memoryStorage[key] = value;
    console.log('數據已保存到內存');
}

// 使用範例
saveToMemory('user', { name: '張三', age: 25 });
console.log(memoryStorage.user);`
                }
            ],
            python: [
                {
                    name: 'Python 基礎模板',
                    category: 'basic',
                    description: '基本程序結構',
                    code: `# Python 基礎程序
def main():
    print("Hello, World!")

if __name__ == "__main__":
    main()`
                },
                {
                    name: '函數定義範例',
                    category: 'basic',
                    description: '函數和文檔字符串',
                    code: `def greet(name):
    """問候函數"""
    return f"你好, {name}!"

def calculate_sum(numbers):
    """計算總和"""
    return sum(numbers)

# 測試
print(greet("學習者"))
print(calculate_sum([1, 2, 3, 4, 5]))`
                },
                {
                    name: '類與對象',
                    category: 'oop',
                    description: '面向對象編程',
                    code: `# 定義類
class Student:
    def __init__(self, name, age):
        self.name = name
        self.age = age
        self.grades = []

    def add_grade(self, grade):
        """添加成績"""
        self.grades.append(grade)

    def get_average(self):
        """計算平均分"""
        if not self.grades:
            return 0
        return sum(self.grades) / len(self.grades)

    def __str__(self):
        return f"學生: {self.name}, 年齡: {self.age}"

# 使用範例
student = Student("小明", 18)
student.add_grade(85)
student.add_grade(90)
student.add_grade(88)

print(student)
print(f"平均分: {student.get_average()}")`
                },
                {
                    name: '檔案處理',
                    category: 'file',
                    description: '讀寫檔案操作',
                    code: `# 檔案讀寫範例

# 寫入檔案
def write_file(filename, content):
    """寫入檔案"""
    try:
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"已寫入檔案: {filename}")
    except Exception as e:
        print(f"寫入錯誤: {e}")

# 讀取檔案
def read_file(filename):
    """讀取檔案"""
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            return f.read()
    except FileNotFoundError:
        print(f"檔案不存在: {filename}")
        return None
    except Exception as e:
        print(f"讀取錯誤: {e}")
        return None

# 使用範例
write_file('test.txt', 'Hello, Python!')
content = read_file('test.txt')
print(content)`
                },
                {
                    name: '資料結構 - 鏈表',
                    category: 'data-structure',
                    description: '單向鏈表實現',
                    code: `# 單向鏈表實現
class Node:
    """鏈表節點"""
    def __init__(self, data):
        self.data = data
        self.next = None

class LinkedList:
    """單向鏈表"""
    def __init__(self):
        self.head = None

    def append(self, data):
        """在末尾添加節點"""
        new_node = Node(data)
        if not self.head:
            self.head = new_node
            return

        current = self.head
        while current.next:
            current = current.next
        current.next = new_node

    def display(self):
        """顯示鏈表"""
        elements = []
        current = self.head
        while current:
            elements.append(str(current.data))
            current = current.next
        print(" -> ".join(elements))

    def find(self, data):
        """查找節點"""
        current = self.head
        while current:
            if current.data == data:
                return True
            current = current.next
        return False

# 使用範例
ll = LinkedList()
ll.append(1)
ll.append(2)
ll.append(3)
ll.display()
print(f"查找 2: {ll.find(2)}")`
                },
                {
                    name: '演算法 - 快速排序',
                    category: 'algorithm',
                    description: '快速排序實現',
                    code: `# 快速排序算法
def quick_sort(arr):
    """快速排序"""
    if len(arr) <= 1:
        return arr

    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]

    return quick_sort(left) + middle + quick_sort(right)

# 測試
numbers = [64, 34, 25, 12, 22, 11, 90]
print(f"原始數組: {numbers}")
sorted_numbers = quick_sort(numbers)
print(f"排序後: {sorted_numbers}")

# 時間複雜度: O(n log n) 平均情況`
                },
                {
                    name: '演算法 - 二分搜尋',
                    category: 'algorithm',
                    description: '二分搜尋實現',
                    code: `# 二分搜尋算法
def binary_search(arr, target):
    """
    二分搜尋
    前提：數組必須已排序
    """
    left, right = 0, len(arr) - 1

    while left <= right:
        mid = (left + right) // 2

        if arr[mid] == target:
            return mid  # 找到目標，返回索引
        elif arr[mid] < target:
            left = mid + 1
        else:
            right = mid - 1

    return -1  # 未找到

# 測試
sorted_arr = [11, 12, 22, 25, 34, 64, 90]
target = 25

result = binary_search(sorted_arr, target)
if result != -1:
    print(f"找到 {target}，索引為 {result}")
else:
    print(f"未找到 {target}")

# 時間複雜度: O(log n)`
                }
            ],
            ruby: [
                {
                    name: 'Ruby 基礎模板',
                    category: 'basic',
                    description: '基本程序結構',
                    code: `# Ruby 基礎程序
def main
  puts "Hello, World!"
end

main if __FILE__ == $0`
                },
                {
                    name: '方法定義範例',
                    category: 'basic',
                    description: '方法和參數',
                    code: `# 定義方法
def greet(name)
  "你好, #{name}!"
end

def calculate_sum(numbers)
  numbers.sum
end

# 測試
puts greet("學習者")
puts "總和: #{calculate_sum([1, 2, 3, 4, 5])}"

# 帶有預設參數的方法
def power(base, exponent = 2)
  base ** exponent
end

puts "2的3次���: #{power(2, 3)}"
puts "5的平方: #{power(5)}"`
                },
                {
                    name: '類與對象',
                    category: 'oop',
                    description: '面向對象編程',
                    code: `# 定義類
class Student
  attr_accessor :name, :age, :grades

  def initialize(name, age)
    @name = name
    @age = age
    @grades = []
  end

  def add_grade(grade)
    @grades << grade
  end

  def average
    return 0 if @grades.empty?
    @grades.sum.to_f / @grades.length
  end

  def to_s
    "學生: #{@name}, 年齡: #{@age}"
  end
end

# 使用範例
student = Student.new("小明", 18)
student.add_grade(85)
student.add_grade(90)
student.add_grade(88)

puts student
puts "平均分: #{student.average.round(2)}"`
                },
                {
                    name: '陣列與雜湊操作',
                    category: 'basic',
                    description: 'Ruby集合操作',
                    code: `# 陣列操作
numbers = [1, 2, 3, 4, 5]

# 常用方法
puts "原始陣列: #{numbers}"
puts "平方: #{numbers.map { |n| n ** 2 }}"
puts "偶數: #{numbers.select { |n| n.even? }}"
puts "總和: #{numbers.sum}"

# 雜湊（Hash）操作
person = {
  name: "張三",
  age: 25,
  city: "台北"
}

puts "\\n個人資料:"
person.each do |key, value|
  puts "  #{key}: #{value}"
end

# 符號與字符串作為鍵
person[:email] = "zhang@example.com"
puts "電子郵件: #{person[:email]}"`
                },
                {
                    name: '檔案處理',
                    category: 'file',
                    description: '讀寫檔案操作',
                    code: `# 檔案讀寫範例

# 寫入檔案
def write_file(filename, content)
  File.open(filename, 'w') do |file|
    file.write(content)
  end
  puts "已寫入檔案: #{filename}"
rescue => e
  puts "寫入錯誤: #{e.message}"
end

# 讀取檔案
def read_file(filename)
  File.read(filename)
rescue Errno::ENOENT
  puts "檔案不存在: #{filename}"
  nil
rescue => e
  puts "讀取錯誤: #{e.message}"
  nil
end

# 使用範例
write_file('test.txt', 'Hello, Ruby!')
content = read_file('test.txt')
puts content if content`
                },
                {
                    name: '演算法 - 氣泡排序',
                    category: 'algorithm',
                    description: '氣泡排序實現',
                    code: `# 氣泡排序算法
def bubble_sort(arr)
  n = arr.length

  (n - 1).times do |i|
    swapped = false

    (n - i - 1).times do |j|
      if arr[j] > arr[j + 1]
        arr[j], arr[j + 1] = arr[j + 1], arr[j]
        swapped = true
      end
    end

    break unless swapped
  end

  arr
end

# 測試
numbers = [64, 34, 25, 12, 22, 11, 90]
puts "���始數組: #{numbers}"
sorted = bubble_sort(numbers.dup)
puts "排序後: #{sorted}"

# 時間複雜度: O(n²)`
                }
            ],
            java: [
                {
                    name: 'Java 基礎模板',
                    category: 'basic',
                    description: '基本程序結構',
                    code: `public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`
                },
                {
                    name: '方法定義範例',
                    category: 'basic',
                    description: '方法和參數',
                    code: `public class MethodExample {
    // 問候方法
    public static String greet(String name) {
        return "你好, " + name + "!";
    }

    // 計算總和
    public static int calculateSum(int[] numbers) {
        int sum = 0;
        for (int num : numbers) {
            sum += num;
        }
        return sum;
    }

    // 帶重載的方法
    public static int multiply(int a, int b) {
        return a * b;
    }

    public static double multiply(double a, double b) {
        return a * b;
    }

    public static void main(String[] args) {
        System.out.println(greet("學習者"));

        int[] nums = {1, 2, 3, 4, 5};
        System.out.println("總和: " + calculateSum(nums));

        System.out.println("整數相乘: " + multiply(5, 3));
        System.out.println("小數相乘: " + multiply(2.5, 4.0));
    }
}`
                },
                {
                    name: '類與對象',
                    category: 'oop',
                    description: '面向對象編程',
                    code: `import java.util.ArrayList;

// 定義學生類
class Student {
    private String name;
    private int age;
    private ArrayList<Integer> grades;

    // 構造函數
    public Student(String name, int age) {
        this.name = name;
        this.age = age;
        this.grades = new ArrayList<>();
    }

    // 添加成績
    public void addGrade(int grade) {
        grades.add(grade);
    }

    // 計算平均分
    public double getAverage() {
        if (grades.isEmpty()) {
            return 0;
        }
        int sum = 0;
        for (int grade : grades) {
            sum += grade;
        }
        return (double) sum / grades.size();
    }

    // Getter 方法
    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    @Override
    public String toString() {
        return "學生: " + name + ", 年齡: " + age;
    }
}

// 主類
public class Main {
    public static void main(String[] args) {
        Student student = new Student("小明", 18);
        student.addGrade(85);
        student.addGrade(90);
        student.addGrade(88);

        System.out.println(student);
        System.out.printf("平均分: %.2f\\n", student.getAverage());
    }
}`
                },
                {
                    name: '異常處理',
                    category: 'basic',
                    description: '���誤處理機制',
                    code: `import java.io.*;

public class ExceptionExample {
    // 檔案讀取（帶異常處理）
    public static String readFile(String filename) {
        try {
            BufferedReader reader = new BufferedReader(new FileReader(filename));
            StringBuilder content = new StringBuilder();
            String line;

            while ((line = reader.readLine()) != null) {
                content.append(line).append("\\n");
            }

            reader.close();
            return content.toString();
        } catch (FileNotFoundException e) {
            System.out.println("檔案不存在: " + filename);
            return null;
        } catch (IOException e) {
            System.out.println("讀取錯誤: " + e.getMessage());
            return null;
        }
    }

    // 除法運算（帶異常處理）
    public static double divide(int a, int b) {
        try {
            return (double) a / b;
        } catch (ArithmeticException e) {
            System.out.println("錯誤: 不能除以零");
            return 0;
        }
    }

    public static void main(String[] args) {
        System.out.println("結果: " + divide(10, 2));
        System.out.println("結果: " + divide(10, 0));
    }
}`
                },
                {
                    name: '資料結構 - ArrayList',
                    category: 'data-structure',
                    description: '動態陣列操作',
                    code: `import java.util.ArrayList;
import java.util.Collections;

public class ArrayListExample {
    public static void main(String[] args) {
        // 創建 ArrayList
        ArrayList<String> fruits = new ArrayList<>();

        // 添加元素
        fruits.add("蘋果");
        fruits.add("香蕉");
        fruits.add("橙子");
        fruits.add("葡萄");

        System.out.println("原始���表: " + fruits);

        // 訪問元素
        System.out.println("第一個水果: " + fruits.get(0));

        // 修改元素
        fruits.set(1, "芒果");
        System.out.println("修改後: " + fruits);

        // 刪除元素
        fruits.remove("橙子");
        System.out.println("刪除橙子後: " + fruits);

        // 排序
        Collections.sort(fruits);
        System.out.println("排序後: " + fruits);

        // 大小和包含
        System.out.println("大小: " + fruits.size());
        System.out.println("是否包含蘋果: " + fruits.contains("蘋果"));

        // 遍歷
        System.out.println("\\n遍歷列表:");
        for (String fruit : fruits) {
            System.out.println("- " + fruit);
        }
    }
}`
                },
                {
                    name: '演算法 - 合併排序',
                    category: 'algorithm',
                    description: '合併排序實現',
                    code: `public class MergeSort {
    // 合併排序主函數
    public static void mergeSort(int[] arr, int left, int right) {
        if (left < right) {
            int mid = (left + right) / 2;

            // 分割左半部
            mergeSort(arr, left, mid);
            // 分割右半部
            mergeSort(arr, mid + 1, right);

            // 合併
            merge(arr, left, mid, right);
        }
    }

    // 合併函數
    private static void merge(int[] arr, int left, int mid, int right) {
        int n1 = mid - left + 1;
        int n2 = right - mid;

        int[] leftArr = new int[n1];
        int[] rightArr = new int[n2];

        for (int i = 0; i < n1; i++)
            leftArr[i] = arr[left + i];
        for (int j = 0; j < n2; j++)
            rightArr[j] = arr[mid + 1 + j];

        int i = 0, j = 0, k = left;

        while (i < n1 && j < n2) {
            if (leftArr[i] <= rightArr[j]) {
                arr[k] = leftArr[i];
                i++;
            } else {
                arr[k] = rightArr[j];
                j++;
            }
            k++;
        }

        while (i < n1) {
            arr[k] = leftArr[i];
            i++;
            k++;
        }

        while (j < n2) {
            arr[k] = rightArr[j];
            j++;
            k++;
        }
    }

    public static void main(String[] args) {
        int[] numbers = {64, 34, 25, 12, 22, 11, 90};

        System.out.print("原始數組: ");
        for (int num : numbers) System.out.print(num + " ");

        mergeSort(numbers, 0, numbers.length - 1);

        System.out.print("\\n排序後: ");
        for (int num : numbers) System.out.print(num + " ");

        System.out.println("\\n\\n時間複雜度: O(n log n)");
    }
}`
                }
            ],
            cpp: [
                {
                    name: 'C++ 基礎模板',
                    category: 'basic',
                    description: '基本程序結構',
                    code: `#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`
                },
                {
                    name: '函數定義範例',
                    category: 'basic',
                    description: '函數和參數',
                    code: `#include <iostream>
#include <string>
#include <vector>
using namespace std;

// 問候函數
string greet(string name) {
    return "你好, " + name + "!";
}

// 計算總和
int calculateSum(vector<int> numbers) {
    int sum = 0;
    for (int num : numbers) {
        sum += num;
    }
    return sum;
}

// 函數重載
int multiply(int a, int b) {
    return a * b;
}

double multiply(double a, double b) {
    return a * b;
}

int main() {
    cout << greet("學習者") << endl;

    vector<int> nums = {1, 2, 3, 4, 5};
    cout << "總和: " << calculateSum(nums) << endl;

    cout << "整數相乘: " << multiply(5, 3) << endl;
    cout << "小數相乘: " << multiply(2.5, 4.0) << endl;

    return 0;
}`
                },
                {
                    name: '類與對象',
                    category: 'oop',
                    description: '面向對象編程',
                    code: `#include <iostream>
#include <string>
#include <vector>
using namespace std;

// 定義學生類
class Student {
private:
    string name;
    int age;
    vector<int> grades;

public:
    // 構造函數
    Student(string n, int a) : name(n), age(a) {}

    // 添加成績
    void addGrade(int grade) {
        grades.push_back(grade);
    }

    // 計算平均分
    double getAverage() {
        if (grades.empty()) {
            return 0;
        }
        int sum = 0;
        for (int grade : grades) {
            sum += grade;
        }
        return static_cast<double>(sum) / grades.size();
    }

    // Getter 方法
    string getName() { return name; }
    int getAge() { return age; }

    // 顯示學生信息
    void display() {
        cout << "學生: " << name << ", 年齡: " << age << endl;
    }
};

int main() {
    Student student("小明", 18);
    student.addGrade(85);
    student.addGrade(90);
    student.addGrade(88);

    student.display();
    cout << "平均分: " << student.getAverage() << endl;

    return 0;
}`
                },
                {
                    name: '指標與引用',
                    category: 'basic',
                    description: '指標和引用操作',
                    code: `#include <iostream>
using namespace std;

// 透過引用交換值
void swapByReference(int &a, int &b) {
    int temp = a;
    a = b;
    b = temp;
}

// 透過指標交換值
void swapByPointer(int *a, int *b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

int main() {
    int x = 10, y = 20;

    cout << "原始值: x = " << x << ", y = " << y << endl;

    // 使用引用交換
    swapByReference(x, y);
    cout << "引用交換後: x = " << x << ", y = " << y << endl;

    // 使用指標交換
    swapByPointer(&x, &y);
    cout << "指標交換後: x = " << x << ", y = " << y << endl;

    // 指標基礎
    int value = 42;
    int *ptr = &value;

    cout << "\\n值: " << value << endl;
    cout << "位址: " << &value << endl;
    cout << "指標指向的值: " << *ptr << endl;

    return 0;
}`
                },
                {
                    name: '資料結構 - Vector',
                    category: 'data-structure',
                    description: '動態陣列操作',
                    code: `#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

int main() {
    // 創建 vector
    vector<int> numbers;

    // 添加元素
    numbers.push_back(5);
    numbers.push_back(2);
    numbers.push_back(8);
    numbers.push_back(1);
    numbers.push_back(9);

    cout << "原始 vector: ";
    for (int num : numbers) {
        cout << num << " ";
    }
    cout << endl;

    // 排序
    sort(numbers.begin(), numbers.end());
    cout << "排序後: ";
    for (int num : numbers) {
        cout << num << " ";
    }
    cout << endl;

    // 訪問元素
    cout << "第一個元素: " << numbers[0] << endl;
    cout << "最後一個元素: " << numbers.back() << endl;

    // 大小和容量
    cout << "大小: " << numbers.size() << endl;
    cout << "容量: " << numbers.capacity() << endl;

    // 查找元素
    auto it = find(numbers.begin(), numbers.end(), 8);
    if (it != numbers.end()) {
        cout << "找到 8 在索引: " << distance(numbers.begin(), it) << endl;
    }

    // 刪除元素
    numbers.pop_back();
    cout << "刪除最後元素後大小: " << numbers.size() << endl;

    return 0;
}`
                },
                {
                    name: '演算法 - 插������序',
                    category: 'algorithm',
                    description: '插入排序實現',
                    code: `#include <iostream>
#include <vector>
using namespace std;

// 插入排序算法
void insertionSort(vector<int>& arr) {
    int n = arr.size();

    for (int i = 1; i < n; i++) {
        int key = arr[i];
        int j = i - 1;

        // 將大於 key 的元素向後移動
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j--;
        }

        arr[j + 1] = key;
    }
}

// 顯示陣列
void printArray(const vector<int>& arr) {
    for (int num : arr) {
        cout << num << " ";
    }
    cout << endl;
}

int main() {
    vector<int> numbers = {64, 34, 25, 12, 22, 11, 90};

    cout << "原始數組: ";
    printArray(numbers);

    insertionSort(numbers);

    cout << "排序後: ";
    printArray(numbers);

    cout << "\\n時間複雜度: O(n²)" << endl;
    cout << "適用場景: 小型數據集或接近排序的數據" << endl;

    return 0;
}`
                }
            ]
        };

        // DOM 元素
        const pages = {
            home: document.getElementById('homePage'),
            free: document.getElementById('freePage'),
            apiSimulator: document.getElementById('apiSimulatorPage'),
            githubSimulator: document.getElementById('githubSimulatorPage')
        };

        const backBtn = document.getElementById('backBtn');

        // 初始化
        function init() {
            setupEventListeners();
        }

        // 事件監聽
        function setupEventListeners() {
            // 主頁語言選擇
            document.querySelectorAll('#homePage .category-card').forEach(card => {
                card.addEventListener('click', () => {
                    const language = card.dataset.language;
                    if (language) {
                        state.language = language;
                        state.mode = 'free';

                        // 设置category（前端或后端）
                        if (['html', 'css', 'javascript'].includes(language)) {
                            state.category = 'frontend';
                        } else {
                            state.category = 'backend';
                        }

                        loadFreeMode();
                    }
                });
            });
            // 返回按鈕
            if (backBtn) {
                backBtn.addEventListener('click', goBack);
            }

            // 模態
            const guideBtn = document.getElementById('guideBtn');
            const flowchartBtn = document.getElementById('flowchartBtn');
            const closeGuide = document.getElementById('closeGuide');
            const closeFlowchart = document.getElementById('closeFlowchart');

            if (guideBtn) {
                guideBtn.addEventListener('click', () => {
                    const guideModal = document.getElementById('guideModal');
                    if (guideModal) guideModal.classList.add('active');
                });
            }

            if (flowchartBtn) {
                flowchartBtn.addEventListener('click', () => {
                    const flowchartModal = document.getElementById('flowchartModal');
                    if (flowchartModal) flowchartModal.classList.add('active');
                });
            }

            if (closeGuide) {
                closeGuide.addEventListener('click', () => {
                    const guideModal = document.getElementById('guideModal');
                    if (guideModal) guideModal.classList.remove('active');
                });
            }

            if (closeFlowchart) {
                closeFlowchart.addEventListener('click', () => {
                    const flowchartModal = document.getElementById('flowchartModal');
                    if (flowchartModal) flowchartModal.classList.remove('active');
                });
            }

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // 自由模式 - 運行代碼按鈕
            const runCodeBtn = document.getElementById('runCodeBtn');
            if (runCodeBtn) {
                runCodeBtn.addEventListener('click', runFreeCode);
            }

            // 自由模式 - 即時預覽（前端語言）
            const freeEditor = document.getElementById('freeCodeEditor');
            if (freeEditor) {
                let typingTimer;
                let analysisTimer;

                freeEditor.addEventListener('input', function(e) {
                // 更新狀態欄
                updateEditorStats();

                // 智能補全（如果啟用）
                if (state.editorSettings.autoComplete !== false) {
                    handleAutoComplete(e);
                }

                // 使用極短的防抖時間，實現真正的即時預覽
                clearTimeout(typingTimer);
                typingTimer = setTimeout(function() {
                    // 前端语言即时预览
                    if (state.category === 'frontend' || ['html', 'css', 'javascript'].includes(state.language)) {
                        runFreeCode();
                    }
                }, 300); // 300ms延遲，平衡響應速度和性能

                // 即時錯誤檢查（如果���用）
                if (state.editorSettings.liveErrorCheck !== false) {
                    clearTimeout(analysisTimer);
                    analysisTimer = setTimeout(function() {
                        checkCodeErrors();
                    }, 1000);
                }

                // 即時���碼分析（2秒防抖）
                clearTimeout(analysisTimer);
                analysisTimer = setTimeout(function() {
                    // 只在 Review 面板處於活躍狀態時或有代碼時才分析
                    const reviewPanel = document.getElementById('reviewPanel');
                    if (reviewPanel && reviewPanel.classList.contains('active')) {
                        analyzeCode();
                    } else {
                        // 即使沒有顯示 Review 面板，也在後台更新分析狀態
                        // 這樣用戶切換到 Review 標籤時就能立即看到結果
                        const code = freeEditor.value;
                        if (code.trim().length > 0) {
                            silentAnalyzeCode(); // 靜默分析，不顯示通知
                        }
                    }
                }, 2000); // 2秒後分析
                });

                // 也監聽 keyup 事件作為備用
                freeEditor.addEventListener('keyup', function() {
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(function() {
                        if (state.category === 'frontend') {
                            runFreeCode();
                        }
                    }, 50);
                });
            }

            // 標籤切換事件
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    switchPreviewTab(targetTab);
                });
            });

            // 保存程式碼片段
            const saveSnippetBtn = document.getElementById('saveSnippetBtn');
            if (saveSnippetBtn) {
                saveSnippetBtn.addEventListener('click', saveCodeSnippet);
            }

            // 匯入按鈕
            const importBtn = document.getElementById('importBtn');
            const fileInput = document.getElementById('fileInput');
            if (importBtn && fileInput) {
                importBtn.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', handleFileImport);
            }

            // 匯出按鈕
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportCode);
            }

            // 模板按鈕
            const templateBtn = document.getElementById('templateBtn');
            if (templateBtn) {
                templateBtn.addEventListener('click', toggleTemplateDropdown);
            }

            // 設置按鈕
            const settingsBtn = document.getElementById('settingsBtn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', openSettings);
            }

            // 點擊外部關閉下拉選單
            document.addEventListener('click', (e) => {
                const templateDropdown = document.getElementById('templateDropdown');
                const templateBtn = document.getElementById('templateBtn');
                if (templateDropdown && templateBtn &&
                    !templateDropdown.contains(e.target) &&
                    !templateBtn.contains(e.target)) {
                    templateDropdown.style.display = 'none';
                }
            });
        }

        // 顯示頁面
        function showPage(pageName) {
            Object.values(pages).forEach(p => {
                if (p) p.classList.remove('active');
            });
            if (pages[pageName]) {
                pages[pageName].classList.add('active');
            }
            if (backBtn) {
                backBtn.style.display = pageName === 'home' ? 'none' : 'block';
            }
        }

        // 顯示指引頁面
        function showGuide(guideType) {
            const guidePage = guideType === 'apiGuide' ? 'apiGuidePage' : 'githubGuidePage';

            // 隱藏所有頁面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });

            // 顯示指引頁面
            const targetPage = document.getElementById(guidePage);
            if (targetPage) {
                targetPage.classList.add('active');
                targetPage.style.display = 'block';

                // 滾動到頁面頂部
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // 顯示通知
                const guideName = guideType === 'apiGuide' ? '前後端API結合流程步驟指引' : 'Github 模擬開發儲存庫操作流程';
                showNotification(`📖 已打開 ${guideName}`, 'success');
            }
        }

        // 返回
        function goBack() {
            if (pages.free && pages.free.classList.contains('active')) {
                showPage('home');
            } else if (pages.apiSimulator && pages.apiSimulator.classList.contains('active')) {
                showPage('home');
            } else if (pages.githubSimulator && pages.githubSimulator.classList.contains('active')) {
                showPage('home');
            }
        }

        // 前端多语言编辑器状态
        const editorState = {
            isMerged: false,
            currentLang: 'html',
            code: {
                html: '',
                css: '',
                javascript: ''
            }
        };

        // 切换语言标签
        function switchLanguageTab(lang) {
            // 只在独立模式下生效
            if (editorState.isMerged) return;

            // 保存当前语言的代码
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            editorState.code[editorState.currentLang] = editor.value;

            // 切换到新语言
            editorState.currentLang = lang;
            editor.value = editorState.code[lang] || '';

            // 更新标签样式
            document.querySelectorAll('.lang-tab').forEach(tab => {
                const tabLang = tab.dataset.lang;
                if (tabLang === lang) {
                    tab.style.borderBottom = '3px solid var(--primary)';
                    tab.style.color = 'var(--primary)';
                    tab.classList.add('active');
                } else {
                    tab.style.borderBottom = '3px solid transparent';
                    tab.style.color = 'var(--text-gray)';
                    tab.classList.remove('active');
                }
            });

            // 更新编辑器标题
            const titleMap = {
                html: 'HTML',
                css: 'CSS',
                javascript: 'JavaScript'
            };
            const titleEl = document.getElementById('freePageTitle');
            if (titleEl) {
                titleEl.textContent = '自由模式 - ' + titleMap[lang];
            }

            // 更新预览
            runFreeCode();
        }

        // 切换合并/独立模式
        function toggleMergeMode() {
            editorState.isMerged = !editorState.isMerged;
            const editor = document.getElementById('freeCodeEditor');
            const mergeBtnText = document.getElementById('mergeBtnText');
            const langTabs = document.querySelectorAll('.lang-tab');

            if (!editor || !mergeBtnText) return;

            if (editorState.isMerged) {
                // 切换到合并模式
                mergeBtnText.textContent = '独立模式';

                // 禁用标签切换
                langTabs.forEach(tab => {
                    tab.style.opacity = '0.5';
                    tab.style.cursor = 'not-allowed';
                });

                // 保存当前语言的代码
                editorState.code[editorState.currentLang] = editor.value;

                // 合并所有代码
                const htmlCode = editorState.code.html || '';
                const cssCode = editorState.code.css || '';
                const jsCode = editorState.code.javascript || '';

                let mergedCode = '<!DOCTYPE html>\n<html lang="zh-TW">\n<head>\n';
                mergedCode += '    <meta charset="UTF-8">\n';
                mergedCode += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
                mergedCode += '    <title>合併編輯器</title>\n';

                if (cssCode) {
                    mergedCode += '    <style>\n' + cssCode + '\n    </style>\n';
                }

                mergedCode += '</head>\n<body>\n\n';
                mergedCode += htmlCode + '\n\n';

                if (jsCode) {
                    mergedCode += '    <script>\n' + jsCode + '\n    </' + 'script>\n';
                }

                mergedCode += '</body>\n</html>';

                editor.value = mergedCode;

                const titleEl = document.getElementById('freePageTitle');
                if (titleEl) {
                    titleEl.textContent = '自由模式 - 合併編輯 (HTML+CSS+JS)';
                }
            } else {
                // 切换到独立模式
                mergeBtnText.textContent = '合併模式';

                // 启用标签切换
                langTabs.forEach(tab => {
                    tab.style.opacity = '1';
                    tab.style.cursor = 'pointer';
                });

                // 尝试从合并代码中提取各部分
                const mergedCode = editor.value;

                // 提取CSS
                const cssMatch = mergedCode.match(/<style[^>]*>([\s\S]*?)<\/style>/i);
                if (cssMatch) {
                    editorState.code.css = cssMatch[1].trim();
                }

                // 提取JavaScript
                const jsMatch = mergedCode.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
                if (jsMatch) {
                    editorState.code.javascript = jsMatch[1].trim();
                }

                // 提取HTML body内容
                const bodyMatch = mergedCode.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
                if (bodyMatch) {
                    let htmlContent = bodyMatch[1].trim();
                    // 移除script标签
                    htmlContent = htmlContent.replace(/<script[\s\S]*?<\/script>/gi, '').trim();
                    editorState.code.html = htmlContent;
                }

                // 恢复到当前选中的语言
                editor.value = editorState.code[editorState.currentLang] || '';
                switchLanguageTab(editorState.currentLang);
            }

            // 更新预览
            runFreeCode();
        }

        // 載入自由模式
        function loadFreeMode() {
            const languageNames = {
                html: 'HTML',
                css: 'CSS',
                javascript: 'JavaScript',
                python: 'Python',
                ruby: 'Ruby',
                java: 'Java',
                csharp: 'C#',
                cpp: 'C++',
                typescript: 'TypeScript',
                go: 'Go',
                rust: 'Rust',
                php: 'PHP'
            };
            const languageName = languageNames[state.language] || state.language.toUpperCase();

            const titleEl = document.getElementById('freePageTitle');
            if (titleEl) {
                titleEl.textContent = '自由模式 - ' + languageName;
            }

            // 設置初始範本代碼
            const editor = document.getElementById('freeCodeEditor');
            const previewContainer = document.getElementById('freePreviewContainer');
            const consoleOutput = document.getElementById('freeConsoleOutput');

            if (!editor || !previewContainer || !consoleOutput) {
                console.error('找不到必要的編輯器元素');
                return;
            }

            // 前端语言初始化editorState
            if (state.category === 'frontend') {
                // 初始化editorState的currentLang
                if (['html', 'css', 'javascript'].includes(state.language)) {
                    editorState.currentLang = state.language;
                    editorState.isMerged = false;

                    // 更新语言标签显示
                    document.querySelectorAll('.lang-tab').forEach(tab => {
                        const tabLang = tab.dataset.lang;
                        if (tabLang === state.language) {
                            tab.style.borderBottom = '3px solid var(--primary)';
                            tab.style.color = 'var(--primary)';
                            tab.classList.add('active');
                        } else {
                            tab.style.borderBottom = '3px solid transparent';
                            tab.style.color = 'var(--text-gray)';
                            tab.classList.remove('active');
                        }
                    });
                }
            }

            if (state.category === 'frontend') {
                // 前端：顯示iframe預覽，隱藏控制台
                previewContainer.style.display = 'flex';
                consoleOutput.style.display = 'none';

                var template;
                if (state.language === 'html') {
                    template = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-TW">',
                        '<head>',
                        '    <meta charset="UTF-8">',
                        '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                        '    <title>HTML編輯器</title>',
                        '    <style>',
                        '        body {',
                        '            font-family: system-ui, -apple-system, sans-serif;',
                        '            padding: 2rem;',
                        '            background: #f5f5f5;',
                        '        }',
                        '        h1 { color: #e34c26; }',
                        '    </style>',
                        '</head>',
                        '<body>',
                        '    <h1>歡迎來到HTML編輯器！</h1>',
                        '    <p>開始編寫您的HTML代碼...</p>',
                        '    ',
                        '</body>',
                        '</html>'
                    ].join('\n');
                } else if (state.language === 'javascript') {
                    var scriptOpen = '<' + 'script>';
                    var scriptClose = '</' + 'script>';
                    template = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-TW">',
                        '<head>',
                        '    <meta charset="UTF-8">',
                        '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                        '    <title>JavaScript編輯器</title>',
                        '    <style>',
                        '        body {',
                        '            font-family: system-ui, -apple-system, sans-serif;',
                        '            padding: 2rem;',
                        '            background: #282c34;',
                        '            color: white;',
                        '        }',
                        '        #output {',
                        '            background: #1e1e1e;',
                        '            padding: 1.5rem;',
                        '            border-radius: 8px;',
                        '            margin-top: 1rem;',
                        '            font-family: "Courier New", monospace;',
                        '            min-height: 100px;',
                        '        }',
                        '    </style>',
                        '</head>',
                        '<body>',
                        '    <h1>⚡ JavaScript編���器</h1>',
                        '    <div id="output">執行結果將顯示在這裡...</div>',
                        '',
                        '    ' + scriptOpen,
                        '        // 在這裡編寫JavaScript代碼',
                        '        const output = document.getElementById("output");',
                        '        ',
                        '        // 範例：顯示訊息',
                        '        output.innerHTML = "Hello, JavaScript! 🚀";',
                        '        ',
                        '        // 嘗試修改這裡的代碼看看效果！',
                        '    ' + scriptClose,
                        '</body>',
                        '</html>'
                    ].join('\n');
                } else if (state.language === 'css') {
                    template = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-TW">',
                        '<head>',
                        '    <meta charset="UTF-8">',
                        '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                        '    <title>CSS編輯器</title>',
                        '    <style>',
                        '        /* CSS樣式編輯器 */',
                        '        * {',
                        '            margin: 0;',
                        '            padding: 0;',
                        '            box-sizing: border-box;',
                        '        }',
                        '',
                        '        body {',
                        '            font-family: system-ui, -apple-system, sans-serif;',
                        '            padding: 2rem;',
                        '            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);',
                        '            min-height: 100vh;',
                        '            display: flex;',
                        '            align-items: center;',
                        '            justify-content: center;',
                        '        }',
                        '',
                        '        .container {',
                        '            background: white;',
                        '            padding: 3rem;',
                        '            border-radius: 20px;',
                        '            box-shadow: 0 20px 60px rgba(0,0,0,0.3);',
                        '            text-align: center;',
                        '            max-width: 600px;',
                        '        }',
                        '',
                        '        h1 {',
                        '            color: #667eea;',
                        '            font-size: 2.5rem;',
                        '            margin-bottom: 1rem;',
                        '        }',
                        '',
                        '        p {',
                        '            color: #666;',
                        '            font-size: 1.2rem;',
                        '            line-height: 1.6;',
                        '        }',
                        '',
                        '        /* 在下方編寫您的CSS樣式 */',
                        '    </style>',
                        '</head>',
                        '<body>',
                        '    <div class="container">',
                        '        <h1>🎨 CSS編輯器</h1>',
                        '        <p>修改上方的CSS樣式，看看效果如何！</p>',
                        '        <p style="margin-top: 1rem; font-size: 0.9rem; color: #999;">',
                        '            提示：嘗試修改顏色、字體大小、邊距等屬性',
                        '        </p>',
                        '    </div>',
                        '</body>',
                        '</html>'
                    ].join('\n');
                } else if (state.language === 'typescript') {
                    // 使用已定義的scriptOpen和scriptClose變數
                    var tsScriptOpen = '<' + 'script>';
                    var tsScriptClose = '</' + 'script>';
                    template = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-TW">',
                        '<head>',
                        '    <meta charset="UTF-8">',
                        '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                        '    <title>TypeScript編輯器</title>',
                        '    <style>',
                        '        body {',
                        '            font-family: system-ui, -apple-system, sans-serif;',
                        '            padding: 2rem;',
                        '            background: linear-gradient(135deg, #3178c6 0%, #235a97 100%);',
                        '            min-height: 100vh;',
                        '            color: white;',
                        '        }',
                        '        .container {',
                        '            max-width: 800px;',
                        '            margin: 0 auto;',
                        '            background: rgba(255,255,255,0.1);',
                        '            padding: 2rem;',
                        '            border-radius: 12px;',
                        '            backdrop-filter: blur(10px);',
                        '        }',
                        '        h1 {',
                        '            color: #ffffff;',
                        '            font-size: 2.5rem;',
                        '            margin-bottom: 1rem;',
                        '        }',
                        '        #output {',
                        '            background: rgba(0,0,0,0.3);',
                        '            padding: 1.5rem;',
                        '            border-radius: 8px;',
                        '            margin-top: 1rem;',
                        '            font-family: "Courier New", monospace;',
                        '            min-height: 100px;',
                        '            border-left: 4px solid #3178c6;',
                        '        }',
                        '    </style>',
                        '</head>',
                        '<body>',
                        '    <div class="container">',
                        '        <h1>⚡ TypeScript編輯器</h1>',
                        '        <p>TypeScript帶來類型安全的JavaScript開發體驗！</p>',
                        '        <div id="output">執行結果將顯示在這裡...</div>',
                        '    </div>',
                        '',
                        '    ' + tsScriptOpen,
                        '        // TypeScript 示例代碼（編譯為JavaScript後運行）',
                        '        const output = document.getElementById("output");',
                        '        ',
                        '        // ���義接口',
                        '        interface User {',
                        '            name: string;',
                        '            age: number;',
                        '        }',
                        '        ',
                        '        const user: User = {',
                        '            name: "學習者",',
                        '            age: 20',
                        '        };',
                        '        ',
                        '        output.innerHTML = `',
                        '            <strong>TypeScript運行成功！</strong><br>',
                        '            用戶名稱: ${user.name}<br>',
                        '            年齡: ${user.age}',
                        '        `;',
                        '    ' + tsScriptClose,
                        '</body>',
                        '</html>'
                    ].join('\n');
                } else {
                    // 默認HTML模板（防止未定義）
                    console.warn('前端語言未匹配到模板:', state.language);
                    template = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-TW">',
                        '<head>',
                        '    <meta charset="UTF-8">',
                        '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                        '    <title>編輯器</title>',
                        '</head>',
                        '<body>',
                        '    <h1>開始編寫代碼...</h1>',
                        '</body>',
                        '</html>'
                    ].join('\n');
                }

                // 對於HTML/CSS/JavaScript，不直接設置完整模板，而是設置簡單的初始代碼
                if (state.language === 'html') {
                    editorState.code.html = '<h1>歡迎來到HTML編輯器！</h1>\n<p>開始編寫您的HTML代碼...</p>';
                    editor.value = editorState.code.html;
                } else if (state.language === 'css') {
                    editorState.code.css = '/* CSS樣式編輯器 */\nbody {\n    font-family: Arial, sans-serif;\n    padding: 20px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n}\n\nh1 {\n    color: white;\n    text-align: center;\n}';
                    editor.value = editorState.code.css;
                } else if (state.language === 'javascript') {
                    editorState.code.javascript = '// 在這裡編寫JavaScript代碼\nconst output = document.getElementById("output");\nif (output) {\n    output.innerHTML = "Hello, JavaScript! 🚀";\n}\n\nconsole.log("JavaScript is running!");';
                    editor.value = editorState.code.javascript;
                } else {
                    // 其他前端語言（TypeScript等）使用完整模板
                    if (template) {
                        editor.value = template;
                    } else {
                        console.error('無法載入模板，語言:', state.language);
                        editor.value = '<!-- 模板載入失敗 -->';
                    }
                }
            } else {
                // 後端：隱藏iframe預覽，顯示控制台輸出
                previewContainer.style.display = 'none';
                consoleOutput.style.display = 'flex';

                var backendTemplate;
                if (state.language === 'python') {
                    backendTemplate = [
                        '# Python 範例',
                        'print("Hello World!")',
                        'print("歡迎來到Python編程世界！")',
                        '',
                        '# 變量',
                        'name = "學習者"',
                        'print("你好，" + name + "！")'
                    ].join('\n');
                } else if (state.language === 'ruby') {
                    backendTemplate = [
                        '# Ruby 範例',
                        'puts "Hello World!"',
                        'puts "歡迎來到Ruby編程世界！"',
                        '',
                        '# 變量',
                        'name = "學習者"',
                        'puts "你好，#{name}！"'
                    ].join('\n');
                } else if (state.language === 'java') {
                    backendTemplate = [
                        '// Java 範例',
                        'public class Main {',
                        '    public static void main(String[] args) {',
                        '        System.out.println("Hello World!");',
                        '        System.out.println("歡迎來到Java編程世界！");',
                        '    }',
                        '}'
                    ].join('\n');
                } else if (state.language === 'csharp') {
                    backendTemplate = [
                        '// C# 範例',
                        'using System;',
                        '',
                        'class Program {',
                        '    static void Main() {',
                        '        Console.WriteLine("Hello World!");',
                        '        Console.WriteLine("歡迎來到C#編程世界！");',
                        '    }',
                        '}'
                    ].join('\n');
                } else if (state.language === 'cpp') {
                    backendTemplate = [
                        '// C++ 範例',
                        '#include ' + '<iostream>',
                        'using namespace std;',
                        '',
                        'int main() {',
                        '    cout ' + '<' + '< "Hello World!" ' + '<' + '< endl;',
                        '    cout ' + '<' + '< "歡迎來到C++編程世界！" ' + '<' + '< endl;',
                        '    return 0;',
                        '}'
                    ].join('\n');
                } else if (state.language === 'go') {
                    backendTemplate = [
                        '// Go 範例',
                        'package main',
                        '',
                        'import "fmt"',
                        '',
                        'func main() {',
                        '    fmt.Println("Hello World!")',
                        '    fmt.Println("歡迎來到Go編程世界！")',
                        '',
                        '    // 變量',
                        '    name := "學習者"',
                        '    fmt.Printf("你好，%s！\\n", name)',
                        '}'
                    ].join('\n');
                } else if (state.language === 'rust') {
                    backendTemplate = [
                        '// Rust 範例',
                        'fn main() {',
                        '    println!("Hello World!");',
                        '    println!("歡迎來到Rust編程世界！");',
                        '',
                        '    // 變量',
                        '    let name = "學習者";',
                        '    println!("你好，{}！", name);',
                        '}'
                    ].join('\n');
                } else if (state.language === 'php') {
                    backendTemplate = [
                        '<' + '?php',
                        '// PHP 範例',
                        'echo "Hello World!\\n";',
                        'echo "歡迎來到PHP編程世界！\\n";',
                        '',
                        '// 變量',
                        '$name = "學習者";',
                        'echo "你好，{$name}！\\n";',
                        '?' + '>'
                    ].join('\n');
                } else {
                    // 默認後端模板
                    backendTemplate = [
                        '// 開始編寫代碼...',
                        'print("Hello World!")'
                    ].join('\n');
                }

                // 確保backendTemplate有值才賦值
                if (backendTemplate) {
                    editor.value = backendTemplate;
                } else {
                    console.error('無法載入後端模板，語言:', state.language);
                    editor.value = '// 模板載入失敗';
                }
            }

            // 執行初始預覽
            runFreeCode();
            // 初始化狀態欄
            updateEditorStats();
            showPage('free');
        }

        // 更新編輯器統計信息
        function updateEditorStats() {
            const editor = document.getElementById('freeCodeEditor');
            const statsEl = document.getElementById('editorStats');
            const statusEl = document.getElementById('editorStatus');

            // 安全檢查：確保元素存在
            if (!editor || !statsEl || !statusEl) {
                return;
            }

            const code = editor.value || '';
            const lines = code.split('\n').length;
            const chars = code.length;

            statsEl.textContent = `行: ${lines} | 字符: ${chars}`;

            // 更新狀態（添加安全檢查）
            if (statusEl.style) {
                if (code.trim() === '') {
                    statusEl.textContent = '就緒';
                    statusEl.style.color = 'var(--text-gray)';
                } else {
                    statusEl.textContent = '編輯中';
                    statusEl.style.color = 'var(--primary)';
                }
            }
        }
        // 自定義輸入對話框
        function showInputDialog(title, placeholder, callback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); padding: 30px; border-radius: 12px; min-width: 400px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 18px;">${title}</h3>
                    <input type="text" id="dialogInput" placeholder="${placeholder}"
                        style="width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border);
                        border-radius: 8px; color: var(--text); font-size: 14px; font-family: 'Inter', sans-serif;">
                    <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;">
                        <button id="dialogCancel" style="padding: 10px 20px; background: transparent; border: 1px solid var(--border);
                            color: var(--text-gray); border-radius: 6px; cursor: pointer;">取消</button>
                        <button id="dialogConfirm" style="padding: 10px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary));
                            border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">確定</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const input = modal.querySelector('#dialogInput');
            const confirmBtn = modal.querySelector('#dialogConfirm');
            const cancelBtn = modal.querySelector('#dialogCancel');

            input.focus();

            const cleanup = (value) => {
                modal.remove();
                if (value !== null && callback) callback(value);
            };

            confirmBtn.onclick = () => cleanup(input.value);
            cancelBtn.onclick = () => cleanup(null);
            input.onkeydown = (e) => {
                if (e.key === 'Enter') cleanup(input.value);
                if (e.key === 'Escape') cleanup(null);
            };
        }

        // 搜尋代碼
        function searchInCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            showInputDialog('搜尋代碼', '請輸入要搜尋的文字', (searchTerm) => {
                if (!searchTerm) return;

                const code = editor.value;
                const index = code.indexOf(searchTerm);

                if (index !== -1) {
                    editor.focus();
                    editor.setSelectionRange(index, index + searchTerm.length);
                    editor.scrollTop = editor.scrollHeight * (index / code.length);
                    showNotification('找到匹配項！', 'success');
                } else {
                    showNotification('未找到匹配項', 'warning');
                }
            });
        }

        // 取代代碼
        function replaceInCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            showInputDialog('取代代碼 - 步驟 1', '請輸入要搜尋的文字', (searchTerm) => {
                if (!searchTerm) return;

                showInputDialog('取代代碼 - 步驟 2', '請輸入要取代的文字', (replaceTerm) => {
                    if (replaceTerm === null) return;

                    const code = editor.value;
                    const newCode = code.replace(new RegExp(searchTerm, 'g'), replaceTerm);

                    if (newCode !== code) {
                        editor.value = newCode;

                        // Update editorState if in frontend mode
                        if (state.category === 'frontend') {
                            editorState.code[editorState.currentLang] = newCode;
                        }

                        updateEditorStats();
                        if (state.category === 'frontend') {
                            runFreeCode();
                        }
                        showNotification('取代成功！', 'success');
                    } else {
                        showNotification('未找到匹配項', 'warning');
                    }
                });
            });
        }

        // 代碼摺疊（簡化版 - 摺疊/展開選中的部分）
        function toggleCodeFold() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const start = editor.selectionStart;
            const end = editor.selectionEnd;

            if (start === end) {
                showNotification('請先選擇要摺疊的代碼區塊', 'info');
                return;
            }

            // 簡單的摺疊標記
            if (!state.foldedRanges) state.foldedRanges = [];

            const selectedText = editor.value.substring(start, end);
            const lineCount = selectedText.split('\n').length;

            showNotification(`已標記 ${lineCount} 行代碼`, 'success');
        }

        // 複製當前行
        function duplicateLine() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            const cursorPos = editor.selectionStart;

            // 找到當前行的開始和結束
            const lines = code.split('\n');
            let charCount = 0;
            let currentLineIndex = 0;

            for (let i = 0; i < lines.length; i++) {
                if (charCount + lines[i].length >= cursorPos) {
                    currentLineIndex = i;
                    break;
                }
                charCount += lines[i].length + 1; // +1 for newline
            }

            const currentLine = lines[currentLineIndex];
            lines.splice(currentLineIndex + 1, 0, currentLine);

            const newCode = lines.join('\n');
            editor.value = newCode;

            // Update editorState if in frontend mode
            if (state.category === 'frontend') {
                editorState.code[editorState.currentLang] = newCode;
            }

            updateEditorStats();
            showNotification('已複製當前行', 'success');
        }

        // 註釋/取消註釋
        function commentLine() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const code = editor.value;

            // 找到選中區域的行
            const beforeSelection = code.substring(0, start);
            const selection = code.substring(start, end);
            const afterSelection = code.substring(end);

            // Get current language (check frontend mode first)
            const currentLang = state.category === 'frontend' ? editorState.currentLang : state.language;

            // 根據語言決定註釋符號
            let commentPrefix = '// ';
            let commentSuffix = '';

            if (currentLang === 'python' || currentLang === 'ruby') {
                commentPrefix = '# ';
            } else if (currentLang === 'html') {
                commentPrefix = '<!-- ';
                commentSuffix = ' -->';
            } else if (currentLang === 'css') {
                commentPrefix = '/* ';
                commentSuffix = ' */';
            }

            const lines = selection.split('\n');
            const isCommented = lines.every(line => {
                const trimmed = line.trim();
                if (commentSuffix) {
                    return trimmed.startsWith(commentPrefix.trim()) && trimmed.endsWith(commentSuffix.trim());
                }
                return trimmed.startsWith(commentPrefix.trim());
            });

            let newLines;
            if (isCommented) {
                // 取消註釋
                if (commentSuffix) {
                    newLines = lines.map(line => {
                        return line.replace(commentPrefix, '').replace(commentSuffix, '');
                    });
                } else {
                    newLines = lines.map(line => line.replace(commentPrefix, ''));
                }
            } else {
                // 添加註釋
                if (commentSuffix) {
                    newLines = lines.map(line => commentPrefix + line + commentSuffix);
                } else {
                    newLines = lines.map(line => commentPrefix + line);
                }
            }

            editor.value = beforeSelection + newLines.join('\n') + afterSelection;

            // Update editorState if in frontend mode
            if (state.category === 'frontend') {
                editorState.code[editorState.currentLang] = editor.value;
            }

            updateEditorStats();
            if (state.category === 'frontend') {
                runFreeCode();
            }
            showNotification(isCommented ? '已取消註釋' : '已添加註釋', 'success');
        }
        // 更新分析狀態表
        function updateAnalysisStatus(category, status, message) {
            const statusIcons = {
                success: '✅',
                warning: '⚠️',
                error: '❌',
                pending: '⏳'
            };

            const statusEl = document.getElementById(`check${category}`);
            const msgEl = document.getElementById(`check${category}Msg`);

            if (statusEl) statusEl.textContent = statusIcons[status] || '⏳';
            if (msgEl) msgEl.textContent = message || '等待分析...';
        }

        function analyzeCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            if (!code.trim()) {
                showNotification('請先編寫一些代碼', 'warning');
                return;
            }

            // 基本統計
            const lines = code.split('\n');
            const totalLines = lines.length;
            const commentLines = lines.filter(line => {
                const trimmed = line.trim();
                return trimmed.startsWith('//') || trimmed.startsWith('#') || trimmed.startsWith('<!--') || trimmed.startsWith('/*');
            }).length;

            // 函數數量檢測
            let functionCount = 0;
            if (state.language === 'javascript') {
                functionCount = (code.match(/function\s+\w+/g) || []).length + (code.match(/\w+\s*=\s*\([^)]*\)\s*=>/g) || []).length;
            } else if (state.language === 'python') {
                functionCount = (code.match(/def\s+\w+/g) || []).length;
            }

            // 問題檢測
            const issues = [];
            const suggestions = [];

            // 檢查代碼長���
            if (totalLines > 500) {
                issues.push({ level: 'warning', msg: '代碼行數較多（>500行），建議拆分為多個文件' });
            }

            // 檢查註釋率
            const commentRatio = commentLines / totalLines;
            if (commentRatio < 0.1 && totalLines > 50) {
                suggestions.push('建議增加代碼註釋，當前註釋率：' + (commentRatio * 100).toFixed(1) + '%');
            } else if (commentRatio > 0.3) {
                suggestions.push('註釋率很好！保持良好的代碼文檔習慣');
            }

            // 檢查語法問題
            if (state.language === 'javascript') {
                // 語法���查
                if (code.includes('var ')) {
                    issues.push({ level: 'info', msg: '建議���用 let 或 const 代替 var' });
                }
                if (!code.includes('use strict') && totalLines > 20) {
                    suggestions.push('建議在腳本頂部添加 "use strict" 啟用嚴格模式');
                }

                // 檢查未閉合的括號
                const openBraces = (code.match(/\{/g) || []).length;
                const closeBraces = (code.match(/\}/g) || []).length;
                if (openBraces !== closeBraces) {
                    issues.push({ level: 'error', msg: `未閉合的大括號：{ 有 ${openBraces} 個，} 有 ${closeBraces} 個` });
                }

                // 效能檢���
                if (code.includes('document.write')) {
                    issues.push({ level: 'warning', msg: '避免使用 document.write，可能影響頁面載入性能' });
                }
                if ((code.match(/for\s*\(/g) || []).length > 5) {
                    suggestions.push('檢測到多個for循環，考慮使用 map/filter/reduce 等函數式方法提升可讀性');
                }

                // 安全性檢查
                if (code.includes('eval(')) {
                    issues.push({ level: 'error', msg: '安全警告：eval() 可能導致代碼注入風險，建議避免使用' });
                }
                if (code.includes('innerHTML') && !code.includes('textContent')) {
                    issues.push({ level: 'warning', msg: '使用 innerHTML 可能存在 XSS 風險，考慮使用 textContent' });
                }

                // 風格檢查
                if (!code.includes(';') && code.length > 100) {
                    suggestions.push('建議在語句結尾添加分號，提高代碼可讀性');
                }
                if ((code.match(/console\.log/g) || []).length > 3) {
                    suggestions.push('檢測到多個 console.log，發布前記得清理調試代碼');
                }

            } else if (state.language === 'python') {
                // 語法檢查
                if (code.includes('\t') && code.includes('    ')) {
                    issues.push({ level: 'warning', msg: '混合使用了Tab和空格縮排，建議統一使用空格' });
                }

                // 效能檢查
                if ((code.match(/for .+ in range\(/g) || []).length > 3) {
                    suggestions.push('多個 for 循環，考慮使用列表推導式提升性能');
                }

                // 安全性檢查
                if (code.includes('exec(') || code.includes('eval(')) {
                    issues.push({ level: 'error', msg: '安全警告：exec/eval 可能導致代碼注入風險' });
                }

                // 風格檢查
                if (!code.includes('"""') && !code.includes("'''") && functionCount > 0) {
                    suggestions.push('建議為函數添加文檔字符串（docstring）');
                }

            } else if (state.language === 'html') {
                // 語法檢查
                if (!code.includes('<!DOCTYPE')) {
                    suggestions.push('建議添加 <!DOCTYPE html> 聲明');
                }
                if (!code.includes('<title>')) {
                    suggestions.push('建議添加 <title> 標籤');
                }

                // 效能檢查
                if ((code.match(/<script/g) || []).length > 5) {
                    suggestions.push('檢測到多個 script 標籤，考慮合併以減少HTTP請求');
                }

                // 安全性檢查
                if (code.includes('onclick=') || code.includes('onload=')) {
                    issues.push({ level: 'warning', msg: '避免使用內聯事件處理器，建議使用 addEventListener' });
                }

                // 無障礙檢查
                if (code.includes('<img') && !code.includes('alt=')) {
                    issues.push({ level: 'warning', msg: '圖片缺少 alt 屬性，影響無障礙訪問' });
                }
                if (!code.includes('lang=')) {
                    suggestions.push('建議在 <html> 標籤添加 lang 屬性');
                }

            } else if (state.language === 'css') {
                // 效能檢查
                if (code.includes('*') && code.includes('{')) {
                    issues.push({ level: 'warning', msg: '避免使用通用選擇器 *，可能影響性能' });
                }

                // 風格檢查
                if (!code.includes('/*') && totalLines > 20) {
                    suggestions.push('建議添加註釋說明樣式用途');
                }
            }

            // 計算品質分數
            let score = 100;
            score -= issues.filter(i => i.level === 'error').length * 15;
            score -= issues.filter(i => i.level === 'warning').length * 8;
            score -= issues.filter(i => i.level === 'info').length * 3;
            if (commentRatio >= 0.1) score += 5;
            if (functionCount > 0) score += 5;
            score = Math.max(0, Math.min(100, score));

            // 更新 UI
            document.getElementById('qualityScore').textContent = score;
            document.getElementById('qualityScore').style.color =
                score >= 80 ? 'var(--success)' : score >= 60 ? 'var(--warning)' : 'var(--error)';
            document.getElementById('qualityBar').style.width = score + '%';

            document.getElementById('statLines').textContent = totalLines;
            document.getElementById('statFunctions').textContent = functionCount;
            document.getElementById('statComments').textContent = commentLines;

            // 問題列表
            const issuesEl = document.getElementById('issuesList');
            if (issues.length === 0) {
                issuesEl.innerHTML = '<div style="color: var(--success);"><i class="fas fa-check-circle"></i> 未發現明顯問題</div>';
            } else {
                issuesEl.innerHTML = issues.map(issue => {
                    const icon = issue.level === 'error' ? 'times-circle' : issue.level === 'warning' ? 'exclamation-triangle' : 'info-circle';
                    const color = issue.level === 'error' ? 'var(--error)' : issue.level === 'warning' ? 'var(--warning)' : 'var(--primary)';
                    return `<div style="margin-bottom: 8px; color: ${color};"><i class="fas fa-${icon}"></i> ${issue.msg}</div>`;
                }).join('');
            }

            // 建議列表
            const suggestionsEl = document.getElementById('suggestionsList');
            if (suggestions.length === 0) {
                suggestionsEl.textContent = '代碼質量良好，繼續保持！';
            } else {
                suggestionsEl.innerHTML = suggestions.map(s =>
                    `<div style="margin-bottom: 8px;"><i class="fas fa-check" style="color: var(--success);"></i> ${s}</div>`
                ).join('');
            }

            // 更新分析狀態表
            const syntaxErrors = issues.filter(i => i.level === 'error' && (i.msg.includes('括號') || i.msg.includes('語法')));
            const styleIssues = issues.filter(i => i.msg.includes('var ') || i.msg.includes('分號') || i.msg.includes('註釋') || i.msg.includes('縮排'));
            const potentialErrors = issues.filter(i => i.level === 'warning' || i.level === 'info');
            const perfIssues = issues.filter(i => i.msg.includes('性能') || i.msg.includes('document.write') || i.msg.includes('for循環') || i.msg.includes('script'));
            const securityIssues = issues.filter(i => i.msg.includes('安全') || i.msg.includes('eval') || i.msg.includes('XSS') || i.msg.includes('innerHTML'));

            // 語法正確性
            if (syntaxErrors.length > 0) {
                updateAnalysisStatus('Syntax', 'error', `發現 ${syntaxErrors.length} 個語法錯誤`);
            } else {
                updateAnalysisStatus('Syntax', 'success', '語法正確');
            }

            // 程式碼風格
            if (styleIssues.length > 0) {
                updateAnalysisStatus('Style', 'warning', `發現 ${styleIssues.length} 個風格問題`);
            } else {
                updateAnalysisStatus('Style', 'success', '風格良好');
            }

            // 潛在錯誤
            if (potentialErrors.length > 0) {
                updateAnalysisStatus('Errors', 'warning', `發現 ${potentialErrors.length} 個潛在問題`);
            } else {
                updateAnalysisStatus('Errors', 'success', '未發現潛在錯誤');
            }

            // 效能優化
            if (perfIssues.length > 0) {
                updateAnalysisStatus('Perf', 'warning', `有 ${perfIssues.length} 個優化建議`);
            } else {
                updateAnalysisStatus('Perf', 'success', '效能良好');
            }

            // 安全性
            if (securityIssues.length > 0) {
                updateAnalysisStatus('Security', 'error', `發現 ${securityIssues.length} 個安全問題`);
            } else {
                updateAnalysisStatus('Security', 'success', '無安全問題');
            }

            showNotification('代碼分析完成！', 'success');
        }

        // 靜默代碼分析（不顯示通知）
        function silentAnalyzeCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            if (!code.trim()) return;

            // 基本統計
            const lines = code.split('\n');
            const totalLines = lines.length;
            const commentLines = lines.filter(line => {
                const trimmed = line.trim();
                return trimmed.startsWith('//') || trimmed.startsWith('#') || trimmed.startsWith('<!--') || trimmed.startsWith('/*');
            }).length;

            // 函數數量檢測
            let functionCount = 0;
            if (state.language === 'javascript') {
                functionCount = (code.match(/function\s+\w+/g) || []).length + (code.match(/\w+\s*=\s*\([^)]*\)\s*=>/g) || []).length;
            } else if (state.language === 'python') {
                functionCount = (code.match(/def\s+\w+/g) || []).length;
            }

            // 問題檢測
            const issues = [];
            const suggestions = [];

            // 檢查代碼長度
            if (totalLines > 500) {
                issues.push({ level: 'warning', msg: '代碼行數較多（>500行），建議拆分為多個文件' });
            }

            // 檢查註釋率
            const commentRatio = commentLines / totalLines;
            if (commentRatio < 0.1 && totalLines > 50) {
                suggestions.push('建議增加代碼註釋，當前註釋率：' + (commentRatio * 100).toFixed(1) + '%');
            } else if (commentRatio > 0.3) {
                suggestions.push('註釋率很好！保持良好的代碼文檔習慣');
            }

            // 檢查語法問題
            if (state.language === 'javascript') {
                // 語法檢查
                if (code.includes('var ')) {
                    issues.push({ level: 'info', msg: '建議使用 let 或 const 代替 var' });
                }
                if (!code.includes('use strict') && totalLines > 20) {
                    suggestions.push('建議在腳本頂部添加 "use strict" 啟用嚴格模式');
                }

                // 檢查未閉合的括號
                const openBraces = (code.match(/\{/g) || []).length;
                const closeBraces = (code.match(/\}/g) || []).length;
                if (openBraces !== closeBraces) {
                    issues.push({ level: 'error', msg: `未閉合的大括號：{ 有 ${openBraces} 個，} 有 ${closeBraces} 個` });
                }

                // 效能檢查
                if (code.includes('document.write')) {
                    issues.push({ level: 'warning', msg: '避免使用 document.write，可能影響頁面載入性能' });
                }
                if ((code.match(/for\s*\(/g) || []).length > 5) {
                    suggestions.push('檢測到多個for循環，考慮使用 map/filter/reduce 等函數式方法提升可讀性');
                }

                // 安全性檢查
                if (code.includes('eval(')) {
                    issues.push({ level: 'error', msg: '安全警告：eval() 可能導致代碼注入風險，建議避免使用' });
                }
                if (code.includes('innerHTML') && !code.includes('textContent')) {
                    issues.push({ level: 'warning', msg: '使用 innerHTML 可能存在 XSS 風險，考慮使用 textContent' });
                }

                // 風格檢查
                if (!code.includes(';') && code.length > 100) {
                    suggestions.push('建議在語句結尾添加分號，提高代碼可讀性');
                }
                if ((code.match(/console\.log/g) || []).length > 3) {
                    suggestions.push('檢測到多個 console.log，發布前記得清理調試代碼');
                }

            } else if (state.language === 'python') {
                // 語法檢查
                if (code.includes('\t') && code.includes('    ')) {
                    issues.push({ level: 'warning', msg: '混合使用了Tab和空格縮排，建議統一使用空格' });
                }

                // 效能檢查
                if ((code.match(/for .+ in range\(/g) || []).length > 3) {
                    suggestions.push('多個 for 循環，考慮使用列表推導式提升性能');
                }

                // 安全性檢查
                if (code.includes('exec(') || code.includes('eval(')) {
                    issues.push({ level: 'error', msg: '安全警告：exec/eval 可能導致代碼注入風險' });
                }

                // 風格檢查
                if (!code.includes('"""') && !code.includes("'''") && functionCount > 0) {
                    suggestions.push('建議為函數添加文檔字符串（docstring）');
                }

            } else if (state.language === 'html') {
                // 語法檢查
                if (!code.includes('<!DOCTYPE')) {
                    suggestions.push('建議添加 <!DOCTYPE html> 聲明');
                }
                if (!code.includes('<title>')) {
                    suggestions.push('建議添加 <title> 標籤');
                }

                // 效能檢查
                if ((code.match(/<script/g) || []).length > 5) {
                    suggestions.push('檢測到多個 script 標籤，考慮合併以減少HTTP請求');
                }

                // 安全性檢查
                if (code.includes('onclick=') || code.includes('onload=')) {
                    issues.push({ level: 'warning', msg: '避免使用內聯事件處理器，建議使用 addEventListener' });
                }

                // 無障礙檢查
                if (code.includes('<img') && !code.includes('alt=')) {
                    issues.push({ level: 'warning', msg: '圖片缺少 alt 屬性，影響無障礙訪問' });
                }
                if (!code.includes('lang=')) {
                    suggestions.push('建議在 <html> 標籤添加 lang 屬性');
                }

            } else if (state.language === 'css') {
                // 效能檢查
                if (code.includes('*') && code.includes('{')) {
                    issues.push({ level: 'warning', msg: '避免使用通用選擇器 *，可能影響性能' });
                }

                // 風格檢查
                if (!code.includes('/*') && totalLines > 20) {
                    suggestions.push('建���添加註釋說明樣式用途');
                }
            }

            // 計算品質分數
            let score = 100;
            score -= issues.filter(i => i.level === 'error').length * 15;
            score -= issues.filter(i => i.level === 'warning').length * 8;
            score -= issues.filter(i => i.level === 'info').length * 3;
            if (commentRatio >= 0.1) score += 5;
            if (functionCount > 0) score += 5;
            score = Math.max(0, Math.min(100, score));

            // 更新 UI
            document.getElementById('qualityScore').textContent = score;
            document.getElementById('qualityScore').style.color =
                score >= 80 ? 'var(--success)' : score >= 60 ? 'var(--warning)' : 'var(--error)';
            document.getElementById('qualityBar').style.width = score + '%';

            document.getElementById('statLines').textContent = totalLines;
            document.getElementById('statFunctions').textContent = functionCount;
            document.getElementById('statComments').textContent = commentLines;

            // 問題列表
            const issuesEl = document.getElementById('issuesList');
            if (issues.length === 0) {
                issuesEl.innerHTML = '<div style="color: var(--success);"><i class="fas fa-check-circle"></i> 未發現明顯問題</div>';
            } else {
                issuesEl.innerHTML = issues.map(issue => {
                    const icon = issue.level === 'error' ? 'times-circle' : issue.level === 'warning' ? 'exclamation-triangle' : 'info-circle';
                    const color = issue.level === 'error' ? 'var(--error)' : issue.level === 'warning' ? 'var(--warning)' : 'var(--primary)';
                    return `<div style="margin-bottom: 8px; color: ${color};"><i class="fas fa-${icon}"></i> ${issue.msg}</div>`;
                }).join('');
            }

            // 建議列表
            const suggestionsEl = document.getElementById('suggestionsList');
            if (suggestions.length === 0) {
                suggestionsEl.textContent = '代碼質量良好，繼續保持！';
            } else {
                suggestionsEl.innerHTML = suggestions.map(s =>
                    `<div style="margin-bottom: 8px;"><i class="fas fa-check" style="color: var(--success);"></i> ${s}</div>`
                ).join('');
            }

            // 更新分析狀態表
            const syntaxErrors = issues.filter(i => i.level === 'error' && (i.msg.includes('括號') || i.msg.includes('語法')));
            const styleIssues = issues.filter(i => i.msg.includes('var ') || i.msg.includes('分號') || i.msg.includes('註釋') || i.msg.includes('縮排'));
            const potentialErrors = issues.filter(i => i.level === 'warning' || i.level === 'info');
            const perfIssues = issues.filter(i => i.msg.includes('性能') || i.msg.includes('document.write') || i.msg.includes('for循環') || i.msg.includes('script'));
            const securityIssues = issues.filter(i => i.msg.includes('安全') || i.msg.includes('eval') || i.msg.includes('XSS') || i.msg.includes('innerHTML'));

            // 語法正確性
            if (syntaxErrors.length > 0) {
                updateAnalysisStatus('Syntax', 'error', `發現 ${syntaxErrors.length} 個語法錯誤`);
            } else {
                updateAnalysisStatus('Syntax', 'success', '語法正確');
            }

            // 程式碼風格
            if (styleIssues.length > 0) {
                updateAnalysisStatus('Style', 'warning', `發現 ${styleIssues.length} 個風格問題`);
            } else {
                updateAnalysisStatus('Style', 'success', '風格良好');
            }

            // 潛在錯誤
            if (potentialErrors.length > 0) {
                updateAnalysisStatus('Errors', 'warning', `發現 ${potentialErrors.length} 個潛在問題`);
            } else {
                updateAnalysisStatus('Errors', 'success', '未發現潛在���誤');
            }

            // 效能優化
            if (perfIssues.length > 0) {
                updateAnalysisStatus('Perf', 'warning', `有 ${perfIssues.length} 個優化建議`);
            } else {
                updateAnalysisStatus('Perf', 'success', '效能良好');
            }

            // 安全性
            if (securityIssues.length > 0) {
                updateAnalysisStatus('Security', 'error', `發現 ${securityIssues.length} 個安全問題`);
            } else {
                updateAnalysisStatus('Security', 'success', '無安全問題');
            }

            // 不顯示通知（靜默分析）
        }

        // 顯示通知訊息
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'var(--success)',
                error: 'var(--error)',
                warning: 'var(--warning)',
                info: 'var(--primary)'
            };

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--card-bg);
                color: ${colors[type]};
                padding: 12px 20px;
                border-radius: 8px;
                border-left: 4px solid ${colors[type]};
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                font-family: 'Inter', sans-serif;
                font-size: 14px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // 🎯 更新 API Key 狀態顯示
        function updateApiKeyStatus(status = 'valid') {
            const statusEl = document.getElementById('apiKeyStatus');
            const timeEl = document.getElementById('apiKeyValidTime');
            if (!statusEl) return;

            const configs = {
                valid: {
                    color: '#10b981',
                    icon: 'fa-check-circle',
                    title: 'API Key 已就緒',
                    desc: '所有 API 端點可以正常訪問'
                },
                testing: {
                    color: '#3b82f6',
                    icon: 'fa-sync-alt fa-spin',
                    title: '正在驗證 API Key',
                    desc: '測試連接中...'
                },
                invalid: {
                    color: '#ef4444',
                    icon: 'fa-times-circle',
                    title: 'API Key 無效',
                    desc: '請重新生成 API Key'
                },
                warning: {
                    color: '#f59e0b',
                    icon: 'fa-exclamation-triangle',
                    title: 'API Key 警告',
                    desc: '請檢查配置'
                }
            };

            const config = configs[status] || configs.valid;

            statusEl.innerHTML = `
                <i class="fas ${config.icon}" style="color: ${config.color}; font-size: 16px;"></i>
                <div style="flex: 1;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: ${config.color};">${config.title}</div>
                    <div style="font-size: 0.75rem; color: var(--text-gray); margin-top: 2px;">${config.desc}</div>
                </div>
                <div id="apiKeyValidTime" style="font-size: 0.75rem; color: var(--text-gray);">剛才</div>
            `;

            statusEl.style.borderLeftColor = config.color;

            // 更新時間
            if (timeEl || status === 'valid') {
                updateApiKeyValidTime();
            }
        }

        // 🎯 更新 API Key 驗證時間
        function updateApiKeyValidTime() {
            const timeEl = document.getElementById('apiKeyValidTime');
            if (!timeEl) return;

            const now = Date.now();
            state.apiSimulator.lastKeyValidation = now;

            timeEl.textContent = '剛才';

            // 定期更新時間顯示
            const updateInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - state.apiSimulator.lastKeyValidation) / 1000);
                if (elapsed < 60) {
                    timeEl.textContent = elapsed + '秒前';
                } else if (elapsed < 3600) {
                    timeEl.textContent = Math.floor(elapsed / 60) + '分鐘前';
                } else {
                    timeEl.textContent = Math.floor(elapsed / 3600) + '小時前';
                    clearInterval(updateInterval);
                }
            }, 10000); // 每10秒更新一次
        }

        // 🎯 增強的HTTP請求可視化（帶實時檢測）
        function enhancedHTTPVisualization(method, endpoint, status) {
            // 更新實時請求監控面板
            const progressEl = document.getElementById('apiRequestProgress');
            if (progressEl) {
                const statusColor = status >= 200 && status < 300 ? '#10b981' : '#ef4444';
                const statusText = status >= 200 && status < 300 ? '成功' : '失敗';

                progressEl.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(${status >= 200 && status < 300 ? '16, 185, 129' : '239, 68, 68'}, 0.1); border-left: 3px solid ${statusColor}; border-radius: 6px;">
                        <i class="fas fa-${status >= 200 && status < 300 ? 'check' : 'times'}-circle" style="color: ${statusColor}; font-size: 16px;"></i>
                        <div style="flex: 1;">
                            <div style="color: ${statusColor}; font-weight: 600; font-size: 13px;">${method} ${endpoint}</div>
                            <div style="color: var(--text-gray); font-size: 11px;">HTTP ${status} - ${statusText}</div>
                        </div>
                    </div>
                `;

                // 3秒後清除
                setTimeout(() => {
                    progressEl.innerHTML = '<div style="color: var(--text-gray); font-size: 12px; text-align: center;">無活動請求</div>';
                }, 3000);
            }

            // 更新 HTTP 監控面板
            updateHTTPMonitor(method, endpoint, status);

            // 驗證 API Key（模擬）
            updateApiKeyStatus('testing');
            setTimeout(() => {
                updateApiKeyStatus('valid');
            }, 500);
        }

        // 🎯 更新 HTTP 請求監控面板
        function updateHTTPMonitor(method, endpoint, status) {
            const indicator = document.getElementById('httpStatusIndicator');
            const counter = document.getElementById('httpTotalRequests');
            const lastRequest = document.getElementById('httpLastRequest');

            if (indicator) {
                const isSuccess = status >= 200 && status < 300;
                indicator.style.background = isSuccess ? '#10b981' : '#ef4444';
                indicator.style.boxShadow = `0 0 10px ${isSuccess ? '#10b981' : '#ef4444'}`;

                setTimeout(() => {
                    indicator.style.background = '#6b7280';
                    indicator.style.boxShadow = 'none';
                }, 2000);
            }

            if (counter) {
                const currentCount = parseInt(counter.textContent) || 0;
                counter.textContent = currentCount + 1;
            }

            if (lastRequest) {
                const time = new Date().toLocaleTimeString('zh-TW');
                const statusColor = status >= 200 && status < 300 ? '#10b981' : '#ef4444';
                const statusIcon = status >= 200 && status < 300 ? 'check-circle' : 'times-circle';

                lastRequest.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-${statusIcon}" style="color: ${statusColor};"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: ${statusColor};">${method} ${endpoint}</div>
                            <div style="font-size: 0.75rem; color: var(--text-gray); margin-top: 2px;">
                                HTTP ${status} • ${time}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ==========================================
        // 🎯 導入/導出功能
        // ==========================================

        // 導入代碼文件
        async function importCodeFile(file, editorId) {
            if (!file) {
                showNotification('❌ 未選擇文件', 'error');
                return;
            }

            // 檢查文件大小（限制10MB）
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showNotification('❌ 文件過大，請選擇小於 10MB 的文件', 'error');
                return;
            }

            try {
                const reader = new FileReader();

                reader.onload = (e) => {
                    const content = e.target.result;
                    const editor = document.getElementById(editorId);

                    if (editor) {
                        editor.value = content;
                        showNotification(`✅ 成功導入文件：${file.name}`, 'success');

                        // 如果是前端編輯器且是HTML/CSS/JS文件，自動預覽
                        if (editorId === 'frontendCodeEditor' && (
                            file.name.endsWith('.html') ||
                            file.name.endsWith('.css') ||
                            file.name.endsWith('.js')
                        )) {
                            setTimeout(() => {
                                const executeBtn = document.getElementById('executeFrontendBtn');
                                if (executeBtn) {
                                    executeBtn.click();
                                }
                            }, 500);
                        }
                    } else {
                        showNotification('❌ 找不到編輯器', 'error');
                    }
                };

                reader.onerror = () => {
                    showNotification('❌ 讀取文件失敗', 'error');
                };

                reader.readAsText(file);
            } catch (error) {
                showNotification(`❌ 導入失敗：${error.message}`, 'error');
            }
        }

        // 導出代碼文件
        function exportCodeFile(content, filename, fileType = 'JavaScript') {
            if (!content || content.trim() === '') {
                showNotification('❌ 沒有內容可導出', 'warning');
                return;
            }

            try {
                // 創建 Blob
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });

                // 創建下載鏈接
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;

                // 觸發下載
                document.body.appendChild(a);
                a.click();

                // 清理
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                showNotification(`✅ 成功���出 ${fileType} 文件：${filename}`, 'success');
            } catch (error) {
                showNotification(`❌ 導出失敗：${error.message}`, 'error');
            }
        }

        // 🎯 導出完整項目（前端+後端+數據庫）
        async function exportCompleteProject() {
            try {
                showNotification('📦 正在打包完整項目...', 'info');

                // 收集所有數據
                const projectData = {
                    metadata: {
                        name: 'API模擬器完整項目',
                        exportDate: new Date().toISOString(),
                        version: '1.0.0',
                        description: '包含前端代碼、API配置、數據庫數據的完整項目'
                    },
                    frontend: {
                        code: document.getElementById('frontendCodeEditor')?.value || '',
                        lastModified: new Date().toISOString()
                    },
                    api: {
                        key: state.apiSimulator.apiKey,
                        logs: state.apiSimulator.logs,
                        requestCount: state.apiSimulator.requestCount,
                        successCount: state.apiSimulator.successCount
                    },
                    database: {
                        users: SimulatedDB.getAll('users'),
                        games: SimulatedDB.getAll('games'),
                        players: SimulatedDB.getAll('players')
                    },
                    github: {
                        commits: gitRepo.commits,
                        branches: gitRepo.branches,
                        currentBranch: gitRepo.currentBranch,
                        workingArea: document.getElementById('gitWorkingArea')?.value || ''
                    }
                };

                // 創建包含多個文件的項目結構
                const projectStructure = {
                    'README.md': generateProjectReadme(projectData),
                    'frontend/index.html': generateFrontendHTML(projectData.frontend.code),
                    'frontend/app.js': projectData.frontend.code,
                    'api/config.json': JSON.stringify(projectData.api, null, 2),
                    'database/data.json': JSON.stringify(projectData.database, null, 2),
                    'github/commits.json': JSON.stringify(projectData.github, null, 2),
                    'project-data.json': JSON.stringify(projectData, null, 2)
                };

                // 由於瀏覽器限制，我們將所有文件打包成一個JSON文件
                const packagedProject = {
                    type: 'complete-project',
                    files: projectStructure,
                    metadata: projectData.metadata
                };

                const blob = new Blob([JSON.stringify(packagedProject, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const timestamp = new Date().toISOString().split('T')[0];
                a.href = url;
                a.download = `complete-project-${timestamp}.json`;

                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                showNotification('✅ 完整項目已成功導出！包含所有前後端代碼和數據。', 'success');
            } catch (error) {
                showNotification(`❌ 項目導出失敗：${error.message}`, 'error');
            }
        }

        // 生成項目 README
        function generateProjectReadme(projectData) {
            return `# API 模擬器完整項目

## 項目信息
- **導出日期**: ${new Date(projectData.metadata.exportDate).toLocaleString('zh-TW')}
- **版本**: ${projectData.metadata.version}

## 項目結構

\`\`\`
project/
├── frontend/           # 前端代碼
│   ├── index.html     # 完整的HTML頁面
│   └── app.js         # JavaScript代碼
├── api/               # API配置
│   └── config.json    # API Key和日誌
├── database/          # 數據庫數據
│   └── data.json      # 用戶、遊戲、玩家數據
├── github/            # Git倉庫數據
│   └── commits.json   # 提交歷史
└── README.md          # 本文件
\`\`\`

## 統計信息
- **API 請求總數**: ${projectData.api.requestCount}
- **成功請求數**: ${projectData.api.successCount}
- **用戶數**: ${projectData.database.users.length}
- **Git 提交數**: ${projectData.github.commits.length}

## 如何使用

### 方式1：使用原平台
1. 訪問原API模擬器平台
2. 使用"導入項目"功能
3. 選擇此 JSON 文件

### 方式2：手動部署
1. 解壓文件到本地目錄
2. 打開 \`frontend/index.html\`
3. 代碼位於 \`frontend/app.js\`

## 注意事項
- API Key 僅用於模擬，不包含真實憑證
- 數據存儲在 localStorage，清除瀏覽器數據會丟失
- 建議定期備份項目

---
由 API 模擬器平台生成 | ${new Date().getFullYear()}
`;
        }

        // 生成完整的HTML頁面
        function generateFrontendHTML(jsCode) {
            return `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 模擬器 - 前端項目</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #252526;
            padding: 30px;
            border-radius: 12px;
        }
        h1 {
            color: #4ec9b0;
            margin-bottom: 20px;
        }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 API 模擬器 - 前端項目</h1>
        <p>此頁面包含從 API 模擬器平台導出的完整前端代碼。</p>
        <p>導出時間：${new Date().toLocaleString('zh-TW')}</p>

        <h2 style="color: #569cd6; margin-top: 30px;">代碼預覽</h2>
        <pre><code>${jsCode.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
    </div>

    <script>
${jsCode}
    </script>
</body>
</html>`;
        }

        // 🎯 導出Git歷史記錄
        function exportGitHistory() {
            try {
                showNotification('📦 正在導出Git歷史...', 'info');

                const gitData = {
                    metadata: {
                        name: 'Git倉庫歷史',
                        exportDate: new Date().toISOString(),
                        currentBranch: gitRepo.currentBranch,
                        totalCommits: Object.values(gitRepo.branches).reduce((sum, branch) => sum + branch.commits.length, 0),
                        totalBranches: Object.keys(gitRepo.branches).length
                    },
                    repository: {
                        currentBranch: gitRepo.currentBranch,
                        branches: gitRepo.branches,
                        pullRequests: gitRepo.pullRequests,
                        workingDirectory: {
                            content: document.getElementById('gitWorkingArea')?.value || '',
                            hasChanges: gitRepo.workingDirectory.hasChanges
                        }
                    },
                    statistics: {
                        branchCount: Object.keys(gitRepo.branches).length,
                        commitsByBranch: Object.entries(gitRepo.branches).reduce((acc, [name, branch]) => {
                            acc[name] = branch.commits.length;
                            return acc;
                        }, {}),
                        totalPullRequests: gitRepo.pullRequests.length,
                        openPullRequests: gitRepo.pullRequests.filter(pr => pr.status === 'open').length,
                        mergedPullRequests: gitRepo.pullRequests.filter(pr => pr.status === 'merged').length
                    }
                };

                // 生成可讀的提交日誌
                let commitLog = '# Git 提交歷史\n\n';
                commitLog += `**當前分支**: ${gitRepo.currentBranch}\n`;
                commitLog += `**導出時間**: ${new Date().toLocaleString('zh-TW')}\n\n`;

                Object.entries(gitRepo.branches).forEach(([branchName, branch]) => {
                    commitLog += `## 分支: ${branchName}\n\n`;
                    if (branch.commits.length === 0) {
                        commitLog += '暫無提交記錄\n\n';
                    } else {
                        branch.commits.forEach(commit => {
                            commitLog += `- **${commit.hash.substring(0, 7)}** ${commit.message}\n`;
                            commitLog += `  作者: ${commit.author} | 時間: ${new Date(commit.timestamp).toLocaleString('zh-TW')}\n\n`;
                        });
                    }
                });

                // 創建包含多個文件的導出包
                const exportPackage = {
                    type: 'git-history-export',
                    files: {
                        'git-data.json': JSON.stringify(gitData, null, 2),
                        'COMMIT_LOG.md': commitLog,
                        'working-code.js': document.getElementById('gitWorkingArea')?.value || ''
                    },
                    metadata: gitData.metadata
                };

                const blob = new Blob([JSON.stringify(exportPackage, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const timestamp = new Date().toISOString().split('T')[0];
                a.href = url;
                a.download = `git-history-${timestamp}.json`;

                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                showNotification('✅ Git歷史已成功導出！包含所有分支、提交記錄和PR。', 'success');
            } catch (error) {
                showNotification(`❌ Git歷史導出失敗：${error.message}`, 'error');
            }
        }

        // 運行自由���式代碼
        function runFreeCode() {
            try {
                const editor = document.getElementById('freeCodeEditor');
                const statusEl = document.getElementById('editorStatus');
                const previewContainer = document.getElementById('freePreviewContainer');
                const previewIndicator = document.getElementById('previewIndicator');
                const executionTimeEl = document.getElementById('executionTime');
                const execTimeValueEl = document.getElementById('execTimeValue');

                if (!editor) {
                    console.error('找不到代碼編輯器');
                    return;
                }

                let code = editor.value;

                // 如果是前端語言且處於獨立模式，需要先保存當前編輯的代碼
                if (state.category === 'frontend' && !editorState.isMerged && ['html', 'css', 'javascript'].includes(editorState.currentLang)) {
                    editorState.code[editorState.currentLang] = code;

                    // 合併HTML/CSS/JavaScript代碼
                    const htmlCode = editorState.code.html || '';
                    const cssCode = editorState.code.css || '';
                    const jsCode = editorState.code.javascript || '';

                    let mergedCode = '<!DOCTYPE html>\n<html lang="zh-TW">\n<head>\n';
                    mergedCode += '    <meta charset="UTF-8">\n';
                    mergedCode += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
                    mergedCode += '    <title>預覽</title>\n';

                    if (cssCode) {
                        mergedCode += '    <style>\n' + cssCode + '\n    </style>\n';
                    }

                    mergedCode += '</head>\n<body>\n\n';
                    mergedCode += htmlCode + '\n\n';

                    if (jsCode) {
                        mergedCode += '    <script>\n' + jsCode + '\n    </' + 'script>\n';
                    }

                    mergedCode += '</body>\n</html>';

                    code = mergedCode;
                }

                if (!code || code.trim() === '') {
                    return; // 如果沒有代碼，不執行
                }

                // 開始計時
                const startTime = performance.now();

                // 更新狀態為執行中
                if (statusEl) {
                    statusEl.textContent = '執行中...';
                    statusEl.style.color = 'var(--warning)';
                }

                if (state.category === 'frontend') {
                    // 前端代碼：使用iframe即時預覽
                    const iframe = document.getElementById('freePreviewFrame');
                    if (!iframe) {
                        console.error('找不到預覽iframe');
                        return;
                    }

                    // 直接設置 srcdoc 屬性
                    iframe.srcdoc = code;

                    // 成功後添加發光效果
                    setTimeout(function() {
                        // 計算執行時間
                        const endTime = performance.now();
                        const duration = (endTime - startTime).toFixed(2);

                        if (previewContainer) {
                            previewContainer.classList.add('glow-success');
                            setTimeout(() => previewContainer.classList.remove('glow-success'), 1500);
                        }
                        if (statusEl) {
                            statusEl.textContent = '執行成功';
                            statusEl.style.color = 'var(--success)';
                            setTimeout(() => {
                                statusEl.textContent = '就緒';
                                statusEl.style.color = 'var(--text-gray)';
                            }, 2000);
                        }
                        // 顯示執行時間
                        if (executionTimeEl && execTimeValueEl) {
                            execTimeValueEl.textContent = duration;
                            executionTimeEl.style.display = 'inline';
                            setTimeout(() => {
                                executionTimeEl.style.display = 'none';
                            }, 5000);
                        }
                        // 預覽指示器脈衝
                        if (previewIndicator) {
                            previewIndicator.style.animation = 'pulse 1s ease-in-out';
                            setTimeout(() => {
                                previewIndicator.style.animation = '';
                            }, 1000);
                        }
                    }, 100);

                    // 備用方法：如果 srcdoc 不工作，嘗試使用 contentDocument
                    setTimeout(function() {
                        if (!iframe.srcdoc || iframe.srcdoc === '') {
                            try {
                                const doc = iframe.contentDocument || iframe.contentWindow.document;
                                doc.open();
                                doc.write(code);
                                doc.close();
                            } catch (e) {
                                console.warn('備用方法也失敗:', e);
                            }
                        }
                    }, 50);
                } else {
                    // 後端代碼：模擬執行（實際上需要後端服務���）
                    const output = document.getElementById('freeConsoleOutput');
                    if (!output) {
                        console.error('找不到控制台輸出元素');
                        return;
                    }

                    // 確保控制台可見
                    output.style.display = 'flex';
                    const previewContainerBackend = document.getElementById('freePreviewContainer');
                    if (previewContainerBackend) {
                        previewContainerBackend.style.display = 'none';
                    }

                    // 簡單模擬Python輸出
                    if (code.includes('print')) {
                        const lines = code.split('\n');
                        let result = '';

                        lines.forEach(line => {
                            // 簡單的print語句解析
                            const printMatch = line.match(/print\s*\(\s*["'](.+?)["']\s*\)/);
                            if (printMatch) {
                                result += printMatch[1] + '\n';
                            }

                            // f-string解析（簡化版）
                            const fstringMatch = line.match(/print\s*\(\s*f["'](.+?)["']\s*\)/);
                            if (fstringMatch) {
                                let text = fstringMatch[1];
                                // 簡單替換變量
                                text = text.replace(/\{name\}/g, '學習者');
                                text = text.replace(/\{numbers\}/g, '[1, 2, 3, 4, 5]');
                                result += text + '\n';
                            }
                        });

                        output.innerHTML = `<div style="color: #00ff00;"><i class="fas fa-check-circle"></i> 執行成功！</div>\n\n${result || '執行結果將顯示在這裡...'}`;
                    } else {
                        output.innerHTML = `<div style="color: #ffa500;"><i class="fas fa-info-circle"></i> 提示：使用 print() 函數輸出內容</div>`;
                    }

                    // 更新狀態
                    if (statusEl) {
                        statusEl.textContent = '執行成功';
                        statusEl.style.color = 'var(--success)';
                        setTimeout(() => {
                            statusEl.textContent = '就緒';
                            statusEl.style.color = 'var(--text-gray)';
                        }, 2000);
                    }
                }
            } catch (error) {
                console.error('運行代碼時出錯:', error);
                if (statusEl) {
                    statusEl.textContent = '執行錯誤';
                    statusEl.style.color = 'var(--error)';
                }
            }
        }

        // 切換預覽標籤
        function switchPreviewTab(tabName) {
            // 更新標籤按鈕狀態
            const tabs = document.querySelectorAll('.preview-tab');
            if (tabs.length === 0) {
                console.warn('預覽標籤元素���存在，可能不在自由模式頁面');
                return;
            }

            tabs.forEach(tab => {
                if (!tab) return; // 安全檢查

                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                    if (tab.style) {
                        tab.style.color = 'var(--primary)';
                        tab.style.borderBottomColor = 'var(--primary)';
                    }
                } else {
                    tab.classList.remove('active');
                    if (tab.style) {
                        tab.style.color = 'var(--text-gray)';
                        tab.style.borderBottomColor = 'transparent';
                    }
                }
            });

            // 更新面板顯示
            const panels = document.querySelectorAll('.preview-panel');
            panels.forEach(panel => {
                if (!panel || !panel.style) return; // 安全檢查
                panel.style.display = 'none';
                panel.classList.remove('active');
            });

            const targetPanel = document.getElementById(tabName + 'Panel');
            if (targetPanel && targetPanel.style) {
                targetPanel.style.display = 'flex';
                setTimeout(() => targetPanel.classList.add('active'), 10);
            }

            // 如果切換到代碼 Review，分析當前代碼
            if (tabName === 'review') {
                analyzeCode();
            }

            // 如果切換到程式碼片段，更新列表
            if (tabName === 'snippets') {
                renderSnippets();
            }
        }

        // 保存程式碼片段
        function saveCodeSnippet() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value.trim();
            if (!code) {
                showNotification('請先輸入代碼', 'error');
                return;
            }

            // 創建自定義對話框詢問片段名稱
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    <h2 class="gradient-text" style="margin-bottom: 20px;">保存程式碼片段</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-gray); margin-bottom: 8px; font-size: 14px;">片段名稱</label>
                        <input type="text" id="snippetNameInput" placeholder="���如：登入表單範例" style="width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px; outline: none;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-gray); margin-bottom: 8px; font-size: 14px;">描述（選填）</label>
                        <textarea id="snippetDescInput" placeholder="簡短描述這段代碼的用途..." style="width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px; outline: none; resize: vertical; min-height: 80px;"></textarea>
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn btn-outline" onclick="this.closest('.modal').remove()">取消</button>
                        <button class="btn" onclick="confirmSaveSnippet()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // 聚焦到輸入框
            setTimeout(() => {
                const input = document.getElementById('snippetNameInput');
                if (input) input.focus();
            }, 100);
        }

        // 確認保存片段
        function confirmSaveSnippet() {
            const nameInput = document.getElementById('snippetNameInput');
            const descInput = document.getElementById('snippetDescInput');
            const editor = document.getElementById('freeCodeEditor');

            const name = nameInput?.value.trim();
            const description = descInput?.value.trim();
            const code = editor?.value.trim();

            if (!name) {
                showNotification('請輸入片段名稱', 'error');
                return;
            }

            // 創建片段對象
            const snippet = {
                id: Date.now(),
                name: name,
                description: description || '',
                code: code,
                language: state.language || 'html',
                category: state.category || 'frontend',
                createdAt: new Date().toISOString()
            };

            // ���存到狀態
            state.snippets.push(snippet);

            // 注意：Canvas Apps 在 iframe 中運行，localStorage 不可用
            // 關閉對話框
            document.querySelector('.modal.active')?.remove();

            // 顯示成功消息
            showNotification(`已保存片段：${name}`, 'success');

            // 如果當前在片段標籤，更新列表
            renderSnippets();
        }

        // 渲染程式碼片段列表
        function renderSnippets() {
            const snippetsList = document.getElementById('snippetsList');
            if (!snippetsList) return;

            // 注意：Canvas Apps 在 iframe 中運行，localStorage 不可用
            if (state.snippets.length === 0) {
                snippetsList.innerHTML = `
                    <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 8px; border-left: 3px solid var(--secondary); text-align: center;">
                        <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">
                            <i class="fas fa-info-circle"></i> 尚無保存的程式碼片段<br>
                            <small style="font-size: 12px; opacity: 0.8;">點擊「保存當前代碼」開始建立您的程式碼庫</small>
                        </p>
                    </div>
                `;
                return;
            }

            // 顯示片段列表
            snippetsList.innerHTML = state.snippets.map(snippet => `
                <div style="background: var(--card-bg); border-radius: 8px; padding: 16px; border: 1px solid var(--border); transition: all 0.3s;"
                     onmouseover="this.style.borderColor='var(--primary)'"
                     onmouseout="this.style.borderColor='var(--border)'">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <div>
                            <h4 style="color: var(--primary); font-size: 14px; margin: 0 0 4px 0; font-family: 'Courier Prime', monospace;">
                                <i class="fas fa-bookmark" style="font-size: 12px; opacity: 0.7;"></i> ${snippet.name}
                            </h4>
                            ${snippet.description ? `<p style="color: var(--text-gray); font-size: 12px; margin: 0; line-height: 1.4;">${snippet.description}</p>` : ''}
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="loadSnippet(${snippet.id})" style="background: rgba(0, 217, 255, 0.1); border: 1px solid var(--primary); color: var(--primary); padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.3s;">
                                <i class="fas fa-upload"></i> 載入
                            </button>
                            <button onclick="deleteSnippet(${snippet.id})" style="background: rgba(255, 71, 87, 0.1); border: 1px solid var(--error); color: var(--error); padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.3s;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div style="background: var(--darker-bg); border-radius: 6px; padding: 12px; margin-top: 8px;">
                        <pre style="margin: 0; font-family: 'Fira Code', monospace; font-size: 11px; color: var(--text-gray); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; max-height: 150px; overflow-y: auto;"><code>${escapeHtml(snippet.code.substring(0, 300))}${snippet.code.length > 300 ? '...' : ''}</code></pre>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px; color: var(--text-gray); display: flex; justify-content: space-between;">
                        <span><i class="fas fa-code"></i> ${snippet.language.toUpperCase()}</span>
                        <span><i class="fas fa-clock"></i> ${new Date(snippet.createdAt).toLocaleDateString('zh-TW')}</span>
                    </div>
                </div>
            `).join('');
        }

        // 載入���式碼片段
        function loadSnippet(snippetId) {
            const snippet = state.snippets.find(s => s.id === snippetId);
            if (!snippet) return;

            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            editor.value = snippet.code;
            updateEditorStats();

            // 切換回預覽標籤
            switchPreviewTab('preview');

            // 如果是前端代碼，立即預覽
            if (snippet.category === 'frontend') {
                runFreeCode();
            }

            showNotification(`已載入：${snippet.name}`, 'success');
        }

        // 刪除程式碼片段
        function deleteSnippet(snippetId) {
            const snippet = state.snippets.find(s => s.id === snippetId);
            if (!snippet) return;

            // 創建確認對話框
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <h3 class="gradient-text" style="margin-bottom: 16px; font-size: 18px;">確認刪除</h3>
                    <p style="color: var(--text-gray); margin-bottom: 20px; line-height: 1.6;">
                        確定要刪除程式碼片段「<strong style="color: var(--primary);">${snippet.name}</strong>」嗎？此操作無法復原。
                    </p>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn btn-outline" onclick="this.closest('.modal').remove()">取消</button>
                        <button class="btn" style="background: var(--error);" onclick="confirmDeleteSnippet(${snippetId})">
                            <i class="fas fa-trash"></i> 刪除
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 確認刪除片段
        function confirmDeleteSnippet(snippetId) {
            state.snippets = state.snippets.filter(s => s.id !== snippetId);

            // 注意：Canvas Apps 在 iframe 中運行，localStorage 不可用
            // 關閉對話框
            document.querySelector('.modal.active')?.remove();

            // 更新列表
            renderSnippets();

            showNotification('片段已刪除', 'success');
        }

        // HTML 轉義函數
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 匯出代碼
        function exportCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            if (!code.trim()) {
                showNotification('沒有代碼可以匯出', 'error');
                return;
            }

            // 確定文件擴展名
            const extensions = {
                html: 'html',
                css: 'css',
                javascript: 'js',
                python: 'py',
                ruby: 'rb',
                java: 'java',
                csharp: 'cs',
                cpp: 'cpp'
            };
            const ext = extensions[state.language] || 'txt';
            const filename = `code_${Date.now()}.${ext}`;

            // 創建 Blob 並下載
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification(`已匯出為 ${filename}`, 'success');
        }

        // 處理文件匯入
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const editor = document.getElementById('freeCodeEditor');
                if (!editor) return;

                editor.value = e.target.result;

                // Update editorState if in frontend mode
                if (state.category === 'frontend') {
                    editorState.code[editorState.currentLang] = e.target.result;
                }

                updateEditorStats();

                // 如果是前端代碼，自動預覽
                if (state.category === 'frontend') {
                    runFreeCode();
                }

                showNotification(`已匯入 ${file.name}`, 'success');
            };

            reader.onerror = () => {
                showNotification('文件讀取失敗', 'error');
            };

            reader.readAsText(file);

            // 重置 file input
            event.target.value = '';
        }

        // 切換模板下拉選單
        function toggleTemplateDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('templateDropdown');
            if (!dropdown) return;

            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';

            if (!isVisible) {
                renderTemplates();
            }
        }

        // 渲染模板列表
        function renderTemplates() {
            const dropdown = document.getElementById('templateDropdown');
            if (!dropdown) return;

            const currentLang = state.language || 'html';
            const langTemplates = templates[currentLang] || [];

            let html = '<div style="max-height: 400px; overflow-y: auto;">';

            // 內建模板
            if (langTemplates.length > 0) {
                html += '<div style="padding: 8px; color: var(--text-gray); font-size: 12px; font-weight: 600; border-bottom: 1px solid var(--border);">內建模板</div>';
                langTemplates.forEach((template, index) => {
                    html += `
                        <div style="padding: 8px 12px; transition: background 0.2s; border-radius: 6px; margin: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                <div onclick="loadTemplate('builtin', ${index})" style="flex: 1; cursor: pointer; color: var(--text); font-size: 13px; font-weight: 500;">
                                    <i class="fas fa-file-code" style="color: var(--primary); margin-right: 6px;"></i>
                                    ${template.name}
                                </div>
                                <div style="display: flex; gap: 4px;">
                                    <button onclick="event.stopPropagation(); previewTemplate('builtin', ${index})"
                                            style="background: rgba(0, 217, 255, 0.1); border: 1px solid rgba(0, 217, 255, 0.3); color: var(--primary); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;"
                                            title="預覽">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="event.stopPropagation(); selectTemplateForComparison('builtin', ${index})"
                                            style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.3); color: var(--secondary); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;"
                                            title="比較">
                                        <i class="fas fa-code-compare"></i>
                                    </button>
                                </div>
                            </div>
                            ${template.description ? `<div style="color: var(--text-gray); font-size: 11px; margin-left: 22px;">${template.description}</div>` : ''}
                        </div>
                    `;
                });
            }

            // 自定義模板
            const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
            if (customTemplates.length > 0) {
                html += '<div style="padding: 8px; color: var(--text-gray); font-size: 12px; font-weight: 600; border-bottom: 1px solid var(--border); margin-top: 8px;">自定義模板</div>';
                customTemplates.forEach((template, index) => {
                    html += `
                        <div style="padding: 12px; cursor: pointer; transition: background 0.2s; border-radius: 6px; margin: 4px; display: flex; justify-content: space-between; align-items: center;">
                            <div onclick="loadTemplate('custom', ${index})" style="flex: 1;">
                                <div style="color: var(--text); font-size: 13px; font-weight: 500;">
                                    <i class="fas fa-bookmark" style="color: var(--secondary); margin-right: 6px;"></i>
                                    ${template.name}
                                </div>
                            </div>
                            <button onclick="event.stopPropagation(); deleteCustomTemplate(${index})" style="background: transparent; border: none; color: var(--error); cursor: pointer; padding: 4px 8px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                });
            }

            // 保存為模板按鈕
            html += `
                <div style="padding: 8px; border-top: 1px solid var(--border); margin-top: 8px;">
                    <button onclick="saveAsTemplate()" class="btn" style="width: 100%; padding: 10px; font-size: 13px;">
                        <i class="fas fa-plus"></i> 將當前代碼保存為模板
                    </button>
                </div>
            `;

            html += '</div>';
            dropdown.innerHTML = html;
        }

        // 載入模板
        function loadTemplate(type, index) {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            let template;
            if (type === 'builtin') {
                const currentLang = state.language || 'html';
                template = templates[currentLang][index];
            } else {
                const currentLang = state.language || 'html';
                const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
                template = customTemplates[index];
            }

            if (!template) return;

            editor.value = template.code;
            updateEditorStats();

            // 如果是前端代碼，自動預覽
            if (state.category === 'frontend') {
                runFreeCode();
            }

            // 關閉下拉選單
            const dropdown = document.getElementById('templateDropdown');
            if (dropdown) dropdown.style.display = 'none';

            showNotification(`已載入模板：${template.name}`, 'success');
        }

        // 預覽模板
        function previewTemplate(type, index) {
            const currentLang = state.language || 'html';
            let template;

            if (type === 'builtin') {
                template = templates[currentLang][index];
            } else {
                const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
                template = customTemplates[index];
            }

            if (!template) return;

            // 創建預覽模態框
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                        <h2 class="gradient-text">
                            <i class="fas fa-eye"></i> 模板預覽
                        </h2>
                        <button class="btn" onclick="previewLoadTemplate('${type}', ${index}); this.closest('.modal').remove();">
                            <i class="fas fa-download"></i> 載入此模板
                        </button>
                    </div>
                    <div style="background: rgba(0, 217, 255, 0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: var(--primary); margin-bottom: 8px;">
                            <i class="fas fa-file-code"></i> ${template.name}
                        </h3>
                        ${template.description ? `<p style="color: var(--text-gray); font-size: 13px; margin-bottom: 8px;">${template.description}</p>` : ''}
                        ${template.category ? `<span style="display: inline-block; padding: 4px 12px; background: rgba(124, 58, 237, 0.2); color: var(--secondary); border-radius: 12px; font-size: 11px; font-weight: 600;">${template.category}</span>` : ''}
                    </div>
                    <div style="background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;">
                            <span style="color: var(--text-gray); font-size: 12px; font-weight: 600;">
                                <i class="fas fa-code"></i> 程式碼
                            </span>
                            <button onclick="copyTemplateCode('${type}', ${index})" style="background: rgba(0, 217, 255, 0.1); border: 1px solid rgba(0, 217, 255, 0.3); color: var(--primary); padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                <i class="fas fa-copy"></i> 複製
                            </button>
                        </div>
                        <pre style="margin: 0; padding: 20px; overflow-x: auto; max-height: 500px; background: var(--darker-bg);"><code style="color: var(--text); font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">${escapeHtml(template.code)}</code></pre>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 從預覽載入模板
        function previewLoadTemplate(type, index) {
            loadTemplate(type, index);
        }

        // 複製模板代碼
        function copyTemplateCode(type, index) {
            const currentLang = state.language || 'html';
            let template;

            if (type === 'builtin') {
                template = templates[currentLang][index];
            } else {
                const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
                template = customTemplates[index];
            }

            if (!template) return;

            navigator.clipboard.writeText(template.code).then(() => {
                showNotification('代碼已複製到剪貼板', 'success');
            }).catch(() => {
                showNotification('複製失敗', 'error');
            });
        }

        // 轉義 HTML
        // 模板比較狀態
        let comparisonState = {
            templates: [],
            types: [],
            indices: []
        };

        // 選擇模板進行比較
        function selectTemplateForComparison(type, index) {
            const currentLang = state.language || 'html';
            let template;

            if (type === 'builtin') {
                template = templates[currentLang][index];
            } else {
                const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
                template = customTemplates[index];
            }

            if (!template) return;

            // 添加到比較列表
            if (comparisonState.templates.length < 2) {
                comparisonState.templates.push(template);
                comparisonState.types.push(type);
                comparisonState.indices.push(index);

                if (comparisonState.templates.length === 1) {
                    showNotification(`已選擇第一個模板：${template.name}，請選擇第二個模板進行比較`, 'info');
                } else if (comparisonState.templates.length === 2) {
                    // 顯示比較���圖
                    showTemplateComparison();
                }
            }
        }

        // 顯示模板比較
        function showTemplateComparison() {
            if (comparisonState.templates.length !== 2) return;

            const template1 = comparisonState.templates[0];
            const template2 = comparisonState.templates[1];

            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 95vw; max-height: 95vh; width: 1400px;">
                    <button class="modal-close" onclick="resetComparison(); this.closest('.modal').remove();">
                        <i class="fas fa-times"></i>
                    </button>
                    <h2 class="gradient-text" style="margin-bottom: 20px;">
                        <i class="fas fa-code-compare"></i> 模板比較
                    </h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: calc(90vh - 100px);">
                        <!-- 模板 1 -->
                        <div style="display: flex; flex-direction: column; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
                            <div style="background: rgba(0, 217, 255, 0.1); padding: 15px; border-bottom: 1px solid var(--border);">
                                <h3 style="color: var(--primary); margin-bottom: 8px;">
                                    <i class="fas fa-file-code"></i> ${template1.name}
                                </h3>
                                ${template1.description ? `<p style="color: var(--text-gray); font-size: 12px; margin-bottom: 6px;">${template1.description}</p>` : ''}
                                ${template1.category ? `<span style="display: inline-block; padding: 3px 10px; background: rgba(124, 58, 237, 0.2); color: var(--secondary); border-radius: 12px; font-size: 10px; font-weight: 600;">${template1.category}</span>` : ''}
                            </div>
                            <div style="flex: 1; overflow: auto; background: var(--darker-bg);">
                                <pre style="margin: 0; padding: 20px; height: 100%;"><code style="color: var(--text); font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6;">${escapeHtml(template1.code)}</code></pre>
                            </div>
                            <div style="padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 8px;">
                                <button class="btn" style="flex: 1; font-size: 12px; padding: 8px;" onclick="loadTemplate('${comparisonState.types[0]}', ${comparisonState.indices[0]}); resetComparison(); this.closest('.modal').remove();">
                                    <i class="fas fa-download"></i> 載入
                                </button>
                                <button class="btn btn-outline" style="flex: 1; font-size: 12px; padding: 8px;" onclick="copyTemplateCode('${comparisonState.types[0]}', ${comparisonState.indices[0]})">
                                    <i class="fas fa-copy"></i> 複製
                                </button>
                            </div>
                        </div>

                        <!-- 模板 2 -->
                        <div style="display: flex; flex-direction: column; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
                            <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-bottom: 1px solid var(--border);">
                                <h3 style="color: var(--secondary); margin-bottom: 8px;">
                                    <i class="fas fa-file-code"></i> ${template2.name}
                                </h3>
                                ${template2.description ? `<p style="color: var(--text-gray); font-size: 12px; margin-bottom: 6px;">${template2.description}</p>` : ''}
                                ${template2.category ? `<span style="display: inline-block; padding: 3px 10px; background: rgba(0, 217, 255, 0.2); color: var(--primary); border-radius: 12px; font-size: 10px; font-weight: 600;">${template2.category}</span>` : ''}
                            </div>
                            <div style="flex: 1; overflow: auto; background: var(--darker-bg);">
                                <pre style="margin: 0; padding: 20px; height: 100%;"><code style="color: var(--text); font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6;">${escapeHtml(template2.code)}</code></pre>
                            </div>
                            <div style="padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 8px;">
                                <button class="btn" style="flex: 1; font-size: 12px; padding: 8px;" onclick="loadTemplate('${comparisonState.types[1]}', ${comparisonState.indices[1]}); resetComparison(); this.closest('.modal').remove();">
                                    <i class="fas fa-download"></i> 載入
                                </button>
                                <button class="btn btn-outline" style="flex: 1; font-size: 12px; padding: 8px;" onclick="copyTemplateCode('${comparisonState.types[1]}', ${comparisonState.indices[1]})">
                                    <i class="fas fa-copy"></i> 複製
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn btn-outline" onclick="resetComparison(); this.closest('.modal').remove();">
                            <i class="fas fa-sync"></i> 重新選擇
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // 重置比較狀態
            resetComparison();
        }

        // 重置比較狀態
        function resetComparison() {
            comparisonState = {
                templates: [],
                types: [],
                indices: []
            };
        }

        // 保存為自定義模板
        function saveAsTemplate() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value.trim();
            if (!code) {
                showNotification('請先輸入代碼', 'error');
                return;
            }

            // 創建對話框
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    <h2 class="gradient-text" style="margin-bottom: 20px;">保存為模板</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-gray); margin-bottom: 8px; font-size: 14px;">模板名稱</label>
                        <input type="text" id="templateNameInput" placeholder="例如：我的響應式佈局" style="width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px; outline: none;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn btn-outline" onclick="this.closest('.modal').remove()">取消</button>
                        <button class="btn" onclick="confirmSaveTemplate()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // 關閉模板下拉選單
            const dropdown = document.getElementById('templateDropdown');
            if (dropdown) dropdown.style.display = 'none';

            setTimeout(() => {
                const input = document.getElementById('templateNameInput');
                if (input) input.focus();
            }, 100);
        }

        // 確認保存模板
        function confirmSaveTemplate() {
            const nameInput = document.getElementById('templateNameInput');
            const editor = document.getElementById('freeCodeEditor');

            const name = nameInput?.value.trim();
            const code = editor?.value.trim();

            if (!name) {
                showNotification('請輸入模板名稱', 'error');
                return;
            }

            const template = {
                id: Date.now(),
                name: name,
                code: code,
                language: state.language || 'html',
                createdAt: new Date().toISOString()
            };

            state.customTemplates.push(template);

            document.querySelector('.modal.active')?.remove();
            showNotification(`已保存模板：${name}`, 'success');
        }

        // 刪���自定義模板
        function deleteCustomTemplate(index) {
            const currentLang = state.language || 'html';
            const customTemplates = state.customTemplates.filter(t => t.language === currentLang);
            const template = customTemplates[index];

            if (!template) return;

            // 找到在全局數組中的實際索引
            const globalIndex = state.customTemplates.findIndex(t => t.id === template.id);
            if (globalIndex === -1) return;

            state.customTemplates.splice(globalIndex, 1);
            renderTemplates();
            showNotification('模板已刪除', 'success');
        }

        // 打開設置面板
        function openSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    <h2 class="gradient-text" style="margin-bottom: 20px;">
                        <i class="fas fa-cog"></i> 編輯器設置
                    </h2>

                    <div style="display: grid; gap: 20px;">
                        <!-- 字體大小 -->
                        <div>
                            <label style="display: block; color: var(--text); margin-bottom: 12px; font-size: 14px; font-weight: 500;">
                                <i class="fas fa-text-height"></i> 字體大小：<span id="fontSizeDisplay">${state.editorSettings.fontSize}px</span>
                            </label>
                            <input type="range" id="fontSizeSlider" min="10" max="24" value="${state.editorSettings.fontSize}"
                                style="width: 100%; accent-color: var(--primary);"
                                oninput="document.getElementById('fontSizeDisplay').textContent = this.value + 'px'">
                            <div style="display: flex; justify-content: space-between; color: var(--text-gray); font-size: 12px; margin-top: 4px;">
                                <span>10px</span>
                                <span>24px</span>
                            </div>
                        </div>

                        <!-- Tab 大小 -->
                        <div>
                            <label style="display: block; color: var(--text); margin-bottom: 12px; font-size: 14px; font-weight: 500;">
                                <i class="fas fa-indent"></i> 縮排大小（空格）：<span id="tabSizeDisplay">${state.editorSettings.tabSize}</span>
                            </label>
                            <input type="range" id="tabSizeSlider" min="2" max="8" step="2" value="${state.editorSettings.tabSize}"
                                style="width: 100%; accent-color: var(--primary);"
                                oninput="document.getElementById('tabSizeDisplay').textContent = this.value">
                            <div style="display: flex; justify-content: space-between; color: var(--text-gray); font-size: 12px; margin-top: 4px;">
                                <span>2</span>
                                <span>8</span>
                            </div>
                        </div>

                        <!-- 行號顯示 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(0, 217, 255, 0.05); border-radius: 8px;">
                            <label style="color: var(--text); font-size: 14px; font-weight: 500;">
                                <i class="fas fa-list-ol"></i> 顯示行號
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="lineNumbersToggle" ${state.editorSettings.showLineNumbers ? 'checked' : ''}>
                                <span class="slider-switch"></span>
                            </label>
                        </div>

                        <!-- 編輯器主題 -->
                        <div>
                            <label style="display: block; color: var(--text); margin-bottom: 12px; font-size: 14px; font-weight: 500;">
                                <i class="fas fa-palette"></i> 編輯器主題
                            </label>
                            <select id="editorThemeSelect" style="width: 100%; padding: 12px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px; cursor: pointer;">
                                <option value="dark" ${state.editorSettings.theme === 'dark' ? 'selected' : ''}>暗夜模���（預設）</option>
                                <option value="vscode" ${state.editorSettings.theme === 'vscode' ? 'selected' : ''}>VS Code 深色</option>
                                <option value="monokai" ${state.editorSettings.theme === 'monokai' ? 'selected' : ''}>Monokai</option>
                                <option value="dracula" ${state.editorSettings.theme === 'dracula' ? 'selected' : ''}>Dracula</option>
                                <option value="light" ${state.editorSettings.theme === 'light' ? 'selected' : ''}>淺色模式</option>
                            </select>
                        </div>

                        <!-- 智慧補全 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(124, 58, 237, 0.05); border-radius: 8px;">
                            <label style="color: var(--text); font-size: 14px; font-weight: 500;">
                                <i class="fas fa-magic"></i> 智慧程式碼補全
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="autoCompleteToggle" ${state.editorSettings.autoComplete !== false ? 'checked' : ''}>
                                <span class="slider-switch"></span>
                            </label>
                        </div>

                        <!-- 錯誤檢查 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(124, 58, 237, 0.05); border-radius: 8px;">
                            <label style="color: var(--text); font-size: 14px; font-weight: 500;">
                                <i class="fas fa-bug"></i> 錯誤即時檢查
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="liveErrorCheckToggle" ${state.editorSettings.liveErrorCheck !== false ? 'checked' : ''}>
                                <span class="slider-switch"></span>
                            </label>
                        </div>

                        <!-- 自動儲存 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(16, 185, 129, 0.05); border-radius: 8px;">
                            <label style="color: var(--text); font-size: 14px; font-weight: 500;">
                                <i class="fas fa-save"></i> 自動儲存代碼
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="autoSaveToggle" ${state.editorSettings.autoSave !== false ? 'checked' : ''}>
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                        <button class="btn btn-outline" onclick="this.closest('.modal').remove()">取消</button>
                        <button class="btn" onclick="applySettings()">
                            <i class="fas fa-check"></i> 應用設置
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 應用設置
        function applySettings() {
            const fontSize = parseInt(document.getElementById('fontSizeSlider')?.value) || 13;
            const tabSize = parseInt(document.getElementById('tabSizeSlider')?.value) || 2;
            const showLineNumbers = document.getElementById('lineNumbersToggle')?.checked || false;
            const theme = document.getElementById('editorThemeSelect')?.value || 'dark';
            const autoComplete = document.getElementById('autoCompleteToggle')?.checked !== false;
            const liveErrorCheck = document.getElementById('liveErrorCheckToggle')?.checked !== false;
            const autoSave = document.getElementById('autoSaveToggle')?.checked !== false;

            state.editorSettings.fontSize = fontSize;
            state.editorSettings.tabSize = tabSize;
            state.editorSettings.showLineNumbers = showLineNumbers;
            state.editorSettings.theme = theme;
            state.editorSettings.autoComplete = autoComplete;
            state.editorSettings.liveErrorCheck = liveErrorCheck;
            state.editorSettings.autoSave = autoSave;

            // 應用到編輯器
            const editor = document.getElementById('freeCodeEditor');
            if (editor) {
                editor.style.fontSize = `${fontSize}px`;
                editor.style.tabSize = tabSize;
                applyEditorTheme(editor, theme);
            }
            // 關閉模態框
            document.querySelector('.modal.active')?.remove();

            showNotification('設置已應用', 'success');
        }

        // 應用編輯器主題
        function applyEditorTheme(editor, theme) {
            if (!editor) return;

            // 定義主題配色
            const themes = {
                dark: {
                    background: '#060914',
                    color: '#e0e0e0',
                    selectionBg: 'rgba(0, 217, 255, 0.2)'
                },
                vscode: {
                    background: '#1e1e1e',
                    color: '#d4d4d4',
                    selectionBg: 'rgba(38, 79, 120, 0.4)'
                },
                monokai: {
                    background: '#272822',
                    color: '#f8f8f2',
                    selectionBg: 'rgba(73, 72, 62, 0.6)'
                },
                dracula: {
                    background: '#282a36',
                    color: '#f8f8f2',
                    selectionBg: 'rgba(68, 71, 90, 0.6)'
                },
                light: {
                    background: '#ffffff',
                    color: '#000000',
                    selectionBg: 'rgba(0, 119, 255, 0.2)'
                }
            };

            const selectedTheme = themes[theme] || themes.dark;

            // 應用主題樣式
            editor.style.background = selectedTheme.background;
            editor.style.color = selectedTheme.color;
            editor.style.setProperty('--selection-bg', selectedTheme.selectionBg);

            // 添加選取樣式（如果尚未添加）
            if (!document.getElementById('editorThemeStyles')) {
                const styleEl = document.createElement('style');
                styleEl.id = 'editorThemeStyles';
                styleEl.textContent = `
                    #freeCodeEditor::selection {
                        background: var(--selection-bg, rgba(0, 217, 255, 0.2));
                    }
                `;
                document.head.appendChild(styleEl);
            }
        }

        // 格式化代碼
        function formatCode() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            let code = editor.value;
            if (!code.trim()) {
                showNotification('沒有���碼可以格式化', 'error');
                return;
            }

            const tabSize = state.editorSettings.tabSize || 2;
            const indent = ' '.repeat(tabSize);

            try {
                const currentLang = state.category === 'frontend' ? editorState.currentLang : state.language;
            if (currentLang === 'html' || code.includes('<' + 'html')) {
                    // HTML 格式化
                    code = formatHTML(code, indent);
                } else if (state.language === 'css' || code.includes('{')) {
                    // CSS 格式化
                    code = formatCSS(code, indent);
                } else if (state.language === 'javascript') {
                    // JavaScript 格式化（簡單版本）
                    code = formatJavaScript(code, indent);
                } else if (state.language === 'python') {
                    // Python 格式化（簡單版本）
                    code = formatPython(code, indent);
                }

                editor.value = code;

                // Update editorState if in frontend mode
                if (state.category === 'frontend') {
                    editorState.code[editorState.currentLang] = code;
                }

                updateEditorStats();
                showNotification('代碼已格式化', 'success');

                // 如果是前端代碼，重新預覽
                if (state.category === 'frontend') {
                    runFreeCode();
                }
            } catch (error) {
                console.error('格式化錯誤:', error);
                showNotification('格式化失敗', 'error');
            }
        }

        // HTML 格式化
        function formatHTML(html, indent) {
            let formatted = '';
            let level = 0;
            const lines = html.split(/>\s*</);

            lines.forEach((line, i) => {
                const trimmed = line.trim();
                if (!trimmed) return;

                // 處理關閉標籤
                if (trimmed.startsWith('/')) {
                    level--;
                }

                // 添加縮排
                formatted += indent.repeat(Math.max(0, level));

                // 添加標籤
                if (i === 0) {
                    formatted += trimmed + (i < lines.length - 1 ? '>\n' : '');
                } else if (i === lines.length - 1) {
                    formatted += '<' + trimmed;
                } else {
                    formatted += '<' + trimmed + '>\n';
                }

                // 處理開標籤（不是自閉���標籤）
                if (!trimmed.startsWith('/') && !trimmed.endsWith('/') &&
                    !['br', 'img', 'input', 'meta', 'link', 'hr'].some(tag => trimmed.startsWith(tag))) {
                    level++;
                }

                // 處理自閉合標籤的反向縮排
                if (trimmed.endsWith('/')) {
                    // 自閉合標籤不改變層級
                }
            });

            return formatted;
        }

        // CSS 格式化
        function formatCSS(css, indent) {
            let formatted = '';
            let level = 0;

            // 移除多餘空白
            css = css.replace(/\s+/g, ' ').trim();

            // 處理每個字符
            for (let i = 0; i < css.length; i++) {
                const char = css[i];

                if (char === '{') {
                    formatted += ' {\n';
                    level++;
                } else if (char === '}') {
                    level--;
                    formatted += '\n' + indent.repeat(level) + '}\n\n';
                } else if (char === ';') {
                    formatted += ';\n' + indent.repeat(level);
                } else {
                    formatted += char;
                }
            }

            return formatted.trim();
        }

        // JavaScript 格式化（簡化版）
        function formatJavaScript(js, indent) {
            let formatted = '';
            let level = 0;

            const lines = js.split('\n');
            lines.forEach(line => {
                const trimmed = line.trim();
                if (!trimmed) return;

                // 處���閉合括號
                if (trimmed.startsWith('}') || trimmed.startsWith(']') || trimmed.startsWith(')')) {
                    level--;
                }

                formatted += indent.repeat(Math.max(0, level)) + trimmed + '\n';

                // 處理開放括號
                if (trimmed.endsWith('{') || trimmed.endsWith('[') || trimmed.endsWith('(')) {
                    level++;
                }
            });

            return formatted;
        }

        // Python 格式化（簡化版）
        function formatPython(python, indent) {
            // Python 格式化主要確保一致的縮排
            const lines = python.split('\n');
            let formatted = '';
            let level = 0;

            lines.forEach(line => {
                const trimmed = line.trim();
                if (!trimmed) {
                    formatted += '\n';
                    return;
                }

                // 處理減少縮排的情況
                if (trimmed.startsWith('elif ') || trimmed.startsWith('else:') ||
                    trimmed.startsWith('except') || trimmed.startsWith('finally:')) {
                    level = Math.max(0, level - 1);
                }

                // 添加行
                formatted += indent.repeat(level) + trimmed + '\n';

                // 處理增加縮排的情況
                if (trimmed.endsWith(':')) {
                    level++;
                }

                // 處理減少縮排的情況
                if (trimmed.startsWith('return ') || trimmed.startsWith('break') ||
                    trimmed.startsWith('continue') || trimmed.startsWith('pass')) {
                    // 這些語句後可能需要減少縮排
                }
            });

            return formatted.trim();
        }

        // 深色模式支持（已默認為深色，但監聽變化）
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // 智能補全處理
        function handleAutoComplete(e) {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const cursorPos = editor.selectionStart;
            const textBeforeCursor = editor.value.substring(0, cursorPos);
            const lastWord = textBeforeCursor.match(/[\w-]+$/)?.[0] || '';

            // HTML 標籤補全
            if (state.language === 'html' && lastWord && lastWord.length >= 2) {
                const htmlTags = ['div', 'span', 'p', 'h1', 'h2', 'h3', 'button', 'input', 'form', 'table', 'ul', 'li', 'img', 'a', 'nav', 'header', 'footer', 'section', 'article'];
                const suggestions = htmlTags.filter(tag => tag.startsWith(lastWord.toLowerCase()));
                if (suggestions.length > 0) {
                    showAutoCompleteSuggestions(suggestions, cursorPos, lastWord);
                }
            }

            // CSS 屬性補全
            if (state.language === 'css') {
                const cssProps = ['background', 'color', 'display', 'flex', 'grid', 'margin', 'padding', 'border', 'width', 'height', 'position', 'font-size', 'font-family'];
                const suggestions = cssProps.filter(prop => prop.startsWith(lastWord.toLowerCase()));
                if (suggestions.length > 0 && lastWord.length >= 2) {
                    showAutoCompleteSuggestions(suggestions, cursorPos, lastWord);
                }
            }

            // JavaScript 關鍵字補全
            if (state.language === 'javascript') {
                const jsKeywords = ['function', 'const', 'let', 'var', 'if', 'else', 'for', 'while', 'return', 'class', 'import', 'export', 'async', 'await'];
                const suggestions = jsKeywords.filter(kw => kw.startsWith(lastWord.toLowerCase()));
                if (suggestions.length > 0 && lastWord.length >= 2) {
                    showAutoCompleteSuggestions(suggestions, cursorPos, lastWord);
                }
            }
        }

        // 顯示自動補全建議
        function showAutoCompleteSuggestions(suggestions, cursorPos, lastWord) {
            // 移除舊的建議框
            const oldSuggestions = document.getElementById('autoCompleteSuggestions');
            if (oldSuggestions) oldSuggestions.remove();

            if (suggestions.length === 0) return;

            // 創建建議框
            const suggestionsBox = document.createElement('div');
            suggestionsBox.id = 'autoCompleteSuggestions';
            suggestionsBox.style.cssText = `
                position: absolute;
                background: var(--card-bg);
                border: 1px solid var(--primary);
                border-radius: 6px;
                padding: 4px;
                z-index: 1000;
                max-height: 200px;
                overflow-y: auto;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;

            suggestions.slice(0, 5).forEach(suggestion => {
                const item = document.createElement('div');
                item.textContent = suggestion;
                item.style.cssText = `
                    padding: 6px 12px;
                    cursor: pointer;
                    color: var(--text);
                    font-family: 'Fira Code', monospace;
                    font-size: 13px;
                    border-radius: 4px;
                `;
                item.addEventListener('mouseenter', () => {
                    item.style.background = 'rgba(0, 217, 255, 0.1)';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'transparent';
                });
                item.addEventListener('click', () => {
                    insertAutoComplete(suggestion, lastWord);
                    suggestionsBox.remove();
                });
                suggestionsBox.appendChild(item);
            });

            document.body.appendChild(suggestionsBox);

            // 定位建議框（簡化版本，放在編輯器下方）
            const editor = document.getElementById('freeCodeEditor');
            const rect = editor.getBoundingClientRect();
            suggestionsBox.style.left = rect.left + 20 + 'px';
            suggestionsBox.style.top = rect.top + 100 + 'px';

            // 5秒後自動關閉
            setTimeout(() => suggestionsBox.remove(), 5000);
        }

        // 插入自動補全
        function insertAutoComplete(suggestion, lastWord) {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const cursorPos = editor.selectionStart;
            const text = editor.value;
            const before = text.substring(0, cursorPos - lastWord.length);
            const after = text.substring(cursorPos);

            editor.value = before + suggestion + after;
            editor.selectionStart = editor.selectionEnd = before.length + suggestion.length;
            editor.focus();
        }

        // 錯誤���查
        function checkCodeErrors() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            const errors = [];

            // HTML 錯誤檢查
            if (state.language === 'html' || code.includes('<' + 'html')) {
                // 檢查未閉合的標籤
                const openTags = code.match(/<(\w+)[^>]*>/g) || [];
                const closeTags = code.match(/<\/(\w+)>/g) || [];
                const selfClosing = ['img', 'br', 'hr', 'input', 'meta', 'link'];

                openTags.forEach(tag => {
                    const tagName = tag.match(/<(\w+)/)[1];
                    if (!selfClosing.includes(tagName)) {
                        const closeTag = `</${tagName}>`;
                        if (!code.includes(closeTag)) {
                            errors.push(`未閉合的標籤: <${tagName}>`);
                        }
                    }
                });
            }

            // JavaScript 錯誤檢查
            if (state.language === 'javascript') {
                // 檢查括號匹配
                const openParens = (code.match(/\(/g) || []).length;
                const closeParens = (code.match(/\)/g) || []).length;
                if (openParens !== closeParens) {
                    errors.push('括號不匹配');
                }

                // 檢查大括號匹配
                const openBraces = (code.match(/\{/g) || []).length;
                const closeBraces = (code.match(/\}/g) || []).length;
                if (openBraces !== closeBraces) {
                    errors.push('大括號不匹配');
                }
            }

            // 顯示錯誤（如果有）
            if (errors.length > 0) {
                const statusEl = document.getElementById('editorStatus');
                if (statusEl) {
                    statusEl.textContent = `⚠️ ${errors[0]}`;
                    statusEl.style.color = 'var(--error)';
                }
            } else {
                const statusEl = document.getElementById('editorStatus');
                if (statusEl) {
                    statusEl.textContent = '✓ 就緒';
                    statusEl.style.color = 'var(--success)';
                }
            }
        }
        // 渲染文件列表
        function renderFileList() {
            const fileList = document.getElementById('fileList');
            if (!fileList) return;

            fileList.innerHTML = state.files.map(file => `
                <div class="file-item ${file.id === state.currentFileId ? 'active' : ''}"
                     onclick="switchToFile(${file.id})">
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                        <i class="fas fa-file-code" style="color: ${getFileIconColor(file.type)};"></i>
                        <span class="file-name">${file.name}</span>
                    </div>
                    <div class="file-actions">
                        <button class="icon-btn" onclick="event.stopPropagation(); renameFile(${file.id})" title="重命名">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn" onclick="event.stopPropagation(); deleteFile(${file.id})" title="刪除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            renderFileTabs();
        }

        // 渲染文件標籤頁
        function renderFileTabs() {
            const fileTabs = document.getElementById('fileTabs');
            if (!fileTabs) return;

            fileTabs.innerHTML = state.files.map(file => `
                <div class="file-tab ${file.id === state.currentFileId ? 'active' : ''}"
                     onclick="switchToFile(${file.id})">
                    <i class="fas fa-file-code"></i>
                    <span>${file.name}</span>
                    <span class="close-tab" onclick="event.stopPropagation(); closeFileTab(${file.id})">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
            `).join('');
        }

        // 獲取文件圖標顏色
        function getFileIconColor(type) {
            const colors = {
                'html': '#e44d26',
                'css': '#264de4',
                'js': '#f7df1e',
                'javascript': '#f7df1e',
                'python': '#3776ab',
                'ruby': '#cc342d',
                'java': '#007396'
            };
            return colors[type] || 'var(--primary)';
        }

        // 創建新文件
        async function createNewFile() {
            const fileName = await showPromptDialog('請輸入文件名稱：', 'untitled.html');
            if (!fileName) return;

            const fileType = fileName.split('.').pop().toLowerCase();
            const newFile = {
                id: state.nextFileId++,
                name: fileName,
                content: '',
                type: fileType,
                active: false
            };

            state.files.push(newFile);
            renderFileList();
            switchToFile(newFile.id);
            showNotification(`已創建文件：${fileName}`, 'success');
        }

        // 切換到指定文件
        function switchToFile(fileId) {
            // 保存當前文件內容
            const currentFile = state.files.find(f => f.id === state.currentFileId);
            const editor = document.getElementById('freeCodeEditor');
            if (currentFile && editor) {
                currentFile.content = editor.value;
            }

            // 切換到新文件
            state.currentFileId = fileId;
            const newFile = state.files.find(f => f.id === fileId);
            if (newFile && editor) {
                editor.value = newFile.content;
                state.language = newFile.type;
            }

            renderFileList();

            // 更新預覽（如果是前端代碼）
            if (state.category === 'frontend') {
                runFreeCode();
            }
        }

        // 關閉文件標籤
        function closeFileTab(fileId) {
            if (state.files.length === 1) {
                showNotification('至少需要保留一個文件', 'error');
                return;
            }

            const index = state.files.findIndex(f => f.id === fileId);
            state.files.splice(index, 1);

            // 如果關閉的是當前文件，切換到第一個文件
            if (fileId === state.currentFileId && state.files.length > 0) {
                switchToFile(state.files[0].id);
            }

            renderFileList();
        }

        // 刪除文件
        async function deleteFile(fileId) {
            if (state.files.length === 1) {
                showNotification('至少需要保留一個文件', 'error');
                return;
            }

            const confirmed = await showConfirmDialog('確定要刪除這個文件嗎？');
            if (confirmed) {
                closeFileTab(fileId);
                showNotification('文件已刪除', 'success');
            }
        }

        // 重命名文件
        async function renameFile(fileId) {
            const file = state.files.find(f => f.id === fileId);
            if (!file) return;

            const newName = await showPromptDialog('請輸入新的文件名稱：', file.name);
            if (!newName || newName === file.name) return;

            file.name = newName;
            file.type = newName.split('.').pop().toLowerCase();
            renderFileList();
            showNotification('文件已重命名', 'success');
        }

        // 切換文件資源管理器
        function toggleFileExplorer() {
            state.fileExplorerVisible = !state.fileExplorerVisible;
            const explorer = document.getElementById('fileExplorer');
            if (explorer) {
                explorer.style.display = state.fileExplorerVisible ? 'flex' : 'none';
            }
        }
        // 切換搜索面板
        function toggleSearchPanel() {
            const panel = document.getElementById('searchPanel');
            if (!panel) return;

            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                document.getElementById('searchInput').focus();
            }
        }

        // 查找下一個
        function findNext() {
            const searchText = document.getElementById('searchInput').value;
            if (!searchText) return;

            const editor = document.getElementById('freeCodeEditor');
            const text = editor.value;
            const isRegex = document.getElementById('regexSearch').checked;
            const isCaseSensitive = document.getElementById('caseSensitive').checked;
            const isWholeWord = document.getElementById('wholeWord').checked;

            try {
                let pattern;
                if (isRegex) {
                    pattern = new RegExp(searchText, isCaseSensitive ? 'g' : 'gi');
                } else {
                    let escaped = searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    if (isWholeWord) {
                        escaped = '\\b' + escaped + '\\b';
                    }
                    pattern = new RegExp(escaped, isCaseSensitive ? 'g' : 'gi');
                }

                // 查找所有匹配
                state.searchMatches = [];
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    state.searchMatches.push({
                        index: match.index,
                        length: match[0].length
                    });
                }

                if (state.searchMatches.length === 0) {
                    document.getElementById('searchResults').textContent = '未找到匹配項';
                    return;
                }

                // 移動到下一個匹配
                state.currentMatchIndex = (state.currentMatchIndex + 1) % state.searchMatches.length;
                highlightMatch();

            } catch (e) {
                document.getElementById('searchResults').textContent = '正則表達式錯誤';
            }
        }

        // 查找上一個
        function findPrevious() {
            if (state.searchMatches.length === 0) {
                findNext();
                return;
            }

            state.currentMatchIndex--;
            if (state.currentMatchIndex < 0) {
                state.currentMatchIndex = state.searchMatches.length - 1;
            }
            highlightMatch();
        }

        // 高亮當前匹配
        function highlightMatch() {
            const editor = document.getElementById('freeCodeEditor');
            if (state.searchMatches.length === 0) return;

            const match = state.searchMatches[state.currentMatchIndex];
            editor.focus();
            editor.setSelectionRange(match.index, match.index + match.length);

            // 更新搜索結果統計
            document.getElementById('searchResults').textContent =
                `第 ${state.currentMatchIndex + 1} 個，共 ${state.searchMatches.length} 個匹配`;
        }

        // 取代下一個
        function replaceNext() {
            if (state.searchMatches.length === 0) {
                findNext();
                return;
            }

            const editor = document.getElementById('freeCodeEditor');
            const replaceText = document.getElementById('replaceInput').value;
            const match = state.searchMatches[state.currentMatchIndex];

            const text = editor.value;
            editor.value = text.substring(0, match.index) + replaceText +
                          text.substring(match.index + match.length);

            // 重新搜索
            findNext();
        }

        // 全部取代
        function replaceAll() {
            const searchText = document.getElementById('searchInput').value;
            const replaceText = document.getElementById('replaceInput').value;
            if (!searchText) return;

            const editor = document.getElementById('freeCodeEditor');
            const isRegex = document.getElementById('regexSearch').checked;
            const isCaseSensitive = document.getElementById('caseSensitive').checked;
            const isWholeWord = document.getElementById('wholeWord').checked;

            try {
                let pattern;
                if (isRegex) {
                    pattern = new RegExp(searchText, isCaseSensitive ? 'g' : 'gi');
                } else {
                    let escaped = searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    if (isWholeWord) {
                        escaped = '\\b' + escaped + '\\b';
                    }
                    pattern = new RegExp(escaped, isCaseSensitive ? 'g' : 'gi');
                }

                const count = (editor.value.match(pattern) || []).length;
                editor.value = editor.value.replace(pattern, replaceText);

                document.getElementById('searchResults').textContent = `已取代 ${count} 處`;
                state.searchMatches = [];
                state.currentMatchIndex = -1;

            } catch (e) {
                document.getElementById('searchResults').textContent = '正則表達式錯誤';
            }
        }

        // ========== 預覽調整大小功能 ==========
        let isResizing = false;
        let lastX = 0;

        function initializeResizer() {
            const resizer = document.getElementById('resizer');
            const editorContainer = document.getElementById('editorContainer');
            const previewSection = document.getElementById('previewSection');

            if (!resizer || !editorContainer || !previewSection) return;

            resizer.addEventListener('mousedown', function(e) {
                isResizing = true;
                lastX = e.clientX;
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                resizer.style.background = 'var(--primary)';
            });

            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;

                const delta = e.clientX - lastX;
                const editorWidth = editorContainer.offsetWidth;
                const previewWidth = previewSection.offsetWidth;
                const totalWidth = editorWidth + previewWidth;

                const newEditorPercent = ((editorWidth + delta) / totalWidth) * 100;
                const newPreviewPercent = 100 - newEditorPercent;

                if (newEditorPercent > 20 && newEditorPercent < 80) {
                    editorContainer.style.flex = `0 0 ${newEditorPercent}%`;
                    previewSection.style.flex = `0 0 ${newPreviewPercent}%`;
                    lastX = e.clientX;
                }
            });

            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = 'default';
                    document.body.style.userSelect = '';
                    resizer.style.background = 'var(--border)';
                }
            });
        }

        // 最大���/還原預覽
        let isPreviewMaximized = false;
        function togglePreviewSize() {
            const editorContainer = document.getElementById('editorContainer');
            const previewSection = document.getElementById('previewSection');
            const expandIcon = document.getElementById('expandIcon');
            const fileExplorer = document.getElementById('fileExplorer');
            const resizer = document.getElementById('resizer');

            isPreviewMaximized = !isPreviewMaximized;

            if (isPreviewMaximized) {
                // 最大化預覽
                editorContainer.style.display = 'none';
                fileExplorer.style.display = 'none';
                resizer.style.display = 'none';
                previewSection.style.flex = '1';
                expandIcon.className = 'fas fa-compress-alt';
            } else {
                // 還原
                editorContainer.style.display = 'flex';
                if (state.fileExplorerVisible) {
                    fileExplorer.style.display = 'flex';
                }
                resizer.style.display = 'block';
                previewSection.style.flex = '0 0 45%';
                expandIcon.className = 'fas fa-expand-alt';
            }
        }

        // ========== HTML模板切換功能 ==========
        let templateHidden = false;

        function getHtmlTemplate() {
            const parts = [
                '<!DOCTYPE html>',
                '<html lang="zh-TW">',
                '<head>',
                '    <meta charset="UTF-8">',
                '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
                '    <title>HTML Editor</title>',
                '    <style>',
                '        /* 在此添加CSS樣式 */',
                '    </style>',
                '</head>',
                '<body>',
                '    <!-- 在此編���HTML內容 -->',
                '',
                '    <' + 'script>',
                '        // 在此編寫JavaScript代碼',
                '    </' + 'script>',
                '</body>',
                '</html>'
            ];
            return parts.join('\n');
        }

        function toggleTemplateCode() {
            const editor = document.getElementById('freeCodeEditor');
            const toggleBtn = document.getElementById('templateToggleBtn');
            const toggleText = document.getElementById('templateToggleText');

            if (!editor) return;

            // Check if current language is HTML (either from state.language or editorState.currentLang)
            const currentLang = state.category === 'frontend' ? editorState.currentLang : state.language;
            if (currentLang !== 'html') {
                showNotification('此功能僅適用於HTML語言', 'warning');
                return;
            }

            templateHidden = !templateHidden;

            if (templateHidden) {
                // 隱藏模板，只顯示body內容
                const content = editor.value;
                const bodyRegex = new RegExp('<' + 'body[^>]*>([\\s\\S]*)<' + '/body>', 'i');
                const bodyMatch = content.match(bodyRegex);

                if (bodyMatch) {
                    let bodyContent = bodyMatch[1].trim();
                    // 移除body內的script標籤（如果有的話保留內容）
                    const scriptRegex = new RegExp('<' + 'script[^>]*>([\\s\\S]*?)<' + '/script>', 'i');
                    const scriptMatch = bodyContent.match(scriptRegex);
                    if (scriptMatch) {
                        const scriptReplaceRegex = new RegExp('<' + 'script[^>]*>[\\s\\S]*?<' + '/script>', 'gi');
                        bodyContent = bodyContent.replace(scriptReplaceRegex, '').trim();
                    }
                    editor.value = bodyContent;

                    // Update editorState if in frontend mode
                    if (state.category === 'frontend') {
                        editorState.code.html = bodyContent;
                    }

                    if (toggleBtn) {
                        const icon = toggleBtn.querySelector('i');
                        if (icon) icon.className = 'fas fa-eye';
                    }
                    if (toggleText) toggleText.textContent = '顯示模板';
                    showNotification('已隱藏HTML模板，僅顯示body內容', 'success');
                } else {
                    templateHidden = false;
                    showNotification('未檢測到完整的HTML模板結構', 'warning');
                }
            } else {
                // 顯示完整模板
                const bodyContent = editor.value;
                const htmlTemplate = getHtmlTemplate();
                const fullCode = htmlTemplate.replace('<!-- 在此編寫HTML內容 -->', bodyContent);
                editor.value = fullCode;

                // Update editorState if in frontend mode
                if (state.category === 'frontend') {
                    editorState.code.html = fullCode;
                }

                if (toggleBtn) {
                    const icon = toggleBtn.querySelector('i');
                    if (icon) icon.className = 'fas fa-eye-slash';
                }
                if (toggleText) toggleText.textContent = '隱藏模板';
                showNotification('已顯示完整HTML模板', 'success');
            }

            // 重新運行代碼
            if (state.category === 'frontend' || state.language === 'html') {
                runFreeCode();
            }
        }

        // ========== 分析面板切換 ==========
        let analysisPanelCollapsed = false;
        function toggleAnalysisPanel() {
            const content = document.getElementById('analysisContent');
            const icon = document.getElementById('analysisPanelIcon');

            analysisPanelCollapsed = !analysisPanelCollapsed;

            if (analysisPanelCollapsed) {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-up';
            } else {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-down';
            }
        }

        // ========== 增強的代碼即時檢測 ==========
        function performLiveAnalysis() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return;

            const code = editor.value;
            const language = state.language || 'html';

            // 更新分析狀態
            const statusEl = document.getElementById('analysisStatus');
            if (statusEl) {
                statusEl.innerHTML = '<i class="fas fa-circle" style="font-size: 6px; color: var(--warning);"></i> 分析中...';
            }

            // 執行各項檢查
            checkSyntaxValidity(code, language);
            checkCodeStyle(code, language);
            checkPotentialErrors(code, language);
            checkPerformance(code, language);
            checkSecurity(code, language);

            // 更新狀態
            if (statusEl) {
                statusEl.innerHTML = '<i class="fas fa-circle" style="font-size: 6px; color: var(--success);"></i> 分析完成';
            }
        }

        // 語法正確性檢查
        function checkSyntaxValidity(code, language) {
            const checkEl = document.getElementById('checkSyntax');
            const msgEl = document.getElementById('checkSyntaxMsg');

            if (!checkEl || !msgEl) return;

            // 如果代码为空，显示待分析状态
            if (!code || code.trim().length === 0) {
                checkEl.textContent = '⏳';
                msgEl.textContent = '等待輸入代碼...';
                msgEl.style.color = 'var(--text-gray)';
                return;
            }

            let isValid = true;
            let message = '語法正確';

            if (language === 'html') {
                // 只检查主要的结构性标签
                const importantTags = ['html', 'head', 'body', 'div', 'section', 'article', 'nav', 'header', 'footer', 'main'];
                const selfClosing = ['img', 'br', 'hr', 'input', 'meta', 'link', 'area', 'base', 'col', 'embed', 'param', 'source', 'track', 'wbr'];

                // 提取所有开始和结束标签
                const openTagsRaw = code.match(/<(\w+)[^>]*>/g) || [];
                const closeTagsRaw = code.match(/<\/(\w+)>/g) || [];

                const openTags = {};
                const closeTags = {};

                openTagsRaw.forEach(tag => {
                    const tagName = tag.match(/<(\w+)/)[1].toLowerCase();
                    if (!selfClosing.includes(tagName)) {
                        openTags[tagName] = (openTags[tagName] || 0) + 1;
                    }
                });

                closeTagsRaw.forEach(tag => {
                    const tagName = tag.match(/<\/(\w+)/)[1].toLowerCase();
                    closeTags[tagName] = (closeTags[tagName] || 0) + 1;
                });

                // 只检查重要标签的匹配
                for (const tagName of importantTags) {
                    if (openTags[tagName] && (!closeTags[tagName] || openTags[tagName] !== closeTags[tagName])) {
                        isValid = false;
                        message = `標籤 <${tagName}> 未正確閉合`;
                        break;
                    }
                }
            } else if (language === 'javascript' || language === 'js') {
                // 移除字符串和注释后再检查括号
                const cleanCode = code
                    .replace(/"(?:[^"\\]|\\.)*"/g, '""')  // 移除双引号字符串
                    .replace(/'(?:[^'\\]|\\.)*'/g, "''")  // 移除单引号字符串
                    .replace(/\/\/.*$/gm, '')              // 移除单行注释
                    .replace(/\/\*[\s\S]*?\*\//g, '');    // 移除多行注释

                const openParen = (cleanCode.match(/\(/g) || []).length;
                const closeParen = (cleanCode.match(/\)/g) || []).length;
                const openBrace = (cleanCode.match(/\{/g) || []).length;
                const closeBrace = (cleanCode.match(/\}/g) || []).length;
                const openBracket = (cleanCode.match(/\[/g) || []).length;
                const closeBracket = (cleanCode.match(/\]/g) || []).length;

                if (openParen !== closeParen) {
                    isValid = false;
                    message = `圓括號不匹配 (開: ${openParen}, 閉: ${closeParen})`;
                } else if (openBrace !== closeBrace) {
                    isValid = false;
                    message = `大括號不匹配 (開: ${openBrace}, 閉: ${closeBrace})`;
                } else if (openBracket !== closeBracket) {
                    isValid = false;
                    message = `方括號不匹配 (開: ${openBracket}, 閉: ${closeBracket})`;
                }
            }

            checkEl.textContent = isValid ? '✅' : '❌';
            msgEl.textContent = message;
            msgEl.style.color = isValid ? 'var(--success)' : 'var(--error)';
        }

        // 代���風格檢查
        function checkCodeStyle(code, language) {
            const checkEl = document.getElementById('checkStyle');
            const msgEl = document.getElementById('checkStyleMsg');

            if (!checkEl || !msgEl) return;

            // 空代碼不檢查
            if (!code || code.trim().length === 0) {
                checkEl.textContent = '⏳';
                msgEl.textContent = '等待輸入代碼...';
                msgEl.style.color = 'var(--text-gray)';
                return;
            }

            const issues = [];
            const lines = code.split('\n');

            // 只在代碼行數���過10行時才檢查縮進（避免小代碼片段虛報）
            if (lines.length > 10) {
                const hasSpaces = lines.some(line => line.match(/^ {4,}/)); // 至少4個空格才算
                const hasTabs = lines.some(line => line.match(/^\t+/));

                if (hasSpaces && hasTabs) {
                    issues.push('混用空格和Tab縮進');
                }
            }

            // 只在超過150字符時才警告（120太嚴格）
            const longLines = lines.filter(line => line.length > 150).length;
            if (longLines > 3) { // 超過3行才警告
                issues.push(`${longLines}行超過150字符`);
            }

            if (issues.length === 0) {
                checkEl.textContent = '✅';
                msgEl.textContent = '代碼風格良好';
                msgEl.style.color = 'var(--success)';
            } else {
                checkEl.textContent = '⚠️';
                msgEl.textContent = issues.join(', ');
                msgEl.style.color = 'var(--warning)';
            }
        }

        // 潛在錯誤檢查
        function checkPotentialErrors(code, language) {
            const checkEl = document.getElementById('checkErrors');
            const msgEl = document.getElementById('checkErrorsMsg');

            if (!checkEl || !msgEl) return;

            // 空代碼不檢查
            if (!code || code.trim().length === 0) {
                checkEl.textContent = '⏳';
                msgEl.textContent = '等待輸���代碼...';
                msgEl.style.color = 'var(--text-gray)';
                return;
            }

            const warnings = [];

            if (language === 'javascript' || language === 'js') {
                // 移除虛報的未宣告變數檢查（太不準確）
                // 只檢查console.log數量過多的情況
                const consoleCount = (code.match(/console\.log/g) || []).length;
                if (consoleCount > 5) { // 超過5個才警告
                    warnings.push(`包含${consoleCount}個console.log除錯語句`);
                }
            }

            if (language === 'html') {
                // 檢查inline樣式過多（提高門檻到10個）
                const inlineStyles = (code.match(/style="/g) || []).length;
                if (inlineStyles > 10) {
                    warnings.push(`${inlineStyles}個inline樣式，建議使用CSS類別`);
                }
            }

            if (warnings.length === 0) {
                checkEl.textContent = '✅';
                msgEl.textContent = '未發現明顯問題';
                msgEl.style.color = 'var(--success)';
            } else {
                checkEl.textContent = '⚠️';
                msgEl.textContent = warnings.join(', ');
                msgEl.style.color = 'var(--warning)';
            }
        }

        // 效能優化檢查
        function checkPerformance(code, language) {
            const checkEl = document.getElementById('checkPerf');
            const msgEl = document.getElementById('checkPerfMsg');

            if (!checkEl || !msgEl) return;

            // 空代碼不檢查
            if (!code || code.trim().length === 0) {
                checkEl.textContent = '⏳';
                msgEl.textContent = '等待輸入代���...';
                msgEl.style.color = 'var(--text-gray)';
                return;
            }

            const suggestions = [];

            if (language === 'javascript' || language === 'js') {
                // 檢查深度嵌套循環（3層以上才警告，避免虛報）
                const tripleNested = code.match(/for[^{]*{[^}]*for[^{]*{[^}]*for/);
                if (tripleNested) {
                    suggestions.push('深度嵌套循環可能影響效能');
                }
            }

            if (language === 'html') {
                // 提高圖片門檻到20張（10太低）
                const imgTags = (code.match(/<img/g) || []).length;
                if (imgTags > 20) {
                    suggestions.push(`${imgTags}張圖片，考慮lazy loading`);
                }
            }

            if (suggestions.length === 0) {
                checkEl.textContent = '✅';
                msgEl.textContent = '效能表現良好';
                msgEl.style.color = 'var(--success)';
            } else {
                checkEl.textContent = '💡';
                msgEl.textContent = suggestions.join(', ');
                msgEl.style.color = 'var(--primary)';
            }
        }

        // 安全性檢查
        function checkSecurity(code, language) {
            const checkEl = document.getElementById('checkSecurity');
            const msgEl = document.getElementById('checkSecurityMsg');

            if (!checkEl || !msgEl) return;

            // 空代碼不檢查
            if (!code || code.trim().length === 0) {
                checkEl.textContent = '⏳';
                msgEl.textContent = '等待輸入代碼...';
                msgEl.style.color = 'var(--text-gray)';
                return;
            }

            const risks = [];

            if (language === 'javascript' || language === 'js') {
                // 只檢查真正危險的eval使用（不在註釋中）
                if (code.includes('eval(') && !code.match(/\/\/.*eval\(/)) {
                    risks.push('使用eval()存在安全風險');
                }

                // 移除innerHTML的虛���（太常見且不一定有風險）
                // 只在同時使用innerHTML且處理用戶輸入時才警告
                const hasInnerHTML = code.includes('innerHTML');
                const hasUserInput = code.match(/\.value|prompt\(|location\.|document\.cookie/);
                if (hasInnerHTML && hasUserInput) {
                    risks.push('處理用戶輸入時使用innerHTML可���有XSS風險');
                }
            }

            if (risks.length === 0) {
                checkEl.textContent = '✅';
                msgEl.textContent = '未發現安全問題';
                msgEl.style.color = 'var(--success)';
            } else {
                checkEl.textContent = '🔒';
                msgEl.textContent = risks.join(', ');
                msgEl.style.color = 'var(--error)';
            }
        }

        // ========== 鍵盤快捷鍵 ==========
        document.addEventListener('keydown', function(e) {
            // Ctrl+F: 打開搜索
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                toggleSearchPanel();
            }

            // Ctrl+H: 打開搜索與取代
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                toggleSearchPanel();
                document.getElementById('replaceInput').focus();
            }

            // Ctrl+S: 保存當前文件（暫時只顯示通知）
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                showNotification('文件已保存到瀏覽器記憶體', 'success');
            }

            // Ctrl+N: 新建文件
            if (e.ctrlKey && e.key === 'n' && state.mode === 'free') {
                e.preventDefault();
                createNewFile();
            }

            // Ctrl+T: 切換模板顯示
            if (e.ctrlKey && e.key === 't' && state.mode === 'free') {
                e.preventDefault();
                toggleTemplateCode();
            }
        });

        // 啟動
        init();

        // 初始化文件系統和功能
        if (document.getElementById('freePage')) {
            renderFileList();
            initializeResizer();

            // 監聽編輯器輸入，觸發即時分析
            const freeEditor = document.getElementById('freeCodeEditor');
            if (freeEditor) {
                let analysisTimer;
                freeEditor.addEventListener('input', function() {
                    clearTimeout(analysisTimer);
                    analysisTimer = setTimeout(function() {
                        performLiveAnalysis();
                    }, 1500); // 1.5秒後進行分析
                });

                // 初次加載���也進行分析
                setTimeout(function() {
                    performLiveAnalysis();
                }, 500);
            }
        }

        // ========================================
        // API 模擬器功能
        // ========================================

        // 模擬數據庫（使用內存存儲）
        const inMemoryDB = {
            users: [],
            games: [],
            players: []
        };

        const SimulatedDB = {
            init() {
                // 初始化內存數據庫
                if (!inMemoryDB.users) inMemoryDB.users = [];
                if (!inMemoryDB.games) inMemoryDB.games = [];
                if (!inMemoryDB.players) inMemoryDB.players = [];
            },

            getTable(tableName) {
                return inMemoryDB[tableName] || [];
            },

            setTable(tableName, data) {
                inMemoryDB[tableName] = data;
            },

            insert(tableName, record) {
                const table = this.getTable(tableName);
                record.id = Date.now() + Math.random();
                record.created_at = new Date().toISOString();
                table.push(record);
                this.setTable(tableName, table);
                return record;
            },

            find(tableName, condition) {
                const table = this.getTable(tableName);
                return table.find(record => {
                    for (let key in condition) {
                        if (record[key] !== condition[key]) return false;
                    }
                    return true;
                });
            },

            findAll(tableName, condition = {}) {
                const table = this.getTable(tableName);
                if (Object.keys(condition).length === 0) return table;
                return table.filter(record => {
                    for (let key in condition) {
                        if (record[key] !== condition[key]) return false;
                    }
                    return true;
                });
            },

            update(tableName, condition, updates) {
                const table = this.getTable(tableName);
                const updated = table.map(record => {
                    let match = true;
                    for (let key in condition) {
                        if (record[key] !== condition[key]) {
                            match = false;
                            break;
                        }
                    }
                    if (match) {
                        return { ...record, ...updates, updated_at: new Date().toISOString() };
                    }
                    return record;
                });
                this.setTable(tableName, updated);
                return updated;
            },

            delete(tableName, condition) {
                const table = this.getTable(tableName);
                const filtered = table.filter(record => {
                    for (let key in condition) {
                        if (record[key] === condition[key]) return false;
                    }
                    return true;
                });
                this.setTable(tableName, filtered);
                return filtered;
            },

            clear(tableName) {
                this.setTable(tableName, []);
            },

            clearAll() {
                this.clear('users');
                this.clear('games');
                this.clear('players');
            }
        };

        // API 模擬器核心
        const APISimulator = {
            generateApiKey() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let key = 'sk_live_';
                for (let i = 0; i < 32; i++) {
                    key += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return key;
            },

            verifyApiKey(apiKey) {
                return apiKey === state.apiSimulator.apiKey;
            },

            addLog(method, endpoint, status, request, response) {
                const log = {
                    timestamp: new Date().toISOString(),
                    method,
                    endpoint,
                    status,
                    request,
                    response
                };
                state.apiSimulator.logs.unshift(log);
                if (state.apiSimulator.logs.length > 50) {
                    state.apiSimulator.logs = state.apiSimulator.logs.slice(0, 50);
                }
                this.updateLogsUI();
            },

            updateLogsUI() {
                const logsContainer = document.getElementById('apiLogs');
                if (!logsContainer) return;

                if (state.apiSimulator.logs.length === 0) {
                    logsContainer.innerHTML = '<div style="color: var(--text-gray); font-style: italic;">暫無請求記錄...</div>';
                    return;
                }

                logsContainer.innerHTML = state.apiSimulator.logs.map(log => {
                    const statusColor = log.status >= 200 && log.status < 300 ? 'var(--success)' : 'var(--error)';
                    const time = new Date(log.timestamp).toLocaleTimeString('zh-TW');
                    return `
                        <div style="margin-bottom: 15px; padding: 10px; background: var(--input-bg); border-radius: 6px; border-left: 3px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: ${statusColor}; font-weight: bold;">${log.method} ${log.endpoint}</span>
                                <span style="color: var(--text-gray);">${time}</span>
                            </div>
                            <div style="color: ${statusColor};">Status: ${log.status}</div>
                            ${log.request ? `<div style="margin-top: 5px; color: var(--text-gray); font-size: 11px;">Request: ${JSON.stringify(log.request).substring(0, 100)}...</div>` : ''}
                        </div>
                    `;
                }).join('');
            },

            updateStats() {
                const requestCountEl = document.getElementById('apiRequestCount');
                const successRateEl = document.getElementById('apiSuccessRate');

                if (requestCountEl) {
                    requestCountEl.textContent = state.apiSimulator.requestCount;
                }

                if (successRateEl) {
                    const rate = state.apiSimulator.requestCount === 0 ? 100 :
                        Math.round((state.apiSimulator.successCount / state.apiSimulator.requestCount) * 100);
                    successRateEl.textContent = rate + '%';
                }
            },

            // 🎯 計算延遲時間（根據用戶配置）
            calculateDelay() {
                const delayType = document.getElementById('apiDelayType')?.value || 'random';

                switch(delayType) {
                    case 'none':
                        return 0;
                    case 'fixed':
                        return parseInt(document.getElementById('apiFixedDelay')?.value || 500);
                    case 'slow':
                        return 1000 + Math.random() * 2000; // 1-3秒
                    case 'random':
                    default:
                        return 300 + Math.random() * 500; // 300-800ms
                }
            },

            // 🎯 應用情境化回應
            applyScenario(normalResponse, method, endpoint) {
                const scenario = document.getElementById('apiScenario')?.value || 'normal';

                switch(scenario) {
                    case 'error500':
                        return {
                            status: 500,
                            body: { error: 'Internal Server Error', message: '服務器遇到錯誤，無法完成請求' }
                        };
                    case 'error404':
                        return {
                            status: 404,
                            body: { error: 'Not Found', message: `端點 ${endpoint} 不存在` }
                        };
                    case 'error403':
                        return {
                            status: 403,
                            body: { error: 'Forbidden', message: '您沒有權限訪問此資源' }
                        };
                    case 'rateLimit':
                        return {
                            status: 429,
                            body: { error: 'Too Many Requests', message: '請求過於頻繁，請稍後再試', retryAfter: 60 }
                        };
                    case 'timeout':
                        return {
                            status: 408,
                            body: { error: 'Request Timeout', message: '請求超時' }
                        };
                    case 'normal':
                    default:
                        return normalResponse;
                }
            },

            // 模擬 API 端點（增強版）
            async handleRequest(method, endpoint, data, headers) {
                return new Promise((resolve) => {
                    // 🎯 開始請求 - 更新即時狀態
                    const requestStartTime = performance.now();
                    state.apiSimulator.realtime.status = 'processing';
                    state.apiSimulator.realtime.activeConnections++;
                    this.updateRealtimeStatus();

                    // 顯示請求進度提示
                    this.showRequestProgress(method, endpoint);

                    // 使用配置的延遲時間
                    const delay = this.calculateDelay();

                    setTimeout(() => {
                        state.apiSimulator.requestCount++;

                        // 驗證 API Key
                        if (!headers || !headers['Authorization'] || !this.verifyApiKey(headers['Authorization'].replace('Bearer ', ''))) {
                            const response = {
                                status: 401,
                                body: { error: 'Unauthorized', message: 'Invalid or missing API key' }
                            };
                            state.apiSimulator.realtime.status = 'error';
                            state.apiSimulator.realtime.lastRequest = { method, endpoint, status: 401 };
                            const latency = performance.now() - requestStartTime;
                            state.apiSimulator.realtime.latency = Math.round(latency);
                            state.apiSimulator.realtime.activeConnections--;
                            this.addLog(method, endpoint, 401, data, response.body);
                            this.updateStats();
                            this.updateRealtimeStatus();
                            this.hideRequestProgress();
                            resolve(response);
                            return;
                        }

                        let response;

                        // 路由處理
                        if (endpoint === '/api/login' && method === 'POST') {
                            response = this.handleLogin(data);
                        } else if (endpoint === '/api/register' && method === 'POST') {
                            response = this.handleRegister(data);
                        } else if (endpoint === '/api/game/save' && method === 'POST') {
                            response = this.handleGameSave(data);
                        } else if (endpoint === '/api/game/load' && method === 'GET') {
                            response = this.handleGameLoad(data);
                        } else if (endpoint === '/api/player' && method === 'GET') {
                            response = this.handleGetPlayer(data);
                        } else if (endpoint === '/api/leaderboard' && method === 'GET') {
                            response = this.handleGetLeaderboard(data);
                        } else {
                            response = {
                                status: 404,
                                body: { error: 'Not Found', message: 'API endpoint not found' }
                            };
                        }

                        // 🎯 應用情境化回應配置
                        response = this.applyScenario(response, method, endpoint);

                        if (response.status >= 200 && response.status < 300) {
                            state.apiSimulator.successCount++;
                            state.apiSimulator.realtime.status = 'success';
                        } else {
                            state.apiSimulator.realtime.status = 'error';
                        }

                        // 計算延遲
                        const latency = performance.now() - requestStartTime;
                        state.apiSimulator.realtime.latency = Math.round(latency);
                        state.apiSimulator.realtime.lastRequest = { method, endpoint, status: response.status };
                        state.apiSimulator.realtime.activeConnections--;

                        this.addLog(method, endpoint, response.status, data, response.body);
                        this.updateStats();
                        this.updateRealtimeStatus();
                        this.hideRequestProgress();

                        // 觸發 HTTP 請求流程可視化（增強版）
                        if (typeof enhancedHTTPVisualization === 'function') {
                            enhancedHTTPVisualization(method, endpoint, response.status);
                        } else if (typeof visualizeHTTPRequest === 'function') {
                            visualizeHTTPRequest(method, endpoint, response.status);
                        }

                        resolve(response);
                    }, 300 + Math.random() * 500); // 模擬網絡延遲
                });
            },

            // 🎯 顯示請求進度
            showRequestProgress(method, endpoint) {
                const progressEl = document.getElementById('apiRequestProgress');
                if (progressEl) {
                    progressEl.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; border-radius: 6px;">
                            <div style="width: 16px; height: 16px; border: 2px solid #3b82f6; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite;"></div>
                            <span style="color: #3b82f6; font-weight: 600;">${method} ${endpoint}</span>
                            <span style="color: var(--text-gray); font-size: 12px;">處理中...</span>
                        </div>
                    `;
                }
            },

            // 🎯 隱藏請求進度
            hideRequestProgress() {
                setTimeout(() => {
                    const progressEl = document.getElementById('apiRequestProgress');
                    if (progressEl) {
                        progressEl.innerHTML = '';
                    }
                }, 1000);
            },

            // 🎯 更新即時狀態顯示
            updateRealtimeStatus() {
                const statusEl = document.getElementById('apiRealtimeStatus');
                if (!statusEl) return;

                const statusColors = {
                    'idle': '#6b7280',
                    'processing': '#3b82f6',
                    'success': '#10b981',
                    'error': '#ef4444'
                };

                const statusIcons = {
                    'idle': 'fa-circle',
                    'processing': 'fa-spinner fa-spin',
                    'success': 'fa-check-circle',
                    'error': 'fa-exclamation-circle'
                };

                const statusTexts = {
                    'idle': '待機中',
                    'processing': '處理請求中',
                    'success': '請求成功',
                    'error': '請求失敗'
                };

                const status = state.apiSimulator.realtime.status;
                const color = statusColors[status] || statusColors.idle;
                const icon = statusIcons[status] || statusIcons.idle;
                const text = statusTexts[status] || statusTexts.idle;

                statusEl.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(${color === '#10b981' ? '16, 185, 129' : color === '#ef4444' ? '239, 68, 68' : color === '#3b82f6' ? '59, 130, 246' : '107, 114, 128'}, 0.1); border-radius: 6px;">
                        <i class="fas ${icon}" style="color: ${color};"></i>
                        <span style="color: ${color}; font-weight: 600; font-size: 13px;">${text}</span>
                        ${state.apiSimulator.realtime.latency > 0 ? `<span style="color: var(--text-gray); font-size: 11px; margin-left: auto;">${state.apiSimulator.realtime.latency}ms</span>` : ''}
                    </div>
                    ${state.apiSimulator.realtime.activeConnections > 0 ? `
                        <div style="margin-top: 6px; font-size: 11px; color: var(--text-gray);">
                            活動連接數: ${state.apiSimulator.realtime.activeConnections}
                        </div>
                    ` : ''}
                `;
            },

            handleLogin(data) {
                if (!data || !data.username || !data.password) {
                    return {
                        status: 400,
                        body: { error: 'Bad Request', message: 'Username and password are required' }
                    };
                }

                const user = SimulatedDB.find('users', { username: data.username });

                if (!user || user.password !== data.password) {
                    return {
                        status: 401,
                        body: { error: 'Unauthorized', message: 'Invalid username or password' }
                    };
                }

                const token = 'token_' + Math.random().toString(36).substring(2);
                return {
                    status: 200,
                    body: {
                        success: true,
                        message: 'Login successful',
                        user: { id: user.id, username: user.username, email: user.email },
                        token: token
                    }
                };
            },

            handleRegister(data) {
                if (!data || !data.username || !data.password || !data.email) {
                    return {
                        status: 400,
                        body: { error: 'Bad Request', message: 'Username, password, and email are required' }
                    };
                }

                const existingUser = SimulatedDB.find('users', { username: data.username });
                if (existingUser) {
                    return {
                        status: 409,
                        body: { error: 'Conflict', message: 'Username already exists' }
                    };
                }

                const newUser = SimulatedDB.insert('users', {
                    username: data.username,
                    password: data.password,
                    email: data.email
                });

                return {
                    status: 201,
                    body: {
                        success: true,
                        message: 'User registered successfully',
                        user: { id: newUser.id, username: newUser.username, email: newUser.email }
                    }
                };
            },

            handleGameSave(data) {
                if (!data || !data.userId) {
                    return {
                        status: 400,
                        body: { error: 'Bad Request', message: 'User ID is required' }
                    };
                }

                const existingGame = SimulatedDB.find('games', { userId: data.userId });

                if (existingGame) {
                    SimulatedDB.update('games', { userId: data.userId }, {
                        level: data.level || existingGame.level,
                        score: data.score || existingGame.score,
                        progress: data.progress || existingGame.progress,
                        inventory: data.inventory || existingGame.inventory
                    });
                } else {
                    SimulatedDB.insert('games', {
                        userId: data.userId,
                        level: data.level || 1,
                        score: data.score || 0,
                        progress: data.progress || {},
                        inventory: data.inventory || []
                    });
                }

                return {
                    status: 200,
                    body: {
                        success: true,
                        message: 'Game progress saved successfully'
                    }
                };
            },

            handleGameLoad(data) {
                if (!data || !data.userId) {
                    return {
                        status: 400,
                        body: { error: 'Bad Request', message: 'User ID is required' }
                    };
                }

                const game = SimulatedDB.find('games', { userId: data.userId });

                if (!game) {
                    return {
                        status: 404,
                        body: { error: 'Not Found', message: 'No saved game found for this user' }
                    };
                }

                return {
                    status: 200,
                    body: {
                        success: true,
                        game: {
                            level: game.level,
                            score: game.score,
                            progress: game.progress,
                            inventory: game.inventory,
                            lastSaved: game.updated_at || game.created_at
                        }
                    }
                };
            },

            handleGetPlayer(data) {
                if (!data || !data.userId) {
                    return {
                        status: 400,
                        body: { error: 'Bad Request', message: 'User ID is required' }
                    };
                }

                let player = SimulatedDB.find('players', { userId: data.userId });

                if (!player) {
                    // 創建默認玩家資料
                    player = SimulatedDB.insert('players', {
                        userId: data.userId,
                        nickname: 'Player_' + Math.floor(Math.random() * 10000),
                        level: 1,
                        exp: 0,
                        coins: 100,
                        achievements: []
                    });
                }

                return {
                    status: 200,
                    body: {
                        success: true,
                        player: {
                            userId: player.userId,
                            nickname: player.nickname,
                            level: player.level,
                            exp: player.exp,
                            coins: player.coins,
                            achievements: player.achievements
                        }
                    }
                };
            },

            handleGetLeaderboard(data) {
                const games = SimulatedDB.getTable('games');
                const sorted = games.sort((a, b) => (b.score || 0) - (a.score || 0)).slice(0, 10);

                return {
                    status: 200,
                    body: {
                        success: true,
                        leaderboard: sorted.map((game, index) => ({
                            rank: index + 1,
                            userId: game.userId,
                            score: game.score || 0,
                            level: game.level || 1
                        }))
                    }
                };
            }
        };

        // API 模擬器示例代碼
        const APIExamples = {
            user_auth: `// 用戶登錄示例
async function loginUser() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        },
        body: JSON.stringify({
            username: 'testuser',
            password: 'password123'
        })
    });

    const data = await response.json();
    console.log('登錄響應:', data);
    return data;
}

// 執行登錄
loginUser();`,

            game_save: `// 保存遊戲進度示例
async function saveGameProgress() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/game/save', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        },
        body: JSON.stringify({
            userId: 'user_12345',
            level: 5,
            score: 1250,
            progress: {
                checkpoints: [1, 2, 3],
                completedQuests: ['quest1', 'quest2']
            },
            inventory: ['sword', 'shield', 'potion']
        })
    });

    const data = await response.json();
    console.log('保存響應:', data);
    return data;
}

// 執行保存
saveGameProgress();`,

            game_load: `// 讀取遊戲進度示例
async function loadGameProgress() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/game/load?userId=user_12345', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        }
    });

    const data = await response.json();
    console.log('讀取響應:', data);

    if (data.success) {
        console.log('關卡:', data.game.level);
        console.log('分數:', data.game.score);
        console.log('進度:', data.game.progress);
        console.log('物品:', data.game.inventory);
    }

    return data;
}

// 執行讀取
loadGameProgress();`,

            player_data: `// 獲取玩家資料示例
async function getPlayerData() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/player?userId=user_12345', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        }
    });

    const data = await response.json();
    console.log('玩家資料:', data);

    if (data.success) {
        console.log('���稱:', data.player.nickname);
        console.log('等級:', data.player.level);
        console.log('經驗值:', data.player.exp);
        console.log('金幣:', data.player.coins);
        console.log('成就:', data.player.achievements);
    }

    return data;
}

// 執行獲取
getPlayerData();`,

            leaderboard: `// 查詢排行榜示例
async function getLeaderboard() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/leaderboard', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        }
    });

    const data = await response.json();
    console.log('排行榜:', data);

    if (data.success) {
        data.leaderboard.forEach(entry => {
            console.log(\`#\${entry.rank} - 用戶 \${entry.userId} - 分數: \${entry.score} - 等級: \${entry.level}\`);
        });
    }

    return data;
}

// 執行查詢
getLeaderboard();`,

            custom: `// 自定義 API 請求
async function customApiRequest() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    const response = await fetch('/api/your-endpoint', {
        method: 'POST', // 或 'GET'
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
        },
        body: JSON.stringify({
            // 您的請求數據
        })
    });

    const data = await response.json();
    console.log('響應:', data);
    return data;
}

// 執行請求
customApiRequest();`,

            // 新增：CORS 跨域請求示例
            cors_example: `// CORS 跨域請求處理示例
// 前端：處理 CORS 相關的請求配置
async function corsExample() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    try {
        // 前端發送請求（支持 CORS）
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + apiKey
            },
            // CORS 相關配置
            credentials: 'include', // 攜帶 Cookie
            mode: 'cors', // 跨域模式
            body: JSON.stringify({
                username: 'testuser',
                password: 'password123'
            })
        });

        const data = await response.json();
        console.log('✅ CORS 請求成功:', data);
        console.log('');
        console.log('📝 後端需要的 CORS 設定：');
        console.log('-----------------------------');
        console.log('// Node.js/Express 後端代碼');
        console.log('const cors = require("cors");');
        console.log('');
        console.log('app.use(cors({');
        console.log('  origin: ["http://localhost:3000"],');
        console.log('  methods: ["GET", "POST", "PUT", "DELETE"],');
        console.log('  allowedHeaders: ["Content-Type", "Authorization"],');
        console.log('  credentials: true');
        console.log('}));');

        return data;
    } catch (error) {
        console.error('❌ CORS 錯誤:', error.message);
        console.log('常見 CORS 問題：');
        console.log('1. 後端未設置 CORS 標頭');
        console.log('2. Origin 不在允許列表中');
        console.log('3. 預檢請求（OPTIONS）失敗');
    }
}

corsExample();`,

            // 新增：錯誤處理與重試機制
            error_handling: `// 錯誤處理與重試機制示例
async function apiWithErrorHandling() {
    const apiKey = document.getElementById('currentApiKey').textContent;
    const maxRetries = 3;
    let retryCount = 0;

    // 重試函數
    async function fetchWithRetry(url, options, retries = maxRetries) {
        try {
            const response = await fetch(url, options);

            // 檢查 HTTP 狀態碼
            if (!response.ok) {
                throw new Error(\`HTTP \${response.status}: \${response.statusText}\`);
            }

            const data = await response.json();

            // 檢查業務邏輯錯誤
            if (!data.success) {
                throw new Error(data.message || '請求失敗');
            }

            console.log('✅ 請求成功:', data);
            return data;

        } catch (error) {
            retryCount++;
            console.error(\`❌ 錯誤 (嘗試 \${retryCount}/\${maxRetries}):\`, error.message);

            // 如果還有重試次數
            if (retryCount < retries) {
                const delay = Math.pow(2, retryCount) * 1000; // 指數退避
                console.log(\`⏳ \${delay}ms 後重試...\`);
                await new Promise(resolve => setTimeout(resolve, delay));
                return fetchWithRetry(url, options, retries);
            }

            // 達到最大重試次數
            throw new Error(\`請求失敗，已重試 \${maxRetries} 次\`);
        }
    }

    // 執行帶重試的請求
    try {
        const data = await fetchWithRetry('/api/player?userId=user_12345', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + apiKey
            }
        });

        console.log('最終結果:', data);
    } catch (finalError) {
        console.error('💥 最終失敗:', finalError.message);
        // 這裡可以顯示用戶友好的錯誤訊息
    }
}

apiWithErrorHandling();`,

            // 新增：文件上傳示例
            file_upload: `// 文件上傳示例 (multipart/form-data)
async function uploadFile() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    // 創建 FormData 對象
    const formData = new FormData();

    // 模擬文件（實際使用時從 <input type="file"> 獲取）
    const fileContent = new Blob(['這是測試文件內容'], { type: 'text/plain' });
    const file = new File([fileContent], 'test.txt', { type: 'text/plain' });

    formData.append('file', file);
    formData.append('userId', 'user_12345');
    formData.append('category', 'avatar');

    console.log('📤 上傳文件資訊:');
    console.log('  檔名:', file.name);
    console.log('  大小:', file.size, 'bytes');
    console.log('  類型:', file.type);
    console.log('');

    try {
        const response = await fetch('/api/upload', {
            method: 'POST',
            headers: {
                // 注意：使用 FormData 時不要設置 Content-Type
                // 瀏覽器會自動設置正確的 boundary
                'Authorization': 'Bearer ' + apiKey
            },
            body: formData
        });

        const data = await response.json();
        console.log('✅ 上傳成功:', data);

        console.log('');
        console.log('📝 後端處理代碼（Node.js/Express）：');
        console.log('------------------------------------');
        console.log('const multer = require("multer");');
        console.log('const storage = multer.diskStorage({');
        console.log('  destination: "./uploads/",');
        console.log('  filename: (req, file, cb) => {');
        console.log('    cb(null, Date.now() + "-" + file.originalname);');
        console.log('  }');
        console.log('});');
        console.log('const upload = multer({ storage });');
        console.log('');
        console.log('app.post("/api/upload", upload.single("file"), (req, res) => {');
        console.log('  res.json({');
        console.log('    success: true,');
        console.log('    filename: req.file.filename');
        console.log('  });');
        console.log('});');

    } catch (error) {
        console.error('❌ 上傳失敗:', error);
    }
}

uploadFile();`,

            // 新增：分頁查詢示例
            pagination: `// 分頁查���示例
async function getPaginatedData(page = 1, limit = 10) {
    const apiKey = document.getElementById('currentApiKey').textContent;

    // 構建查詢參數
    const params = new URLSearchParams({
        page: page,
        limit: limit,
        sort: 'score',
        order: 'desc'
    });

    const url = \`/api/leaderboard?\${params.toString()}\`;
    console.log('📊 請求 URL:', url);

    try {
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + apiKey
            }
        });

        const data = await response.json();

        if (data.success) {
            console.log('✅ 獲取第', page, '頁數據');
            console.log('總記錄數:', data.total || 'N/A');
            console.log('當前頁:', page);
            console.log('每頁數量:', limit);
            console.log('數據:', data.leaderboard);

            console.log('');
            console.log('📝 後端分頁代碼（Node.js）：');
            console.log('-------------------------------');
            console.log('app.get("/api/leaderboard", async (req, res) => {');
            console.log('  const page = parseInt(req.query.page) || 1;');
            console.log('  const limit = parseInt(req.query.limit) || 10;');
            console.log('  const skip = (page - 1) * limit;');
            console.log('  ');
            console.log('  const data = await Model');
            console.log('    .find()');
            console.log('    .sort({ score: -1 })');
            console.log('    .skip(skip)');
            console.log('    .limit(limit);');
            console.log('  ');
            console.log('  const total = await Model.countDocuments();');
            console.log('  ');
            console.log('  res.json({');
            console.log('    success: true,');
            console.log('    data,');
            console.log('    pagination: {');
            console.log('      page,');
            console.log('      limit,');
            console.log('      total,');
            console.log('      pages: Math.ceil(total / limit)');
            console.log('    }');
            console.log('  });');
            console.log('});');
        }

        return data;
    } catch (error) {
        console.error('❌ 獲取失敗:', error);
    }
}

// 獲取第 1 頁
getPaginatedData(1, 10);`,

            // 新增：批量請求處理
            batch_request: `// 批量請求處理示例
async function batchRequests() {
    const apiKey = document.getElementById('currentApiKey').textContent;

    // 定義多個請求
    const requests = [
        { userId: 'user_001', type: 'player' },
        { userId: 'user_002', type: 'player' },
        { userId: 'user_003', type: 'player' }
    ];

    console.log('📦 發送批量請求:', requests.length, '個');

    try {
        // 方法 1: Promise.all（並行）
        console.log('\\n方法 1: Promise.all（並行執行）');
        const promises = requests.map(req =>
            fetch(\`/api/player?userId=\${req.userId}\`, {
                headers: {
                    'Authorization': 'Bearer ' + apiKey
                }
            }).then(res => res.json())
        );

        const results = await Promise.all(promises);
        console.log('✅ 並行請求完成:', results.length, '個結果');
        results.forEach((data, i) => {
            console.log(\`  結果 \${i+1}:\`, data.success ? '成功' : '失敗');
        });

        // 方法 2: 順序執行（用於有依賴關係的請求）
        console.log('\\n方法 2: 順序執行');
        const sequentialResults = [];
        for (const req of requests) {
            const response = await fetch(\`/api/player?userId=\${req.userId}\`, {
                headers: { 'Authorization': 'Bearer ' + apiKey }
            });
            const data = await response.json();
            sequentialResults.push(data);
            console.log(\`  完成 \${req.userId}\`);
        }

        console.log('\\n📝 後端批量處理代碼：');
        console.log('--------------------------------');
        console.log('app.post("/api/batch", async (req, res) => {');
        console.log('  const { requests } = req.body;');
        console.log('  ');
        console.log('  const results = await Promise.all(');
        console.log('    requests.map(async (req) => {');
        console.log('      try {');
        console.log('        const data = await processRequest(req);');
        console.log('        return { success: true, data };');
        console.log('      } catch (error) {');
        console.log('        return { success: false, error: error.message };');
        console.log('      }');
        console.log('    })');
        console.log('  );');
        console.log('  ');
        console.log('  res.json({ success: true, results });');
        console.log('});');

    } catch (error) {
        console.error('❌ 批量請求失敗:', error);
    }
}

batchRequests();`,

            // 新增：後端代碼示例
            backend_code: `/* ========================================
   完整的後端代碼示例（Node.js/Express）
   ======================================== */

// 1. 安裝必要套件
// npm install express cors body-parser

// 2. 後端主文件 (server.js)
const express = require('express');
const cors = require('cors');
const app = express();

// ==========================================
// 中介軟體設���
// ==========================================

// 1️⃣ CORS 跨域設置
app.use(cors({
    origin: ['http://localhost:3000', 'https://yourdomain.com'],
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization'],
    credentials: true  // 允許攜帶 Cookie
}));

// 2️⃣ 請求主體解析
app.use(express.json());  // 解析 JSON
app.use(express.urlencoded({ extended: true }));  // 解析表單

// 3️⃣ 自定義日誌中介軟體
app.use((req, res, next) => {
    console.log(\`[\${new Date().toISOString()}] \${req.method} \${req.url}\`);
    next();
});

// ==========================================
// API 路由
// ==========================================

// 用戶登錄
app.post('/api/login', async (req, res) => {
    try {
        const { username, password } = req.body;

        // 驗證輸入
        if (!username || !password) {
            return res.status(400).json({
                success: false,
                message: '用戶名和密碼為必填項'
            });
        }

        // 查詢用戶（這裡用假數據示範）
        // 實際應該查詢資料庫
        const user = { id: 1, username, email: 'user@example.com' };

        res.json({
            success: true,
            message: '登錄成功',
            user,
            token: 'jwt_token_here'
        });

    } catch (error) {
        res.status(500).json({
            success: false,
            message: '伺服器錯誤'
        });
    }
});

// 獲取玩家資料
app.get('/api/player', async (req, res) => {
    try {
        const { userId } = req.query;

        if (!userId) {
            return res.status(400).json({
                success: false,
                message: 'userId 為必填參數'
            });
        }

        // 從資料庫獲取資料（示範）
        const player = {
            userId,
            nickname: 'Player_' + userId,
            level: 10,
            exp: 5000,
            coins: 1000
        };

        res.json({
            success: true,
            player
        });

    } catch (error) {
        res.status(500).json({
            success: false,
            message: error.message
        });
    }
});

// ==========================================
// 錯誤處理中介軟體（���須放在最後）
// ==========================================
app.use((err, req, res, next) => {
    console.error(err.stack);

    res.status(err.status || 500).json({
        success: false,
        message: err.message || '內部伺服器錯誤',
        // 開發環境顯示詳細錯誤
        ...(process.env.NODE_ENV === 'development' && {
            stack: err.stack
        })
    });
});

// ==========================================
// 啟動伺服器
// ==========================================
const PORT = process.env.PORT || 3001;
app.listen(PORT, () => {
    console.log(\`✅ 伺服器運行在 http://localhost:\${PORT}\`);
});

/* ========================================
   使用說明：
   1. 將以上代碼保存為 server.js
   2. 運行: node server.js
   3. 伺服器將在 http://localhost:3001 啟動
   4. 前端可以調用 API 端點
   ======================================== */`,

            // 新增：完整的前端 API 服務層
            frontend_api_service: `/* ========================================
   完整的前端 API 服務層（React + Axios）
   ======================================== */

// 1. 安裝必要套件
// npm install axios

// 2. 創建 API 服務文件 (services/api.js)
import axios from 'axios';

// ==========================================
// 創建 Axios 實例
// ==========================================
const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5000/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// ==========================================
// 請求攔截器（自動添加 Token）
// ==========================================
api.interceptors.request.use(
  (config) => {
    // 從 localStorage 獲取 token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = \`Bearer \${token}\`;
    }

    console.log('📤 發送請求:', config.method.toUpperCase(), config.url);
    return config;
  },
  (error) => {
    console.error('❌ 請求錯誤:', error);
    return Promise.reject(error);
  }
);

// ==========================================
// 響應攔截器（統一錯誤處理）
// ==========================================
api.interceptors.response.use(
  (response) => {
    console.log('📥 收到響應:', response.status, response.data);
    return response.data;  // 直接返回 data
  },
  (error) => {
    if (error.response) {
      // 服務器返回錯誤
      const { status, data } = error.response;

      switch (status) {
        case 401:
          // 未授權，跳轉到登錄頁
          console.error('❌ 未授權，請重新登錄');
          localStorage.removeItem('token');
          window.location.href = '/login';
          break;
        case 403:
          console.error('❌ 權限不足');
          break;
        case 404:
          console.error('❌ 資源不存在');
          break;
        case 500:
          console.error('❌ 服務器錯誤');
          break;
        default:
          console.error(\`❌ 請求失敗: \${status}\`);
      }

      return Promise.reject({
        status,
        message: data?.message || '請求失敗'
      });
    } else if (error.request) {
      // 請求已發送但沒有收到響應
      console.error('❌ 網絡錯誤，請檢查連接');
      return Promise.reject({
        status: 0,
        message: '網絡錯誤'
      });
    } else {
      // 請求配置錯誤
      console.error('❌ 請求配置錯誤:', error.message);
      return Promise.reject(error);
    }
  }
);

// ==========================================
// API 方法封裝
// ==========================================

// 用戶相關 API
export const userAPI = {
  // 獲取所有用戶
  getUsers: () => api.get('/users'),

  // 獲取單個用戶
  getUserById: (id) => api.get(\`/users/\${id}\`),

  // 創建用戶
  createUser: (userData) => api.post('/users', userData),

  // 更新用戶
  updateUser: (id, userData) => api.put(\`/users/\${id}\`, userData),

  // 刪除用戶
  deleteUser: (id) => api.delete(\`/users/\${id}\`)
};

// 認證相關 API
export const authAPI = {
  // 登錄
  login: (credentials) => api.post('/auth/login', credentials),

  // 註冊
  register: (userData) => api.post('/auth/register', userData),

  // 登出
  logout: () => api.post('/auth/logout'),

  // 獲取當前用戶信息
  getProfile: () => api.get('/auth/profile')
};

// 導出 API 實例
export default api;

// ==========================================
// 使用示例：在 React 組件中使用
// ==========================================

/*
// components/UserList.jsx
import React, { useState, useEffect } from 'react';
import { userAPI } from '../services/api';

function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // 獲取用戶列表
  const fetchUsers = async () => {
    try {
      setLoading(true);
      const response = await userAPI.getUsers();
      setUsers(response.data);
      setError(null);
    } catch (err) {
      setError(err.message);
      console.error('獲取用戶失敗:', err);
    } finally {
      setLoading(false);
    }
  };

  // 添加用戶
  const handleAddUser = async (userData) => {
    try {
      await userAPI.createUser(userData);
      alert('用戶添加成功');
      await fetchUsers();  // 重新獲取列表
    } catch (err) {
      alert(\`添加失敗: \${err.message}\`);
    }
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  if (loading) return <div>載入中...</div>;
  if (error) return <div>錯誤: {error}</div>;

  return (
    <div>
      <h1>用戶列表</h1>
      <ul>
        {users.map(user => (
          <li key={user.id}>{user.name} - {user.email}</li>
        ))}
      </ul>
    </div>
  );
}
*/`,

            // 新增：JWT 身份驗證完整示例
            jwt_auth_example: `/* ========================================
   JWT 身份驗證完整示例
   ======================================== */

// ==========================================
// 後端：JWT 驗證中間件 (middleware/auth.js)
// ==========================================
const jwt = require('jsonwebtoken');

// JWT 驗證中間件
const authenticateToken = (req, res, next) => {
  // 從 header 獲取 token
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];  // Bearer TOKEN

  if (!token) {
    return res.status(401).json({
      success: false,
      message: '需要訪問令牌'
    });
  }

  // 驗證 token
  jwt.verify(token, process.env.JWT_SECRET || 'your-secret-key', (err, user) => {
    if (err) {
      return res.status(403).json({
        success: false,
        message: '無效的令牌'
      });
    }

    // 將用戶信息附加到請求對象
    req.user = user;
    next();
  });
};

// 登錄路由
app.post('/api/auth/login', async (req, res) => {
  const { username, password } = req.body;

  try {
    // 1. 驗證用戶名和密碼（這裡簡化處理）
    if (username === 'admin' && password === 'password123') {
      // 2. 創建 JWT token
      const user = {
        id: 1,
        username: username,
        role: 'admin'
      };

      const token = jwt.sign(
        user,
        process.env.JWT_SECRET || 'your-secret-key',
        { expiresIn: '24h' }  // token 有效期
      );

      // 3. 返回 token
      res.json({
        success: true,
        message: '登錄成功',
        data: {
          user: user,
          token: token
        }
      });
    } else {
      res.status(401).json({
        success: false,
        message: '用戶名或密碼錯誤'
      });
    }
  } catch (error) {
    res.status(500).json({
      success: false,
      message: '服務器���誤'
    });
  }
});

// 需要驗證的路由
app.get('/api/profile', authenticateToken, (req, res) => {
  res.json({
    success: true,
    message: '獲取個人資料成功',
    data: req.user
  });
});

// ==========================================
// 前端：Token 管理工具 (utils/auth.js)
// ==========================================

class AuthService {
  // 保存 token
  static setToken(token) {
    localStorage.setItem('token', token);
  }

  // 獲取 token
  static getToken() {
    return localStorage.getItem('token');
  }

  // 移除 token（登出）
  static removeToken() {
    localStorage.removeItem('token');
  }

  // 檢查是否已登錄
  static isAuthenticated() {
    return !!this.getToken();
  }

  // 解析 token 獲取用戶信息
  static parseToken() {
    const token = this.getToken();
    if (!token) return null;

    try {
      // JWT token 格式：header.payload.signature
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64).split('').map(c => {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join('')
      );

      return JSON.parse(jsonPayload);
    } catch (error) {
      console.error('解析 token 失敗:', error);
      return null;
    }
  }
}

// ==========================================
// 前端：使用示例
// ==========================================

// 登錄函數
async function login() {
  try {
    const response = await fetch('/api/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: 'admin',
        password: 'password123'
      })
    });

    const data = await response.json();

    if (data.success) {
      // 保存 token
      AuthService.setToken(data.data.token);
      console.log('✅ 登錄成功');
      console.log('用戶信息:', data.data.user);

      // 跳轉到主頁
      window.location.href = '/dashboard';
    } else {
      console.error('❌ 登錄失敗:', data.message);
    }
  } catch (error) {
    console.error('❌ 請求失敗:', error);
  }
}

// 訪問需要驗證的 API
async function getProfile() {
  const token = AuthService.getToken();

  if (!token) {
    console.error('❌ 未登錄');
    return;
  }

  try {
    const response = await fetch('/api/profile', {
      method: 'GET',
      headers: {
        'Authorization': \`Bearer \${token}\`,
        'Content-Type': 'application/json'
      }
    });

    const data = await response.json();

    if (data.success) {
      console.log('✅ 獲取個人資料成功');
      console.log('個人資料:', data.data);
    } else {
      console.error('❌ 獲取失敗:', data.message);
    }
  } catch (error) {
    console.error('❌ 請求失敗:', error);
  }
}

// 登出
function logout() {
  AuthService.removeToken();
  console.log('✅ 已登出');
  window.location.href = '/login';
}

// 使用示例
console.log('=== JWT 驗證示例 ===');
console.log('執行 login() 登錄');
console.log('執行 getProfile() 獲取個人資料');
console.log('執行 logout() 登出');`,

            // 新增：完整的 CORS 配置示例
            cors_config: `/* ========================================
   CORS（跨域資源共享）完整配置
   ======================================== */

// 1. 安裝 CORS 套件
// npm install cors

const express = require('express');
const cors = require('cors');
const app = express();

// ==========================================
// 方案 1：基本 CORS（允許所有來源）
// ==========================================
app.use(cors());

// ==========================================
// 方案 2：進階 CORS（限制特定來源）
// ==========================================
const corsOptions = {
  // 允許的���源
  origin: [
    'http://localhost:3000',      // 開發環境
    'http://localhost:3001',
    'https://yourdomain.com',     // 生產環境
    'https://www.yourdomain.com'
  ],

  // 允許的 HTTP 方法
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'PATCH'],

  // 允許的請求頭
  allowedHeaders: [
    'Content-Type',
    'Authorization',
    'X-Requested-With',
    'Accept',
    'Origin'
  ],

  // 允許暴露的響應頭
  exposedHeaders: ['Content-Range', 'X-Content-Range'],

  // 允許攜帶憑證（cookies）
  credentials: true,

  // 預檢請求的緩存時間（秒）
  maxAge: 86400  // 24小時
};

app.use(cors(corsOptions));

// ==========================================
// 方案 3：動態 CORS（根據請求來源判斷）
// ==========================================
const dynamicCors = cors((req, callback) => {
  const allowedOrigins = [
    'http://localhost:3000',
    'https://yourdomain.com'
  ];

  const origin = req.header('Origin');

  if (allowedOrigins.includes(origin)) {
    callback(null, { origin: true, credentials: true });
  } else {
    callback(null, { origin: false });
  }
});

app.use(dynamicCors);

// ==========================================
// 方案 4：手動 CORS 中間件（完全控制）
// ==========================================
app.use((req, res, next) => {
  const allowedOrigins = [
    'http://localhost:3000',
    'https://yourdomain.com'
  ];

  const origin = req.headers.origin;

  if (allowedOrigins.includes(origin)) {
    res.setHeader('Access-Control-Allow-Origin', origin);
  }

  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  res.setHeader('Access-Control-Allow-Credentials', 'true');
  res.setHeader('Access-Control-Max-Age', '86400');

  // 處理預檢請求
  if (req.method === 'OPTIONS') {
    res.status(200).end();
    return;
  }

  next();
});

// ==========================================
// 測試 CORS 的路由
// ==========================================
app.get('/api/test', (req, res) => {
  res.json({
    success: true,
    message: 'CORS 配置成功！',
    origin: req.headers.origin
  });
});

// ==========================================
// 前端測試 CORS
// ==========================================
/*
// 在前端執行此代碼測試 CORS
async function testCORS() {
  try {
    const response = await fetch('http://localhost:5000/api/test', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'include'  // 如果需要發送 cookies
    });

    const data = await response.json();
    console.log('✅ CORS 測試成功:', data);
  } catch (error) {
    console.error('❌ CORS 錯誤:', error);
  }
}

testCORS();
*/

console.log('📌 CORS 配置完成');
console.log('💡 提示：確保前端運行在允許的來源列表中');`
        };

        // API 模擬器初始化
        function initAPISimulator() {
            // 初始化數據庫
            SimulatedDB.init();

            // 生成初始 API Key
            if (!state.apiSimulator.apiKey) {
                state.apiSimulator.apiKey = APISimulator.generateApiKey();
            }

            // 更新 UI
            const apiKeyEl = document.getElementById('currentApiKey');
            if (apiKeyEl) {
                apiKeyEl.textContent = state.apiSimulator.apiKey;
            }

            // 🎯 初始化 API Key 狀態顯示
            setTimeout(() => {
                if (typeof updateApiKeyStatus === 'function') {
                    updateApiKeyStatus('valid');
                }
            }, 500);

            // 綁定事件
            const apiSimulatorCard = document.getElementById('apiSimulatorCard');
            if (apiSimulatorCard) {
                apiSimulatorCard.addEventListener('click', () => {
                    showPage('apiSimulator');
                    loadAPISimulatorExample('user_auth');
                });
            }

            const generateApiKeyBtn = document.getElementById('generateApiKeyBtn');
            if (generateApiKeyBtn) {
                generateApiKeyBtn.addEventListener('click', () => {
                    state.apiSimulator.apiKey = APISimulator.generateApiKey();
                    document.getElementById('currentApiKey').textContent = state.apiSimulator.apiKey;
                    updateApiKeyStatus('valid');
                    showNotification('✅ API Key 已重新生成並驗證成功', 'success');
                });
            }

            const copyApiKeyBtn = document.getElementById('copyApiKeyBtn');
            if (copyApiKeyBtn) {
                copyApiKeyBtn.addEventListener('click', () => {
                    const apiKey = document.getElementById('currentApiKey').textContent;
                    navigator.clipboard.writeText(apiKey).then(() => {
                        showNotification('API Key 已複製到剪貼板', 'success');
                    }).catch(() => {
                        showNotification('複製失敗', 'error');
                    });
                });
            }

            const frontendExample = document.getElementById('frontendExample');
            if (frontendExample) {
                frontendExample.addEventListener('change', (e) => {
                    loadAPISimulatorExample(e.target.value);
                });
            }

            const executeFrontendBtn = document.getElementById('executeFrontendBtn');
            if (executeFrontendBtn) {
                executeFrontendBtn.addEventListener('click', executeAPISimulatorCode);
            }

            const clearFrontendBtn = document.getElementById('clearFrontendBtn');
            if (clearFrontendBtn) {
                clearFrontendBtn.addEventListener('click', () => {
                    document.getElementById('frontendCodeEditor').value = '';
                });
            }

            // 🎯 導入前端代碼按鈕
            const importFrontendBtn = document.getElementById('importFrontendBtn');
            const frontendFileInput = document.getElementById('frontendFileInput');
            if (importFrontendBtn && frontendFileInput) {
                importFrontendBtn.addEventListener('click', () => {
                    frontendFileInput.click();
                });

                frontendFileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        importCodeFile(file, 'frontendCodeEditor');
                    }
                    // 重置input以允許重複導入同一文件
                    e.target.value = '';
                });
            }

            // 🎯 導出前端代碼按鈕
            const exportFrontendBtn = document.getElementById('exportFrontendBtn');
            if (exportFrontendBtn) {
                exportFrontendBtn.addEventListener('click', () => {
                    const code = document.getElementById('frontendCodeEditor').value;
                    exportCodeFile(code, 'frontend-code.js', 'JavaScript');
                });
            }

            const viewUsersBtn = document.getElementById('viewUsersBtn');
            if (viewUsersBtn) {
                viewUsersBtn.addEventListener('click', () => viewDatabaseTable('users'));
            }

            const viewGamesBtn = document.getElementById('viewGamesBtn');
            if (viewGamesBtn) {
                viewGamesBtn.addEventListener('click', () => viewDatabaseTable('games'));
            }

            const viewPlayersBtn = document.getElementById('viewPlayersBtn');
            if (viewPlayersBtn) {
                viewPlayersBtn.addEventListener('click', () => viewDatabaseTable('players'));
            }

            const clearDatabaseBtn = document.getElementById('clearDatabaseBtn');
            if (clearDatabaseBtn) {
                clearDatabaseBtn.addEventListener('click', async () => {
                    const confirmed = await showConfirmDialog('確定要清空所有數據庫表嗎？此操作不可恢復！');
                    if (confirmed) {
                        SimulatedDB.clearAll();
                        showNotification('數據庫已清空', 'success');
                        document.getElementById('databaseView').textContent = '數據庫已清空，所有表都是空的。';
                    }
                });
            }

            const clearLogsBtn = document.getElementById('clearLogsBtn');
            if (clearLogsBtn) {
                clearLogsBtn.addEventListener('click', () => {
                    state.apiSimulator.logs = [];
                    APISimulator.updateLogsUI();
                    showNotification('日誌已清空', 'success');
                });
            }

            // 🎯 API 延遲類型選擇監聽器
            const apiDelayTypeSelect = document.getElementById('apiDelayType');
            const fixedDelayControl = document.getElementById('fixedDelayControl');
            if (apiDelayTypeSelect && fixedDelayControl) {
                apiDelayTypeSelect.addEventListener('change', (e) => {
                    if (e.target.value === 'fixed') {
                        fixedDelayControl.style.display = 'block';
                    } else {
                        fixedDelayControl.style.display = 'none';
                    }
                });
            }

            // 添加一些示例數據
            addSampleData();
        }

        function loadAPISimulatorExample(exampleKey) {
            const editor = document.getElementById('frontendCodeEditor');
            if (editor && APIExamples[exampleKey]) {
                editor.value = APIExamples[exampleKey];
            }
        }

        async function executeAPISimulatorCode() {
            const code = document.getElementById('frontendCodeEditor').value;
            const backendResponse = document.getElementById('backendResponse');

            if (!code.trim()) {
                showNotification('請輸入代碼', 'error');
                return;
            }

            // 🎯 顯示並重置 HTTP 生命周期面板
            const lifecyclePanel = document.getElementById('httpLifecyclePanel');
            if (lifecyclePanel) {
                lifecyclePanel.style.display = 'block';
                resetLifecycleSteps();
            }

            // 更新狀態：前端開始執行
            updateConnectionStatus('frontend', 'processing');

            backendResponse.textContent = '⏳ 正在處理請求...\n等待後端響應...';

            // 覆蓋 fetch 以攔截請求
            const originalFetch = window.fetch;
            let requestMade = false;

            window.fetch = async function(url, options = {}) {
                requestMade = true;

                // 🎯 開始生命周期動畫
                await animateLifecycleStep(1, '前端發送請求');

                // 更新狀態：正在建立連結
                updateConnectionStatus('connection', 'processing');
                updateConnectionStatus('backend', 'processing');

                const method = options.method || 'GET';
                const headers = options.headers || {};
                let body = null;

                if (options.body) {
                    try {
                        body = JSON.parse(options.body);
                    } catch (e) {
                        body = options.body;
                    }
                }

                // 處理 GET 請求的查詢參數
                let endpoint = url;
                let queryData = {};
                if (url.includes('?')) {
                    const [path, query] = url.split('?');
                    endpoint = path;
                    const params = new URLSearchParams(query);
                    params.forEach((value, key) => {
                        queryData[key] = value;
                    });
                }

                const requestData = method === 'GET' ? queryData : body;

                // 🎯 生命周期步驟2：中間件處理
                await animateLifecycleStep(2, '驗證CORS、API Key');

                // 🎯 生命周期步驟3：路由匹配
                await animateLifecycleStep(3, `路由: ${method} ${endpoint}`);

                // 🎯 生命周期步驟4：業務邏輯
                await animateLifecycleStep(4, '處理業務邏輯');

                // 更新狀態：數據庫操作中
                updateConnectionStatus('database', 'processing');

                // 🎯 生命周期步驟5：數據庫操作
                await animateLifecycleStep(5, '執行數據庫查詢');

                const response = await APISimulator.handleRequest(method, endpoint, requestData, headers);

                // 🎯 生命周期步驟6：響應組裝
                await animateLifecycleStep(6, `HTTP ${response.status}`);

                // 🎯 顯示 HTTP 請求流程可視化動畫
                visualizeHTTPRequest(method, endpoint, response.status);

                // 🎯 生命周期步驟7：返回前端
                await animateLifecycleStep(7, '前端接收並處理');

                // 更新狀態：所有步驟成功
                updateConnectionStatus('connection', 'success');
                updateConnectionStatus('backend', 'success');
                updateConnectionStatus('database', 'success');

                // 更新後端響應顯示
                backendResponse.innerHTML = `<span style="color: var(--primary);">// HTTP ${response.status} ${response.status >= 200 && response.status < 300 ? 'OK' : 'Error'}</span>
<span style="color: var(--secondary);">// 後端處理完成，返回 JSON 響應</span>
<span style="color: #10b981;">// ✓ 此請求已在平台內部完成（無需實際網絡連接）</span>

${JSON.stringify(response.body, null, 2)}

<span style="color: var(--text-gray);">// ============================================</span>
<span style="color: var(--text-gray);">// 此響應由模擬後端生成</span>
<span style="color: var(--text-gray);">// 數據已保存到本地 localStorage 模擬數據庫</span>
<span style="color: #10b981;">// ✓ 所有操作在此平台內一站式完成</span>`;

                return {
                    ok: response.status >= 200 && response.status < 300,
                    status: response.status,
                    json: async () => response.body,
                    text: async () => JSON.stringify(response.body)
                };
            };

            try {
                // 執行用戶代碼
                const result = await eval(`(async () => { ${code} })()`);

                // 恢復原始 fetch
                window.fetch = originalFetch;

                // 更新狀態：前端執行成功
                updateConnectionStatus('frontend', 'success');

                showNotification('✅ 代碼執行完成！前後端已成功連結。', 'success');
            } catch (error) {
                window.fetch = originalFetch;
                backendResponse.textContent = `❌ 執行錯誤:\n${error.message}\n\n${error.stack}`;

                // 更新狀態：錯誤
                updateConnectionStatus('frontend', 'error');
                if (requestMade) {
                    updateConnectionStatus('connection', 'error');
                    updateConnectionStatus('backend', 'error');
                }

                showNotification('代碼執行出錯: ' + error.message, 'error');
            }
        }

        function viewDatabaseTable(tableName) {
            const table = SimulatedDB.getTable(tableName);
            const databaseView = document.getElementById('databaseView');

            if (table.length === 0) {
                databaseView.textContent = `表 "${tableName}" 是空的\n\n提示：執行一些 API 請求來添加數據`;
                return;
            }

            const tableNameMap = {
                users: '用戶表',
                games: '遊戲進度表',
                players: '玩家資料表'
            };

            databaseView.textContent = `${tableNameMap[tableName]} (${table.length} 條記錄)\n\n` +
                JSON.stringify(table, null, 2);
        }

        function addSampleData() {
            // 檢查是否已有示例數據
            const users = SimulatedDB.getTable('users');
            if (users.length === 0) {
                // 添加示例用戶
                SimulatedDB.insert('users', {
                    username: 'testuser',
                    password: 'password123',
                    email: 'testuser@example.com'
                });

                SimulatedDB.insert('users', {
                    username: 'player1',
                    password: 'pass456',
                    email: 'player1@example.com'
                });
            }
        }

        // ========================================
        // GitHub 模擬器功能
        // ========================================

        // Git 倉庫狀態（使用內存存儲，因為 iframe 環境不支持 localStorage）
        const gitRepo = {
            currentBranch: 'main',
            branches: {
                main: {
                    commits: [],
                    files: {}
                }
            },
            workingDirectory: {
                lastSavedContent: '',
                hasChanges: false
            },
            pullRequests: [],
            remoteRepo: {
                branches: {}
            }
        };

        // 初始化 Git 倉庫
        function initGitRepo() {
            // 確保 main 分支存在
            if (!gitRepo.branches.main) {
                gitRepo.branches.main = { commits: [], files: {} };
            }

            // 綁定 GitHub 卡片點擊事件
            const githubCard = document.getElementById('githubSimulatorCard');
            if (githubCard) {
                githubCard.addEventListener('click', () => {
                    showPage('githubSimulator');
                    updateGitUI();
                });
            }

            // 綁定工作區文本變化
            const workingArea = document.getElementById('gitWorkingArea');
            if (workingArea) {
                workingArea.addEventListener('input', () => {
                    gitRepo.workingDirectory.hasChanges =
                        workingArea.value !== gitRepo.workingDirectory.lastSavedContent;
                    updateGitUI();
                });
            }

            // 🎯 綁定 GitHub 導入/導出按鈕
            const importGitCodeBtn = document.getElementById('importGitCodeBtn');
            const gitFileInput = document.getElementById('gitFileInput');
            if (importGitCodeBtn && gitFileInput) {
                importGitCodeBtn.addEventListener('click', () => {
                    gitFileInput.click();
                });

                gitFileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        importCodeFile(file, 'gitWorkingArea');
                    }
                    e.target.value = '';
                });
            }

            const exportGitCodeBtn = document.getElementById('exportGitCodeBtn');
            if (exportGitCodeBtn) {
                exportGitCodeBtn.addEventListener('click', () => {
                    const code = document.getElementById('gitWorkingArea').value;
                    exportCodeFile(code, 'git-working-code.js', 'Git代碼');
                });
            }

            const exportGitHistoryBtn = document.getElementById('exportGitHistoryBtn');
            if (exportGitHistoryBtn) {
                exportGitHistoryBtn.addEventListener('click', exportGitHistory);
            }
        }

        // 保���倉庫狀態（內存存儲，數據在刷新後會重置）
        function saveGitRepo() {
            // 在 iframe 環境中使用內存存儲
            // 數據會在頁面刷新後重置
        }

        // 更新 UI
        function updateGitUI() {
            // 更新當前分支顯示
            const branchEl = document.getElementById('currentBranch');
            if (branchEl) {
                branchEl.textContent = gitRepo.currentBranch;
            }

            // 更新提交數量
            const commitCountEl = document.getElementById('commitCount');
            if (commitCountEl) {
                const commits = gitRepo.branches[gitRepo.currentBranch]?.commits || [];
                commitCountEl.textContent = commits.length;
            }

            // 更新未提交變更數量
            const changedFilesEl = document.getElementById('changedFiles');
            if (changedFilesEl) {
                changedFilesEl.textContent = gitRepo.workingDirectory.hasChanges ? '1' : '0';
            }

            // 更新分支列表
            updateBranchList();
            // 更新提交歷史
            updateCommitHistory();
            // 更新 PR 列表
            updatePullRequestList();
        }

        // Git 命令實現

        // git status
        function gitStatus() {
            const workingArea = document.getElementById('gitWorkingArea');
            let output = `$ git status\n\n`;
            output += `On branch ${gitRepo.currentBranch}\n`;

            if (gitRepo.workingDirectory.hasChanges) {
                output += `\nChanges not staged for commit:\n`;
                output += `  (use "git add <file>..." to update what will be committed)\n`;
                output += `  (use "git restore <file>..." to discard changes in working directory)\n\n`;
                output += `\t\x1b[31mmodified:   main.js\x1b[0m\n`;
                output += `\nno changes added to commit (use "git add" and/or "git commit -a")\n`;
            } else {
                output += `\nnothing to commit, working tree clean\n`;
            }

            printToTerminal(output);
        }

        // git commit
        async function showCommitDialog() {
            if (!gitRepo.workingDirectory.hasChanges) {
                printToTerminal('$ git commit\nnothing to commit, working tree clean');
                showNotification('沒有變更需要提交', 'error');
                return;
            }

            const message = await showPromptDialog(
                '提交代碼',
                '請輸入提交信息 (commit message):',
                'Update main.js'
            );

            if (message) {
                gitCommit(message);
            }
        }

        function gitCommit(message) {
            if (!gitRepo.workingDirectory.hasChanges) {
                return;
            }

            const workingArea = document.getElementById('gitWorkingArea');
            const content = workingArea.value;

            // 創建提交
            const commit = {
                hash: generateCommitHash(),
                message: message,
                author: 'Sam. T',
                date: new Date().toISOString(),
                content: content,
                branch: gitRepo.currentBranch
            };

            // 添加到當前分支
            if (!gitRepo.branches[gitRepo.currentBranch]) {
                gitRepo.branches[gitRepo.currentBranch] = { commits: [], files: {} };
            }
            gitRepo.branches[gitRepo.currentBranch].commits.unshift(commit);

            // 更新文件狀態
            gitRepo.branches[gitRepo.currentBranch].files['main.js'] = content;

            // 標記為已保存
            gitRepo.workingDirectory.lastSavedContent = content;
            gitRepo.workingDirectory.hasChanges = false;

            // 保存並更新 UI
            saveGitRepo();
            updateGitUI();

            // 輸出到終端
            printToTerminal(`$ git commit -m "${message}"\n[${gitRepo.currentBranch} ${commit.hash.substring(0, 7)}] ${message}\n 1 file changed`);
            showNotification('提交成功！', 'success');
        }

        // git branch
        async function showBranchDialog() {
            const branchName = await showPromptDialog(
                '創建新分支',
                '請輸入分支名稱:',
                'feature/new-feature'
            );

            if (branchName) {
                gitBranch(branchName);
            }
        }

        function gitBranch(branchName) {
            // 檢查分支是否已存在
            if (gitRepo.branches[branchName]) {
                printToTerminal(`$ git branch ${branchName}\nfatal: A branch named '${branchName}' already exists.`);
                showNotification('分支已存在', 'error');
                return;
            }

            // 從當前分支創建新分支（複製提交歷史和文件）
            gitRepo.branches[branchName] = {
                commits: [...(gitRepo.branches[gitRepo.currentBranch]?.commits || [])],
                files: {...(gitRepo.branches[gitRepo.currentBranch]?.files || {})}
            };

            saveGitRepo();
            updateGitUI();

            printToTerminal(`$ git branch ${branchName}\nCreated branch '${branchName}' from '${gitRepo.currentBranch}'`);
            showNotification(`分支 '${branchName}' 創建成功`, 'success');
        }

        // 切換分支
        function switchBranch(branchName) {
            if (gitRepo.workingDirectory.hasChanges) {
                showNotification('請先提交或放棄當前更改', 'error');
                printToTerminal(`$ git checkout ${branchName}\nerror: Your local changes to the following files would be overwritten by checkout:\n\tmain.js\nPlease commit your changes or stash them before you switch branches.`);
                return;
            }

            gitRepo.currentBranch = branchName;

            // 加載分支文件到工作區
            const workingArea = document.getElementById('gitWorkingArea');
            if (workingArea) {
                const branchFiles = gitRepo.branches[branchName]?.files || {};
                workingArea.value = branchFiles['main.js'] || '';
                gitRepo.workingDirectory.lastSavedContent = workingArea.value;
            }

            saveGitRepo();
            updateGitUI();

            printToTerminal(`$ git checkout ${branchName}\nSwitched to branch '${branchName}'`);
            showNotification(`已切換到分支 '${branchName}'`, 'success');
        }

        // git merge
        async function showMergeDialog() {
            const branches = Object.keys(gitRepo.branches).filter(b => b !== gitRepo.currentBranch);

            if (branches.length === 0) {
                showNotification('沒有其他分支可以合併', 'error');
                return;
            }

            const branchName = await showPromptDialog(
                '合併分支',
                `請輸入要合併到 ${gitRepo.currentBranch} 的分支名稱:\n可用分支: ${branches.join(', ')}`,
                branches[0]
            );

            if (branchName) {
                gitMerge(branchName);
            }
        }

        function gitMerge(sourceBranch) {
            if (!gitRepo.branches[sourceBranch]) {
                printToTerminal(`$ git merge ${sourceBranch}\nfatal: '${sourceBranch}' does not match any branch.`);
                showNotification('分支不存在', 'error');
                return;
            }

            if (sourceBranch === gitRepo.currentBranch) {
                printToTerminal(`$ git merge ${sourceBranch}\nAlready up to date.`);
                return;
            }

            // 簡化的合併：將源分支的提交添加到當前分支
            const sourceCommits = gitRepo.branches[sourceBranch].commits;
            const currentCommits = gitRepo.branches[gitRepo.currentBranch].commits;

            // 合併提交（簡化版本，實際 git 更複雜）
            const newCommits = sourceCommits.filter(sc =>
                !currentCommits.some(cc => cc.hash === sc.hash)
            );

            if (newCommits.length === 0) {
                printToTerminal(`$ git merge ${sourceBranch}\nAlready up to date.`);
                return;
            }

            // 添加新提交
            gitRepo.branches[gitRepo.currentBranch].commits = [
                ...newCommits,
                ...currentCommits
            ];

            // 合併文件（取源分支的最新版本）
            gitRepo.branches[gitRepo.currentBranch].files = {
                ...gitRepo.branches[gitRepo.currentBranch].files,
                ...gitRepo.branches[sourceBranch].files
            };

            // 創建合併提交
            const mergeCommit = {
                hash: generateCommitHash(),
                message: `Merge branch '${sourceBranch}' into ${gitRepo.currentBranch}`,
                author: 'Sam. T',
                date: new Date().toISOString(),
                content: '',
                branch: gitRepo.currentBranch,
                isMerge: true
            };

            gitRepo.branches[gitRepo.currentBranch].commits.unshift(mergeCommit);

            saveGitRepo();
            updateGitUI();

            printToTerminal(`$ git merge ${sourceBranch}\nMerge made by the 'ort' strategy.\n ${newCommits.length} commit(s) merged`);
            showNotification(`成功合併 '${sourceBranch}' 到 '${gitRepo.currentBranch}'`, 'success');
        }

        // git diff - 顯示文件變更差異
        function gitDiff() {
            const workingArea = document.getElementById('gitWorkingArea');
            const currentContent = workingArea ? workingArea.value : '';
            const lastSavedContent = gitRepo.workingDirectory.lastSavedContent || '';

            if (currentContent === lastSavedContent) {
                printToTerminal(`$ git diff\n(無變更)`);
                showNotification('沒有檔案變更', 'info');
                return;
            }

            // 生成簡化的 diff 輸出
            const oldLines = lastSavedContent.split('\n');
            const newLines = currentContent.split('\n');

            let diffOutput = `$ git diff\ndiff --git a/main.js b/main.js\nindex ${Math.random().toString(36).substring(7)}..${Math.random().toString(36).substring(7)} 100644\n--- a/main.js\n+++ b/main.js\n@@ -1,${oldLines.length} +1,${newLines.length} @@\n`;

            const maxLines = Math.max(oldLines.length, newLines.length);
            let changeCount = 0;

            for (let i = 0; i < Math.min(maxLines, 20); i++) {
                const oldLine = oldLines[i] || '';
                const newLine = newLines[i] || '';

                if (oldLine !== newLine) {
                    changeCount++;
                    if (oldLine) {
                        diffOutput += `-${oldLine}\n`;
                    }
                    if (newLine) {
                        diffOutput += `+${newLine}\n`;
                    }
                }
            }

            if (maxLines > 20) {
                diffOutput += `... (還有 ${maxLines - 20} 行未顯示)\n`;
            }

            printToTerminal(diffOutput);
            showNotification(`顯示 ${changeCount} 處變更`, 'success');
        }

        // git tag - 創建標籤
        async function showTagDialog() {
            const tagName = await showPromptDialog(
                '創建標籤',
                '請輸入標籤名稱（如 v1.0.0）:',
                'v1.0.0'
            );

            if (tagName) {
                gitTag(tagName);
            }
        }

        function gitTag(tagName) {
            // 檢查標籤是否已存在
            if (gitRepo.tags && gitRepo.tags[tagName]) {
                printToTerminal(`$ git tag ${tagName}\nfatal: tag '${tagName}' already exists`);
                showNotification('標籤已存在', 'error');
                return;
            }

            // 初始化 tags 對象（如果不存在）
            if (!gitRepo.tags) {
                gitRepo.tags = {};
            }

            // 獲取當前分支的最新提交
            const currentBranchCommits = gitRepo.branches[gitRepo.currentBranch]?.commits || [];
            const latestCommit = currentBranchCommits[currentBranchCommits.length - 1];

            if (!latestCommit) {
                printToTerminal(`$ git tag ${tagName}\nfatal: Failed to resolve 'HEAD' as a valid ref.`);
                showNotification('沒有提交可以標記', 'error');
                return;
            }

            // 創建標籤
            gitRepo.tags[tagName] = {
                commit: latestCommit.hash,
                message: latestCommit.message,
                date: new Date().toISOString(),
                branch: gitRepo.currentBranch
            };

            saveGitRepo();
            updateGitUI();

            printToTerminal(`$ git tag ${tagName}\nCreated tag '${tagName}' at ${latestCommit.hash.substring(0, 7)}\nMessage: ${latestCommit.message}`);
            showNotification(`標籤 '${tagName}' 創建成功`, 'success');
        }

        // git push
        function gitPush() {
            const currentBranch = gitRepo.currentBranch;
            const commits = gitRepo.branches[currentBranch]?.commits || [];

            if (commits.length === 0) {
                printToTerminal(`$ git push origin ${currentBranch}\nEverything up-to-date`);
                return;
            }

            // 模擬推送到遠程倉庫
            gitRepo.remoteRepo.branches[currentBranch] = {
                commits: [...commits],
                files: {...(gitRepo.branches[currentBranch]?.files || {})}
            };

            saveGitRepo();

            printToTerminal(`$ git push origin ${currentBranch}\nEnumerating objects: ${commits.length * 3}, done.\nCounting objects: 100% (${commits.length * 3}/${commits.length * 3}), done.\nWriting objects: 100% (${commits.length * 3}/${commits.length * 3}), ${Math.floor(Math.random() * 5000 + 1000)} bytes | ${Math.floor(Math.random() * 500 + 100)} KiB/s, done.\nTotal ${commits.length * 3} (delta ${Math.floor(commits.length / 2)}), reused 0 (delta 0)\nTo https://github.com/samt/repo.git\n   ${commits[1]?.hash.substring(0, 7) || '0000000'}..${commits[0].hash.substring(0, 7)}  ${currentBranch} -> ${currentBranch}`);
            showNotification('推送成功！', 'success');
        }

        // git pull
        function gitPull() {
            const currentBranch = gitRepo.currentBranch;
            const remoteBranch = gitRepo.remoteRepo.branches[currentBranch];

            if (!remoteBranch) {
                printToTerminal(`$ git pull origin ${currentBranch}\nThere is no tracking information for the current branch.`);
                return;
            }

            const remoteCommits = remoteBranch.commits || [];
            const localCommits = gitRepo.branches[currentBranch]?.commits || [];

            // 檢查是否有新提交
            const newCommits = remoteCommits.filter(rc =>
                !localCommits.some(lc => lc.hash === rc.hash)
            );

            if (newCommits.length === 0) {
                printToTerminal(`$ git pull origin ${currentBranch}\nAlready up to date.`);
                return;
            }

            // 拉取新提交
            gitRepo.branches[currentBranch].commits = [...remoteCommits];
            gitRepo.branches[currentBranch].files = {...remoteBranch.files};

            // 更新工作區
            const workingArea = document.getElementById('gitWorkingArea');
            if (workingArea) {
                workingArea.value = gitRepo.branches[currentBranch].files['main.js'] || '';
                gitRepo.workingDirectory.lastSavedContent = workingArea.value;
            }

            saveGitRepo();
            updateGitUI();

            printToTerminal(`$ git pull origin ${currentBranch}\nUpdating ${localCommits[0]?.hash.substring(0, 7) || '0000000'}..${remoteCommits[0].hash.substring(0, 7)}\nFast-forward\n ${newCommits.length} file(s) changed`);
            showNotification('拉取成功！', 'success');
        }

        // Pull Request
        async function showPullRequestDialog() {
            const branches = Object.keys(gitRepo.branches).filter(b => b !== 'main');

            if (branches.length === 0) {
                showNotification('請先創建功能分支', 'error');
                return;
            }

            if (gitRepo.currentBranch === 'main') {
                showNotification('請切換到功能分支後創建 PR', 'error');
                return;
            }

            const title = await showPromptDialog(
                '創建 Pull Request',
                'PR 標題:',
                `Merge ${gitRepo.currentBranch} into main`
            );

            if (title) {
                createPullRequest(title);
            }
        }

        function createPullRequest(title) {
            const pr = {
                id: gitRepo.pullRequests.length + 1,
                title: title,
                sourceBranch: gitRepo.currentBranch,
                targetBranch: 'main',
                author: 'Sam. T',
                createdAt: new Date().toISOString(),
                status: 'open',
                commits: gitRepo.branches[gitRepo.currentBranch]?.commits.length || 0
            };

            gitRepo.pullRequests.push(pr);
            saveGitRepo();
            updatePullRequestList();

            printToTerminal(`$ gh pr create --title "${title}"\nCreating pull request for ${gitRepo.currentBranch} into main\n\nhttps://github.com/samt/repo/pull/${pr.id}`);
            showNotification('Pull Request 創建成功！', 'success');
        }

        function mergePullRequest(prId) {
            const pr = gitRepo.pullRequests.find(p => p.id === prId);
            if (!pr) return;

            // 切換到目標分支
            gitRepo.currentBranch = pr.targetBranch;

            // 執行合併
            gitMerge(pr.sourceBranch);

            // 關閉 PR
            pr.status = 'merged';
            saveGitRepo();
            updatePullRequestList();

            printToTerminal(`$ gh pr merge ${prId}\n✓ Merged pull request #${prId}`);
            showNotification(`PR #${prId} 已合併`, 'success');
        }

        function closePullRequest(prId) {
            const pr = gitRepo.pullRequests.find(p => p.id === prId);
            if (!pr) return;

            pr.status = 'closed';
            saveGitRepo();
            updatePullRequestList();

            printToTerminal(`$ gh pr close ${prId}\n✓ Closed pull request #${prId}`);
            showNotification(`PR #${prId} 已關閉`, 'success');
        }

        // 更新分支列表 UI
        function updateBranchList() {
            const listEl = document.getElementById('gitBranchList');
            if (!listEl) return;

            const branches = Object.keys(gitRepo.branches);
            if (branches.length === 0) return;

            listEl.innerHTML = branches.map(branch => {
                const isCurrent = branch === gitRepo.currentBranch;
                return `
                    <div onclick="switchBranch('${branch}')" style="padding: 12px 16px; background: ${isCurrent ? 'rgba(0, 217, 255, 0.1)' : 'transparent'}; border-left: 4px solid ${isCurrent ? 'var(--primary)' : 'transparent'}; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(0, 217, 255, 0.05)'" onmouseout="this.style.background='${isCurrent ? 'rgba(0, 217, 255, 0.1)' : 'transparent'}'">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas ${isCurrent ? 'fa-check' : 'fa-code-branch'}" style="color: ${isCurrent ? 'var(--primary)' : 'var(--text-gray)'};"></i>
                            <span style="font-weight: ${isCurrent ? '600' : '400'}; color: ${isCurrent ? 'var(--primary)' : 'var(--text)'};">${branch}</span>
                            ${isCurrent ? '<span style="font-size: 12px; color: var(--text-gray); margin-left: auto;">（當前分支）</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 更新提交歷史 UI
        function updateCommitHistory() {
            const historyEl = document.getElementById('gitCommitHistory');
            if (!historyEl) return;

            const commits = gitRepo.branches[gitRepo.currentBranch]?.commits || [];

            if (commits.length === 0) {
                historyEl.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                        <p>還沒有提交記錄</p>
                        <p style="font-size: 13px; margin-top: 8px;">修改代碼後執行 git commit 來創建第一個提交</p>
                    </div>
                `;
                return;
            }

            historyEl.innerHTML = commits.map((commit, index) => {
                const date = new Date(commit.date);
                return `
                    <div style="padding: 16px; background: ${index === 0 ? 'rgba(0, 217, 255, 0.05)' : 'transparent'}; border-left: 4px solid ${commit.isMerge ? '#a371f7' : 'var(--primary)'}; border-radius: 8px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: start; gap: 12px;">
                            <i class="fas ${commit.isMerge ? 'fa-code-merge' : 'fa-circle'}" style="color: ${commit.isMerge ? '#a371f7' : 'var(--primary)'}; font-size: 12px; margin-top: 4px;"></i>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--text); margin-bottom: 6px;">${commit.message}</div>
                                <div style="font-size: 12px; color: var(--text-gray); font-family: 'Fira Code', monospace;">
                                    ${commit.hash.substring(0, 7)} • ${commit.author} • ${date.toLocaleString('zh-TW')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 更新 PR 列表 UI
        function updatePullRequestList() {
            const listEl = document.getElementById('pullRequestList');
            if (!listEl) return;

            const openPRs = gitRepo.pullRequests.filter(pr => pr.status === 'open');
            const closedPRs = gitRepo.pullRequests.filter(pr => pr.status !== 'open');

            if (gitRepo.pullRequests.length === 0) {
                listEl.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fab fa-github" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                        <p>沒有活動的 Pull Request</p>
                        <p style="font-size: 13px; margin-top: 8px;">創建分支並發起 Pull Request 來協作開發</p>
                    </div>
                `;
                return;
            }

            let html = '';

            if (openPRs.length > 0) {
                html += '<h4 style="color: var(--primary); margin-bottom: 16px; font-size: 14px;"><i class="fas fa-circle" style="color: var(--success);"></i> Open</h4>';
                html += openPRs.map(pr => {
                    const date = new Date(pr.createdAt);
                    return `
                        <div style="padding: 20px; background: rgba(0, 217, 255, 0.05); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: start; justify-content: space-between; margin-bottom: 12px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--text); font-size: 16px; margin-bottom: 8px;">
                                        #${pr.id} ${pr.title}
                                    </div>
                                    <div style="font-size: 13px; color: var(--text-gray);">
                                        <span style="color: var(--primary);">${pr.author}</span> wants to merge
                                        <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: #a371f7;">${pr.sourceBranch}</code>
                                        into
                                        <code style="background: var(--darker-bg); padding: 2px 8px; border-radius: 4px; color: var(--primary);">${pr.targetBranch}</code>
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-gray); margin-top: 6px;">
                                        <i class="fas fa-clock"></i> ${date.toLocaleString('zh-TW')} • ${pr.commits} commits
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="mergePullRequest(${pr.id})" class="btn" style="padding: 8px 16px; font-size: 13px; background: linear-gradient(135deg, var(--success), var(--primary));">
                                    <i class="fas fa-code-merge"></i> Merge
                                </button>
                                <button onclick="closePullRequest(${pr.id})" class="btn btn-outline" style="padding: 8px 16px; font-size: 13px;">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            if (closedPRs.length > 0) {
                html += '<h4 style="color: var(--text-gray); margin: 24px 0 16px 0; font-size: 14px;"><i class="fas fa-check"></i> Closed</h4>';
                html += closedPRs.map(pr => {
                    const date = new Date(pr.createdAt);
                    const statusColor = pr.status === 'merged' ? 'var(--github-purple)' : 'var(--error)';
                    const statusIcon = pr.status === 'merged' ? 'fa-code-merge' : 'fa-times';
                    return `
                        <div style="padding: 16px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; opacity: 0.7;">
                            <div style="font-weight: 600; color: var(--text-gray); font-size: 14px; margin-bottom: 6px;">
                                <i class="fas ${statusIcon}" style="color: ${statusColor};"></i>
                                #${pr.id} ${pr.title}
                            </div>
                            <div style="font-size: 12px; color: var(--text-gray);">
                                ${pr.status === 'merged' ? 'Merged' : 'Closed'} • ${date.toLocaleDateString('zh-TW')}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            listEl.innerHTML = html;
        }

        // 輔助功能

        function addNewFile() {
            showNotification('功能開發中：多文件支持即將推出', 'error');
        }

        function simulateChange() {
            const workingArea = document.getElementById('gitWorkingArea');
            if (workingArea) {
                const changes = [
                    '\n// 添���新功能\nfunction newFeature() {\n    return "New feature";\n}',
                    '\n// 修復 bug\nfunction bugFix() {\n    console.log("Bug fixed");\n}',
                    '\n// 重構代碼\nfunction refactor() {\n    // 優化性能\n}',
                    '\n// 添加註釋\n/* 這是一個重要的函數 */'
                ];
                const randomChange = changes[Math.floor(Math.random() * changes.length)];
                workingArea.value += randomChange;
                gitRepo.workingDirectory.hasChanges = true;
                updateGitUI();
                showNotification('代碼已修改', 'success');
            }
        }

        function clearGitTerminal() {
            const terminal = document.getElementById('gitTerminal');
            if (terminal) {
                terminal.textContent = '$ 等待 Git 命令...';
            }
        }

        // GitHub侧边栏折叠功能
        function toggleGitSidebar() {
            // 檢查是否為移動設備 (max-width: 768px)
            if (window.matchMedia('(max-width: 768px)').matches) {
                // 在移動設備上，側邊欄始終展開，不執行折疊操作
                return;
            }

            const sidebar = document.getElementById('gitSidebar');
            const icon = document.getElementById('gitSidebarToggleIcon');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
                if (icon) {
                    if (sidebar.classList.contains('collapsed')) {
                        icon.className = 'fas fa-chevron-right';
                    } else {
                        icon.className = 'fas fa-chevron-left';
                    }
                }
            }
        }

        // API模拟器侧边栏折叠功能
        function toggleApiSidebar() {
            const sidebar = document.getElementById('apiSidebar');
            const icon = document.getElementById('apiSidebarToggleIcon');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
                if (icon) {
                    if (sidebar.classList.contains('collapsed')) {
                        icon.className = 'fas fa-chevron-right';
                    } else {
                        icon.className = 'fas fa-chevron-left';
                    }
                }
            }
        }

        function printToTerminal(text) {
            const terminal = document.getElementById('gitTerminal');
            if (terminal) {
                terminal.textContent = text;
                terminal.scrollTop = terminal.scrollHeight;
            }
        }

        function generateCommitHash() {
            return Array.from({length: 40}, () =>
                Math.floor(Math.random() * 16).toString(16)
            ).join('');
        }

        async function showCloneDialog() {
            printToTerminal(`$ git clone https://github.com/samt/repo.git\nCloning into 'repo'...\nremote: Enumerating objects: 100, done.\nremote: Counting objects: 100% (100/100), done.\nremote: Compressing objects: 100% (80/80), done.\nremote: Total 100 (delta 20), reused 100 (delta 20), pack-reused 0\nReceiving objects: 100% (100/100), 50.00 KiB | 500.00 KiB/s, done.\nResolving deltas: 100% (20/20), done.`);
            showNotification('倉庫克隆完成（模擬）', 'success');
        }

        async function showForkDialog() {
            printToTerminal(`$ gh repo fork samt/repo --clone\n✓ Created fork yourname/repo\n✓ Cloned fork`);
            showNotification('倉庫已 Fork（模擬）', 'success');
        }

        // ==========================================
        // 專業 IDE 功能增強
        // ==========================================

        // 行號自動更新
        function updateLineNumbers() {
            const editor = document.getElementById('freeCodeEditor');
            const lineNumbersDiv = document.getElementById('lineNumbers');
            if (!editor || !lineNumbersDiv) return;

            const lines = editor.value.split('\n');
            const lineCount = lines.length;
            let lineNumbersHTML = '';
            for (let i = 1; i <= lineCount; i++) {
                lineNumbersHTML += `<div style="height: 20.8px; color: ${i === getCurrentLine() ? 'var(--primary)' : 'inherit'};">${i}</div>`;
            }
            lineNumbersDiv.innerHTML = lineNumbersHTML;
        }

        // 獲取當前光標所在行
        function getCurrentLine() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return 1;
            const cursorPos = editor.selectionStart;
            const textBeforeCursor = editor.value.substring(0, cursorPos);
            return textBeforeCursor.split('\n').length;
        }

        // 獲取當前光標所在列
        function getCurrentColumn() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor) return 1;
            const cursorPos = editor.selectionStart;
            const textBeforeCursor = editor.value.substring(0, cursorPos);
            const lines = textBeforeCursor.split('\n');
            return lines[lines.length - 1].length + 1;
        }

        // 更新狀態欄的游標位置
        function updateCursorPosition() {
            const lineSpan = document.getElementById('statusLine');
            const columnSpan = document.getElementById('statusColumn');
            if (lineSpan) lineSpan.textContent = getCurrentLine();
            if (columnSpan) columnSpan.textContent = getCurrentColumn();
        }

        // 更新選中信息
        function updateSelectionInfo() {
            const editor = document.getElementById('freeCodeEditor');
            const selectionInfo = document.getElementById('selectionInfo');
            const selectedCount = document.getElementById('selectedCount');
            if (!editor || !selectionInfo || !selectedCount) return;

            const selectionLength = editor.selectionEnd - editor.selectionStart;
            if (selectionLength > 0) {
                selectedCount.textContent = selectionLength;
                selectionInfo.style.display = 'inline';
            } else {
                selectionInfo.style.display = 'none';
            }
        }

        // 切換小地圖
        let minimapVisible = false;
        function toggleMinimap() {
            const minimap = document.getElementById('minimap');
            if (!minimap) return;
            minimapVisible = !minimapVisible;
            minimap.style.display = minimapVisible ? 'block' : 'none';
            if (minimapVisible) {
                updateMinimap();
            }
        }

        // 更新小地圖
        function updateMinimap() {
            const editor = document.getElementById('freeCodeEditor');
            const canvas = document.getElementById('minimapCanvas');
            if (!editor || !canvas || !minimapVisible) return;

            const ctx = canvas.getContext('2d');
            const lines = editor.value.split('\n');
            const canvasHeight = canvas.height = lines.length * 2;
            canvas.width = 120;

            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 繪製代碼內容（簡化版）
            ctx.fillStyle = '#4ec9b0';
            lines.forEach((line, index) => {
                const width = Math.min(line.length * 0.8, 100);
                if (line.trim().length > 0) {
                    ctx.fillRect(10, index * 2, width, 1.5);
                }
            });
        }

        // Git 分支菜單
        function showGitBranchMenu() {
            const branches = ['main', 'develop', 'feature/new-ui', 'hotfix/bug-123'];
            const currentBranch = document.getElementById('statusGitBranch').textContent;

            const menu = `
                <div style="position: fixed; bottom: 40px; left: 12px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 8px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.5); z-index: 10000; min-width: 200px;">
                    <div style="padding: 8px 16px; color: var(--text-gray); font-size: 11px; text-transform: uppercase; font-weight: 600;">切換 Git 分支</div>
                    ${branches.map(branch => `
                        <button onclick="switchGitBranch('${branch}'); this.closest('div').remove();" style="width: 100%; padding: 10px 16px; background: transparent; border: none; color: var(--text); text-align: left; cursor: pointer; font-family: 'Fira Code', monospace; font-size: 12px; display: flex; align-items: center; gap: 8px; transition: all 0.2s;" onmouseover="this.style.background='var(--hover-bg)'" onmouseout="this.style.background='transparent'">
                            ${branch === currentBranch ? '<i class="fas fa-check" style="color: var(--primary);"></i>' : '<span style="width: 14px;"></span>'}
                            <span>${branch}</span>
                        </button>
                    `).join('')}
                </div>
            `;

            // 移除已存在的菜單
            const existing = document.querySelector('[data-git-branch-menu]');
            if (existing) existing.remove();

            const div = document.createElement('div');
            div.setAttribute('data-git-branch-menu', 'true');
            div.innerHTML = menu;
            document.body.appendChild(div);

            // 點擊外部關閉
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!div.contains(e.target)) {
                        div.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }

        function switchGitBranch(branchName) {
            document.getElementById('statusGitBranch').textContent = branchName;
            showNotification(`已切換到分支: ${branchName}`, 'success');
        }

        // 問題面板切換
        function toggleProblemsPanel() {
            showNotification('問題面板功能即將推出', 'info');
        }

        // 語言選擇器
        function showLanguageSelector() {
            const languages = [
                { id: 'javascript', name: 'JavaScript', icon: 'fab fa-js' },
                { id: 'typescript', name: 'TypeScript', icon: 'fab fa-js' },
                { id: 'python', name: 'Python', icon: 'fab fa-python' },
                { id: 'java', name: 'Java', icon: 'fab fa-java' },
                { id: 'html', name: 'HTML', icon: 'fab fa-html5' },
                { id: 'css', name: 'CSS', icon: 'fab fa-css3-alt' },
                { id: 'php', name: 'PHP', icon: 'fab fa-php' },
                { id: 'json', name: 'JSON', icon: 'fas fa-code' }
            ];

            const menu = `
                <div class="optimized-scroll" style="position: fixed; bottom: 40px; right: 12px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 8px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.5); z-index: 10000; min-width: 220px; max-height: 400px;">
                    <div style="padding: 8px 16px; color: var(--text-gray); font-size: 11px; text-transform: uppercase; font-weight: 600;">選擇語言模式</div>
                    ${languages.map(lang => `
                        <button onclick="setLanguageMode('${lang.id}', '${lang.name}'); this.closest('div').remove();" style="width: 100%; padding: 10px 16px; background: transparent; border: none; color: var(--text); text-align: left; cursor: pointer; font-family: 'Fira Code', monospace; font-size: 12px; display: flex; align-items: center; gap: 12px; transition: all 0.2s;" onmouseover="this.style.background='var(--hover-bg)'" onmouseout="this.style.background='transparent'">
                            <i class="${lang.icon}" style="width: 20px; color: var(--primary);"></i>
                            <span>${lang.name}</span>
                        </button>
                    `).join('')}
                </div>
            `;

            const existing = document.querySelector('[data-lang-menu]');
            if (existing) existing.remove();

            const div = document.createElement('div');
            div.setAttribute('data-lang-menu', 'true');
            div.innerHTML = menu;
            document.body.appendChild(div);

            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!div.contains(e.target)) {
                        div.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }

        function setLanguageMode(langId, langName) {
            const statusLanguage = document.getElementById('statusLanguage');
            if (statusLanguage) {
                statusLanguage.textContent = langName;
            }
            showNotification(`���言模式已切換為: ${langName}`, 'success');
        }

        // 命令面板（Ctrl+Shift+P）
        function showCommandPalette() {
            const commands = [
                { name: '運行代碼', icon: 'fa-play', action: () => document.getElementById('runCodeBtn')?.click() },
                { name: '格式化代碼', icon: 'fa-align-left', action: () => formatCode() },
                { name: '搜索代碼', icon: 'fa-search', action: () => toggleSearchPanel() },
                { name: '切換小地圖', icon: 'fa-map', action: () => toggleMinimap() },
                { name: '顯示/隱藏模板', icon: 'fa-eye', action: () => toggleTemplateCode() },
                { name: '切換主題', icon: 'fa-palette', action: () => showThemeSelector() },
                { name: '前往指定行', icon: 'fa-arrow-right', action: () => goToLine() }
            ];

            const modal = document.createElement('div');
            modal.id = 'commandPaletteModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: flex-start;
                justify-content: center;
                padding-top: 100px;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); border: 1px solid var(--primary); border-radius: 12px; width: 600px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
                    <input type="text" id="commandPaletteInput" placeholder="輸入命令..." style="width: 100%; padding: 16px 20px; background: var(--darker-bg); border: none; border-bottom: 1px solid var(--border); color: var(--text); font-size: 16px; outline: none; border-radius: 12px 12px 0 0; font-family: 'Fira Code', monospace;">
                    <div id="commandPaletteList" class="optimized-scroll" style="max-height: 400px;">
                        ${commands.map((cmd, index) => `
                            <button data-cmd-index="${index}" style="width: 100%; padding: 14px 20px; background: transparent; border: none; color: var(--text); text-align: left; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 12px; transition: all 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05);" onmouseover="this.style.background='var(--hover-bg)'" onmouseout="this.style.background='transparent'">
                                <i class="fas ${cmd.icon}" style="width: 20px; color: var(--primary);"></i>
                                <span>${cmd.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            document.getElementById('commandPaletteInput').focus();

            // 處理命令點擊
            document.getElementById('commandPaletteList').addEventListener('click', (e) => {
                const btn = e.target.closest('[data-cmd-index]');
                if (btn) {
                    const index = parseInt(btn.dataset.cmdIndex);
                    commands[index].action();
                    modal.remove();
                }
            });

            // ESC 關閉
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            // 搜索過濾
            document.getElementById('commandPaletteInput').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const buttons = document.querySelectorAll('[data-cmd-index]');
                buttons.forEach((btn, index) => {
                    const cmdName = commands[index].name.toLowerCase();
                    btn.style.display = cmdName.includes(query) ? 'flex' : 'none';
                });
            });
        }

        // 前往指定行
        function goToLine() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); border: 1px solid var(--primary); border-radius: 12px; width: 400px; max-width: 90%; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-arrow-right"></i> 前往指定行
                    </h3>
                    <input type="number" id="gotoLineInput" min="1" placeholder="輸入行號..." style="width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 16px; font-family: 'Fira Code', monospace; margin-bottom: 20px;">
                    <div style="display: flex; gap: 12px;">
                        <button id="gotoLineConfirm" style="flex: 1; padding: 12px; background: var(--primary); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            前往
                        </button>
                        <button id="gotoLineCancel" style="flex: 1; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer; transition: all 0.3s;">
                            取消
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            const input = document.getElementById('gotoLineInput');
            input.focus();

            function doGoto() {
                const lineNumber = input.value;
                if (lineNumber) {
                    const editor = document.getElementById('freeCodeEditor');
                    if (!editor) return;
                    const lines = editor.value.split('\n');
                    const line = Math.min(Math.max(1, parseInt(lineNumber)), lines.length);

                    // 計算光標位置
                    let position = 0;
                    for (let i = 0; i < line - 1; i++) {
                        position += lines[i].length + 1; // +1 for newline
                    }

                    editor.setSelectionRange(position, position);
                    editor.focus();
                    updateCursorPosition();
                    showNotification(`已跳轉到第 ${line} 行`, 'success');
                }
                modal.remove();
            }

            document.getElementById('gotoLineConfirm').addEventListener('click', doGoto);
            document.getElementById('gotoLineCancel').addEventListener('click', () => modal.remove());
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') doGoto();
                if (e.key === 'Escape') modal.remove();
            });
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // 主題選擇器
        function showThemeSelector() {
            const themes = [
                { id: 'vscode-dark', name: 'VS Code Dark+ (當前)', colors: { primary: '#4ec9b0', secondary: '#569cd6' } },
                { id: 'monokai', name: 'Monokai Pro', colors: { primary: '#a9dc76', secondary: '#fc9867' } },
                { id: 'dracula', name: 'Dracula', colors: { primary: '#50fa7b', secondary: '#ff79c6' } },
                { id: 'github-dark', name: 'GitHub Dark', colors: { primary: '#7ee787', secondary: '#58a6ff' } },
                { id: 'one-dark', name: 'One Dark Pro', colors: { primary: '#98c379', secondary: '#61afef' } }
            ];

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); border: 1px solid var(--primary); border-radius: 12px; width: 500px; max-width: 90%; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-palette"></i> 選擇編輯器主題
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${themes.map((theme, index) => `
                            <button onclick="applyTheme('${theme.id}', '${theme.colors.primary}', '${theme.colors.secondary}'); this.closest('div').closest('div').closest('div').remove();" style="padding: 16px 20px; background: var(--darker-bg); border: ${index === 0 ? '2px solid var(--primary)' : '1px solid var(--border)'}; border-radius: 8px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.background='var(--hover-bg)'" onmouseout="this.style.background='var(--darker-bg)'">
                                <div style="display: flex; gap: 6px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${theme.colors.primary};"></div>
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${theme.colors.secondary};"></div>
                                </div>
                                <span style="font-family: 'Fira Code', monospace;">${theme.name}</span>
                            </button>
                        `).join('')}
                    </div>
                    <button onclick="this.closest('div').closest('div').remove();" style="margin-top: 20px; width: 100%; padding: 12px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer; transition: all 0.3s;">
                        取消
                    </button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function applyTheme(themeId, primaryColor, secondaryColor) {
            document.documentElement.style.setProperty('--primary', primaryColor);
            document.documentElement.style.setProperty('--secondary', secondaryColor);
            showNotification(`已應用主題`, 'success');
        }

        // 快捷鍵支持
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+P: 命令面板
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                showCommandPalette();
            }

            // Ctrl+G: 前往指定行
            if (e.ctrlKey && e.key === 'g') {
                e.preventDefault();
                goToLine();
            }

            // Ctrl+K Ctrl+T: 主題選擇
            if (e.ctrlKey && e.key === 'k') {
                window.__waitingForThemeShortcut = true;
                setTimeout(() => { window.__waitingForThemeShortcut = false; }, 1000);
            }
            if (window.__waitingForThemeShortcut && e.ctrlKey && e.key === 't') {
                e.preventDefault();
                showThemeSelector();
                window.__waitingForThemeShortcut = false;
            }
        });

        // 監聽編輯器輸入
        const editor = document.getElementById('freeCodeEditor');
        if (editor) {
            editor.addEventListener('input', () => {
                updateLineNumbers();
                updateMinimap();
            });

            editor.addEventListener('keyup', updateCursorPosition);
            editor.addEventListener('click', updateCursorPosition);
            editor.addEventListener('select', () => {
                updateSelectionInfo();
                updateCursorPosition();
            });

            // 初始化
            updateLineNumbers();
            updateCursorPosition();
        }

        // ==========================================
        // 🎯 一站式平台功能：傳送到模擬器
        // ==========================================

        // 傳送代碼到 API 模擬器（全局函數）
        window.sendToAPISimulator = function() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor || !editor.value.trim()) {
                showNotification('⚠️ 請先輸入代碼再傳送', 'warning');
                return;
            }

            const code = editor.value;

            // 顯示傳送動畫
            showTransferAnimation('API 模擬器');

            setTimeout(() => {
                // 自動檢測代碼類型
                const isBackendCode = code.includes('app.') || code.includes('router.') || code.includes('express') ||
                                     code.includes('req.body') || code.includes('res.json') || code.includes('mongoose');

                const isFrontendCode = code.includes('fetch(') || code.includes('axios') || code.includes('$.ajax') ||
                                      code.includes('XMLHttpRequest') || code.includes('/api/');

                // 切換到 API 模擬器頁面
                showPage('apiSimulatorPage');

                // 根據代碼類型載入到對應編輯器
                if (isFrontendCode) {
                    const frontendEditor = document.getElementById('frontendCodeEditor');
                    if (frontendEditor) {
                        frontendEditor.value = code;
                        showNotification('✅ 前端代碼已傳送到 API 模擬器！', 'success');

                        // 自動執行
                        setTimeout(() => {
                            const executeBtn = document.getElementById('executeFrontendBtn');
                            if (executeBtn) {
                                showNotification('🚀 自動執行代碼中...', 'info');
                                executeBtn.click();
                            }
                        }, 800);
                    }
                } else if (isBackendCode) {
                    showNotification('✅ 後端代碼已識別！在此平台中，後端邏輯已自動模擬，您可以直接測試前端 API 調用。', 'success');
                } else {
                    // 默認作為前端代碼處理
                    const frontendEditor = document.getElementById('frontendCodeEditor');
                    if (frontendEditor) {
                        frontendEditor.value = code;
                        showNotification('✅ 代碼已傳送到 API 模擬器（前端區域）', 'success');
                    }
                }
            }, 1000);
        };

        // 傳送代碼到 GitHub 模擬器（全局函數）
        window.sendToGitHub = function() {
            const editor = document.getElementById('freeCodeEditor');
            if (!editor || !editor.value.trim()) {
                showNotification('⚠️ 請先輸入代碼再傳送', 'warning');
                return;
            }

            const code = editor.value;

            // 顯示傳送動畫
            showTransferAnimation('GitHub 模擬器');

            setTimeout(() => {
                // 切換到 GitHub 模擬器頁面
                showPage('githubPage');

                // 載入代碼到工作區
                const workingArea = document.getElementById('gitWorkingArea');
                if (workingArea) {
                    workingArea.value = code;
                    gitRepo.workingDirectory.hasChanges = true;
                    updateGitUI();
                    showNotification('✅ 代碼已傳送到 GitHub 模擬器工作區！', 'success');

                    // 自動執行 git status
                    setTimeout(() => {
                        showNotification('💡 提示：代碼已載入，您可以開始使用 Git 命令（git status, git commit 等）', 'info');
                        gitStatus();
                    }, 800);
                }
            }, 1000);
        };

        // 顯示傳送動畫（全局函數）
        window.showTransferAnimation = function(targetName) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.85);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeInAnim 0.3s ease-out;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); border: 2px solid var(--primary); border-radius: 16px; padding: 40px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.8); animation: slideUpAnim 0.5s ease-out;">
                    <div style="font-size: 64px; margin-bottom: 20px; animation: bounceAnim 1s infinite;">
                        📤
                    </div>
                    <h3 style="color: var(--primary); font-size: 1.5rem; margin-bottom: 10px;">
                        正在傳送代碼
                    </h3>
                    <p style="color: var(--text-gray); font-size: 1rem;">
                        目標：${targetName}
                    </p>
                    <div style="margin-top: 20px; width: 200px; height: 4px; background: var(--darker-bg); border-radius: 2px; overflow: hidden;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); animation: progressAnim 1s ease-out;"></div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // 1秒後自���移除
            setTimeout(() => {
                modal.style.animation = 'fadeOutAnim 0.3s ease-out';
                setTimeout(() => modal.remove(), 300);
            }, 1000);
        };

        // ==========================================
        // 🎯 HTTP 請求流程可視化
        // ==========================================

        // 顯示 HTTP 請求流程動畫（全局函數）
        window.visualizeHTTPRequest = function(method, endpoint, status) {
            // 更新請求日誌
            const logContainer = document.getElementById('requestLogContainer');
            if (logContainer) {
                const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
                const logEntry = document.createElement('div');
                logEntry.style.cssText = 'margin-bottom: 8px; padding: 8px; background: rgba(78, 201, 176, 0.1); border-left: 3px solid #10b981; border-radius: 4px;';

                logEntry.innerHTML = `
                    <div style="color: #10b981; font-weight: bold;">[${timestamp}] ${method} ${endpoint}</div>
                    <div style="color: var(--text-gray); font-size: 11px; margin-top: 4px;">
                        ✓ 請求已在平台內部處理（無需實際網絡連接）
                    </div>
                    <div style="color: #10b981; font-size: 11px; margin-top: 4px;">
                        → 狀態: ${status} | 響應時間: ${Math.floor(Math.random() * 50 + 10)}ms
                    </div>
                `;

                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            // 播放步驟動畫
            animateRequestFlow();
        };

        // 動畫化請求流程步驟（全局函數）
        window.animateRequestFlow = function() {
            const steps = ['step1Indicator', 'step2Indicator', 'step3Indicator', 'step4Indicator', 'step5Indicator'];
            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#10b981'];

            steps.forEach((stepId, index) => {
                setTimeout(() => {
                    const step = document.getElementById(stepId);
                    if (step) {
                        // 高亮當前步驟
                        step.style.borderColor = colors[index];
                        step.style.background = `rgba(${hexToRgb(colors[index])}, 0.2)`;
                        step.style.transform = 'scale(1.1)';

                        // 恢復之前的步驟
                        if (index > 0) {
                            const prevStep = document.getElementById(steps[index - 1]);
                            if (prevStep) {
                                prevStep.style.transform = 'scale(1)';
                                prevStep.style.borderColor = 'transparent';
                                prevStep.style.background = 'var(--card-bg)';
                            }
                        }

                        // 最後一步完成後重置
                        if (index === steps.length - 1) {
                            setTimeout(() => {
                                step.style.transform = 'scale(1)';
                                step.style.borderColor = 'transparent';
                                step.style.background = 'var(--card-bg)';
                            }, 500);
                        }
                    }
                }, index * 300);
            });
        };

        // 輔助函數：將 hex 顏色轉換為 rgb（全局函數）
        window.hexToRgb = function(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ?
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` :
                '78, 201, 176';
        };

        // ==========================================
        // 快速開始示範功能
        // ==========================================

        // 🎯 顯示數據流可視化動畫
        function showDataFlowVisualization(step, status) {
            const flowPanel = document.getElementById('dataFlowVisualization');
            if (!flowPanel) return;

            // 顯示面板
            flowPanel.style.display = 'block';

            const arrow1 = document.getElementById('dataFlowArrow1');
            const arrow2 = document.getElementById('dataFlowArrow2');
            const label1 = document.getElementById('dataFlowLabel1');
            const label2 = document.getElementById('dataFlowLabel2');

            // 根據步驟高亮不同的箭頭
            if (step === 'frontend' || step === 'connection') {
                if (arrow1) {
                    arrow1.style.background = 'linear-gradient(90deg, var(--primary), var(--primary))';
                    arrow1.style.animation = 'flowPulse 1s ease-in-out infinite';
                }
                if (label1) {
                    label1.style.color = 'var(--primary)';
                    label1.style.fontWeight = 'bold';
                }
            }

            if (step === 'backend' || step === 'database') {
                if (arrow2) {
                    arrow2.style.background = 'linear-gradient(90deg, var(--secondary), var(--secondary))';
                    arrow2.style.animation = 'flowPulse 1s ease-in-out infinite';
                }
                if (label2) {
                    label2.style.color = 'var(--secondary)';
                    label2.style.fontWeight = 'bold';
                }
            }

            // 成功時移除動畫
            if (status === 'success') {
                setTimeout(() => {
                    if (arrow1) {
                        arrow1.style.animation = 'none';
                        arrow1.style.background = 'linear-gradient(90deg, transparent, var(--primary))';
                    }
                    if (arrow2) {
                        arrow2.style.animation = 'none';
                        arrow2.style.background = 'linear-gradient(90deg, transparent, var(--secondary))';
                    }
                    if (label1) {
                        label1.style.fontWeight = 'normal';
                    }
                    if (label2) {
                        label2.style.fontWeight = 'normal';
                    }
                }, 1000);
            }
        }

        // 🎯 HTTP 請求生命周期動畫函數
        function animateLifecycleStep(stepNumber, statusText) {
            return new Promise((resolve) => {
                const stepEl = document.getElementById(`lifecycle-step-${stepNumber}`);
                if (!stepEl) {
                    resolve();
                    return;
                }

                // 高亮當前步驟
                stepEl.style.opacity = '1';
                stepEl.style.borderLeftColor = '#3b82f6';
                stepEl.style.background = 'rgba(59, 130, 246, 0.1)';

                const indicator = stepEl.querySelector('.step-indicator');
                if (indicator) {
                    indicator.style.background = '#3b82f6';
                    indicator.style.boxShadow = '0 0 15px rgba(59, 130, 246, 0.5)';
                }

                // 延遲後標記為完成
                setTimeout(() => {
                    stepEl.style.borderLeftColor = '#10b981';
                    stepEl.style.background = 'rgba(16, 185, 129, 0.05)';

                    if (indicator) {
                        indicator.style.background = '#10b981';
                        indicator.style.boxShadow = 'none';
                    }

                    const checkIcon = stepEl.querySelector('.fa-check-circle');
                    if (checkIcon) {
                        checkIcon.style.display = 'block';
                        checkIcon.style.color = '#10b981';
                    }

                    resolve();
                }, 200); // 每步200ms
            });
        }

        // 🎯 重置生命周期步驟
        function resetLifecycleSteps() {
            for (let i = 1; i <= 7; i++) {
                const stepEl = document.getElementById(`lifecycle-step-${i}`);
                if (stepEl) {
                    stepEl.style.opacity = '0.5';
                    stepEl.style.borderLeftColor = '#6b7280';
                    stepEl.style.background = 'var(--card-bg)';

                    const indicator = stepEl.querySelector('.step-indicator');
                    if (indicator) {
                        indicator.style.background = '#6b7280';
                        indicator.style.boxShadow = 'none';
                    }

                    const checkIcon = stepEl.querySelector('.fa-check-circle');
                    if (checkIcon) {
                        checkIcon.style.display = 'none';
                    }
                }
            }
        }

        // 🎯 開發階段切換函數
        function showDevStage(stageNumber) {
            // 隱藏所有階段面板
            document.querySelectorAll('.dev-stage-panel').forEach(panel => {
                panel.style.display = 'none';
            });

            // 顯示選中的階段
            const targetPanel = document.getElementById(`dev-stage-${stageNumber}`);
            if (targetPanel) {
                targetPanel.style.display = 'block';
            }

            // 更新按鈕樣式
            document.querySelectorAll('.dev-stage-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'transparent';
                btn.style.borderColor = 'var(--border)';
                btn.style.color = 'var(--text-gray)';
            });

            const activeBtn = document.querySelector(`[data-stage="${stageNumber}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = 'rgba(59, 130, 246, 0.2)';
                activeBtn.style.borderColor = '#3b82f6';
                activeBtn.style.color = '#3b82f6';
            }

            // 顯示切換通知
            showNotification(`✅ 已切換到第${stageNumber}階段`, 'success');
        }

        // 🎯 工具模擬器函數
        function showToolSimulator(toolType) {
            const toolConfigs = {
                vscode: {
                    name: 'VS Code',
                    icon: 'fas fa-code',
                    color: '#007acc',
                    description: '功能強大的代碼編輯器，支援多種程式語言和豐富的插件生態系統。',
                    features: [
                        '✓ IntelliSense 智能代碼補全',
                        '✓ 內建Git版本控制',
                        '✓ 豐富的插件市場',
                        '✓ 調試工具',
                        '✓ 終端機集成'
                    ],
                    action: '前端和後端代碼編輯器已在平台中集成',
                    link: 'frontendCodeEditor'
                },
                postman: {
                    name: 'Postman',
                    icon: 'fas fa-vial',
                    color: '#ff6c37',
                    description: 'API開發和測試的完整平台，支援自動化測試、集合管理和協作功能。',
                    features: [
                        '✓ API端點測試',
                        '✓ 請求集合管理',
                        '✓ 環境變數配置',
                        '✓ 自動化測試腳本',
                        '✓ API文檔生成'
                    ],
                    action: 'API模擬器已集成完整的API測試功能',
                    link: 'apiSimulatorSection'
                },
                docker: {
                    name: 'Docker',
                    icon: 'fab fa-docker',
                    color: '#2496ed',
                    description: '容器化平台，提供一致的開發、測試和部署環境。',
                    features: [
                        '✓ 應用容器化',
                        '✓ 快速部署',
                        '✓ 環境隔離',
                        '✓ 資源優化',
                        '✓ 跨平台支援'
                    ],
                    action: '本平台純瀏覽器運行，無需Docker安裝',
                    link: null
                },
                swagger: {
                    name: 'Swagger UI',
                    icon: 'fas fa-book',
                    color: '#85ea2d',
                    description: 'API文檔和測試工具，自動生成互動式API文檔。',
                    features: [
                        '✓ 自動生成API文檔',
                        '✓ 互動式測試界面',
                        '✓ OpenAPI規範支援',
                        '✓ API端點可視化',
                        '✓ 請求/響應範例'
                    ],
                    action: 'API模擬器提供完整的API文檔和測試功能',
                    link: 'apiSimulatorSection'
                }
            };

            const config = toolConfigs[toolType];
            if (!config) {
                showNotification('❌ 未知的工具類型', 'error');
                return;
            }

            // 創建模擬器彈窗
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;

            modal.innerHTML = `
                <div style="background: var(--card-bg); border-radius: 16px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); animation: slideUp 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid var(--border);">
                        <div style="width: 50px; height: 50px; border-radius: 12px; background: ${config.color}; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white;">
                            <i class="${config.icon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="color: var(--text); margin: 0; font-size: 1.5rem;">${config.name}</h3>
                            <p style="color: var(--text-gray); margin: 5px 0 0 0; font-size: 0.9rem;">開發工具模擬器</p>
                        </div>
                        <button onclick="this.closest('div').closest('div').closest('div').remove();" style="width: 36px; height: 36px; border-radius: 50%; background: var(--darker-bg); border: 1px solid var(--border); color: var(--text-gray); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--text); margin-bottom: 10px; font-size: 1.1rem;">
                            <i class="fas fa-info-circle"></i> 工具簡介
                        </h4>
                        <p style="color: var(--text-gray); line-height: 1.7; font-size: 0.95rem;">
                            ${config.description}
                        </p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--text); margin-bottom: 15px; font-size: 1.1rem;">
                            <i class="fas fa-star"></i> 主要功能
                        </h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${config.features.map(feature => `
                                <div style="padding: 10px 15px; background: var(--darker-bg); border-radius: 8px; border-left: 3px solid ${config.color}; color: var(--text-gray); font-size: 0.9rem;">
                                    ${feature}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="padding: 15px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); border-radius: 10px; margin-bottom: 20px;">
                        <div style="color: var(--text); font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-lightbulb" style="color: #f59e0b;"></i>
                            平台整合說明
                        </div>
                        <p style="color: var(--text-gray); margin: 0; font-size: 0.9rem; line-height: 1.6;">
                            ${config.action}
                        </p>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        ${config.link ? `
                            <button onclick="document.getElementById('${config.link}').scrollIntoView({behavior: 'smooth'}); this.closest('div').closest('div').closest('div').remove();" style="flex: 1; padding: 12px 20px; background: ${config.color}; border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-arrow-right"></i>
                                前往功能區
                            </button>
                        ` : ''}
                        <button onclick="this.closest('div').closest('div').closest('div').remove();" style="flex: 1; padding: 12px 20px; background: var(--darker-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            關閉
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // 點擊背景關閉
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            // 顯示通知
            showNotification(`🚀 已啟動 ${config.name} 模擬器`, 'info');
        }

        // API 模擬器快速開始
        // 更新前後端連結狀態指示器
        function updateConnectionStatus(step, status) {
            const statusMap = {
                frontend: { element: 'frontendStatus', text: 'frontendStatusText' },
                connection: { element: 'connectionStatus', text: 'connectionStatusText' },
                backend: { element: 'backendStatus', text: 'backendStatusText' },
                database: { element: 'databaseStatus', text: 'databaseStatusText' }
            };

            const config = statusMap[step];
            if (!config) return;

            const element = document.getElementById(config.element);
            const textElement = document.getElementById(config.text);

            if (!element || !textElement) return;

            // 🎯 顯示數據流可視化
            if (status === 'processing' || status === 'success') {
                showDataFlowVisualization(step, status);
            }

            // 重置所有狀態
            if (status === 'reset') {
                element.style.border = '2px solid var(--border)';
                element.style.background = 'var(--card-bg)';
                textElement.style.color = 'var(--text-gray)';

                const defaultTexts = {
                    frontend: '等待代碼執行...',
                    connection: '未連結',
                    backend: '等待請求...',
                    database: '未連接'
                };
                textElement.textContent = defaultTexts[step] || '';
                return;
            }

            // 更新狀態
            if (status === 'processing') {
                element.style.border = '2px solid #f59e0b';
                element.style.background = 'rgba(245, 158, 11, 0.1)';
                textElement.style.color = '#f59e0b';

                const processingTexts = {
                    frontend: '正在執行代碼...',
                    connection: '正在建立連結...',
                    backend: '正在處理請求...',
                    database: '正在讀寫數據...'
                };
                textElement.textContent = processingTexts[step] || '';
            } else if (status === 'success') {
                element.style.border = '2px solid #10b981';
                element.style.background = 'rgba(16, 185, 129, 0.1)';
                textElement.style.color = '#10b981';

                const successTexts = {
                    frontend: '✓ 代碼執行成功',
                    connection: '✓ 已連結',
                    backend: '✓ 處理完成',
                    database: '✓ 數據已更新'
                };
                textElement.textContent = successTexts[step] || '';
            } else if (status === 'error') {
                element.style.border = '2px solid #ef4444';
                element.style.background = 'rgba(239, 68, 68, 0.1)';
                textElement.style.color = '#ef4444';
                textElement.textContent = '✗ 錯誤';
            }
        }

        // 一鍵測試前後端整合
        async function testFullStackIntegration() {
            showNotification('⚡ 開始自動測試前後端整合...', 'info');

            // 重置所有狀態
            ['frontend', 'connection', 'backend', 'database'].forEach(s => updateConnectionStatus(s, 'reset'));

            await new Promise(r => setTimeout(r, 500));

            // 步驟1: 載入示例代碼
            updateConnectionStatus('frontend', 'processing');
            showNotification('📝 步驟 1/4: 正在載入示例代碼...', 'info');

            const selector = document.getElementById('frontendExample');
            if (selector) {
                selector.value = 'user_auth';
                selector.dispatchEvent(new Event('change'));
            }

            await new Promise(r => setTimeout(r, 800));
            updateConnectionStatus('frontend', 'success');
            showNotification('✅ 步驟 1/4: 示例代碼已載入', 'success');

            await new Promise(r => setTimeout(r, 500));

            // 步驟2: 建立連結並發送請求
            updateConnectionStatus('connection', 'processing');
            updateConnectionStatus('backend', 'processing');
            showNotification('🔗 步驟 2/4: 正在發送 API 請求到後端...', 'info');

            const executeBtn = document.getElementById('executeFrontendBtn');
            if (executeBtn) {
                executeBtn.click();
            }

            await new Promise(r => setTimeout(r, 1200));
            updateConnectionStatus('connection', 'success');
            updateConnectionStatus('backend', 'success');
            showNotification('✅ 步驟 2/4: 前後端已成功連結，API 請求已處理', 'success');

            await new Promise(r => setTimeout(r, 500));

            // 步驟3: 驗證數據庫
            updateConnectionStatus('database', 'processing');
            showNotification('💾 步驟 3/4: 正在驗證數據庫操作...', 'info');

            const viewUsersBtn = document.getElementById('viewUsersBtn');
            if (viewUsersBtn) {
                viewUsersBtn.click();
            }

            await new Promise(r => setTimeout(r, 1000));
            updateConnectionStatus('database', 'success');
            showNotification('✅ 步驟 3/4: 數據庫操作驗證成功', 'success');

            await new Promise(r => setTimeout(r, 500));

            // 步驟4: 完成
            showNotification('🎉 步驟 4/4: 前後端整合測試完成！\n\n✓ 前端代碼執行正常\n✓ API 請求成功發送\n✓ 後端處理並返回響應\n✓ 數據成功存入數據庫\n\n所有模塊已成功連結！', 'success');
        }

        // 清空所有API模擬器數據
        async function clearAllAPISimulatorData() {
            const confirmed = await showConfirmDialog(
                '確定要清空所有數據嗎？',
                '這將清空數據庫（users、games、players表）、重置 API 請求日誌、重置統計數據、清空代碼編輯器。此操作無法撤銷！'
            );

            if (!confirmed) {
                return;
            }

            try {
                // 清空數據庫
                SimulatedDB.clearAll();

                // 清空API日誌
                state.apiSimulator.logs = [];
                state.apiSimulator.requestCount = 0;
                state.apiSimulator.successCount = 0;

                // 清空編輯器
                const frontendCode = document.getElementById('frontendCode');
                const backendResponse = document.getElementById('backendResponse');
                const dbOutput = document.getElementById('dbOutput');

                if (frontendCode) frontendCode.value = '// 在此輸入前端代碼\n// 或從下方選擇示例代碼\n';
                if (backendResponse) backendResponse.textContent = '// 等待前端代碼執行後，後端響應將在此顯示\n// 點擊「執行前端代碼」按鈕開始測試';
                if (dbOutput) dbOutput.textContent = '// 點擊上方按鈕查看數據庫內容\n';

                // 重置統計
                updateAPIStats();
                updateAPILogs();

                // 重置狀態指示器
                ['frontend', 'connection', 'backend', 'database'].forEach(s => updateConnectionStatus(s, 'reset'));

                showNotification('✅ 所有數據已清空，系統已重置！', 'success');
            } catch (error) {
                showNotification('❌ 清空數據時發生錯誤: ' + error.message, 'error');
            }
        }

        function loadQuickStartExample() {
            showNotification('🚀 正在載入完整 API 示範...', 'info');

            setTimeout(() => {
                // 1. 選擇用戶認證示例
                const selector = document.getElementById('frontendExample');
                if (selector) {
                    selector.value = 'user_auth';
                    // 觸發 change 事件以載入代碼
                    selector.dispatchEvent(new Event('change'));
                }

                showNotification('✅ 步驟1: 已載入用戶認證示例代碼', 'success');

                // 2. 延遲執行代碼
                setTimeout(() => {
                    const executeBtn = document.getElementById('executeFrontendBtn');
                    if (executeBtn) {
                        executeBtn.click();
                    }
                    showNotification('✅ 步驟2: 正在執行前端代碼並發送 API 請求...', 'success');

                    // 3. 延遲顯示數據庫
                    setTimeout(() => {
                        const viewUsersBtn = document.getElementById('viewUsersBtn');
                        if (viewUsersBtn) {
                            viewUsersBtn.click();
                        }
                        showNotification('✅ 步驟3: 已顯示數據庫內���！', 'success');

                        // 4. 最終提示
                        setTimeout(() => {
                            showNotification('🎉 API 示範完成！請查看：\n1️⃣ 右側後端響應\n2️⃣ 下方數據庫內容\n3️⃣ API 請求日誌', 'success');
                        }, 1000);
                    }, 1500);
                }, 1000);
            }, 500);
        }

        // GitHub 快速開始
        function githubQuickStart() {
            showNotification('🚀 正在開始 Git 工作流程示範...', 'info');

            setTimeout(() => {
                // 1. 模擬代碼修改
                const workingArea = document.getElementById('gitWorkingArea');
                if (workingArea) {
                    workingArea.value = `// 新增的登錄功能\nfunction login(username, password) {\n    console.log("用���登錄:", username);\n    return true;\n}`;
                    gitRepo.workingDirectory.hasChanges = true;
                    updateGitUI();
                }
                showNotification('✅ 步驟1: 已修改代碼', 'success');

                // 2. git status
                setTimeout(() => {
                    gitStatus();
                    showNotification('✅ 步驟2: 查看倉庫狀態（有未提交更改）', 'success');

                    // 3. git commit
                    setTimeout(() => {
                        gitCommit('feat: 新增用戶登錄功能');
                        showNotification('✅ 步驟3: 已提交代碼到本地倉庫', 'success');

                        // 4. 創建新分支
                        setTimeout(() => {
                            gitBranch('feature/login');
                            showNotification('✅ 步驟4: 已創建新分支 feature/login', 'success');

                            // 5. git push
                            setTimeout(() => {
                                gitPush();
                                showNotification('✅ 步驟5: 已推送到遠程倉庫（GitHub）', 'success');

                                // 6. 創建 PR
                                setTimeout(() => {
                                    createPullRequest('新增登錄功能', 'feature/login', 'main', '實現了基本的用戶登錄功能，包括用戶名和密碼驗證。');
                                    showNotification('🎉 步驟6: 已創建 Pull Request！\n\n完整的 Git 工作流程示範完成！\n\n請查看：\n1️⃣ Git 終端輸出\n2️⃣ 提交歷史\n3️⃣ 分支列表\n4️⃣ Pull Request 列表', 'success');
                                }, 1500);
                            }, 1500);
                        }, 1500);
                    }, 1500);
                }, 1000);
            }, 500);
        }

        // 在頁面加載完成後初始化 API 模擬器和 Git 模擬器
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initAPISimulator();
                initGitRepo();
                updateLineNumbers();
                updateCursorPosition();

                // 顯示歡迎提示
                setTimeout(() => {
                    showNotification('💡 按 Ctrl+Shift+P 打開命令面板', 'info');
                }, 2000);
            }, 500);
        });
    </script>

    <style>
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* API 模擬器頁面的響應式設計 */
        @media (max-width: 768px) {
            #apiSimulatorPage .container > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            #apiSimulatorPage textarea {
                height: 250px !important;
            }
        }
    </style>













</body></html>